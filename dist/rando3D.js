require=function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e){!function(){"use strict";$(document).ready(function(){document.formationGuide=new FormationGuide(config)})}()},{"modules/cameras/bird-camera":void 0,"modules/cameras/camera-computer":void 0,"modules/cameras/camera-container":void 0,"modules/cameras/examine-camera":void 0,"modules/cameras/hiker-camera":void 0,"modules/dem":void 0,"modules/events":void 0,"modules/poi":void 0,"modules/scene":void 0,"modules/settings":void 0,"modules/tile-container":void 0,"modules/trek":void 0,"modules/utils":void 0}],BezierPlugin:[function(e,t){(function(i){var n="undefined"!=typeof t&&t.exports&&"undefined"!=typeof i?i:this||window;(n._gsQueue||(n._gsQueue=[])).push(function(){"use strict";var e=180/Math.PI,t=[],i=[],r=[],o={},s=n._gsDefine.globals,a=function(e,t,i,n){this.a=e,this.b=t,this.c=i,this.d=n,this.da=n-e,this.ca=i-e,this.ba=t-e},h=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",c=function(e,t,i,n){var r={a:e},o={},s={},a={c:n},h=(e+t)/2,c=(t+i)/2,u=(i+n)/2,l=(h+c)/2,f=(c+u)/2,p=(f-l)/8;return r.b=h+(e-h)/4,o.b=l+p,r.c=o.a=(r.b+o.b)/2,o.c=s.a=(l+f)/2,s.b=f-p,a.b=u+(n-u)/4,s.c=a.a=(s.b+a.b)/2,[r,o,s,a]},u=function(e,n,o,s,a){var h,u,l,f,p,d,m,g,_,v,y,x,b,T=e.length-1,w=0,M=e[0].a;for(h=0;T>h;h++)p=e[w],u=p.a,l=p.d,f=e[w+1].d,a?(y=t[h],x=i[h],b=(x+y)*n*.25/(s?.5:r[h]||.5),d=l-(l-u)*(s?.5*n:0!==y?b/y:0),m=l+(f-l)*(s?.5*n:0!==x?b/x:0),g=l-(d+((m-d)*(3*y/(y+x)+.5)/4||0))):(d=l-(l-u)*n*.5,m=l+(f-l)*n*.5,g=l-(d+m)/2),d+=g,m+=g,p.c=_=d,p.b=0!==h?M:M=p.a+.6*(p.c-p.a),p.da=l-u,p.ca=_-u,p.ba=M-u,o?(v=c(u,M,_,l),e.splice(w,1,v[0],v[1],v[2],v[3]),w+=4):w++,M=m;p=e[w],p.b=M,p.c=M+.4*(p.d-M),p.da=p.d-p.a,p.ca=p.c-p.a,p.ba=M-p.a,o&&(v=c(p.a,M,p.c,p.d),e.splice(w,1,v[0],v[1],v[2],v[3]))},l=function(e,n,r,o){var s,h,c,u,l,f,p=[];if(o)for(e=[o].concat(e),h=e.length;--h>-1;)"string"==typeof(f=e[h][n])&&"="===f.charAt(1)&&(e[h][n]=o[n]+Number(f.charAt(0)+f.substr(2)));if(s=e.length-2,0>s)return p[0]=new a(e[0][n],0,0,e[-1>s?0:1][n]),p;for(h=0;s>h;h++)c=e[h][n],u=e[h+1][n],p[h]=new a(c,0,0,u),r&&(l=e[h+2][n],t[h]=(t[h]||0)+(u-c)*(u-c),i[h]=(i[h]||0)+(l-u)*(l-u));return p[h]=new a(e[h][n],0,0,e[h+1][n]),p},f=function(e,n,s,a,c,f){var p,d,m,g,_,v,y,x,b={},T=[],w=f||e[0];c="string"==typeof c?","+c+",":h,null==n&&(n=1);for(d in e[0])T.push(d);if(e.length>1){for(x=e[e.length-1],y=!0,p=T.length;--p>-1;)if(d=T[p],Math.abs(w[d]-x[d])>.05){y=!1;break}y&&(e=e.concat(),f&&e.unshift(f),e.push(e[1]),f=e[e.length-3])}for(t.length=i.length=r.length=0,p=T.length;--p>-1;)d=T[p],o[d]=-1!==c.indexOf(","+d+","),b[d]=l(e,d,o[d],f);for(p=t.length;--p>-1;)t[p]=Math.sqrt(t[p]),i[p]=Math.sqrt(i[p]);if(!a){for(p=T.length;--p>-1;)if(o[d])for(m=b[T[p]],v=m.length-1,g=0;v>g;g++)_=m[g+1].da/i[g]+m[g].da/t[g],r[g]=(r[g]||0)+_*_;for(p=r.length;--p>-1;)r[p]=Math.sqrt(r[p])}for(p=T.length,g=s?4:1;--p>-1;)d=T[p],m=b[d],u(m,n,s,a,o[d]),y&&(m.splice(0,g),m.splice(m.length-g,g));return b},p=function(e,t,i){t=t||"soft";var n,r,o,s,h,c,u,l,f,p,d,m={},g="cubic"===t?3:2,_="soft"===t,v=[];if(_&&i&&(e=[i].concat(e)),null==e||e.length<g+1)throw"invalid Bezier data";for(f in e[0])v.push(f);for(c=v.length;--c>-1;){for(f=v[c],m[f]=h=[],p=0,l=e.length,u=0;l>u;u++)n=null==i?e[u][f]:"string"==typeof(d=e[u][f])&&"="===d.charAt(1)?i[f]+Number(d.charAt(0)+d.substr(2)):Number(d),_&&u>1&&l-1>u&&(h[p++]=(n+h[p-2])/2),h[p++]=n;for(l=p-g+1,p=0,u=0;l>u;u+=g)n=h[u],r=h[u+1],o=h[u+2],s=2===g?0:h[u+3],h[p++]=d=3===g?new a(n,r,o,s):new a(n,(2*r+n)/3,(2*r+o)/3,o);h.length=p}return m},d=function(e,t,i){for(var n,r,o,s,a,h,c,u,l,f,p,d=1/i,m=e.length;--m>-1;)for(f=e[m],o=f.a,s=f.d-o,a=f.c-o,h=f.b-o,n=r=0,u=1;i>=u;u++)c=d*u,l=1-c,n=r-(r=(c*c*s+3*l*(c*a+l*h))*c),p=m*i+u-1,t[p]=(t[p]||0)+n*n},m=function(e,t){t=t>>0||6;var i,n,r,o,s=[],a=[],h=0,c=0,u=t-1,l=[],f=[];for(i in e)d(e[i],s,t);for(r=s.length,n=0;r>n;n++)h+=Math.sqrt(s[n]),o=n%t,f[o]=h,o===u&&(c+=h,o=n/t>>0,l[o]=f,a[o]=c,h=0,f=[]);return{length:c,lengths:a,segments:l}},g=n._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.4",API:2,global:!0,init:function(e,t,i){this._target=e,t instanceof Array&&(t={values:t}),this._func={},this._round={},this._props=[],this._timeRes=null==t.timeResolution?6:parseInt(t.timeResolution,10);var n,r,o,s,a,h=t.values||[],c={},u=h[0],l=t.autoRotate||i.vars.orientToBezier;this._autoRotate=l?l instanceof Array?l:[["x","y","rotation",l===!0?0:Number(l)||0]]:null;for(n in u)this._props.push(n);for(o=this._props.length;--o>-1;)n=this._props[o],this._overwriteProps.push(n),r=this._func[n]="function"==typeof e[n],c[n]=r?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]():parseFloat(e[n]),a||c[n]!==h[0][n]&&(a=c);if(this._beziers="cubic"!==t.type&&"quadratic"!==t.type&&"soft"!==t.type?f(h,isNaN(t.curviness)?1:t.curviness,!1,"thruBasic"===t.type,t.correlate,a):p(h,t.type,c),this._segCount=this._beziers[n].length,this._timeRes){var d=m(this._beziers,this._timeRes);this._length=d.length,this._lengths=d.lengths,this._segments=d.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(l=this._autoRotate)for(this._initialRotations=[],l[0]instanceof Array||(this._autoRotate=l=[l]),o=l.length;--o>-1;){for(s=0;3>s;s++)n=l[o][s],this._func[n]="function"==typeof e[n]?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]:!1;n=l[o][2],this._initialRotations[o]=this._func[n]?this._func[n].call(this._target):this._target[n]}return this._startRatio=i.vars.runBackwards?1:0,!0},set:function(t){var i,n,r,o,s,a,h,c,u,l,f=this._segCount,p=this._func,d=this._target,m=t!==this._startRatio;if(this._timeRes){if(u=this._lengths,l=this._curSeg,t*=this._length,r=this._li,t>this._l2&&f-1>r){for(c=f-1;c>r&&(this._l2=u[++r])<=t;);this._l1=u[r-1],this._li=r,this._curSeg=l=this._segments[r],this._s2=l[this._s1=this._si=0]}else if(t<this._l1&&r>0){for(;r>0&&(this._l1=u[--r])>=t;);0===r&&t<this._l1?this._l1=0:r++,this._l2=u[r],this._li=r,this._curSeg=l=this._segments[r],this._s1=l[(this._si=l.length-1)-1]||0,this._s2=l[this._si]}if(i=r,t-=this._l1,r=this._si,t>this._s2&&r<l.length-1){for(c=l.length-1;c>r&&(this._s2=l[++r])<=t;);this._s1=l[r-1],this._si=r}else if(t<this._s1&&r>0){for(;r>0&&(this._s1=l[--r])>=t;);0===r&&t<this._s1?this._s1=0:r++,this._s2=l[r],this._si=r}a=(r+(t-this._s1)/(this._s2-this._s1))*this._prec}else i=0>t?0:t>=1?f-1:f*t>>0,a=(t-i*(1/f))*f;for(n=1-a,r=this._props.length;--r>-1;)o=this._props[r],s=this._beziers[o][i],h=(a*a*s.da+3*n*(a*s.ca+n*s.ba))*a+s.a,this._round[o]&&(h=Math.round(h)),p[o]?d[o](h):d[o]=h;if(this._autoRotate){var g,_,v,y,x,b,T,w=this._autoRotate;for(r=w.length;--r>-1;)o=w[r][2],b=w[r][3]||0,T=w[r][4]===!0?1:e,s=this._beziers[w[r][0]],g=this._beziers[w[r][1]],s&&g&&(s=s[i],g=g[i],_=s.a+(s.b-s.a)*a,y=s.b+(s.c-s.b)*a,_+=(y-_)*a,y+=(s.c+(s.d-s.c)*a-y)*a,v=g.a+(g.b-g.a)*a,x=g.b+(g.c-g.b)*a,v+=(x-v)*a,x+=(g.c+(g.d-g.c)*a-x)*a,h=m?Math.atan2(x-v,y-_)*T+b:this._initialRotations[r],p[o]?d[o](h):d[o]=h)}}}),_=g.prototype;g.bezierThrough=f,g.cubicToQuadratic=c,g._autoCSS=!0,g.quadraticToCubic=function(e,t,i){return new a(e,(2*t+e)/3,(2*t+i)/3,i)},g._cssRegister=function(){var e=s.CSSPlugin;if(e){var t=e._internals,i=t._parseToProxy,n=t._setPluginRatio,r=t.CSSPropTween;t._registerComplexSpecialProp("bezier",{parser:function(e,t,o,s,a,h){t instanceof Array&&(t={values:t}),h=new g;var c,u,l,f=t.values,p=f.length-1,d=[],m={};if(0>p)return a;for(c=0;p>=c;c++)l=i(e,f[c],s,a,h,p!==c),d[c]=l.end;for(u in t)m[u]=t[u];return m.values=d,a=new r(e,"bezier",0,0,l.pt,2),a.data=l,a.plugin=h,a.setRatio=n,0===m.autoRotate&&(m.autoRotate=!0),!m.autoRotate||m.autoRotate instanceof Array||(c=m.autoRotate===!0?0:Number(m.autoRotate),m.autoRotate=null!=l.end.left?[["left","top","rotation",c,!1]]:null!=l.end.x?[["x","y","rotation",c,!1]]:!1),m.autoRotate&&(s._transform||s._enableTransforms(!1),l.autoRotate=s._target._gsTransform),h._onInitTween(l.proxy,m,s._tween),a}})}},_._roundProps=function(e,t){for(var i=this._overwriteProps,n=i.length;--n>-1;)(e[i[n]]||e.bezier||e.bezierThrough)&&(this._round[i[n]]=t)},_._kill=function(e){var t,i,n=this._props;for(t in this._beziers)if(t in e)for(delete this._beziers[t],delete this._func[t],i=n.length;--i>-1;)n[i]===t&&n.splice(i,1);return this._super._kill.call(this,e)}}),n._gsDefine&&n._gsQueue.pop()(),function(i){"use strict";var r=function(){return(n.GreenSockGlobals||n)[i]};"function"==typeof define&&define.amd?define(["TweenLite"],r):"undefined"!=typeof t&&t.exports&&(e("../TweenLite.js"),t.exports=r())}("BezierPlugin")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../TweenLite.js":"TweenLite"}],DirectionalRotationPlugin:[function(e,t){(function(e){var i="undefined"!=typeof t&&t.exports&&"undefined"!=typeof e?e:this||window;(i._gsQueue||(i._gsQueue=[])).push(function(){"use strict";i._gsDefine.plugin({propName:"directionalRotation",version:"0.2.1",API:2,init:function(e,t){"object"!=typeof t&&(t={rotation:t}),this.finals={};var i,n,r,o,s,a,h=t.useRadians===!0?2*Math.PI:360,c=1e-6;for(i in t)"useRadians"!==i&&(a=(t[i]+"").split("_"),n=a[0],r=parseFloat("function"!=typeof e[i]?e[i]:e[i.indexOf("set")||"function"!=typeof e["get"+i.substr(3)]?i:"get"+i.substr(3)]()),o=this.finals[i]="string"==typeof n&&"="===n.charAt(1)?r+parseInt(n.charAt(0)+"1",10)*Number(n.substr(2)):Number(n)||0,s=o-r,a.length&&(n=a.join("_"),-1!==n.indexOf("short")&&(s%=h,s!==s%(h/2)&&(s=0>s?s+h:s-h)),-1!==n.indexOf("_cw")&&0>s?s=(s+9999999999*h)%h-(s/h|0)*h:-1!==n.indexOf("ccw")&&s>0&&(s=(s-9999999999*h)%h-(s/h|0)*h)),(s>c||-c>s)&&(this._addTween(e,i,r,r+s,i),this._overwriteProps.push(i)));return!0},set:function(e){var t;if(1!==e)this._super.setRatio.call(this,e);else for(t=this._firstPT;t;)t.f?t.t[t.p](this.finals[t.p]):t.t[t.p]=this.finals[t.p],t=t._next}})._autoCSS=!0}),i._gsDefine&&i._gsQueue.pop()()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],EasePack:[function(e,t){(function(e){var i="undefined"!=typeof t&&t.exports&&"undefined"!=typeof e?e:this||window;(i._gsQueue||(i._gsQueue=[])).push(function(){"use strict";i._gsDefine("easing.Back",["easing.Ease"],function(e){var t,n,r,o=i.GreenSockGlobals||i,s=o.com.greensock,a=2*Math.PI,h=Math.PI/2,c=s._class,u=function(t,i){var n=c("easing."+t,function(){},!0),r=n.prototype=new e;return r.constructor=n,r.getRatio=i,n},l=e.register||function(){},f=function(e,t,i,n){var r=c("easing."+e,{easeOut:new t,easeIn:new i,easeInOut:new n},!0);return l(r,e),r},p=function(e,t,i){this.t=e,this.v=t,i&&(this.next=i,i.prev=this,this.c=i.v-t,this.gap=i.t-e)},d=function(t,i){var n=c("easing."+t,function(e){this._p1=e||0===e?e:1.70158,this._p2=1.525*this._p1},!0),r=n.prototype=new e;return r.constructor=n,r.getRatio=i,r.config=function(e){return new n(e)},n},m=f("Back",d("BackOut",function(e){return(e-=1)*e*((this._p1+1)*e+this._p1)+1}),d("BackIn",function(e){return e*e*((this._p1+1)*e-this._p1)}),d("BackInOut",function(e){return(e*=2)<1?.5*e*e*((this._p2+1)*e-this._p2):.5*((e-=2)*e*((this._p2+1)*e+this._p2)+2)})),g=c("easing.SlowMo",function(e,t,i){t=t||0===t?t:.7,null==e?e=.7:e>1&&(e=1),this._p=1!==e?t:0,this._p1=(1-e)/2,this._p2=e,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),_=g.prototype=new e;return _.constructor=g,_.getRatio=function(e){var t=e+(.5-e)*this._p;return e<this._p1?this._calcEnd?1-(e=1-e/this._p1)*e:t-(e=1-e/this._p1)*e*e*e*t:e>this._p3?this._calcEnd?1-(e=(e-this._p3)/this._p1)*e:t+(e-t)*(e=(e-this._p3)/this._p1)*e*e*e:this._calcEnd?1:t},g.ease=new g(.7,.7),_.config=g.config=function(e,t,i){return new g(e,t,i)},t=c("easing.SteppedEase",function(e){e=e||1,this._p1=1/e,this._p2=e+1},!0),_=t.prototype=new e,_.constructor=t,_.getRatio=function(e){return 0>e?e=0:e>=1&&(e=.999999999),(this._p2*e>>0)*this._p1},_.config=t.config=function(e){return new t(e)},n=c("easing.RoughEase",function(t){t=t||{};for(var i,n,r,o,s,a,h=t.taper||"none",c=[],u=0,l=0|(t.points||20),f=l,d=t.randomize!==!1,m=t.clamp===!0,g=t.template instanceof e?t.template:null,_="number"==typeof t.strength?.4*t.strength:.4;--f>-1;)i=d?Math.random():1/l*f,n=g?g.getRatio(i):i,"none"===h?r=_:"out"===h?(o=1-i,r=o*o*_):"in"===h?r=i*i*_:.5>i?(o=2*i,r=o*o*.5*_):(o=2*(1-i),r=o*o*.5*_),d?n+=Math.random()*r-.5*r:f%2?n+=.5*r:n-=.5*r,m&&(n>1?n=1:0>n&&(n=0)),c[u++]={x:i,y:n};for(c.sort(function(e,t){return e.x-t.x}),a=new p(1,1,null),f=l;--f>-1;)s=c[f],a=new p(s.x,s.y,a);this._prev=new p(0,0,0!==a.t?a:a.next)},!0),_=n.prototype=new e,_.constructor=n,_.getRatio=function(e){var t=this._prev;if(e>t.t){for(;t.next&&e>=t.t;)t=t.next;t=t.prev}else for(;t.prev&&e<=t.t;)t=t.prev;return this._prev=t,t.v+(e-t.t)/t.gap*t.c},_.config=function(e){return new n(e)},n.ease=new n,f("Bounce",u("BounceOut",function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}),u("BounceIn",function(e){return(e=1-e)<1/2.75?1-7.5625*e*e:2/2.75>e?1-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?1-(7.5625*(e-=2.25/2.75)*e+.9375):1-(7.5625*(e-=2.625/2.75)*e+.984375)}),u("BounceInOut",function(e){var t=.5>e;return e=t?1-2*e:2*e-1,e=1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5})),f("Circ",u("CircOut",function(e){return Math.sqrt(1-(e-=1)*e)}),u("CircIn",function(e){return-(Math.sqrt(1-e*e)-1)}),u("CircInOut",function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)})),r=function(t,i,n){var r=c("easing."+t,function(e,t){this._p1=e>=1?e:1,this._p2=(t||n)/(1>e?e:1),this._p3=this._p2/a*(Math.asin(1/this._p1)||0),this._p2=a/this._p2},!0),o=r.prototype=new e;return o.constructor=r,o.getRatio=i,o.config=function(e,t){return new r(e,t)},r},f("Elastic",r("ElasticOut",function(e){return this._p1*Math.pow(2,-10*e)*Math.sin((e-this._p3)*this._p2)+1},.3),r("ElasticIn",function(e){return-(this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*this._p2))},.3),r("ElasticInOut",function(e){return(e*=2)<1?-.5*this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*this._p2):this._p1*Math.pow(2,-10*(e-=1))*Math.sin((e-this._p3)*this._p2)*.5+1},.45)),f("Expo",u("ExpoOut",function(e){return 1-Math.pow(2,-10*e)}),u("ExpoIn",function(e){return Math.pow(2,10*(e-1))-.001}),u("ExpoInOut",function(e){return(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))})),f("Sine",u("SineOut",function(e){return Math.sin(e*h)}),u("SineIn",function(e){return-Math.cos(e*h)+1}),u("SineInOut",function(e){return-.5*(Math.cos(Math.PI*e)-1)})),c("easing.EaseLookup",{find:function(t){return e.map[t]}},!0),l(o.SlowMo,"SlowMo","ease,"),l(n,"RoughEase","ease,"),l(t,"SteppedEase","ease,"),m},!0)}),i._gsDefine&&i._gsQueue.pop()()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],TimelineLite:[function(e,t){(function(i){var n="undefined"!=typeof t&&t.exports&&"undefined"!=typeof i?i:this||window;(n._gsQueue||(n._gsQueue=[])).push(function(){"use strict";n._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,i){var r=function(e){t.call(this,e),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,n,r=this.vars;for(n in r)i=r[n],c(i)&&-1!==i.join("").indexOf("{self}")&&(r[n]=this._swapSelfInParams(i));c(r.tweens)&&this.add(r.tweens,0,r.align,r.stagger)},o=1e-10,s=i._internals,a=r._internals={},h=s.isSelector,c=s.isArray,u=s.lazyTweens,l=s.lazyRender,f=[],p=n._gsDefine.globals,d=function(e){var t,i={};for(t in e)i[t]=e[t];return i},m=a.pauseCallback=function(e,t,i,n){var r,s=e._timeline,a=s._totalTime,h=e._startTime,c=e._rawPrevTime<0||0===e._rawPrevTime&&s._reversed,u=c?0:o,l=c?o:0;if(t||!this._forcingPlayhead){for(s.pause(h),r=e._prev;r&&r._startTime===h;)r._rawPrevTime=l,r=r._prev;for(r=e._next;r&&r._startTime===h;)r._rawPrevTime=u,r=r._next;t&&t.apply(n||s,i||f),(this._forcingPlayhead||!s._paused)&&s.seek(a)}},g=function(e){var t,i=[],n=e.length;for(t=0;t!==n;i.push(e[t++]));return i},_=r.prototype=new t;return r.version="1.16.1",_.constructor=r,_.kill()._gc=_._forcingPlayhead=!1,_.to=function(e,t,n,r){var o=n.repeat&&p.TweenMax||i;return t?this.add(new o(e,t,n),r):this.set(e,n,r)},_.from=function(e,t,n,r){return this.add((n.repeat&&p.TweenMax||i).from(e,t,n),r)},_.fromTo=function(e,t,n,r,o){var s=r.repeat&&p.TweenMax||i;return t?this.add(s.fromTo(e,t,n,r),o):this.set(e,r,o)},_.staggerTo=function(e,t,n,o,s,a,c,u){var l,f=new r({onComplete:a,onCompleteParams:c,onCompleteScope:u,smoothChildTiming:this.smoothChildTiming});for("string"==typeof e&&(e=i.selector(e)||e),e=e||[],h(e)&&(e=g(e)),o=o||0,0>o&&(e=g(e),e.reverse(),o*=-1),l=0;l<e.length;l++)n.startAt&&(n.startAt=d(n.startAt)),f.to(e[l],t,d(n),l*o);return this.add(f,s)},_.staggerFrom=function(e,t,i,n,r,o,s,a){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(e,t,i,n,r,o,s,a)},_.staggerFromTo=function(e,t,i,n,r,o,s,a,h){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,this.staggerTo(e,t,n,r,o,s,a,h)},_.call=function(e,t,n,r){return this.add(i.delayedCall(0,e,t,n),r)},_.set=function(e,t,n){return n=this._parseTimeOrLabel(n,0,!0),null==t.immediateRender&&(t.immediateRender=n===this._time&&!this._paused),this.add(new i(e,0,t),n)},r.exportRoot=function(e,t){e=e||{},null==e.smoothChildTiming&&(e.smoothChildTiming=!0);var n,o,s=new r(e),a=s._timeline;for(null==t&&(t=!0),a._remove(s,!0),s._startTime=0,s._rawPrevTime=s._time=s._totalTime=a._time,n=a._first;n;)o=n._next,t&&n instanceof i&&n.target===n.vars.onComplete||s.add(n,n._startTime-n._delay),n=o;return a.add(s,0),s},_.add=function(n,o,s,a){var h,u,l,f,p,d;if("number"!=typeof o&&(o=this._parseTimeOrLabel(o,0,!0,n)),!(n instanceof e)){if(n instanceof Array||n&&n.push&&c(n)){for(s=s||"normal",a=a||0,h=o,u=n.length,l=0;u>l;l++)c(f=n[l])&&(f=new r({tweens:f})),this.add(f,h),"string"!=typeof f&&"function"!=typeof f&&("sequence"===s?h=f._startTime+f.totalDuration()/f._timeScale:"start"===s&&(f._startTime-=f.delay())),h+=a;return this._uncache(!0)}if("string"==typeof n)return this.addLabel(n,o);if("function"!=typeof n)throw"Cannot add "+n+" into the timeline; it is not a tween, timeline, function, or string.";n=i.delayedCall(0,n)}if(t.prototype.add.call(this,n,o),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(p=this,d=p.rawTime()>n._startTime;p._timeline;)d&&p._timeline.smoothChildTiming?p.totalTime(p._totalTime,!0):p._gc&&p._enabled(!0,!1),p=p._timeline;return this},_.remove=function(t){if(t instanceof e)return this._remove(t,!1);if(t instanceof Array||t&&t.push&&c(t)){for(var i=t.length;--i>-1;)this.remove(t[i]);return this}return"string"==typeof t?this.removeLabel(t):this.kill(null,t)},_._remove=function(e,i){t.prototype._remove.call(this,e,i);var n=this._last;return n?this._time>n._startTime+n._totalDuration/n._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},_.append=function(e,t){return this.add(e,this._parseTimeOrLabel(null,t,!0,e))},_.insert=_.insertMultiple=function(e,t,i,n){return this.add(e,t||0,i,n)},_.appendMultiple=function(e,t,i,n){return this.add(e,this._parseTimeOrLabel(null,t,!0,e),i,n)},_.addLabel=function(e,t){return this._labels[e]=this._parseTimeOrLabel(t),this},_.addPause=function(e,t,n,r){var o=i.delayedCall(0,m,["{self}",t,n,r],this);return o.data="isPause",this.add(o,e)},_.removeLabel=function(e){return delete this._labels[e],this},_.getLabelTime=function(e){return null!=this._labels[e]?this._labels[e]:-1},_._parseTimeOrLabel=function(t,i,n,r){var o;if(r instanceof e&&r.timeline===this)this.remove(r);else if(r&&(r instanceof Array||r.push&&c(r)))for(o=r.length;--o>-1;)r[o]instanceof e&&r[o].timeline===this&&this.remove(r[o]);if("string"==typeof i)return this._parseTimeOrLabel(i,n&&"number"==typeof t&&null==this._labels[i]?t-this.duration():0,n);if(i=i||0,"string"!=typeof t||!isNaN(t)&&null==this._labels[t])null==t&&(t=this.duration());else{if(o=t.indexOf("="),-1===o)return null==this._labels[t]?n?this._labels[t]=this.duration()+i:i:this._labels[t]+i;i=parseInt(t.charAt(o-1)+"1",10)*Number(t.substr(o+1)),t=o>1?this._parseTimeOrLabel(t.substr(0,o-1),0,n):this.duration()}return Number(t)+i},_.seek=function(e,t){return this.totalTime("number"==typeof e?e:this._parseTimeOrLabel(e),t!==!1)},_.stop=function(){return this.paused(!0)},_.gotoAndPlay=function(e,t){return this.play(e,t)},_.gotoAndStop=function(e,t){return this.pause(e,t)},_.render=function(e,t,i){this._gc&&this._enabled(!0,!1);var n,r,s,a,h,c=this._dirty?this.totalDuration():this._totalDuration,p=this._time,d=this._startTime,m=this._timeScale,g=this._paused;if(e>=c)this._totalTime=this._time=c,this._reversed||this._hasPausedChild()||(r=!0,a="onComplete",h=!!this._timeline.autoRemoveChildren,0===this._duration&&(0===e||this._rawPrevTime<0||this._rawPrevTime===o)&&this._rawPrevTime!==e&&this._first&&(h=!0,this._rawPrevTime>o&&(a="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:o,e=c+1e-4;else if(1e-7>e)if(this._totalTime=this._time=0,(0!==p||0===this._duration&&this._rawPrevTime!==o&&(this._rawPrevTime>0||0>e&&this._rawPrevTime>=0))&&(a="onReverseComplete",r=this._reversed),0>e)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(h=r=!0,a="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(h=!0),this._rawPrevTime=e;else{if(this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:o,0===e&&r)for(n=this._first;n&&0===n._startTime;)n._duration||(r=!1),n=n._next;e=0,this._initted||(h=!0)}else this._totalTime=this._time=this._rawPrevTime=e;if(this._time!==p&&this._first||i||h){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==p&&e>0&&(this._active=!0),0===p&&this.vars.onStart&&0!==this._time&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||f)),this._time>=p)for(n=this._first;n&&(s=n._next,!this._paused||g);)(n._active||n._startTime<=this._time&&!n._paused&&!n._gc)&&(n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)),n=s;else for(n=this._last;n&&(s=n._prev,!this._paused||g);)(n._active||n._startTime<=p&&!n._paused&&!n._gc)&&(n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)),n=s;this._onUpdate&&(t||(u.length&&l(),this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||f))),a&&(this._gc||(d===this._startTime||m!==this._timeScale)&&(0===this._time||c>=this.totalDuration())&&(r&&(u.length&&l(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[a]&&this.vars[a].apply(this.vars[a+"Scope"]||this,this.vars[a+"Params"]||f)))}},_._hasPausedChild=function(){for(var e=this._first;e;){if(e._paused||e instanceof r&&e._hasPausedChild())return!0;e=e._next}return!1},_.getChildren=function(e,t,n,r){r=r||-9999999999;for(var o=[],s=this._first,a=0;s;)s._startTime<r||(s instanceof i?t!==!1&&(o[a++]=s):(n!==!1&&(o[a++]=s),e!==!1&&(o=o.concat(s.getChildren(!0,t,n)),a=o.length))),s=s._next;return o},_.getTweensOf=function(e,t){var n,r,o=this._gc,s=[],a=0;for(o&&this._enabled(!0,!0),n=i.getTweensOf(e),r=n.length;--r>-1;)(n[r].timeline===this||t&&this._contains(n[r]))&&(s[a++]=n[r]);return o&&this._enabled(!1,!0),s},_.recent=function(){return this._recent},_._contains=function(e){for(var t=e.timeline;t;){if(t===this)return!0;t=t.timeline}return!1},_.shiftChildren=function(e,t,i){i=i||0;for(var n,r=this._first,o=this._labels;r;)r._startTime>=i&&(r._startTime+=e),r=r._next;if(t)for(n in o)o[n]>=i&&(o[n]+=e);return this._uncache(!0)},_._kill=function(e,t){if(!e&&!t)return this._enabled(!1,!1);for(var i=t?this.getTweensOf(t):this.getChildren(!0,!0,!1),n=i.length,r=!1;--n>-1;)i[n]._kill(e,t)&&(r=!0);return r},_.clear=function(e){var t=this.getChildren(!1,!0,!0),i=t.length;for(this._time=this._totalTime=0;--i>-1;)t[i]._enabled(!1,!1);return e!==!1&&(this._labels={}),this._uncache(!0)},_.invalidate=function(){for(var t=this._first;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},_._enabled=function(e,i){if(e===this._gc)for(var n=this._first;n;)n._enabled(e,!0),n=n._next;return t.prototype._enabled.call(this,e,i)},_.totalTime=function(){this._forcingPlayhead=!0;var t=e.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,t},_.duration=function(e){return arguments.length?(0!==this.duration()&&0!==e&&this.timeScale(this._duration/e),this):(this._dirty&&this.totalDuration(),this._duration)},_.totalDuration=function(e){if(!arguments.length){if(this._dirty){for(var t,i,n=0,r=this._last,o=999999999999;r;)t=r._prev,r._dirty&&r.totalDuration(),r._startTime>o&&this._sortChildren&&!r._paused?this.add(r,r._startTime-r._delay):o=r._startTime,r._startTime<0&&!r._paused&&(n-=r._startTime,this._timeline.smoothChildTiming&&(this._startTime+=r._startTime/this._timeScale),this.shiftChildren(-r._startTime,!1,-9999999999),o=0),i=r._startTime+r._totalDuration/r._timeScale,i>n&&(n=i),r=t;this._duration=this._totalDuration=n,this._dirty=!1}return this._totalDuration}return 0!==this.totalDuration()&&0!==e&&this.timeScale(this._totalDuration/e),this},_.paused=function(t){if(!t)for(var i=this._first,n=this._time;i;)i._startTime===n&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return e.prototype.paused.apply(this,arguments)},_.usesFrames=function(){for(var t=this._timeline;t._timeline;)t=t._timeline;return t===e._rootFramesTimeline},_.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},r},!0)}),n._gsDefine&&n._gsQueue.pop()(),function(i){"use strict";var r=function(){return(n.GreenSockGlobals||n)[i]};"function"==typeof define&&define.amd?define(["TweenLite"],r):"undefined"!=typeof t&&t.exports&&(e("./TweenLite.js"),t.exports=r())}("TimelineLite")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./TweenLite.js":"TweenLite"}],TweenLite:[function(e,t){(function(e){!function(e,i){"use strict";var n=e.GreenSockGlobals=e.GreenSockGlobals||e;if(!n.TweenLite){var r,o,s,a,h,c=function(e){var t,i=e.split("."),r=n;for(t=0;t<i.length;t++)r[i[t]]=r=r[i[t]]||{};return r},u=c("com.greensock"),l=1e-10,f=function(e){var t,i=[],n=e.length;for(t=0;t!==n;i.push(e[t++]));return i},p=function(){},d=function(){var e=Object.prototype.toString,t=e.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&e.call(i)===t)}}(),m={},g=function(r,o,s,a){this.sc=m[r]?m[r].sc:[],m[r]=this,this.gsClass=null,this.func=s;var h=[];this.check=function(u){for(var l,f,p,d,_=o.length,v=_;--_>-1;)(l=m[o[_]]||new g(o[_],[])).gsClass?(h[_]=l.gsClass,v--):u&&l.sc.push(this);if(0===v&&s)for(f=("com.greensock."+r).split("."),p=f.pop(),d=c(f.join("."))[p]=this.gsClass=s.apply(s,h),a&&(n[p]=d,"function"==typeof define&&define.amd?define((e.GreenSockAMDPath?e.GreenSockAMDPath+"/":"")+r.split(".").pop(),[],function(){return d}):r===i&&"undefined"!=typeof t&&t.exports&&(t.exports=d)),_=0;_<this.sc.length;_++)this.sc[_].check()},this.check(!0)},_=e._gsDefine=function(e,t,i,n){return new g(e,t,i,n)},v=u._class=function(e,t,i){return t=t||function(){},_(e,[],function(){return t},i),t};_.globals=n;var y=[0,0,1,1],x=[],b=v("easing.Ease",function(e,t,i,n){this._func=e,this._type=i||0,this._power=n||0,this._params=t?y.concat(t):y},!0),T=b.map={},w=b.register=function(e,t,i,n){for(var r,o,s,a,h=t.split(","),c=h.length,l=(i||"easeIn,easeOut,easeInOut").split(",");--c>-1;)for(o=h[c],r=n?v("easing."+o,null,!0):u.easing[o]||{},s=l.length;--s>-1;)a=l[s],T[o+"."+a]=T[a+o]=r[a]=e.getRatio?e:e[a]||new e};for(s=b.prototype,s._calcEnd=!1,s.getRatio=function(e){if(this._func)return this._params[0]=e,this._func.apply(null,this._params);var t=this._type,i=this._power,n=1===t?1-e:2===t?e:.5>e?2*e:2*(1-e);return 1===i?n*=n:2===i?n*=n*n:3===i?n*=n*n*n:4===i&&(n*=n*n*n*n),1===t?1-n:2===t?n:.5>e?n/2:1-n/2},r=["Linear","Quad","Cubic","Quart","Quint,Strong"],o=r.length;--o>-1;)s=r[o]+",Power"+o,w(new b(null,null,1,o),s,"easeOut",!0),w(new b(null,null,2,o),s,"easeIn"+(0===o?",easeNone":"")),w(new b(null,null,3,o),s,"easeInOut");T.linear=u.easing.Linear.easeIn,T.swing=u.easing.Quad.easeInOut;var M=v("events.EventDispatcher",function(e){this._listeners={},this._eventTarget=e||this});s=M.prototype,s.addEventListener=function(e,t,i,n,r){r=r||0;var o,s,c=this._listeners[e],u=0;for(null==c&&(this._listeners[e]=c=[]),s=c.length;--s>-1;)o=c[s],o.c===t&&o.s===i?c.splice(s,1):0===u&&o.pr<r&&(u=s+1);c.splice(u,0,{c:t,s:i,up:n,pr:r}),this!==a||h||a.wake()},s.removeEventListener=function(e,t){var i,n=this._listeners[e];if(n)for(i=n.length;--i>-1;)if(n[i].c===t)return void n.splice(i,1)},s.dispatchEvent=function(e){var t,i,n,r=this._listeners[e];if(r)for(t=r.length,i=this._eventTarget;--t>-1;)n=r[t],n&&(n.up?n.c.call(n.s||i,{type:e,target:i}):n.c.call(n.s||i))};var E=e.requestAnimationFrame,A=e.cancelAnimationFrame,P=Date.now||function(){return(new Date).getTime()},S=P();for(r=["ms","moz","webkit","o"],o=r.length;--o>-1&&!E;)E=e[r[o]+"RequestAnimationFrame"],A=e[r[o]+"CancelAnimationFrame"]||e[r[o]+"CancelRequestAnimationFrame"];v("Ticker",function(e,t){var i,n,r,o,s,c=this,u=P(),f=t!==!1&&E,d=500,m=33,g="tick",_=function(e){var t,a,h=P()-S;h>d&&(u+=h-m),S+=h,c.time=(S-u)/1e3,t=c.time-s,(!i||t>0||e===!0)&&(c.frame++,s+=t+(t>=o?.004:o-t),a=!0),e!==!0&&(r=n(_)),a&&c.dispatchEvent(g)};M.call(c),c.time=c.frame=0,c.tick=function(){_(!0)},c.lagSmoothing=function(e,t){d=e||1/l,m=Math.min(t,d,0)},c.sleep=function(){null!=r&&(f&&A?A(r):clearTimeout(r),n=p,r=null,c===a&&(h=!1))},c.wake=function(){null!==r?c.sleep():c.frame>10&&(S=P()-d+5),n=0===i?p:f&&E?E:function(e){return setTimeout(e,1e3*(s-c.time)+1|0)},c===a&&(h=!0),_(2)},c.fps=function(e){return arguments.length?(i=e,o=1/(i||60),s=this.time+o,void c.wake()):i},c.useRAF=function(e){return arguments.length?(c.sleep(),f=e,void c.fps(i)):f},c.fps(e),setTimeout(function(){f&&c.frame<5&&c.useRAF(!1)},1500)}),s=u.Ticker.prototype=new u.events.EventDispatcher,s.constructor=u.Ticker;var C=v("core.Animation",function(e,t){if(this.vars=t=t||{},this._duration=this._totalDuration=e||0,this._delay=Number(t.delay)||0,this._timeScale=1,this._active=t.immediateRender===!0,this.data=t.data,this._reversed=t.reversed===!0,j){h||a.wake();var i=this.vars.useFrames?G:j;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});a=C.ticker=new u.Ticker,s=C.prototype,s._dirty=s._gc=s._initted=s._paused=!1,s._totalTime=s._time=0,s._rawPrevTime=-1,s._next=s._last=s._onUpdate=s._timeline=s.timeline=null,s._paused=!1;var D=function(){h&&P()-S>2e3&&a.wake(),setTimeout(D,2e3)};D(),s.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},s.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},s.resume=function(e,t){return null!=e&&this.seek(e,t),this.paused(!1)},s.seek=function(e,t){return this.totalTime(Number(e),t!==!1)},s.restart=function(e,t){return this.reversed(!1).paused(!1).totalTime(e?-this._delay:0,t!==!1,!0)
},s.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},s.render=function(){},s.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},s.isActive=function(){var e,t=this._timeline,i=this._startTime;return!t||!this._gc&&!this._paused&&t.isActive()&&(e=t.rawTime())>=i&&e<i+this.totalDuration()/this._timeScale},s._enabled=function(e,t){return h||a.wake(),this._gc=!e,this._active=this.isActive(),t!==!0&&(e&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!e&&this.timeline&&this._timeline._remove(this,!0)),!1},s._kill=function(){return this._enabled(!1,!1)},s.kill=function(e,t){return this._kill(e,t),this},s._uncache=function(e){for(var t=e?this:this.timeline;t;)t._dirty=!0,t=t.timeline;return this},s._swapSelfInParams=function(e){for(var t=e.length,i=e.concat();--t>-1;)"{self}"===e[t]&&(i[t]=this);return i},s.eventCallback=function(e,t,i,n){if("on"===(e||"").substr(0,2)){var r=this.vars;if(1===arguments.length)return r[e];null==t?delete r[e]:(r[e]=t,r[e+"Params"]=d(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,r[e+"Scope"]=n),"onUpdate"===e&&(this._onUpdate=t)}return this},s.delay=function(e){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+e-this._delay),this._delay=e,this):this._delay},s.duration=function(e){return arguments.length?(this._duration=this._totalDuration=e,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==e&&this.totalTime(this._totalTime*(e/this._duration),!0),this):(this._dirty=!1,this._duration)},s.totalDuration=function(e){return this._dirty=!1,arguments.length?this.duration(e):this._totalDuration},s.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(e>this._duration?this._duration:e,t)):this._time},s.totalTime=function(e,t,i){if(h||a.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>e&&!i&&(e+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var n=this._totalDuration,r=this._timeline;if(e>n&&!i&&(e=n),this._startTime=(this._paused?this._pauseTime:r._time)-(this._reversed?n-e:e)/this._timeScale,r._dirty||this._uncache(!1),r._timeline)for(;r._timeline;)r._timeline._time!==(r._startTime+r._totalTime)/r._timeScale&&r.totalTime(r._totalTime,!0),r=r._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==e||0===this._duration)&&(this.render(e,t,!1),V.length&&X())}return this},s.progress=s.totalProgress=function(e,t){return arguments.length?this.totalTime(this.duration()*e,t):this._time/this.duration()},s.startTime=function(e){return arguments.length?(e!==this._startTime&&(this._startTime=e,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,e-this._delay)),this):this._startTime},s.endTime=function(e){return this._startTime+(0!=e?this.totalDuration():this.duration())/this._timeScale},s.timeScale=function(e){if(!arguments.length)return this._timeScale;if(e=e||l,this._timeline&&this._timeline.smoothChildTiming){var t=this._pauseTime,i=t||0===t?t:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/e}return this._timeScale=e,this._uncache(!1)},s.reversed=function(e){return arguments.length?(e!=this._reversed&&(this._reversed=e,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},s.paused=function(e){if(!arguments.length)return this._paused;var t,i,n=this._timeline;return e!=this._paused&&n&&(h||e||a.wake(),t=n.rawTime(),i=t-this._pauseTime,!e&&n.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=e?t:null,this._paused=e,this._active=this.isActive(),!e&&0!==i&&this._initted&&this.duration()&&this.render(n.smoothChildTiming?this._totalTime:(t-this._startTime)/this._timeScale,!0,!0)),this._gc&&!e&&this._enabled(!0,!1),this};var I=v("core.SimpleTimeline",function(e){C.call(this,0,e),this.autoRemoveChildren=this.smoothChildTiming=!0});s=I.prototype=new C,s.constructor=I,s.kill()._gc=!1,s._first=s._last=s._recent=null,s._sortChildren=!1,s.add=s.insert=function(e,t){var i,n;if(e._startTime=Number(t||0)+e._delay,e._paused&&this!==e._timeline&&(e._pauseTime=e._startTime+(this.rawTime()-e._startTime)/e._timeScale),e.timeline&&e.timeline._remove(e,!0),e.timeline=e._timeline=this,e._gc&&e._enabled(!0,!0),i=this._last,this._sortChildren)for(n=e._startTime;i&&i._startTime>n;)i=i._prev;return i?(e._next=i._next,i._next=e):(e._next=this._first,this._first=e),e._next?e._next._prev=e:this._last=e,e._prev=i,this._recent=e,this._timeline&&this._uncache(!0),this},s._remove=function(e,t){return e.timeline===this&&(t||e._enabled(!1,!0),e._prev?e._prev._next=e._next:this._first===e&&(this._first=e._next),e._next?e._next._prev=e._prev:this._last===e&&(this._last=e._prev),e._next=e._prev=e.timeline=null,e===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},s.render=function(e,t,i){var n,r=this._first;for(this._totalTime=this._time=this._rawPrevTime=e;r;)n=r._next,(r._active||e>=r._startTime&&!r._paused)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,i):r.render((e-r._startTime)*r._timeScale,t,i)),r=n},s.rawTime=function(){return h||a.wake(),this._totalTime};var R=v("TweenLite",function(t,i,n){if(C.call(this,i,n),this.render=R.prototype.render,null==t)throw"Cannot tween a null target.";this.target=t="string"!=typeof t?t:R.selector(t)||t;var r,o,s,a=t.jquery||t.length&&t!==e&&t[0]&&(t[0]===e||t[0].nodeType&&t[0].style&&!t.nodeType),h=this.vars.overwrite;if(this._overwrite=h=null==h?W[R.defaultOverwrite]:"number"==typeof h?h>>0:W[h],(a||t instanceof Array||t.push&&d(t))&&"number"!=typeof t[0])for(this._targets=s=f(t),this._propLookup=[],this._siblings=[],r=0;r<s.length;r++)o=s[r],o?"string"!=typeof o?o.length&&o!==e&&o[0]&&(o[0]===e||o[0].nodeType&&o[0].style&&!o.nodeType)?(s.splice(r--,1),this._targets=s=s.concat(f(o))):(this._siblings[r]=Y(o,this,!1),1===h&&this._siblings[r].length>1&&K(o,this,null,1,this._siblings[r])):(o=s[r--]=R.selector(o),"string"==typeof o&&s.splice(r+1,1)):s.splice(r--,1);else this._propLookup={},this._siblings=Y(t,this,!1),1===h&&this._siblings.length>1&&K(t,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-l,this.render(-this._delay))},!0),L=function(t){return t&&t.length&&t!==e&&t[0]&&(t[0]===e||t[0].nodeType&&t[0].style&&!t.nodeType)},O=function(e,t){var i,n={};for(i in e)U[i]||i in t&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!k[i]||k[i]&&k[i]._autoCSS)||(n[i]=e[i],delete e[i]);e.css=n};s=R.prototype=new C,s.constructor=R,s.kill()._gc=!1,s.ratio=0,s._firstPT=s._targets=s._overwrittenProps=s._startAt=null,s._notifyPluginsOfEnabled=s._lazy=!1,R.version="1.16.1",R.defaultEase=s._ease=new b(null,null,1,1),R.defaultOverwrite="auto",R.ticker=a,R.autoSleep=120,R.lagSmoothing=function(e,t){a.lagSmoothing(e,t)},R.selector=e.$||e.jQuery||function(t){var i=e.$||e.jQuery;return i?(R.selector=i,i(t)):"undefined"==typeof document?t:document.querySelectorAll?document.querySelectorAll(t):document.getElementById("#"===t.charAt(0)?t.substr(1):t)};var V=[],B={},F=R._internals={isArray:d,isSelector:L,lazyTweens:V},k=R._plugins={},N=F.tweenLookup={},z=0,U=F.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1},W={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},G=C._rootFramesTimeline=new I,j=C._rootTimeline=new I,H=30,X=F.lazyRender=function(){var e,t=V.length;for(B={};--t>-1;)e=V[t],e&&e._lazy!==!1&&(e.render(e._lazy[0],e._lazy[1],!0),e._lazy=!1);V.length=0};j._startTime=a.time,G._startTime=a.frame,j._active=G._active=!0,setTimeout(X,1),C._updateRoot=R.render=function(){var e,t,i;if(V.length&&X(),j.render((a.time-j._startTime)*j._timeScale,!1,!1),G.render((a.frame-G._startTime)*G._timeScale,!1,!1),V.length&&X(),a.frame>=H){H=a.frame+(parseInt(R.autoSleep,10)||120);for(i in N){for(t=N[i].tweens,e=t.length;--e>-1;)t[e]._gc&&t.splice(e,1);0===t.length&&delete N[i]}if(i=j._first,(!i||i._paused)&&R.autoSleep&&!G._first&&1===a._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||a.sleep()}}},a.addEventListener("tick",C._updateRoot);var Y=function(e,t,i){var n,r,o=e._gsTweenID;if(N[o||(e._gsTweenID=o="t"+z++)]||(N[o]={target:e,tweens:[]}),t&&(n=N[o].tweens,n[r=n.length]=t,i))for(;--r>-1;)n[r]===t&&n.splice(r,1);return N[o].tweens},q=function(e,t,i,n){var r,o,s=e.vars.onOverwrite;return s&&(r=s(e,t,i,n)),s=R.onOverwrite,s&&(o=s(e,t,i,n)),r!==!1&&o!==!1},K=function(e,t,i,n,r){var o,s,a,h;if(1===n||n>=4){for(h=r.length,o=0;h>o;o++)if((a=r[o])!==t)a._gc||q(a,t)&&a._enabled(!1,!1)&&(s=!0);else if(5===n)break;return s}var c,u=t._startTime+l,f=[],p=0,d=0===t._duration;for(o=r.length;--o>-1;)(a=r[o])===t||a._gc||a._paused||(a._timeline!==t._timeline?(c=c||Z(t,0,d),0===Z(a,c,d)&&(f[p++]=a)):a._startTime<=u&&a._startTime+a.totalDuration()/a._timeScale>u&&((d||!a._initted)&&u-a._startTime<=2e-10||(f[p++]=a)));for(o=p;--o>-1;)if(a=f[o],2===n&&a._kill(i,e,t)&&(s=!0),2!==n||!a._firstPT&&a._initted){if(2!==n&&!q(a,t))continue;a._enabled(!1,!1)&&(s=!0)}return s},Z=function(e,t,i){for(var n=e._timeline,r=n._timeScale,o=e._startTime;n._timeline;){if(o+=n._startTime,r*=n._timeScale,n._paused)return-100;n=n._timeline}return o/=r,o>t?o-t:i&&o===t||!e._initted&&2*l>o-t?l:(o+=e.totalDuration()/e._timeScale/r)>t+l?0:o-t-l};s._init=function(){var e,t,i,n,r,o=this.vars,s=this._overwrittenProps,a=this._duration,h=!!o.immediateRender,c=o.ease;if(o.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),r={};for(n in o.startAt)r[n]=o.startAt[n];if(r.overwrite=!1,r.immediateRender=!0,r.lazy=h&&o.lazy!==!1,r.startAt=r.delay=null,this._startAt=R.to(this.target,0,r),h)if(this._time>0)this._startAt=null;else if(0!==a)return}else if(o.runBackwards&&0!==a)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(h=!1),i={};for(n in o)U[n]&&"autoCSS"!==n||(i[n]=o[n]);if(i.overwrite=0,i.data="isFromStart",i.lazy=h&&o.lazy!==!1,i.immediateRender=h,this._startAt=R.to(this.target,0,i),h){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=c=c?c instanceof b?c:"function"==typeof c?new b(c,o.easeParams):T[c]||R.defaultEase:R.defaultEase,o.easeParams instanceof Array&&c.config&&(this._ease=c.config.apply(c,o.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(e=this._targets.length;--e>-1;)this._initProps(this._targets[e],this._propLookup[e]={},this._siblings[e],s?s[e]:null)&&(t=!0);else t=this._initProps(this.target,this._propLookup,this._siblings,s);if(t&&R._onPluginEvent("_onInitAllProps",this),s&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),o.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=o.onUpdate,this._initted=!0},s._initProps=function(t,i,n,r){var o,s,a,h,c,u;if(null==t)return!1;B[t._gsTweenID]&&X(),this.vars.css||t.style&&t!==e&&t.nodeType&&k.css&&this.vars.autoCSS!==!1&&O(this.vars,t);for(o in this.vars){if(u=this.vars[o],U[o])u&&(u instanceof Array||u.push&&d(u))&&-1!==u.join("").indexOf("{self}")&&(this.vars[o]=u=this._swapSelfInParams(u,this));else if(k[o]&&(h=new k[o])._onInitTween(t,this.vars[o],this)){for(this._firstPT=c={_next:this._firstPT,t:h,p:"setRatio",s:0,c:1,f:!0,n:o,pg:!0,pr:h._priority},s=h._overwriteProps.length;--s>-1;)i[h._overwriteProps[s]]=this._firstPT;(h._priority||h._onInitAllProps)&&(a=!0),(h._onDisable||h._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=i[o]=c={_next:this._firstPT,t:t,p:o,f:"function"==typeof t[o],n:o,pg:!1,pr:0},c.s=c.f?t[o.indexOf("set")||"function"!=typeof t["get"+o.substr(3)]?o:"get"+o.substr(3)]():parseFloat(t[o]),c.c="string"==typeof u&&"="===u.charAt(1)?parseInt(u.charAt(0)+"1",10)*Number(u.substr(2)):Number(u)-c.s||0;c&&c._next&&(c._next._prev=c)}return r&&this._kill(r,t)?this._initProps(t,i,n,r):this._overwrite>1&&this._firstPT&&n.length>1&&K(t,this,i,this._overwrite,n)?(this._kill(i,t),this._initProps(t,i,n,r)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(B[t._gsTweenID]=!0),a)},s.render=function(e,t,i){var n,r,o,s,a=this._time,h=this._duration,c=this._rawPrevTime;if(e>=h)this._totalTime=this._time=h,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(n=!0,r="onComplete",i=i||this._timeline.autoRemoveChildren),0===h&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(e=0),(0===e||0>c||c===l&&"isPause"!==this.data)&&c!==e&&(i=!0,c>l&&(r="onReverseComplete")),this._rawPrevTime=s=!t||e||c===e?e:l);else if(1e-7>e)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==a||0===h&&c>0)&&(r="onReverseComplete",n=this._reversed),0>e&&(this._active=!1,0===h&&(this._initted||!this.vars.lazy||i)&&(c>=0&&(c!==l||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=s=!t||e||c===e?e:l)),this._initted||(i=!0);else if(this._totalTime=this._time=e,this._easeType){var u=e/h,f=this._easeType,p=this._easePower;(1===f||3===f&&u>=.5)&&(u=1-u),3===f&&(u*=2),1===p?u*=u:2===p?u*=u*u:3===p?u*=u*u*u:4===p&&(u*=u*u*u*u),this.ratio=1===f?1-u:2===f?u:.5>e/h?u/2:1-u/2}else this.ratio=this._ease.getRatio(e/h);if(this._time!==a||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=a,this._rawPrevTime=c,V.push(this),void(this._lazy=[e,t]);this._time&&!n?this.ratio=this._ease.getRatio(this._time/h):n&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==a&&e>=0&&(this._active=!0),0===a&&(this._startAt&&(e>=0?this._startAt.render(e,t,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._time||0===h)&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||x))),o=this._firstPT;o;)o.f?o.t[o.p](o.c*this.ratio+o.s):o.t[o.p]=o.c*this.ratio+o.s,o=o._next;this._onUpdate&&(0>e&&this._startAt&&e!==-1e-4&&this._startAt.render(e,t,i),t||(this._time!==a||n)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||x)),r&&(!this._gc||i)&&(0>e&&this._startAt&&!this._onUpdate&&e!==-1e-4&&this._startAt.render(e,t,i),n&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[r]&&this.vars[r].apply(this.vars[r+"Scope"]||this,this.vars[r+"Params"]||x),0===h&&this._rawPrevTime===l&&s!==l&&(this._rawPrevTime=0))}},s._kill=function(e,t,i){if("all"===e&&(e=null),null==e&&(null==t||t===this.target))return this._lazy=!1,this._enabled(!1,!1);t="string"!=typeof t?t||this._targets||this.target:R.selector(t)||t;var n,r,o,s,a,h,c,u,l;if((d(t)||L(t))&&"number"!=typeof t[0])for(n=t.length;--n>-1;)this._kill(e,t[n])&&(h=!0);else{if(this._targets){for(n=this._targets.length;--n>-1;)if(t===this._targets[n]){a=this._propLookup[n]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[n]=e?this._overwrittenProps[n]||{}:"all";break}}else{if(t!==this.target)return!1;a=this._propLookup,r=this._overwrittenProps=e?this._overwrittenProps||{}:"all"}if(a){if(c=e||a,u=e!==r&&"all"!==r&&e!==a&&("object"!=typeof e||!e._tempKill),i&&(R.onOverwrite||this.vars.onOverwrite)){for(o in c)a[o]&&(l||(l=[]),l.push(o));if(!q(this,i,t,l))return!1}for(o in c)(s=a[o])&&(s.pg&&s.t._kill(c)&&(h=!0),s.pg&&0!==s.t._overwriteProps.length||(s._prev?s._prev._next=s._next:s===this._firstPT&&(this._firstPT=s._next),s._next&&(s._next._prev=s._prev),s._next=s._prev=null),delete a[o]),u&&(r[o]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return h},s.invalidate=function(){return this._notifyPluginsOfEnabled&&R._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],C.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-l,this.render(-this._delay)),this},s._enabled=function(e,t){if(h||a.wake(),e&&this._gc){var i,n=this._targets;if(n)for(i=n.length;--i>-1;)this._siblings[i]=Y(n[i],this,!0);else this._siblings=Y(this.target,this,!0)}return C.prototype._enabled.call(this,e,t),this._notifyPluginsOfEnabled&&this._firstPT?R._onPluginEvent(e?"_onEnable":"_onDisable",this):!1},R.to=function(e,t,i){return new R(e,t,i)},R.from=function(e,t,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new R(e,t,i)},R.fromTo=function(e,t,i,n){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,new R(e,t,n)},R.delayedCall=function(e,t,i,n,r){return new R(t,0,{delay:e,onComplete:t,onCompleteParams:i,onCompleteScope:n,onReverseComplete:t,onReverseCompleteParams:i,onReverseCompleteScope:n,immediateRender:!1,lazy:!1,useFrames:r,overwrite:0})},R.set=function(e,t){return new R(e,0,t)},R.getTweensOf=function(e,t){if(null==e)return[];e="string"!=typeof e?e:R.selector(e)||e;var i,n,r,o;if((d(e)||L(e))&&"number"!=typeof e[0]){for(i=e.length,n=[];--i>-1;)n=n.concat(R.getTweensOf(e[i],t));for(i=n.length;--i>-1;)for(o=n[i],r=i;--r>-1;)o===n[r]&&n.splice(i,1)}else for(n=Y(e).concat(),i=n.length;--i>-1;)(n[i]._gc||t&&!n[i].isActive())&&n.splice(i,1);return n},R.killTweensOf=R.killDelayedCallsTo=function(e,t,i){"object"==typeof t&&(i=t,t=!1);for(var n=R.getTweensOf(e,t),r=n.length;--r>-1;)n[r]._kill(i,e)};var Q=v("plugins.TweenPlugin",function(e,t){this._overwriteProps=(e||"").split(","),this._propName=this._overwriteProps[0],this._priority=t||0,this._super=Q.prototype},!0);if(s=Q.prototype,Q.version="1.10.1",Q.API=2,s._firstPT=null,s._addTween=function(e,t,i,n,r,o){var s,a;return null!=n&&(s="number"==typeof n||"="!==n.charAt(1)?Number(n)-i:parseInt(n.charAt(0)+"1",10)*Number(n.substr(2)))?(this._firstPT=a={_next:this._firstPT,t:e,p:t,s:i,c:s,f:"function"==typeof e[t],n:r||t,r:o},a._next&&(a._next._prev=a),a):void 0},s.setRatio=function(e){for(var t,i=this._firstPT,n=1e-6;i;)t=i.c*e+i.s,i.r?t=Math.round(t):n>t&&t>-n&&(t=0),i.f?i.t[i.p](t):i.t[i.p]=t,i=i._next},s._kill=function(e){var t,i=this._overwriteProps,n=this._firstPT;if(null!=e[this._propName])this._overwriteProps=[];else for(t=i.length;--t>-1;)null!=e[i[t]]&&i.splice(t,1);for(;n;)null!=e[n.n]&&(n._next&&(n._next._prev=n._prev),n._prev?(n._prev._next=n._next,n._prev=null):this._firstPT===n&&(this._firstPT=n._next)),n=n._next;return!1},s._roundProps=function(e,t){for(var i=this._firstPT;i;)(e[this._propName]||null!=i.n&&e[i.n.split(this._propName+"_").join("")])&&(i.r=t),i=i._next},R._onPluginEvent=function(e,t){var i,n,r,o,s,a=t._firstPT;if("_onInitAllProps"===e){for(;a;){for(s=a._next,n=r;n&&n.pr>a.pr;)n=n._next;(a._prev=n?n._prev:o)?a._prev._next=a:r=a,(a._next=n)?n._prev=a:o=a,a=s}a=t._firstPT=r}for(;a;)a.pg&&"function"==typeof a.t[e]&&a.t[e]()&&(i=!0),a=a._next;return i},Q.activate=function(e){for(var t=e.length;--t>-1;)e[t].API===Q.API&&(k[(new e[t])._propName]=e[t]);return!0},_.plugin=function(e){if(!(e&&e.propName&&e.init&&e.API))throw"illegal plugin definition.";var t,i=e.propName,n=e.priority||0,r=e.overwriteProps,o={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},s=v("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){Q.call(this,i,n),this._overwriteProps=r||[]},e.global===!0),a=s.prototype=new Q(i);a.constructor=s,s.API=e.API;for(t in o)"function"==typeof e[t]&&(a[o[t]]=e[t]);return s.version=e.version,Q.activate([s]),s},r=e._gsQueue){for(o=0;o<r.length;o++)r[o]();for(s in m)m[s].func||e.console.log("GSAP encountered missing dependency: com.greensock."+s)}h=!1}}("undefined"!=typeof t&&t.exports&&"undefined"!=typeof e?e:this||window,"TweenLite")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],babylonjs:[function(e,t){var i;!function(e){var t=function(){function e(e,t,i){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),this.r=e,this.g=t,this.b=i}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){t.r=this.r*e,t.g=this.g*e,t.b=this.b*e},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){this.r=e.r,this.g=e.g,this.b=e.b},e.prototype.copyFromFloats=function(e,t,i){this.r=e,this.g=t,this.b=i},e.FromArray=function(t){return new e(t[0],t[1],t[2])},e.FromInts=function(t,i,n){return new e(t/255,i/255,n/255)},e.Lerp=function(t,i,n){var r=t.r+(i.r-t.r)*n,o=t.g+(i.g-t.g)*n,s=t.b+(i.b-t.b)*n;return new e(r,o,s)},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e}();e.Color3=t;var i=function(){function t(e,t,i,n){this.r=e,this.g=t,this.b=i,this.a=n}return t.prototype.addInPlace=function(e){this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},t.prototype.subtractToRef=function(e,t){t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e,this.a*e)},t.prototype.scaleToRef=function(e,t){t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.Lerp=function(i,n,r){var o=new t(0,0,0,0);return e.Color4.LerpToRef(i,n,r,o),o},t.LerpToRef=function(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i,n.a=e.a+(t.a-e.a)*i},t.FromArray=function(e,i){return"undefined"==typeof i&&(i=0),new t(e[i],e[i+1],e[i+2],e[i+3])},t.FromInts=function(e,i,n,r){return new t(e/255,i/255,n/255,r/255)},t}();e.Color4=i;var n=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},e.prototype.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.scaleInPlace=function(e){this.x*=e,this.y*=e},e.prototype.scale=function(t){return new e(this.x*t,this.y*t)},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){var e=this.length();if(0!==e){var t=1/e;this.x*=t,this.y*=t}},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.FromArray=function(t,i){return i||(i=0),new e(t[i],t[i+1])},e.CatmullRom=function(t,i,n,r,o){var s=o*o,a=o*s,h=.5*(2*i.x+(-t.x+n.x)*o+(2*t.x-5*i.x+4*n.x-r.x)*s+(-t.x+3*i.x-3*n.x+r.x)*a),c=.5*(2*i.y+(-t.y+n.y)*o+(2*t.y-5*i.y+4*n.y-r.y)*s+(-t.y+3*i.y-3*n.y+r.y)*a);return new e(h,c)},e.Clamp=function(t,i,n){var r=t.x;r=r>n.x?n.x:r,r=r<i.x?i.x:r;var o=t.y;return o=o>n.y?n.y:o,o=o<i.y?i.y:o,new e(r,o)},e.Hermite=function(t,i,n,r,o){var s=o*o,a=o*s,h=2*a-3*s+1,c=-2*a+3*s,u=a-2*s+o,l=a-s,f=t.x*h+n.x*c+i.x*u+r.x*l,p=t.y*h+n.y*c+i.y*u+r.y*l;return new e(f,p)},e.Lerp=function(t,i,n){var r=t.x+(i.x-t.x)*n,o=t.y+(i.y-t.y)*n;return new e(r,o)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(e){var t=e.clone();return t.normalize(),t},e.Minimize=function(t,i){var n=t.x<i.x?t.x:i.x,r=t.y<i.y?t.y:i.y;return new e(n,r)},e.Maximize=function(t,i){var n=t.x>i.x?t.x:i.x,r=t.y>i.y?t.y:i.y;return new e(n,r)},e.Transform=function(t,i){var n=t.x*i.m[0]+t.y*i.m[4],r=t.x*i.m[1]+t.y*i.m[5];return new e(n,r)},e.Distance=function(t,i){return Math.sqrt(e.DistanceSquared(t,i))},e.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},e}();e.Vector2=n;var r=function(){function t(e,t,i){this.x=e,this.y=t,this.z=i}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z},t.prototype.addInPlace=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.addToRef=function(e,t){t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z},t.prototype.subtractInPlace=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.subtractToRef=function(e,t){t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z},t.prototype.subtractFromFloats=function(e,i,n){return new t(this.x-e,this.y-i,this.z-n)},t.prototype.subtractFromFloatsToRef=function(e,t,i,n){n.x=this.x-e,n.y=this.y-t,n.z=this.z-i},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(e){this.x*=e,this.y*=e,this.z*=e},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.scaleToRef=function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},t.prototype.equalsWithEpsilon=function(t){return Math.abs(this.x-t.x)<e.Engine.Epsilon&&Math.abs(this.y-t.y)<e.Engine.Epsilon&&Math.abs(this.z-t.z)<e.Engine.Epsilon},t.prototype.equalsToFloats=function(e,t,i){return this.x===e&&this.y===t&&this.z===i},t.prototype.multiplyInPlace=function(e){this.x*=e.x,this.y*=e.y,this.z*=e.z},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z)},t.prototype.multiplyToRef=function(e,t){t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z},t.prototype.multiplyByFloats=function(e,i,n){return new t(this.x*e,this.y*i,this.z*n)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z)},t.prototype.divideToRef=function(e,t){t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z},t.prototype.MinimizeInPlace=function(e){e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z)},t.prototype.MaximizeInPlace=function(e){e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){var e=this.length();if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y,this.z=e.z},t.prototype.copyFromFloats=function(e,t,i){this.x=e,this.y=t,this.z=i},t.FromArray=function(e,i){return i||(i=0),new t(e[i],e[i+1],e[i+2])},t.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},t.FromFloatArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},t.FromFloatsToRef=function(e,t,i,n){n.x=e,n.y=t,n.z=i},t.Zero=function(){return new t(0,0,0)},t.Up=function(){return new t(0,1,0)},t.TransformCoordinates=function(e,i){var n=t.Zero();return t.TransformCoordinatesToRef(e,i,n),n},t.TransformCoordinatesToRef=function(e,t,i){var n=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8]+t.m[12],r=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9]+t.m[13],o=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]+t.m[14],s=e.x*t.m[3]+e.y*t.m[7]+e.z*t.m[11]+t.m[15];i.x=n/s,i.y=r/s,i.z=o/s},t.TransformCoordinatesFromFloatsToRef=function(e,t,i,n,r){var o=e*n.m[0]+t*n.m[4]+i*n.m[8]+n.m[12],s=e*n.m[1]+t*n.m[5]+i*n.m[9]+n.m[13],a=e*n.m[2]+t*n.m[6]+i*n.m[10]+n.m[14],h=e*n.m[3]+t*n.m[7]+i*n.m[11]+n.m[15];r.x=o/h,r.y=s/h,r.z=a/h},t.TransformNormal=function(e,i){var n=t.Zero();return t.TransformNormalToRef(e,i,n),n},t.TransformNormalToRef=function(e,t,i){i.x=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],i.y=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],i.z=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]},t.TransformNormalFromFloatsToRef=function(e,t,i,n,r){r.x=e*n.m[0]+t*n.m[4]+i*n.m[8],r.y=e*n.m[1]+t*n.m[5]+i*n.m[9],r.z=e*n.m[2]+t*n.m[6]+i*n.m[10]},t.CatmullRom=function(e,i,n,r,o){var s=o*o,a=o*s,h=.5*(2*i.x+(-e.x+n.x)*o+(2*e.x-5*i.x+4*n.x-r.x)*s+(-e.x+3*i.x-3*n.x+r.x)*a),c=.5*(2*i.y+(-e.y+n.y)*o+(2*e.y-5*i.y+4*n.y-r.y)*s+(-e.y+3*i.y-3*n.y+r.y)*a),u=.5*(2*i.z+(-e.z+n.z)*o+(2*e.z-5*i.z+4*n.z-r.z)*s+(-e.z+3*i.z-3*n.z+r.z)*a);return new t(h,c,u)},t.Clamp=function(e,i,n){var r=e.x;r=r>n.x?n.x:r,r=r<i.x?i.x:r;var o=e.y;o=o>n.y?n.y:o,o=o<i.y?i.y:o;var s=e.z;return s=s>n.z?n.z:s,s=s<i.z?i.z:s,new t(r,o,s)},t.Hermite=function(e,i,n,r,o){var s=o*o,a=o*s,h=2*a-3*s+1,c=-2*a+3*s,u=a-2*s+o,l=a-s,f=e.x*h+n.x*c+i.x*u+r.x*l,p=e.y*h+n.y*c+i.y*u+r.y*l,d=e.z*h+n.z*c+i.z*u+r.z*l;return new t(f,p,d)},t.Lerp=function(e,i,n){var r=e.x+(i.x-e.x)*n,o=e.y+(i.y-e.y)*n,s=e.z+(i.z-e.z)*n;return new t(r,o,s)},t.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.Cross=function(e,i){var n=t.Zero();return t.CrossToRef(e,i,n),n},t.CrossToRef=function(e,t,i){i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Project=function(i,n,r,o){var s=o.width,a=o.height,h=o.x,c=o.y,u=e.Matrix.FromValues(s/2,0,0,0,0,-a/2,0,0,0,0,1,0,h+s/2,a/2+c,0,1),l=n.multiply(r).multiply(u);return t.TransformCoordinates(i,l)},t.Unproject=function(t,i,n,r,o,s){var a=r.multiply(o).multiply(s);a.invert(),t.x=t.x/i*2-1,t.y=-(t.y/n*2-1);var h=e.Vector3.TransformCoordinates(t,a),c=t.x*a.m[3]+t.y*a.m[7]+t.z*a.m[11]+a.m[15];return e.Tools.WithinEpsilon(c,1)&&(h=h.scale(1/c)),h},t.Minimize=function(e,t){var i=e.clone();return i.MinimizeInPlace(t),i},t.Maximize=function(e,t){var i=e.clone();return i.MaximizeInPlace(t),i},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))
},t.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return i*i+n*n+r*r},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t}();e.Vector3=r;var o=function(){function e(e,t,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),this.x=e,this.y=t,this.z=i,this.w=n}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.multiply=function(t){var i=new e(0,0,0,1);return this.multiplyToRef(t,i),i},e.prototype.multiplyToRef=function(e,t){t.x=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,t.y=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,t.z=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,t.w=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=1/this.length();this.x*=e,this.y*=e,this.z*=e,this.w*=e},e.prototype.toEulerAngles=function(){var e=this.x,t=this.y,i=this.z,n=this.w,o=e*e,s=t*t,a=i*i,h=Math.atan2(2*(t*n-e*i),1-2*(s+a)),c=Math.asin(2*(e*t+i*n)),u=Math.atan2(2*(e*n-t*i),1-2*(o+a)),l=e*t+i*n;return l>.499?(h=2*Math.atan2(e,n),u=0):-.499>l&&(h=-2*Math.atan2(e,n),u=0),new r(c,h,u)},e.prototype.toRotationMatrix=function(e){var t=this.x*this.x,i=this.y*this.y,n=this.z*this.z,r=this.x*this.y,o=this.z*this.w,s=this.z*this.x,a=this.y*this.w,h=this.y*this.z,c=this.x*this.w;e.m[0]=1-2*(i+n),e.m[1]=2*(r+o),e.m[2]=2*(s-a),e.m[3]=0,e.m[4]=2*(r-o),e.m[5]=1-2*(n+t),e.m[6]=2*(h+c),e.m[7]=0,e.m[8]=2*(s+a),e.m[9]=2*(h-c),e.m[10]=1-2*(i+t),e.m[11]=0,e.m[12]=0,e.m[13]=0,e.m[14]=0,e.m[15]=1},e.prototype.fromRotationMatrix=function(e){var t,i=e.m,n=i[0],r=i[4],o=i[8],s=i[1],a=i[5],h=i[9],c=i[2],u=i[6],l=i[10],f=n+a+l;return f>0?(t=.5/Math.sqrt(f+1),this.w=.25/t,this.x=(u-h)*t,this.y=(o-c)*t,void(this.z=(s-r)*t)):n>a&&n>l?(t=2*Math.sqrt(1+n-a-l),this.w=(u-h)/t,this.x=.25*t,this.y=(r+s)/t,void(this.z=(o+c)/t)):a>l?(t=2*Math.sqrt(1+a-n-l),this.w=(o-c)/t,this.x=(r+s)/t,this.y=.25*t,void(this.z=(h+u)/t)):(t=2*Math.sqrt(1+l-n-a),this.w=(s-r)/t,this.x=(o+c)/t,this.y=(h+u)/t,void(this.z=.25*t))},e.RotationAxis=function(t,i){var n=new e,r=Math.sin(i/2);return n.w=Math.cos(i/2),n.x=t.x*r,n.y=t.y*r,n.z=t.z*r,n},e.FromArray=function(t,i){return i||(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])},e.RotationYawPitchRoll=function(t,i,n){var r=new e;return e.RotationYawPitchRollToRef(t,i,n,r),r},e.RotationYawPitchRollToRef=function(e,t,i,n){var r=.5*i,o=.5*t,s=.5*e,a=Math.sin(r),h=Math.cos(r),c=Math.sin(o),u=Math.cos(o),l=Math.sin(s),f=Math.cos(s);n.x=f*c*h+l*u*a,n.y=l*u*h-f*c*a,n.z=f*u*a-l*c*h,n.w=f*u*h+l*c*a},e.Slerp=function(t,i,n){var r,o,s=n,a=t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)o=1-s,r=h?-s:s;else{var c=Math.acos(a),u=1/Math.sin(c);o=Math.sin((1-s)*c)*u,r=h?-Math.sin(s*c)*u:Math.sin(s*c)*u}return new e(o*t.x+r*i.x,o*t.y+r*i.y,o*t.z+r*i.z,o*t.w+r*i.w)},e}();e.Quaternion=o;var s=function(){function e(){this.m=new Float32Array(16)}return e.prototype.isIdentity=function(){return 1!=this.m[0]||1!=this.m[5]||1!=this.m[10]||1!=this.m[15]?!1:0!=this.m[1]||0!=this.m[2]||0!=this.m[3]||0!=this.m[4]||0!=this.m[6]||0!=this.m[7]||0!=this.m[8]||0!=this.m[9]||0!=this.m[11]||0!=this.m[12]||0!=this.m[13]||0!=this.m[14]?!1:!0},e.prototype.determinant=function(){var e=this.m[10]*this.m[15]-this.m[11]*this.m[14],t=this.m[9]*this.m[15]-this.m[11]*this.m[13],i=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],o=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*e-this.m[6]*t+this.m[7]*i)-this.m[1]*(this.m[4]*e-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*t-this.m[5]*n+this.m[7]*o)-this.m[3]*(this.m[4]*i-this.m[5]*r+this.m[6]*o)},e.prototype.toArray=function(){return this.m},e.prototype.asArray=function(){return this.toArray()},e.prototype.invert=function(){this.invertToRef(this)},e.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],n=this.m[2],r=this.m[3],o=this.m[4],s=this.m[5],a=this.m[6],h=this.m[7],c=this.m[8],u=this.m[9],l=this.m[10],f=this.m[11],p=this.m[12],d=this.m[13],m=this.m[14],g=this.m[15],_=l*g-f*m,v=u*g-f*d,y=u*m-l*d,x=c*g-f*p,b=c*m-l*p,T=c*d-u*p,w=s*_-a*v+h*y,M=-(o*_-a*x+h*b),E=o*v-s*x+h*T,A=-(o*y-s*b+a*T),P=1/(t*w+i*M+n*E+r*A),S=a*g-h*m,C=s*g-h*d,D=s*m-a*d,I=o*g-h*p,R=o*m-a*p,L=o*d-s*p,O=a*f-h*l,V=s*f-h*u,B=s*l-a*u,F=o*f-h*c,k=o*l-a*c,N=o*u-s*c;e.m[0]=w*P,e.m[4]=M*P,e.m[8]=E*P,e.m[12]=A*P,e.m[1]=-(i*_-n*v+r*y)*P,e.m[5]=(t*_-n*x+r*b)*P,e.m[9]=-(t*v-i*x+r*T)*P,e.m[13]=(t*y-i*b+n*T)*P,e.m[2]=(i*S-n*C+r*D)*P,e.m[6]=-(t*S-n*I+r*R)*P,e.m[10]=(t*C-i*I+r*L)*P,e.m[14]=-(t*D-i*R+n*L)*P,e.m[3]=-(i*O-n*V+r*B)*P,e.m[7]=(t*O-n*F+r*k)*P,e.m[11]=-(t*V-i*F+r*N)*P,e.m[15]=(t*B-i*k+n*N)*P},e.prototype.setTranslation=function(e){this.m[12]=e.x,this.m[13]=e.y,this.m[14]=e.z},e.prototype.multiply=function(t){var i=new e;return this.multiplyToRef(t,i),i},e.prototype.copyFrom=function(e){for(var t=0;16>t;t++)this.m[t]=e.m[t]},e.prototype.copyToArray=function(e,t){"undefined"==typeof t&&(t=0);for(var i=0;16>i;i++)e[t+i]=this.m[i]},e.prototype.multiplyToRef=function(e,t){this.multiplyToArray(e,t.m,0)},e.prototype.multiplyToArray=function(e,t,i){var n=this.m[0],r=this.m[1],o=this.m[2],s=this.m[3],a=this.m[4],h=this.m[5],c=this.m[6],u=this.m[7],l=this.m[8],f=this.m[9],p=this.m[10],d=this.m[11],m=this.m[12],g=this.m[13],_=this.m[14],v=this.m[15],y=e.m[0],x=e.m[1],b=e.m[2],T=e.m[3],w=e.m[4],M=e.m[5],E=e.m[6],A=e.m[7],P=e.m[8],S=e.m[9],C=e.m[10],D=e.m[11],I=e.m[12],R=e.m[13],L=e.m[14],O=e.m[15];t[i]=n*y+r*w+o*P+s*I,t[i+1]=n*x+r*M+o*S+s*R,t[i+2]=n*b+r*E+o*C+s*L,t[i+3]=n*T+r*A+o*D+s*O,t[i+4]=a*y+h*w+c*P+u*I,t[i+5]=a*x+h*M+c*S+u*R,t[i+6]=a*b+h*E+c*C+u*L,t[i+7]=a*T+h*A+c*D+u*O,t[i+8]=l*y+f*w+p*P+d*I,t[i+9]=l*x+f*M+p*S+d*R,t[i+10]=l*b+f*E+p*C+d*L,t[i+11]=l*T+f*A+p*D+d*O,t[i+12]=m*y+g*w+_*P+v*I,t[i+13]=m*x+g*M+_*S+v*R,t[i+14]=m*b+g*E+_*C+v*L,t[i+15]=m*T+g*A+_*D+v*O},e.prototype.equals=function(e){return e&&this.m[0]===e.m[0]&&this.m[1]===e.m[1]&&this.m[2]===e.m[2]&&this.m[3]===e.m[3]&&this.m[4]===e.m[4]&&this.m[5]===e.m[5]&&this.m[6]===e.m[6]&&this.m[7]===e.m[7]&&this.m[8]===e.m[8]&&this.m[9]===e.m[9]&&this.m[10]===e.m[10]&&this.m[11]===e.m[11]&&this.m[12]===e.m[12]&&this.m[13]===e.m[13]&&this.m[14]===e.m[14]&&this.m[15]===e.m[15]},e.prototype.clone=function(){return e.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},e.FromArray=function(t,i){var n=new e;return i||(i=0),e.FromArrayToRef(t,i,n),n},e.FromArrayToRef=function(e,t,i){for(var n=0;16>n;n++)i.m[n]=e[n+t]},e.FromValuesToRef=function(e,t,i,n,r,o,s,a,h,c,u,l,f,p,d,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=n,g.m[4]=r,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=h,g.m[9]=c,g.m[10]=u,g.m[11]=l,g.m[12]=f,g.m[13]=p,g.m[14]=d,g.m[15]=m},e.FromValues=function(t,i,n,r,o,s,a,h,c,u,l,f,p,d,m,g){var _=new e;return _.m[0]=t,_.m[1]=i,_.m[2]=n,_.m[3]=r,_.m[4]=o,_.m[5]=s,_.m[6]=a,_.m[7]=h,_.m[8]=c,_.m[9]=u,_.m[10]=l,_.m[11]=f,_.m[12]=p,_.m[13]=d,_.m[14]=m,_.m[15]=g,_},e.Identity=function(){return e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},e.Zero=function(){return e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},e.RotationX=function(t){var i=new e;return e.RotationXToRef(t,i),i},e.RotationXToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=n,t.m[10]=n,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},e.RotationY=function(t){var i=new e;return e.RotationYToRef(t,i),i},e.RotationYToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=n,t.m[2]=-i,t.m[8]=i,t.m[10]=n,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},e.RotationZ=function(t){var i=new e;return e.RotationZToRef(t,i),i},e.RotationZToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=n,t.m[1]=i,t.m[4]=-i,t.m[5]=n,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},e.RotationAxis=function(t,i){var n=Math.sin(-i),r=Math.cos(-i),o=1-r;t.normalize();var s=e.Zero();return s.m[0]=t.x*t.x*o+r,s.m[1]=t.x*t.y*o-t.z*n,s.m[2]=t.x*t.z*o+t.y*n,s.m[3]=0,s.m[4]=t.y*t.x*o+t.z*n,s.m[5]=t.y*t.y*o+r,s.m[6]=t.y*t.z*o-t.x*n,s.m[7]=0,s.m[8]=t.z*t.x*o-t.y*n,s.m[9]=t.z*t.y*o+t.x*n,s.m[10]=t.z*t.z*o+r,s.m[11]=0,s.m[15]=1,s},e.RotationYawPitchRoll=function(t,i,n){var r=new e;return e.RotationYawPitchRollToRef(t,i,n,r),r},e.RotationYawPitchRollToRef=function(e,t,i,n){o.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},e.Scaling=function(t,i,n){var r=e.Zero();return e.ScalingToRef(t,i,n,r),r},e.ScalingToRef=function(e,t,i,n){n.m[0]=e,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=t,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=i,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},e.Translation=function(t,i,n){var r=e.Identity();return e.TranslationToRef(t,i,n,r),r},e.TranslationToRef=function(t,i,n,r){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,n,1,r)},e.LookAtLH=function(t,i,n){var r=e.Zero();return e.LookAtLHToRef(t,i,n,r),r},e.LookAtLHToRef=function(t,i,n,o){i.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return e.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,o)},e.OrthoLH=function(t,i,n,r){var o=2/t,s=2/i,a=1/(r-n),h=n/(n-r);return e.FromValues(o,0,0,0,0,s,0,0,0,0,a,0,0,0,h,1)},e.OrthoOffCenterLH=function(t,i,n,r,o,s){var a=e.Zero();return e.OrthoOffCenterLHToRef(t,i,n,r,o,s,a),a},e.OrthoOffCenterLHToRef=function(e,t,i,n,r,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(n-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(r-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(n+i)/(i-n),s.m[14]=r/(r-o),s.m[15]=1},e.PerspectiveLH=function(t,i,n,r){var o=e.Zero();return o.m[0]=2*n/t,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*n/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-r/(n-r),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r),o},e.PerspectiveFovLH=function(t,i,n,r){var o=e.Zero();return e.PerspectiveFovLHToRef(t,i,n,r,o),o},e.PerspectiveFovLHToRef=function(e,t,i,n,r){var o=1/Math.tan(.5*e);r.m[0]=o/t,r.m[1]=r.m[2]=r.m[3]=0,r.m[5]=o,r.m[4]=r.m[6]=r.m[7]=0,r.m[8]=r.m[9]=0,r.m[10]=-n/(i-n),r.m[11]=1,r.m[12]=r.m[13]=r.m[15]=0,r.m[14]=i*n/(i-n)},e.GetFinalMatrix=function(t,i,n,r,o,s){var a=t.width,h=t.height,c=t.x,u=t.y,l=e.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,c+a/2,h/2+u,o,1);return i.multiply(n).multiply(r).multiply(l)},e.Transpose=function(t){var i=new e;return i.m[0]=t.m[0],i.m[1]=t.m[4],i.m[2]=t.m[8],i.m[3]=t.m[12],i.m[4]=t.m[1],i.m[5]=t.m[5],i.m[6]=t.m[9],i.m[7]=t.m[13],i.m[8]=t.m[2],i.m[9]=t.m[6],i.m[10]=t.m[10],i.m[11]=t.m[14],i.m[12]=t.m[3],i.m[13]=t.m[7],i.m[14]=t.m[11],i.m[15]=t.m[15],i},e.Reflection=function(t){var i=new e;return e.ReflectionToRef(t,i),i},e.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,n=e.normal.y,r=e.normal.z,o=-2*i,s=-2*n,a=-2*r;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*n,t.m[5]=s*n+1,t.m[6]=a*n,t.m[7]=0,t.m[8]=o*r,t.m[9]=s*r,t.m[10]=a*r+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},e._tempQuaternion=new o,e._xAxis=r.Zero(),e._yAxis=r.Zero(),e._zAxis=r.Zero(),e}();e.Matrix=s;var a=function(){function t(e,t,i,n){this.normal=new r(e,t,i),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;0!=e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t},t.prototype.transform=function(t){var i=e.Matrix.Transpose(t),n=this.normal.x,r=this.normal.y,o=this.normal.z,s=this.d,a=n*i.m[0]+r*i.m[1]+o*i.m[2]+s*i.m[3],h=n*i.m[4]+r*i.m[5]+o*i.m[6]+s*i.m[7],c=n*i.m[8]+r*i.m[9]+o*i.m[10]+s*i.m[11],u=n*i.m[12]+r*i.m[13]+o*i.m[14]+s*i.m[15];return new e.Plane(a,h,c,u)},t.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},t.prototype.copyFromPoints=function(e,t,i){var n,r=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,c=i.z-e.z,u=o*c-s*h,l=s*a-r*c,f=r*h-o*a,p=Math.sqrt(u*u+l*l+f*f);n=0!=p?1/p:0,this.normal.x=u*n,this.normal.y=l*n,this.normal.z=f*n,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z)},t.prototype.isFrontFacingTo=function(e,t){var i=r.Dot(this.normal,e);return t>=i},t.prototype.signedDistanceTo=function(e){return r.Dot(e,this.normal)+this.d},t.FromArray=function(t){return new e.Plane(t[0],t[1],t[2],t[3])},t.FromPoints=function(t,i,n){var r=new e.Plane(0,0,0,0);return r.copyFromPoints(t,i,n),r},t.FromPositionAndNormal=function(t,i){var n=new e.Plane(0,0,0,0);return i.normalize(),n.normal=i,n.d=-(i.x*t.x+i.y*t.y+i.z*t.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var n=-(t.x*e.x+t.y*e.y+t.z*e.z);return r.Dot(i,t)+n},t}();e.Plane=a;var h=function(){function e(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}return e.prototype.toGlobal=function(t){var i=t.getRenderWidth(),n=t.getRenderHeight();return new e(this.x*i,this.y*n,this.width*i,this.height*n)},e}();e.Viewport=h;var c=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],n=0;6>n;n++)i.push(new a(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=c;var u=function(){function t(e,t){this.origin=e,this.direction=t}return t.prototype.intersectsBoxMinMax=function(e,t){var i=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var r=1/this.direction.x,o=(e.x-this.origin.x)*r,s=(t.x-this.origin.x)*r;if(o>s){var a=o;o=s,s=a}if(i=Math.max(o,i),n=Math.min(s,n),i>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(r=1/this.direction.y,o=(e.y-this.origin.y)*r,s=(t.y-this.origin.y)*r,o>s&&(a=o,o=s,s=a),i=Math.max(o,i),n=Math.min(s,n),i>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(r=1/this.direction.z,o=(e.z-this.origin.z)*r,s=(t.z-this.origin.z)*r,o>s&&(a=o,o=s,s=a),i=Math.max(o,i),n=Math.min(s,n),i>n)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,n=e.center.z-this.origin.z,r=t*t+i*i+n*n,o=e.radius*e.radius;if(o>=r)return!0;var s=t*this.direction.x+i*this.direction.y+n*this.direction.z;if(0>s)return!1;var a=r-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,n){this._edge1||(this._edge1=e.Vector3.Zero(),this._edge2=e.Vector3.Zero(),this._pvec=e.Vector3.Zero(),this._tvec=e.Vector3.Zero(),this._qvec=e.Vector3.Zero()),i.subtractToRef(t,this._edge1),n.subtractToRef(t,this._edge2),e.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var o=r.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=r.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*s;return 0>h||a+h>1?null:new e.IntersectionInfo(a,h,r.Dot(this._edge2,this._qvec)*s)},t.CreateNew=function(i,n,r,o,s,a,h){var c=e.Vector3.Unproject(new e.Vector3(i,n,0),r,o,s,a,h),u=e.Vector3.Unproject(new e.Vector3(i,n,1),r,o,s,a,h),l=u.subtract(c);return l.normalize(),new t(c,l)},t.Transform=function(i,n){var r=e.Vector3.TransformCoordinates(i.origin,n),o=e.Vector3.TransformNormal(i.direction,n);return new t(r,o)},t}();e.Ray=u,function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(e.Space||(e.Space={}));var l=(e.Space,function(){function t(){}return t.X=new e.Vector3(1,0,0),t.Y=new e.Vector3(0,1,0),t.Z=new e.Vector3(0,0,1),t}());e.Axis=l}(i||(i={}));var i;!function(e){var t,i=60,n=[],r=60,o=0,s=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},a=function(){function a(){}return a.GetFilename=function(e){var t=e.lastIndexOf("/");return 0>t?e:e.substring(t+1)},a.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)3==i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},a.ToDegrees=function(e){return 180*e/Math.PI},a.ToRadians=function(e){return e*Math.PI/180},a.ExtractMinAndMaxIndexed=function(t,i,n,r){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=n;n+r>a;a++){var h=new e.Vector3(t[3*i[a]],t[3*i[a]+1],t[3*i[a]+2]);o=e.Vector3.Minimize(h,o),s=e.Vector3.Maximize(h,s)}return{minimum:o,maximum:s}},a.ExtractMinAndMax=function(t,i,n){for(var r=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=i;i+n>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);r=e.Vector3.Minimize(a,r),o=e.Vector3.Maximize(a,o)}return{minimum:r,maximum:o}},a.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},a.GetPointerPrefix=function(){var e="pointer";return navigator.pointerEnabled||(e="mouse"),e},a.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},a.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},a.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},a.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},a.LoadImage=function(t,i,n,r){t=a.CleanUrl(t);var o=new Image;o.crossOrigin="anonymous",o.onload=function(){i(o)},o.onerror=function(e){n(o,e)};var s=function(){o.src=t},h=function(){r.loadImageFromDB(t,o)};if(r&&r.enableTexturesOffline&&e.Database.isUASupportingBlobStorage)r.openAsync(h,s);else if(-1===t.indexOf("file:"))s();else try{var c,u=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[u],{oneTimeOnly:!0})}catch(l){c=URL.createObjectURL(e.FilesInput.FilesTextures[u])}o.src=c}catch(f){a.Log("Error while trying to load texture: "+u),o.src=null}return o},a.LoadFile=function(t,i,n,r,o){t=a.CleanUrl(t);var s=function(){var r=new XMLHttpRequest,s=a.BaseUrl+t;r.open("GET",s,!0),o&&(r.responseType="arraybuffer"),r.onprogress=n,r.onreadystatechange=function(){if(4==r.readyState){if(200!=r.status&&!e.Tools.ValidateXHRData(r,o?6:1))throw new Error("Error status: "+r.status+" - Unable to load "+s);i(o?r.response:r.responseText)}},r.send(null)},h=function(){r.loadFileFromDB(t,i,n,s,o)};if(-1!==t.indexOf("file:")){var c=t.substring(5);e.Tools.ReadFile(e.FilesInput.FilesToLoad[c],i,n,!0)}else r&&r.enableSceneOffline?r.openAsync(h,s):s()},a.ReadFile=function(e,t,i,n){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,n?r.readAsArrayBuffer(e):r.readAsText(e)},a.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},a.WithinEpsilon=function(e,t){var i=e-t;return i>=-1.401298e-45&&1.401298e-45>=i},a.DeepCopy=function(e,t,i,n){for(var r in e)if(("_"!==r[0]||n&&-1!==n.indexOf(r))&&(!i||-1===i.indexOf(r))){var o=e[r],a=typeof o;if("function"!=a)if("object"==a)if(o instanceof Array){if(t[r]=[],o.length>0)if("object"==typeof o[0])for(var h=0;h<o.length;h++){var c=s(o[h],t);-1===t[r].indexOf(c)&&t[r].push(c)}else t[r]=o.slice(0)}else t[r]=s(o,t);else t[r]=o}},a.IsEmpty=function(e){for(var t in e)return!1;return!0},a.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(n){}}},a.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(n){}}},a.GetFps=function(){return r},a.GetDeltaTime=function(){return o},a._MeasureFps=function(){n.push((new Date).getTime());var e=n.length;if(e>=2&&(o=n[e-1]-n[e-2]),e>=i){e>i&&(n.splice(0,1),e=n.length);for(var t=0,s=0;e-1>s;s++)t+=n[s+1]-n[s];r=1e3/(t/(e-1))}},a.CreateScreenshot=function(i,n,r){var o,s,h=n.getScene(),c=null;if(h.activeCamera!==n&&(c=h.activeCamera,h.activeCamera=n),r.precision)o=Math.round(i.getRenderWidth()*r.precision),s=Math.round(o/i.getAspectRatio(n)),r={width:o,height:s};else if(r.width&&r.height)o=r.width,s=r.height;else if(r.width&&!r.height)o=r.width,s=Math.round(o/i.getAspectRatio(n)),r={width:o,height:s};else if(r.height&&!r.width)s=r.height,o=Math.round(s*i.getAspectRatio(n)),r={width:o,height:s};else{if(isNaN(r))return void a.Error("Invalid 'size' parameter !");s=r,o=r}var u=new e.RenderTargetTexture("screenShot",r,i.scenes[0],!1,!1);u.renderList=i.scenes[0].meshes,u.onAfterRender=function(){for(var e=4*o,n=s/2,r=i.readPixels(0,0,o,s),a=0;n>a;a++)for(var h=0;e>h;h++){var c=h+a*e,u=s-a-1,l=h+u*e,f=r[c];r[c]=r[l],r[l]=f}t||(t=document.createElement("canvas")),t.width=o,t.height=s;var p=t.getContext("2d"),d=p.createImageData(o,s);d.data.set(r),p.putImageData(d,0,0);var m=t.toDataURL();if("download"in document.createElement("a")){var g=window.document.createElement("a");g.href=m;var _=new Date,v=_.getFullYear()+"/"+_.getMonth()+"/"+_.getDate()+"-"+_.getHours()+":"+_.getMinutes();g.setAttribute("download","screenshot-"+v+".png"),window.document.body.appendChild(g),g.addEventListener("click",function(){g.parentElement.removeChild(g)}),g.click()}else{var y=window.open(""),x=y.document.createElement("img");x.src=m,y.document.body.appendChild(x)}},u.render(!0),u.dispose(),c&&(h.activeCamera=c)},a.ValidateXHRData=function(t,i){"undefined"==typeof i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var n=e.Internals.TGATools.GetTGAHeader(t.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(2===i)return!1}if(4&i){var r=new Uint8Array(t.response,0,3);return 68==r[0]&&68==r[1]&&83==r[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(a,"NoneLogLevel",{get:function(){return a._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(a,"MessageLogLevel",{get:function(){return a._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(a,"WarningLogLevel",{get:function(){return a._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ErrorLogLevel",{get:function(){return a._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AllLogLevel",{get:function(){return a._MessageLogLevel|a._WarningLogLevel|a._ErrorLogLevel},enumerable:!0,configurable:!0}),a._FormatMessage=function(e){var t=function(e){return 10>e?"0"+e:""+e},i=new Date;return"BJS - ["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},a._LogDisabled=function(){},a._LogEnabled=function(e){console.log(a._FormatMessage(e))},a._WarnDisabled=function(){},a._WarnEnabled=function(e){console.warn(a._FormatMessage(e))},a._ErrorDisabled=function(){},a._ErrorEnabled=function(e){console.error(a._FormatMessage(e))},Object.defineProperty(a,"LogLevels",{set:function(e){a.Log=(e&a.MessageLogLevel)===a.MessageLogLevel?a._LogEnabled:a._LogDisabled,a.Warn=(e&a.WarningLogLevel)===a.WarningLogLevel?a._WarnEnabled:a._WarnDisabled,a.Error=(e&a.ErrorLogLevel)===a.ErrorLogLevel?a._ErrorEnabled:a._ErrorDisabled},enumerable:!0,configurable:!0}),a.BaseUrl="",a._NoneLogLevel=0,a._MessageLogLevel=1,a._WarningLogLevel=2,a._ErrorLogLevel=4,a.Log=a._LogEnabled,a.Warn=a._WarnEnabled,a.Error=a._ErrorEnabled,a}();e.Tools=a}(i||(i={}));var i;!function(e){var t=function(e,t,i,n){var r=e.createShader("vertex"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(r,(n?n+"\n":"")+t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));return r},i=function(t,i,n){var r=n.NEAREST,o=n.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(r=n.LINEAR,o=i?n.LINEAR_MIPMAP_NEAREST:n.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(r=n.LINEAR,o=i?n.LINEAR_MIPMAP_LINEAR:n.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(r=n.NEAREST,o=i?n.NEAREST_MIPMAP_LINEAR:n.NEAREST),{min:o,mag:r}},n=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},r=function(t,r,o,s,a,h,c,u,l,f){"undefined"==typeof f&&(f=e.Texture.TRILINEAR_SAMPLINGMODE);var p=o.getEngine(),d=n(s,p.getCaps().maxTextureSize),m=n(a,p.getCaps().maxTextureSize);r.bindTexture(r.TEXTURE_2D,t),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,void 0===h?1:h?1:0),l(d,m);var g=i(f,!c,r);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,g.mag),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,g.min),c||u||r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),p._activeTexturesCache=[],t._baseWidth=s,t._baseHeight=a,t._width=d,t._height=m,t.isReady=!0,o._removePendingData(t)},o=function(t,i,n,r,s,a){var h,c=function(){n.push(h),r._removePendingData(h),i!=a.length-1?o(t,i+1,n,r,s,a):s(n)},u=function(){r._removePendingData(h)};h=e.Tools.LoadImage(t+a[i],c,u,r.database),r._addPendingData(h)},s=function(){function e(){}return e}();e.EngineCapabilities=s;var a=function(){function a(e,t,i){var n=this;this.isFullscreen=!1,this.isPointerLock=!1,this.forceWireframe=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.scenes=new Array,this._windowIsBackground=!1,this._runningLoop=!1,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._depthMask=!1,this._renderingCanvas=e,this._canvasClientRect=this._renderingCanvas.getBoundingClientRect(),i=i||{},i.antialias=t;try{this._gl=e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}catch(r){throw new Error("WebGL not supported")}if(!this._gl)throw new Error("WebGL not supported");this._onBlur=function(){n._windowIsBackground=!0},this._onFocus=function(){n._windowIsBackground=!1},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),this._workingCanvas=document.createElement("canvas"),this._workingContext=this._workingCanvas.getContext("2d"),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new s,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?n.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?n.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?n.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(n.isFullscreen=document.msIsFullScreen),n.isFullscreen&&n._pointerLockRequested&&(e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&e.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){n.isPointerLock=document.mozPointerLockElement===e||document.webkitPointerLockElement===e||document.msPointerLockElement===e||document.pointerLockElement===e},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1)}return Object.defineProperty(a,"ALPHA_DISABLE",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_ADD",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_COMBINE",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_NONE",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_LOADED",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_LOADING",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_NOTLOADED",{get:function(){return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Version",{get:function(){return"1.13.0"
},enumerable:!0,configurable:!0}),a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},a.prototype.setDepthFunctionToGreater=function(){this._gl.depthFunc(this._gl.GREATER)},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._gl.depthFunc(this._gl.GEQUAL)},a.prototype.setDepthFunctionToLess=function(){this._gl.depthFunc(this._gl.LESS)},a.prototype.setDepthFunctionToLessOrEqual=function(){this._gl.depthFunc(this._gl.LEQUAL)},a.prototype.stopRenderLoop=function(){this._renderFunction=null,this._runningLoop=!1},a.prototype._renderLoop=function(){var t=this,i=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(i=!1),i&&(this.beginFrame(),this._renderFunction&&this._renderFunction(),this.endFrame()),this._runningLoop&&e.Tools.QueueNewFrame(function(){t._renderLoop()})},a.prototype.runRenderLoop=function(t){var i=this;this._runningLoop=!0,this._renderFunction=t,e.Tools.QueueNewFrame(function(){i._renderLoop()})},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,i){this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthMask&&this._gl.clearDepth(1);var n=0;t&&(n|=this._gl.COLOR_BUFFER_BIT),i&&this._depthMask&&(n|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(n)},a.prototype.setViewport=function(e,t,i){var n=t||this._renderingCanvas.width,r=i||this._renderingCanvas.height,o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*n,s*r,n*e.width,r*e.height)},a.prototype.setDirectViewport=function(e,t,i,n){this._cachedViewport=null,this._gl.viewport(e,t,i,n)},a.prototype.beginFrame=function(){e.Tools._MeasureFps()},a.prototype.endFrame=function(){this.flushFramebuffer()},a.prototype.resize=function(){this._renderingCanvas.width=this._renderingCanvas.clientWidth/this._hardwareScalingLevel,this._renderingCanvas.height=this._renderingCanvas.clientHeight/this._hardwareScalingLevel,this._canvasClientRect=this._renderingCanvas.getBoundingClientRect()},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t},a.prototype.bindBuffers=function(e,t,i,n,r){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<i.length;s++){var a=r.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,n,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t))},a.prototype.bindMultiBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var n=i.getAttributesNames(),r=0;r<n.length;r++){var o=i.getAttributeLocation(r);if(o>=0){var s=e[n[r]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t))},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var n=0;4>n;n++){var r=i[n];this._gl.enableVertexAttribArray(r),this._gl.vertexAttribPointer(r,4,this._gl.FLOAT,!1,64,16*n),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var i=0;4>i;i++){var n=t[i];this._gl.disableVertexAttribArray(n),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,0)}},a.prototype.draw=function(e,t,i,n){return n?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,this._gl.UNSIGNED_SHORT,2*t,n):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,this._gl.UNSIGNED_SHORT,2*t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,i,n,r,o,s,a,h){var c=t.vertexElement||t.vertex||t,u=t.fragmentElement||t.fragment||t,l=c+"+"+u+"@"+o;if(this._compiledEffects[l])return this._compiledEffects[l];var f=new e.Effect(t,i,n,r,this,o,s,a,h);return f._key=l,this._compiledEffects[l]=f,f},a.prototype.createShaderProgram=function(e,i,n){var r=t(this._gl,e,"vertex",n),o=t(this._gl,i,"fragment",n),s=this._gl.createProgram();this._gl.attachShader(s,r),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(r),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var i=[],n=0;n<t.length;n++)i.push(this._gl.getUniformLocation(e,t[n]));return i},a.prototype.getAttributes=function(e,t){for(var i=[],n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(e,t[n]))}catch(r){i.push(-1)}return i},a.prototype.enableEffect=function(e){if(e&&e.getAttributesCount()&&this._currentEffect!==e){this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var i=e.getAttributesCount(),n=0;i>n;n++){var r=e.getAttributeLocation(n);r>=0&&(this._vertexAttribArrays[r]=!0,this._gl.enableVertexAttribArray(r))}this._currentEffect=e}},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},a.prototype.setFloat3=function(e,t,i,n){e&&this._gl.uniform3f(e,t,i,n)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,i,n,r){e&&this._gl.uniform4f(e,t,i,n,r)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},a.prototype.setState=function(e){this._cullingState!==e&&(e?(this._gl.cullFace(this.cullBackFaces?this._gl.BACK:this._gl.FRONT),this._gl.enable(this._gl.CULL_FACE)):this._gl.disable(this._gl.CULL_FACE),this._cullingState=e)},a.prototype.setDepthBuffer=function(e){e?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST)},a.prototype.setDepthWrite=function(e){this._gl.depthMask(e),this._depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(t){switch(t){case e.Engine.ALPHA_DISABLE:this.setDepthWrite(!0),this._gl.disable(this._gl.BLEND);break;case e.Engine.ALPHA_COMBINE:this.setDepthWrite(!1),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._gl.enable(this._gl.BLEND);break;case e.Engine.ALPHA_ADD:this.setDepthWrite(!1),this._gl.blendFuncSeparate(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._gl.enable(this._gl.BLEND)}},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._cullingState=null,this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,i){var n=this._gl;n.bindTexture(n.TEXTURE_2D,t);var r=n.NEAREST,o=n.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(r=n.LINEAR,o=n.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(r=n.LINEAR,o=n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o),n.bindTexture(n.TEXTURE_2D,null)},a.prototype.createTexture=function(t,i,n,o,s){var a=this;"undefined"==typeof s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var h=this._gl.createTexture(),c=t.substr(t.length-4,4).toLowerCase(),u=this.getCaps().s3tc&&".dds"===c,l=".tga"===c;if(o._addPendingData(h),h.url=t,h.noMipmap=i,h.references=1,this._loadedTexturesCache.push(h),l)e.Tools.LoadFile(t,function(t){var c=new Uint8Array(t),u=e.Internals.TGATools.GetTGAHeader(c);r(h,a._gl,o,u.width,u.height,n,i,!1,function(){e.Internals.TGATools.UploadContent(a._gl,c)},s)},null,o.database,!0);else if(u)e.Tools.LoadFile(t,function(c){var u=e.Internals.DDSTools.GetDDSInfo(c),l=(u.isRGB||u.isLuminance||u.mipmapCount>1)&&!i&&u.width>>u.mipmapCount-1==1;r(h,a._gl,o,u.width,u.height,n,!l,u.isFourCC,function(){console.log("loading "+t),e.Internals.DDSTools.UploadDDSLevels(a._gl,a.getCaps().s3tc,c,u,l,1)},s)},null,o.database,!0);else{var f=function(e){r(h,a._gl,o,e.width,e.height,n,i,!1,function(t,i){var n=e.width==t&&e.height==i;n||(a._workingCanvas.width=t,a._workingCanvas.height=i,a._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,i)),a._gl.texImage2D(a._gl.TEXTURE_2D,0,a._gl.RGBA,a._gl.RGBA,a._gl.UNSIGNED_BYTE,n?e:a._workingCanvas)},s)},p=function(){o._removePendingData(h)};e.Tools.LoadImage(t,f,p,o.database)}return h},a.prototype.createDynamicTexture=function(e,t,r,o){var s=this._gl.createTexture();e=n(e,this._caps.maxTextureSize),t=n(t,this._caps.maxTextureSize),this._gl.bindTexture(this._gl.TEXTURE_2D,s);var a=i(o,r,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,a.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,a.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],s._baseWidth=e,s._baseHeight=t,s._width=e,s._height=t,s.isReady=!1,s.generateMipMaps=r,s.references=1,this._loadedTexturesCache.push(s),s},a.prototype.updateDynamicTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,i){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1),t.videoWidth!==e._width||t.videoHeight!==e._height?(e._workingCanvas||(e._workingCanvas=document.createElement("canvas"),e._workingContext=e._workingCanvas.getContext("2d"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)):this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRenderTargetTexture=function(t,n){var r=!1,o=!0,s=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==n&&(r=void 0===n.generateMipMaps?n:n.generateMipmaps,o=void 0===n.generateDepthBuffer?!0:n.generateDepthBuffer,void 0!==n.samplingMode&&(s=n.samplingMode));var a=this._gl,h=a.createTexture();a.bindTexture(a.TEXTURE_2D,h);var c=t.width||t,u=t.height||t,l=i(s,r,a);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,l.mag),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,l.min),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c,u,0,a.RGBA,a.UNSIGNED_BYTE,null);var f;o&&(f=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,f),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c,u));var p=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,p),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,h,0),o&&a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,f),a.bindTexture(a.TEXTURE_2D,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),h._framebuffer=p,o&&(h._depthBuffer=f),h._width=c,h._height=u,h.isReady=!0,h.generateMipMaps=r,h.references=1,this._activeTexturesCache=[],this._loadedTexturesCache.push(h),h},a.prototype.createCubeTexture=function(t,i,r,s){var a=this,h=this._gl,c=h.createTexture();c.isCube=!0,c.url=t,c.references=1,this._loadedTexturesCache.push(c);var u=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&".dds"===u;return l?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),n=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!s;h.bindTexture(h.TEXTURE_CUBE_MAP,c),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(a._gl,a.getCaps().s3tc,t,i,n,6),s||i.isFourCC||1!=i.mipmapCount||h.generateMipmap(h.TEXTURE_CUBE_MAP),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,n?h.LINEAR_MIPMAP_LINEAR:h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.bindTexture(h.TEXTURE_CUBE_MAP,null),a._activeTexturesCache=[],c._width=i.width,c._height=i.height,c.isReady=!0}):o(t,0,[],i,function(e){var t=n(e[0].width,a._caps.maxCubemapTextureSize),i=t;a._workingCanvas.width=t,a._workingCanvas.height=i;var r=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Z];h.bindTexture(h.TEXTURE_CUBE_MAP,c),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,0);for(var o=0;o<r.length;o++)a._workingContext.drawImage(e[o],0,0,e[o].width,e[o].height,0,0,t,i),h.texImage2D(r[o],0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,a._workingCanvas);s||h.generateMipmap(h.TEXTURE_CUBE_MAP),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,s?h.LINEAR:h.LINEAR_MIPMAP_LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.bindTexture(h.TEXTURE_CUBE_MAP,null),a._activeTexturesCache=[],c._width=t,c._height=i,c.isReady=!0},r),c},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var i=0;i<this._caps.maxTexturesImageUnits;i++)this._gl.activeTexture(this._gl["TEXTURE"+i]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[i]=null;var n=this._loadedTexturesCache.indexOf(e);-1!==n&&this._loadedTexturesCache.splice(n,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var n=e.getUniform(t[i]);this._gl.uniform1i(n,i)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl["TEXTURE"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl["TEXTURE"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(i instanceof e.VideoTexture)i.update()&&(this._activeTexturesCache[t]=null);else if(i.delayLoadState==e.Engine.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!=i){this._activeTexturesCache[t]=i;var n=i.getInternalTexture();if(this._gl.activeTexture(this._gl["TEXTURE"+t]),n.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,n),n._cachedCoordinatesMode!==i.coordinatesMode){n._cachedCoordinatesMode=i.coordinatesMode;var r=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,r),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,r)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,n),n._cachedWrapU!==i.wrapU)switch(n._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(n._cachedWrapV!==i.wrapV)switch(n._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},a.prototype._setAnisotropicLevel=function(e,t){var i=this._caps.textureAnisotropicFilterExtension;i&&t._cachedAnisotropicFilteringLevel!==t.anisotropicFilteringLevel&&(this._gl.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropicFilteringLevel,this._caps.maxAnisotropy)),t._cachedAnisotropicFilteringLevel=t.anisotropicFilteringLevel)},a.prototype.readPixels=function(e,t,i,n){var r=new Uint8Array(n*i*4);return this._gl.readPixels(0,0,i,n,this._gl.RGBA,this._gl.UNSIGNED_BYTE,r),r},a.prototype.dispose=function(){for(this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},a.isSupported=function(){try{var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return null!=t&&!!window.WebGLRenderingContext}catch(i){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.ShadersRepository="Babylon/Shaders/",a}();e.Engine=a}(i||(i={}));var i;!function(e){var t=function(){function t(e,t){this.state="",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(){},t.prototype._isSynchronized=function(){return!0},t.prototype.isSynchronizedWithParent=function(){return this.parent?this.parent._currentRenderId<=this._currentRenderId:!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];n.isDescendantOf(this)&&t.push(n)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var n=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*n,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,n=this.centerWorld.y-t.y,r=this.centerWorld.z-t.z,o=Math.sqrt(i*i+n*n+r*r);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,n=e.centerWorld.y-t.centerWorld.y,r=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+n*n+r*r);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this["extends"]=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var n=0;n<this.vectors.length;n++)this.vectorsWorld[n]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var n=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,n),n.x<this.minimumWorld.x&&(this.minimumWorld.x=n.x),n.y<this.minimumWorld.y&&(this.minimumWorld.y=n.y),n.z<this.minimumWorld.z&&(this.minimumWorld.z=n.z),n.x>this.maximumWorld.x&&(this.maximumWorld.x=n.x),n.y>this.maximumWorld.y&&(this.maximumWorld.y=n.y),n.z>this.maximumWorld.z&&(this.maximumWorld.z=n.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=e.Engine.Epsilon;return this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,i,n,r){var o=e.Vector3.Clamp(n,t,i),s=e.Vector3.DistanceSquared(n,o);return r*r>=s},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var n=8,r=0;8>r&&t[i].dotCoordinate(e[r])<0;r++)--n;if(0==n)return!1}return!0},t}();e.BoundingBox=t}(i||(i={}));var i;!function(e){var t=function(t,i){var n=e.Vector3.Dot(i.center,t),r=Math.abs(e.Vector3.Dot(i.directions[0],t))*i["extends"].x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i["extends"].y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i["extends"].z,a=r+o+s;return{min:n-a,max:n+a}},i=function(e,t,i,n){return!(e>n||i>t)},n=function(e,n,r){var o=t(e,n),s=t(e,r);return i(o.min,o.max,s.min,s.max)},r=function(){function t(t,i){this.minimum=t,this.maximum=i,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var r=this.boundingBox,o=t.boundingBox;return n(r.directions[0],r,o)&&n(r.directions[1],r,o)&&n(r.directions[2],r,o)&&n(o.directions[0],r,o)&&n(o.directions[1],r,o)&&n(o.directions[2],r,o)&&n(e.Vector3.Cross(r.directions[0],o.directions[0]),r,o)&&n(e.Vector3.Cross(r.directions[0],o.directions[1]),r,o)&&n(e.Vector3.Cross(r.directions[0],o.directions[2]),r,o)&&n(e.Vector3.Cross(r.directions[1],o.directions[0]),r,o)&&n(e.Vector3.Cross(r.directions[1],o.directions[1]),r,o)&&n(e.Vector3.Cross(r.directions[1],o.directions[2]),r,o)&&n(e.Vector3.Cross(r.directions[2],o.directions[0]),r,o)&&n(e.Vector3.Cross(r.directions[2],o.directions[1]),r,o)&&n(e.Vector3.Cross(r.directions[2],o.directions[2]),r,o)?!0:!1},t}();e.BoundingInfo=r}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n){t.call(this,i,n),this.diffuse=new e.Color3(1,1,1),this.specular=new e.Color3(1,1,1),this.intensity=1,this.range=Number.MAX_VALUE,this.excludedMeshes=new Array,this._excludedMeshesIds=new Array,n.lights.push(this)}return n(i,t),i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.transferToEffect=function(){},i.prototype._getWorldMatrix=function(){return e.Matrix.Identity()},i.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=e.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._parentedWorldMatrix):t
},i.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null);var e=this.getScene().lights.indexOf(this);this.getScene().lights.splice(e,1)},i}(e.Node);e.Light=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i,n){t.call(this,e,n),this.position=i}return n(i,t),i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),void t.setFloat4(i,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,0)):void t.setFloat4(i,this.position.x,this.position.y,this.position.z,0)},i.prototype.getShadowGenerator=function(){return null},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.PointLight=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i,n,r,o,s){t.call(this,e,s),this.position=i,this.direction=n,this.angle=r,this.exponent=o}return n(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.transferToEffect=function(t,i,n){var r;if(this.parent&&this.parent.getWorldMatrix){this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),this._transformedPosition||(this._transformedPosition=e.Vector3.Zero());var o=this.parent.getWorldMatrix();e.Vector3.TransformCoordinatesToRef(this.position,o,this._transformedPosition),e.Vector3.TransformNormalToRef(this.direction,o,this._transformedDirection),t.setFloat4(i,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,this.exponent),r=e.Vector3.Normalize(this._transformedDirection)}else t.setFloat4(i,this.position.x,this.position.y,this.position.z,this.exponent),r=e.Vector3.Normalize(this.direction);t.setFloat4(n,r.x,r.y,r.z,Math.cos(.5*this.angle))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.SpotLight=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i,n){t.call(this,e,n),this.direction=i,this.position=i.scale(-1)}return n(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype._computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),!0):!1},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void t.setFloat4(i,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void t.setFloat4(i,this.direction.x,this.direction.y,this.direction.z,1)},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i}(e.Light);e.DirectionalLight=t}(i||(i={}));var i;!function(e){var t=function(){function t(i,n){var r=this;this.filter=t.FILTER_VARIANCESHADOWMAP,this._darkness=0,this._transparencyShadow=!1,this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._light=n,this._scene=n.getScene(),n._shadowGenerator=this,this._shadowMap=new e.RenderTargetTexture(n.name+"_shadowMap",i,this._scene,!1),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.renderParticles=!1;var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances;if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,!1);var h=t.getMaterial();if(r._effect.setMatrix("viewProjection",r.getTransformMatrix()),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();r._effect.setTexture("diffuseSampler",c),r._effect.setMatrix("diffuseMatrix",c.getTextureMatrix())}var u=i.skeleton&&i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind);if(u&&r._effect.setMatrices("mBones",i.skeleton.getTransformMatrices()),a)i._renderWithInstances(t,!1,s,r._effect,o);else if(s.renderSelf[t._id]&&(r._effect.setMatrix("world",i.getWorldMatrix()),i._draw(t,!0)),s.visibleInstances[t._id])for(var l=0;l<s.visibleInstances[t._id].length;l++){var f=s.visibleInstances[t._id][l];r._effect.setMatrix("world",f.getWorldMatrix()),i._draw(t,!0)}}else r._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(e,t,i){var n;for(n=0;n<e.length;n++)o(e.data[n]);for(n=0;n<t.length;n++)o(t.data[n]);if(r._transparencyShadow)for(n=0;n<i.length;n++)o(i.data[n])}}return Object.defineProperty(t,"FILTER_NONE",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_VARIANCESHADOWMAP",{get:function(){return t._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_POISSONSAMPLING",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVarianceShadowMap",{get:function(){return this.filter===t.FILTER_VARIANCESHADOWMAP},set:function(e){this.filter=e?t.FILTER_VARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePoissonSampling",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING},set:function(e){this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var n=[];this.useVarianceShadowMap&&n.push("#define VSM");var r=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(r.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(r.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.skeleton&&o.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&o.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(r.push(e.VertexBuffer.MatricesIndicesKind),r.push(e.VertexBuffer.MatricesWeightsKind),n.push("#define BONES"),n.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))),i&&(n.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"));var a=n.join("\n");return this._cachedDefines!=a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("shadowMap",r,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],a)),this._effect.isReady()},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getLight=function(){return this._light},t.prototype.getTransformMatrix=function(){var t=this._light.position,i=this._light.direction;if(this._light._computeTransformedPosition()&&(t=this._light._transformedPosition),!(this._cachedPosition&&this._cachedDirection&&t.equals(this._cachedPosition)&&i.equals(this._cachedDirection))){this._cachedPosition=t.clone(),this._cachedDirection=i.clone();var n=this._scene.activeCamera;e.Matrix.LookAtLHToRef(t,this._light.position.add(i),e.Vector3.Up(),this._viewMatrix),e.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,n.minZ,n.maxZ,this._projectionMatrix),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){e>=1?this._darkness=1:0>=e&&(this._darkness=0),elsethis._darkness=e},t.prototype.setTransparencyShadow=function(e){this._transparencyShadow=e},t.prototype.dispose=function(){this._shadowMap.dispose()},t._FILTER_NONE=0,t._FILTER_VARIANCESHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t}();e.ShadowGenerator=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r){t.call(this,i,r),this.direction=n,this.groundColor=new e.Color3(0,0,0)}return n(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i,n){var r=e.Vector3.Normalize(this.direction);t.setFloat4(i,r.x,r.y,r.z,0),t.setColor3(n,this.groundColor.scale(this.intensity))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},i}(e.Light);e.HemisphericLight=t}(i||(i={}));var i;!function(e){var t=function(e,t,i,n){return e.x>i.x+n?!1:i.x-n>t.x?!1:e.y>i.y+n?!1:i.y-n>t.y?!1:e.z>i.z+n?!1:i.z-n>t.z?!1:!0},i=function(e,t,i,n){var r=t*t-4*e*i,o={root:0,found:!1};if(0>r)return o;var s=Math.sqrt(r),a=(-t-s)/(2*e),h=(-t+s)/(2*e);if(a>h){var c=h;h=a,a=c}return a>0&&n>a?(o.root=a,o.found=!0,o):h>0&&n>h?(o.root=h,o.found=!0,o):o},n=function(){function n(){this.radius=new e.Vector3(1,1,1),this.retry=0,this.basePointWorld=e.Vector3.Zero(),this.velocityWorld=e.Vector3.Zero(),this.normalizedVelocity=e.Vector3.Zero(),this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero()}return n.prototype._initialize=function(t,i,n){this.velocity=i,e.Vector3.NormalizeToRef(i,this.normalizedVelocity),this.basePoint=t,t.multiplyToRef(this.radius,this.basePointWorld),i.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=n,this.collisionFound=!1},n.prototype._checkPointInTriangle=function(t,i,n,r,o){i.subtractToRef(t,this._tempVector),n.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=e.Vector3.Dot(this._tempVector4,o);return 0>s?!1:(r.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),0>s?!1:(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),s>=0))},n.prototype._canDoCollision=function(i,n,r,o){var s=e.Vector3.Distance(this.basePointWorld,i),a=Math.max(this.radius.x,this.radius.y,this.radius.z);return s>this.velocityWorldLength+a+n?!1:t(r,o,this.basePointWorld,this.velocityWorldLength+a)?!0:!1},n.prototype._testTriangle=function(t,n,r,o,s){var a,h=!1;n._trianglePlanes||(n._trianglePlanes=[]),n._trianglePlanes[t]||(n._trianglePlanes[t]=new e.Plane(0,0,0,0),n._trianglePlanes[t].copyFromPoints(r,o,s));var c=n._trianglePlanes[t];if(n.getMaterial()||c.isFrontFacingTo(this.normalizedVelocity,0)){var u=c.signedDistanceTo(this.basePoint),l=e.Vector3.Dot(c.normal,this.velocity);if(0==l){if(Math.abs(u)>=1)return;h=!0,a=0}else{a=(-1-u)/l;var f=(1-u)/l;if(a>f){var p=f;f=a,a=p}if(a>1||0>f)return;0>a&&(a=0),a>1&&(a=1)}this._collisionPoint.copyFromFloats(0,0,0);var d=!1,m=1;if(h||(this.basePoint.subtractToRef(c.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(a,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,r,o,s,c.normal)&&(d=!0,m=a,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!d){var g=this.velocity.lengthSquared(),_=g;this.basePoint.subtractToRef(r,this._tempVector);var v=2*e.Vector3.Dot(this.velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,x=i(_,v,y,m);x.found&&(m=x.root,d=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(o,this._tempVector),v=2*e.Vector3.Dot(this.velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,x=i(_,v,y,m),x.found&&(m=x.root,d=!0,this._collisionPoint.copyFrom(o)),this.basePoint.subtractToRef(s,this._tempVector),v=2*e.Vector3.Dot(this.velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,x=i(_,v,y,m),x.found&&(m=x.root,d=!0,this._collisionPoint.copyFrom(s)),o.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex);var b=this._edge.lengthSquared(),T=e.Vector3.Dot(this._edge,this.velocity),w=e.Vector3.Dot(this._edge,this._baseToVertex);if(_=b*-g+T*T,v=2*b*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*T*w,y=b*(1-this._baseToVertex.lengthSquared())+w*w,x=i(_,v,y,m),x.found){var M=(T*x.root-w)/b;M>=0&&1>=M&&(m=x.root,d=!0,this._edge.scaleInPlace(M),r.addToRef(this._edge,this._collisionPoint))}s.subtractToRef(o,this._edge),o.subtractToRef(this.basePoint,this._baseToVertex),b=this._edge.lengthSquared(),T=e.Vector3.Dot(this._edge,this.velocity),w=e.Vector3.Dot(this._edge,this._baseToVertex),_=b*-g+T*T,v=2*b*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*T*w,y=b*(1-this._baseToVertex.lengthSquared())+w*w,x=i(_,v,y,m),x.found&&(M=(T*x.root-w)/b,M>=0&&1>=M&&(m=x.root,d=!0,this._edge.scaleInPlace(M),o.addToRef(this._edge,this._collisionPoint))),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex),b=this._edge.lengthSquared(),T=e.Vector3.Dot(this._edge,this.velocity),w=e.Vector3.Dot(this._edge,this._baseToVertex),_=b*-g+T*T,v=2*b*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*T*w,y=b*(1-this._baseToVertex.lengthSquared())+w*w,x=i(_,v,y,m),x.found&&(M=(T*x.root-w)/b,M>=0&&1>=M&&(m=x.root,d=!0,this._edge.scaleInPlace(M),s.addToRef(this._edge,this._collisionPoint)))}if(d){var E=m*this.velocity.length();(!this.collisionFound||E<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=E,this.collisionFound=!0,this.collidedMesh=n.getMesh())}}},n.prototype._collide=function(e,t,i,n,r,o){for(var s=n;r>s;s+=3){var a=t[i[s]-o],h=t[i[s+1]-o],c=t[i[s+2]-o];this._testTriangle(s,e,c,h,a)}},n.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this.nearestDistance/i.length()),this.basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)},n}();e.Collider=n}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(n,r,o){t.call(this,n,o),this.position=r,this.upVector=e.Vector3.Up(),this.orthoLeft=null,this.orthoRight=null,this.orthoBottom=null,this.orthoTop=null,this.fov=.8,this.minZ=.1,this.maxZ=1e3,this.inertia=.9,this.mode=i.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new e.Viewport(0,0,1,1),this.subCameras=[],this.layerMask=4294967295,this._computedViewMatrix=e.Matrix.Identity(),this._projectionMatrix=new e.Matrix,this._postProcesses=new Array,this._postProcessesTakenIndices=[],o.cameras.push(this),o.activeCamera||(o.activeCamera=this)}return n(i,t),i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this.getEngine();this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=i.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=i.getRenderWidth(),this._cache.renderHeight=i.getRenderHeight()},i.prototype._updateFromScene=function(){this.updateCache(),this._update()},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return t.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},i.prototype._isSynchronizedProjectionMatrix=function(){var t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;var i=this.getEngine();return t=this.mode===e.Camera.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===i.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight()},i.prototype.attachControl=function(){},i.prototype.detachControl=function(){},i.prototype._update=function(){},i.prototype.attachPostProcess=function(t,i){if("undefined"==typeof i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1)return e.Tools.Error("You're trying to reuse a post process not defined as reusable."),0;if(null==i||0>i)return this._postProcesses.push(t),this._postProcessesTakenIndices.push(this._postProcesses.length-1),this._postProcesses.length-1;var n=0;if(this._postProcesses[i]){for(var r=this._postProcesses.length-1,o=r;o>=i+1;--o)this._postProcesses[o+1]=this._postProcesses[o];n=1}for(o=0;o<this._postProcessesTakenIndices.length;++o)if(!(this._postProcessesTakenIndices[o]<i)){r=this._postProcessesTakenIndices.length-1;for(var s=r;s>=o;--s)this._postProcessesTakenIndices[s+1]=this._postProcessesTakenIndices[s]+n;this._postProcessesTakenIndices[o]=i;break}n||-1!=this._postProcessesTakenIndices.indexOf(i)||this._postProcessesTakenIndices.push(i);var a=i+n;return this._postProcesses[a]=t,a},i.prototype.detachPostProcess=function(e,t){"undefined"==typeof t&&(t=null);var i=[];if(t)for(t=t instanceof Array?t:[t],o=0;o<t.length;o++){var n=this._postProcesses[t[o]];n===e?(delete this._postProcesses[t[o]],s=this._postProcessesTakenIndices.indexOf(t[o]),this._postProcessesTakenIndices.splice(s,1)):i.push(o)}else for(var r=this._postProcesses.length,o=0;r>o;o++)if(this._postProcesses[o]===e){delete this._postProcesses[o];var s=this._postProcessesTakenIndices.indexOf(o);this._postProcessesTakenIndices.splice(s,1)}return i},i.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=e.Matrix.Identity());var t=this.getViewMatrix();return t.invertToRef(this._worldMatrix),this._worldMatrix},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype.getViewMatrix=function(){return this._computedViewMatrix=this._computeViewMatrix(),this.parent&&this.parent.getWorldMatrix&&!this.isSynchronized()?(this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._computedViewMatrix.invert(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix):this._computedViewMatrix},i.prototype._computeViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this.parent&&this.parent.getWorldMatrix||(this._currentRenderId=this.getScene().getRenderId()),this._computedViewMatrix)},i.prototype.getProjectionMatrix=function(t){if(!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var i=this.getEngine();if(this.mode===e.Camera.PERSPECTIVE_CAMERA)return this.minZ<=0&&(this.minZ=.1),e.Matrix.PerspectiveFovLHToRef(this.fov,i.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix;var n=i.getRenderWidth()/2,r=i.getRenderHeight()/2;return e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-r,this.orthoTop||r,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},i.prototype.dispose=function(){var e=this.getScene().cameras.indexOf(this);this.getScene().cameras.splice(e,1);for(var t=0;t<this._postProcessesTakenIndices.length;++t)this._postProcesses[this._postProcessesTakenIndices[t]].dispose(this)},i.PERSPECTIVE_CAMERA=0,i.ORTHOGRAPHIC_CAMERA=1,i}(e.Node);e.Camera=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r){t.call(this,i,n,r),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0),this.rotation=new e.Vector3(0,0,0),this.ellipsoid=new e.Vector3(.5,1,.5),this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.speed=2,this.checkCollisions=!1,this.applyGravity=!1,this.noRotationConstraint=!1,this.angularSensibility=2e3,this.lockedTarget=null,this._keys=[],this._collider=new e.Collider,this._needMoveForGravity=!0,this._currentTarget=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._camMatrix=e.Matrix.Zero(),this._cameraTransformMatrix=e.Matrix.Zero(),this._cameraRotationMatrix=e.Matrix.Zero(),this._referencePoint=new e.Vector3(0,0,1),this._transformedReferencePoint=e.Vector3.Zero(),this._oldPosition=e.Vector3.Zero(),this._diffPosition=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._lookAtTemp=e.Matrix.Zero(),this._tempMatrix=e.Matrix.Zero()}return n(i,t),i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&this._cache.rotation.equals(this.rotation)},i.prototype._computeLocalCameraSpeed=function(){return this.speed*(e.Tools.GetDeltaTime()/(10*e.Tools.GetFps()))},i.prototype.setTarget=function(t){this.upVector.normalize(),e.Matrix.LookAtLHToRef(this.position,t,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);this.rotation.y=i.x>=0?-Math.atan(i.z/i.x)+Math.PI/2:-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=-Math.acos(e.Vector3.Dot(new e.Vector3(0,1,0),this.upVector)),isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype.attachControl=function(t,i){var n,r=this,o=this.getEngine();this._attachedElement||(this._attachedElement=t,void 0===this._onMouseDown&&(this._onMouseDown=function(e){n={x:e.clientX,y:e.clientY},i||e.preventDefault()},this._onMouseUp=function(e){n=null,i||e.preventDefault()},this._onMouseOut=function(e){n=null,r._keys=[],i||e.preventDefault()},this._onMouseMove=function(e){if(n||o.isPointerLock){var t,s;o.isPointerLock?(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,s=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0):(t=e.clientX-n.x,s=e.clientY-n.y),r.cameraRotation.y+=t/r.angularSensibility,r.cameraRotation.x+=s/r.angularSensibility,n={x:e.clientX,y:e.clientY},i||e.preventDefault()}},this._onKeyDown=function(e){if(-1!==r.keysUp.indexOf(e.keyCode)||-1!==r.keysDown.indexOf(e.keyCode)||-1!==r.keysLeft.indexOf(e.keyCode)||-1!==r.keysRight.indexOf(e.keyCode)){var t=r._keys.indexOf(e.keyCode);-1===t&&r._keys.push(e.keyCode),i||e.preventDefault()}},this._onKeyUp=function(e){if(-1!==r.keysUp.indexOf(e.keyCode)||-1!==r.keysDown.indexOf(e.keyCode)||-1!==r.keysLeft.indexOf(e.keyCode)||-1!==r.keysRight.indexOf(e.keyCode)){var t=r._keys.indexOf(e.keyCode);t>=0&&r._keys.splice(t,1),i||e.preventDefault()}},this._onLostFocus=function(){r._keys=[]},this._reset=function(){r._keys=[],n=null,r.cameraDirection=new e.Vector3(0,0,0),r.cameraRotation=new e.Vector2(0,0)}),t.addEventListener("mousedown",this._onMouseDown,!1),t.addEventListener("mouseup",this._onMouseUp,!1),t.addEventListener("mouseout",this._onMouseOut,!1),t.addEventListener("mousemove",this._onMouseMove,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedElement==t&&(t.removeEventListener("mousedown",this._onMouseDown),t.removeEventListener("mouseup",this._onMouseUp),t.removeEventListener("mouseout",this._onMouseOut),t.removeEventListener("mousemove",this._onMouseMove),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._attachedElement=null,this._reset&&this._reset())},i.prototype._collideWithWorld=function(t){var i;i=this.parent?e.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid,this.getScene()._getNewPosition(this._oldPosition,t,this._collider,3,this._newPosition),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>e.Engine.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),this.onCollide&&this.onCollide(this._collider.collidedMesh))},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero());for(var t=0;t<this._keys.length;t++){var i=this._keys[t],n=this._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?this._localDirection.copyFromFloats(-n,0,0):-1!==this.keysUp.indexOf(i)?this._localDirection.copyFromFloats(0,0,n):-1!==this.keysRight.indexOf(i)?this._localDirection.copyFromFloats(n,0,0):-1!==this.keysDown.indexOf(i)&&this._localDirection.copyFromFloats(0,0,-n),this.getViewMatrix().invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.cameraDirection.addInPlace(this._transformedDirection)}},i.prototype._update=function(){this._checkInputs();var t=this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0,i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t)if(this.checkCollisions&&this.getScene().collisionsEnabled){if(this._collideWithWorld(this.cameraDirection),this.applyGravity){var n=this.position;this._collideWithWorld(this.getScene().gravity),this._needMoveForGravity=0!=e.Vector3.DistanceSquared(n,this.position)}}else this.position.addInPlace(this.cameraDirection);if(i&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var r=Math.PI/2*.95;this.rotation.x>r&&(this.rotation.x=r),this.rotation.x<-r&&(this.rotation.x=-r)}t&&(Math.abs(this.cameraDirection.x)<e.Engine.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<e.Engine.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<e.Engine.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<e.Engine.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<e.Engine.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia))},i.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(0!=this.upVector.x||1!=this.upVector.y||0!=this.upVector.z?(e.Matrix.LookAtLHToRef(e.Vector3.Zero(),this._referencePoint,this.upVector,this._lookAtTemp),e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix,this._tempMatrix),this._lookAtTemp.invert(),this._tempMatrix.multiplyToRef(this._lookAtTemp,this._cameraRotationMatrix)):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},i}(e.Camera);e.FreeCamera=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i,n){t.call(this,e,i,n),this._offsetX=null,this._offsetY=null,this._pointerCount=0,this._pointerPressed=[],this.angularSensibility=2e5,this.moveSensibility=500}return n(i,t),i.prototype.attachControl=function(t,i){var n,r=this;this._attachedCanvas||(this._attachedCanvas=t,void 0===this._onPointerDown&&(this._onPointerDown=function(e){i||e.preventDefault(),r._pointerPressed.push(e.pointerId),1===r._pointerPressed.length&&(n={x:e.clientX,y:e.clientY})},this._onPointerUp=function(e){i||e.preventDefault();var t=r._pointerPressed.indexOf(e.pointerId);-1!==t&&(r._pointerPressed.splice(t,1),0==t&&(n=null,r._offsetX=null,r._offsetY=null))},this._onPointerMove=function(e){if(i||e.preventDefault(),n){var t=r._pointerPressed.indexOf(e.pointerId);
0==t&&(r._offsetX=e.clientX-n.x,r._offsetY=-(e.clientY-n.y))}},this._onLostFocus=function(){r._offsetX=null,r._offsetY=null}),t.addEventListener("pointerdown",this._onPointerDown),t.addEventListener("pointerup",this._onPointerUp),t.addEventListener("pointerout",this._onPointerUp),t.addEventListener("pointermove",this._onPointerMove),e.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]))},i.prototype.detachControl=function(t){this._attachedCanvas==t&&(t.removeEventListener("pointerdown",this._onPointerDown),t.removeEventListener("pointerup",this._onPointerUp),t.removeEventListener("pointerout",this._onPointerUp),t.removeEventListener("pointermove",this._onPointerMove),e.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),this._attachedCanvas=null)},i.prototype._checkInputs=function(){if(this._offsetX)if(this.cameraRotation.y+=this._offsetX/this.angularSensibility,this._pointerPressed.length>1)this.cameraRotation.x+=-this._offsetY/this.angularSensibility;else{var t=this._computeLocalCameraSpeed(),i=new e.Vector3(0,0,t*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(i,this._cameraRotationMatrix))}},i}(e.FreeCamera);e.TouchCamera=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i,n){var r=this;t.call(this,e,i,n),this._offsetX=null,this._offsetY=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0,this.angularSensibility=1e4,this.moveSensibility=50,window.addEventListener("resize",function(){r._initialOrientationGamma=null},!1)}return n(i,t),i.prototype.attachControl=function(e){var t=this;this._attachedCanvas||(this._attachedCanvas=e,this._orientationChanged||(this._orientationChanged=function(e){t._initialOrientationGamma||(t._initialOrientationGamma=e.gamma,t._initialOrientationBeta=e.beta),t._orientationGamma=e.gamma,t._orientationBeta=e.beta,t._offsetY=t._initialOrientationBeta-t._orientationBeta,t._offsetX=t._initialOrientationGamma-t._orientationGamma}),window.addEventListener("deviceorientation",this._orientationChanged))},i.prototype.detachControl=function(e){this._attachedCanvas==e&&(window.removeEventListener("deviceorientation",this._orientationChanged),this._attachedCanvas=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0)},i.prototype._checkInputs=function(){if(this._offsetX){this.cameraRotation.y-=this._offsetX/this.angularSensibility;var t=this._computeLocalCameraSpeed(),i=new e.Vector3(0,0,t*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(i,this._cameraRotationMatrix))}},i}(e.FreeCamera);e.DeviceOrientationCamera=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=e.Tools.GetPointerPrefix(),i=function(i){function r(t,n,r,o,s,a){i.call(this,t,e.Vector3.Zero(),a),this.alpha=n,this.beta=r,this.radius=o,this.target=s,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.angularSensibility=1e3,this.wheelPrecision=3,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.zoomOnFactor=1,this._keys=[],this._viewMatrix=new e.Matrix,this.checkCollisions=!1,this.collisionRadius=new e.Vector3(.5,.5,.5),this._collider=new e.Collider,this._previousPosition=e.Vector3.Zero(),this._collisionVelocity=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this.getViewMatrix()}return n(r,i),r.prototype._getTargetPosition=function(){return this.target.position||this.target},r.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0},r.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius},r.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius:!1},r.prototype.attachControl=function(i,n){var r,o,s=this;if(!this._attachedElement){this._attachedElement=i;var a=this.getEngine();void 0===this._onPointerDown&&(this._onPointerDown=function(e){o||(o=e.pointerId,r={x:e.clientX,y:e.clientY},n||e.preventDefault())},this._onPointerUp=function(e){r=null,o=null,n||e.preventDefault()},this._onPointerMove=function(e){if(r&&o===e.pointerId){var t=e.clientX-r.x,i=e.clientY-r.y;s.inertialAlphaOffset-=t/s.angularSensibility,s.inertialBetaOffset-=i/s.angularSensibility,r={x:e.clientX,y:e.clientY},n||e.preventDefault()}},this._onMouseMove=function(e){if(a.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;s.inertialAlphaOffset-=t/s.angularSensibility,s.inertialBetaOffset-=i/s.angularSensibility,n||e.preventDefault()}},this._wheel=function(e){var t=0;e.wheelDelta?t=e.wheelDelta/(40*s.wheelPrecision):e.detail&&(t=-e.detail/s.wheelPrecision),t&&(s.inertialRadiusOffset+=t),e.preventDefault&&(n||e.preventDefault())},this._onKeyDown=function(e){if(-1!==s.keysUp.indexOf(e.keyCode)||-1!==s.keysDown.indexOf(e.keyCode)||-1!==s.keysLeft.indexOf(e.keyCode)||-1!==s.keysRight.indexOf(e.keyCode)){var t=s._keys.indexOf(e.keyCode);-1===t&&s._keys.push(e.keyCode),e.preventDefault&&(n||e.preventDefault())}},this._onKeyUp=function(e){if(-1!==s.keysUp.indexOf(e.keyCode)||-1!==s.keysDown.indexOf(e.keyCode)||-1!==s.keysLeft.indexOf(e.keyCode)||-1!==s.keysRight.indexOf(e.keyCode)){var t=s._keys.indexOf(e.keyCode);t>=0&&s._keys.splice(t,1),e.preventDefault&&(n||e.preventDefault())}},this._onLostFocus=function(){s._keys=[],o=null},this._onGestureStart=function(e){void 0!==window.MSGesture&&(s._MSGestureHandler||(s._MSGestureHandler=new MSGesture,s._MSGestureHandler.target=i),s._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){s.radius*=e.scale,e.preventDefault&&(n||(e.stopPropagation(),e.preventDefault()))},this._reset=function(){s._keys=[],s.inertialAlphaOffset=0,s.inertialBetaOffset=0,s.inertialRadiusOffset=0,r=null,o=null}),i.addEventListener(t+"down",this._onPointerDown,!1),i.addEventListener(t+"up",this._onPointerUp,!1),i.addEventListener(t+"out",this._onPointerUp,!1),i.addEventListener(t+"move",this._onPointerMove,!1),i.addEventListener("mousemove",this._onMouseMove,!1),i.addEventListener("MSPointerDown",this._onGestureStart,!1),i.addEventListener("MSGestureChange",this._onGesture,!1),i.addEventListener("mousewheel",this._wheel,!1),i.addEventListener("DOMMouseScroll",this._wheel,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])}},r.prototype.detachControl=function(i){this._attachedElement==i&&(i.removeEventListener(t+"down",this._onPointerDown),i.removeEventListener(t+"up",this._onPointerUp),i.removeEventListener(t+"out",this._onPointerUp),i.removeEventListener(t+"move",this._onPointerMove),i.removeEventListener("mousemove",this._onMouseMove),i.removeEventListener("MSPointerDown",this._onGestureStart),i.removeEventListener("MSGestureChange",this._onGesture),i.removeEventListener("mousewheel",this._wheel),i.removeEventListener("DOMMouseScroll",this._wheel),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._MSGestureHandler=null,this._attachedElement=null,this._reset&&this._reset())},r.prototype._update=function(){for(var t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(i)?this.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(i)?this.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(i)&&(this.inertialBetaOffset+=.01)}(0!=this.inertialAlphaOffset||0!=this.inertialBetaOffset||0!=this.inertialRadiusOffset)&&(this.alpha+=this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Engine.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Engine.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<e.Engine.Epsilon&&(this.inertialRadiusOffset=0)),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerBetaLimit&&this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit&&this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},r.prototype.setPosition=function(e){var t=e.subtract(this._getTargetPosition());this.radius=t.length(),this.alpha=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2))),t.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(t.y/this.radius)},r.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),n=Math.cos(this.beta),r=Math.sin(this.beta),o=this._getTargetPosition();return o.addToRef(new e.Vector3(this.radius*t*r,this.radius*n,this.radius*i*r),this.position),this.checkCollisions&&(this._collider.radius=this.collisionRadius,this.position.subtractToRef(this._previousPosition,this._collisionVelocity),this.getScene()._getNewPosition(this._previousPosition,this._collisionVelocity,this._collider,3,this._newPosition),this._newPosition.equalsWithEpsilon(this.position)||(this.position.copyFrom(this._previousPosition),this.alpha=this._previousAlpha,this.beta=this._previousBeta,this.radius=this._previousRadius,this.onCollide&&this.onCollide(this._collider.collidedMesh))),e.Matrix.LookAtLHToRef(this.position,o,this.upVector,this._viewMatrix),this._previousAlpha=this.alpha,this._previousBeta=this.beta,this._previousRadius=this.radius,this._previousPosition.copyFrom(this.position),this._viewMatrix},r.prototype.zoomOn=function(t){t=t||this.getScene().meshes;var i=e.Mesh.MinMax(t),n=e.Vector3.Distance(i.min,i.max);this.radius=n*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:n})},r.prototype.focusOn=function(t){var i,n;void 0===t.min?(i=t||this.getScene().meshes,i=e.Mesh.MinMax(i),n=e.Vector3.Distance(i.min,i.max)):(i=t,n=t.distance),this.target=e.Mesh.Center(i),this.maxZ=2*n},r}(e.Camera);e.ArcRotateCamera=i}(i||(i={}));var i;!function(e){var t=function(){function t(t){this.autoClear=!0,this.clearColor=new e.Color3(.2,.2,.3),this.ambientColor=new e.Color3(0,0,0),this.forceWireframe=!1,this.cameraToUseForPointers=null,this.fogMode=e.Scene.FOGMODE_NONE,this.fogColor=new e.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this.defaultMaterial=new e.StandardMaterial("default material",this),this.texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spriteManagers=new Array,this.layers=new Array,this.skeletons=new Array,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new e.Vector3(0,-9,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this._actionManagers=new Array,this._meshesForIntersections=new e.SmartArray(256),this._totalVertices=0,this._activeVertices=0,this._activeParticles=0,this._lastFrameDuration=0,this._evaluateActiveMeshesDuration=0,this._renderTargetsDuration=0,this._particlesDuration=0,this._renderDuration=0,this._spritesDuration=0,this._animationRatio=0,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._toBeDisposed=new e.SmartArray(256),this._onReadyCallbacks=new Array,this._pendingData=[],this._onBeforeRenderCallbacks=new Array,this._activeMeshes=new e.SmartArray(256),this._processedMaterials=new e.SmartArray(256),this._renderTargets=new e.SmartArray(256),this._activeParticleSystems=new e.SmartArray(256),this._activeSkeletons=new e.SmartArray(32),this._activeAnimatables=new Array,this._transformMatrix=e.Matrix.Zero(),this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._engine=t,t.scenes.push(this),this._renderingManager=new e.RenderingManager(this),this.postProcessManager=new e.PostProcessManager(this),this.postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager,this._boundingBoxRenderer=new e.BoundingBoxRenderer(this),this.attachControl()}return Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),t.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices},t.prototype.getActiveVertices=function(){return this._activeVertices},t.prototype.getActiveParticles=function(){return this._activeParticles},t.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},t.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},t.prototype.getRenderDuration=function(){return this._renderDuration},t.prototype.getParticlesDuration=function(){return this._particlesDuration},t.prototype.getSpritesDuration=function(){return this._spritesDuration},t.prototype.getAnimationRatio=function(){return this._animationRatio},t.prototype.getRenderId=function(){return this._renderId},t.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},t.prototype.attachControl=function(){var t=this;this._onPointerMove=function(e){var i=t._engine.getRenderingCanvas();t._updatePointerPosition(e);var n=t.pick(t._pointerX,t._pointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPointerTriggers},!1,t.cameraToUseForPointers);n.hit?(t.setPointerOverMesh(n.pickedMesh),i.style.cursor="pointer",t._meshUnderPointer=n.pickedMesh):(t.setPointerOverMesh(null),i.style.cursor="",t._meshUnderPointer=null)},this._onPointerDown=function(i){var n=null;t.onPointerDown||(n=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPickTriggers}),t._updatePointerPosition(i);var r=t.pick(t._pointerX,t._pointerY,n,!1,t.cameraToUseForPointers);if(r.hit&&r.pickedMesh.actionManager){switch(i.button){case 0:r.pickedMesh.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(r.pickedMesh));break;case 1:r.pickedMesh.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(r.pickedMesh));break;case 2:r.pickedMesh.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(r.pickedMesh))}r.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(r.pickedMesh))}t.onPointerDown&&t.onPointerDown(i,r)},this._onKeyDown=function(i){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(t,i))},this._onKeyUp=function(i){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(t,i))};var i=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().addEventListener(i+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener(i+"down",this._onPointerDown,!1),window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1)},t.prototype.detachControl=function(){var t=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(t+"move",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener(t+"down",this._onPointerDown),window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)},t.prototype.isReady=function(){if(this._pendingData.length>0)return!1;for(var t=0;t<this._geometries.length;t++){var i=this._geometries[t];if(i.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(!n.isReady())return!1;var r=n.material;if(r&&!r.isReady(n))return!1}return!0},t.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},t.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this._pendingData.indexOf(e);-1!==t&&this._pendingData.splice(t,1)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},t.prototype.executeWhenReady=function(e){var t=this;this._onReadyCallbacks.push(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype._checkIsReady=function(){var e=this;return this.isReady()?(this._onReadyCallbacks.forEach(function(e){e()}),this._onReadyCallbacks=[],void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},t.prototype.beginAnimation=function(t,i,n,r,o,s,a){if(void 0===o&&(o=1),this.stopAnimation(t),a||(a=new e.Animatable(this,t,i,n,r,o,s)),t.animations&&a.appendAnimations(t,t.animations),t.getAnimatables)for(var h=t.getAnimatables(),c=0;c<h.length;c++)this.beginAnimation(h[c],i,n,r,o,s,a);return a},t.prototype.beginDirectAnimation=function(t,i,n,r,o,s,a){void 0===s&&(s=1);var h=new e.Animatable(this,t,n,r,o,s,a,i);return h},t.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},t.prototype.stopAnimation=function(e){var t=this.getAnimatableByTarget(e);t&&t.stop()},t.prototype._animate=function(){this._animationStartDate||(this._animationStartDate=(new Date).getTime());for(var e=(new Date).getTime(),t=e-this._animationStartDate,i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i]._animate(t)||(this._activeAnimatables.splice(i,1),i--)},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t){this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},t.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getGeometryByID=function(e){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===e)return this._geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!t&&this.getGeometryByID(e.id)?!1:(this._geometries.push(e),!0)},t.prototype.getGeometries=function(){return this._geometries},t.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype._evaluateSubMesh=function(e,t){if(1==t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){var i=e.getMaterial();t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),i&&(i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concat(i.getRenderTargetTextures())),this._activeVertices+=e.verticesCount,this._renderingManager.dispatch(e))}},t.prototype._evaluateActiveMeshes=function(){this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._boundingBoxRenderer.reset(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix);var t,i;if(this._selectionOctree){var n=this._selectionOctree.select(this._frustumPlanes);t=n.data,i=n.length}else i=this.meshes.length,t=this.meshes;for(var r=0;i>r;r++){var o=t[r];this._totalVertices+=o.getTotalVertices(),o.isReady()&&(o.computeWorldMatrix(),o._preActivate(),o.actionManager&&o.actionManager.hasSpecificTriggers([e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(o),o.isEnabled()&&o.isVisible&&o.visibility>0&&0!=(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes)&&(this._activeMeshes.push(o),o._activate(this._renderId),this._activeMesh(o)))}var s=(new Date).getTime();if(this.particlesEnabled)for(var a=0;a<this.particleSystems.length;a++){var h=this.particleSystems[a];h.isStarted()&&(!h.emitter.position||h.emitter&&h.emitter.isEnabled())&&(this._activeParticleSystems.push(h),h.animate())}this._particlesDuration+=(new Date).getTime()-s},t.prototype._activeMesh=function(e){if(e.skeleton&&this._activeSkeletons.pushNoDuplicate(e.skeleton),e.showBoundingBox&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),e.subMeshes){var t,i;if(e._submeshesOctree&&e.useOctreeForRenderingSelection){var n=e._submeshesOctree.select(this._frustumPlanes);t=n.length,i=n.data}else i=e.subMeshes,t=i.length;for(var r=0;t>r;r++){var o=i[r];this._evaluateSubMesh(o,e)}}},t.prototype.updateTransformMatrix=function(e){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._renderForCamera=function(e){var t=this._engine;if(this.activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");t.setViewport(this.activeCamera.viewport),this._renderId++,this.updateTransformMatrix(),this.beforeCameraRender&&this.beforeCameraRender(this.activeCamera);var i=(new Date).getTime();this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=(new Date).getTime()-i;for(var n=0;n<this._activeSkeletons.length;n++){var r=this._activeSkeletons.data[n];r.prepare()}for(var o=0;o<this.customRenderTargets.length;o++){var s=this.customRenderTargets[o];this._renderTargets.push(s)}var a=(new Date).getTime();if(this.renderTargetsEnabled){for(var h=0;h<this._renderTargets.length;h++)s=this._renderTargets.data[h],s._shouldRender()&&(this._renderId++,s.render());this._renderId++}this._renderTargets.length>0&&t.restoreDefaultFramebuffer(),this._renderTargetsDuration=(new Date).getTime()-a,this.postProcessManager._prepareFrame();var c=(new Date).getTime();if(this.layers.length){t.setDepthBuffer(!1);var u,l;for(u=0;u<this.layers.length;u++)l=this.layers[u],l.isBackground&&l.render();t.setDepthBuffer(!0)}this._renderingManager.render(null,null,!0,!0),this._boundingBoxRenderer.render();for(var f=0;f<this.lensFlareSystems.length;f++)this.lensFlareSystems[f].render();if(this.layers.length){for(t.setDepthBuffer(!1),u=0;u<this.layers.length;u++)l=this.layers[u],l.isBackground||l.render();t.setDepthBuffer(!0)}this._renderDuration+=(new Date).getTime()-c,this.postProcessManager._finalizeFrame(e.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),this.afterCameraRender&&this.afterCameraRender(this.activeCamera)},t.prototype._processSubCameras=function(e){if(0==e.subCameras.length)return void this._renderForCamera(e);for(var t=0;t<e.subCameras.length;t++)this._renderForCamera(e.subCameras[t]);this.activeCamera=e,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},t.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++)for(var i=this._meshesForIntersections.data[t],n=0;n<i.actionManager.actions.length;n++){var r=i.actionManager.actions[n];if(r.trigger==e.ActionManager.OnIntersectionEnterTrigger||r.trigger==e.ActionManager.OnIntersectionExitTrigger){var o=r.getTriggerParameter(),s=o.intersectsMesh(i,!1),a=i._intersectionsInProgress.indexOf(o);if(s&&-1===a&&r.trigger==e.ActionManager.OnIntersectionEnterTrigger)i.actionManager.processTrigger(e.ActionManager.OnIntersectionEnterTrigger,e.ActionEvent.CreateNew(i)),i._intersectionsInProgress.push(o);else if(!s&&a>-1&&r.trigger==e.ActionManager.OnIntersectionExitTrigger){i.actionManager.processTrigger(e.ActionManager.OnIntersectionExitTrigger,e.ActionEvent.CreateNew(i));var h=i._intersectionsInProgress.indexOf(o);h>-1&&i._intersectionsInProgress.splice(h,1)}}}},t.prototype.render=function(){var i=(new Date).getTime();this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeVertices=0,this._meshesForIntersections.reset(),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger,null),this.beforeRender&&this.beforeRender();for(var n=0;n<this._onBeforeRenderCallbacks.length;n++)this._onBeforeRenderCallbacks[n]();var r=Math.max(t.MinDeltaTime,Math.min(e.Tools.GetDeltaTime(),t.MaxDeltaTime));this._animationRatio=.06*r,this._animate(),this._physicsEngine&&this._physicsEngine._runOneStep(r/1e3),this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe,!0);for(var o=0;o<this.lights.length;o++){var s=this.lights[o],a=s.getShadowGenerator();s.isEnabled()&&a&&-1!==a.getShadowMap().getScene().textures.indexOf(a.getShadowMap())&&this._renderTargets.push(a.getShadowMap())}if(this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var h=this._renderId,c=0;c<this.activeCameras.length;c++)this._renderId=h,this._processSubCameras(this.activeCameras[c]);else this._processSubCameras(this.activeCamera);this._checkIntersections(),this.afterRender&&this.afterRender();for(var u=0;u<this._toBeDisposed.length;u++)this._toBeDisposed.data[u].dispose(),this._toBeDisposed[u]=null;this._toBeDisposed.reset(),this._lastFrameDuration=(new Date).getTime()-i},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),this.onDispose&&this.onDispose(),this.detachControl();var e,t=this._engine.getRenderingCanvas();for(e=0;e<this.cameras.length;e++)this.cameras[e].detachControl(t);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),e=this._engine.scenes.indexOf(this),this._engine.scenes.splice(e,1),this._engine.wipeCaches()},t.prototype._getNewPosition=function(e,t,i,n,r,o){"undefined"==typeof o&&(o=null),e.divideToRef(i.radius,this._scaledPosition),t.divideToRef(i.radius,this._scaledVelocity),i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,n,r,o),r.multiplyInPlace(i.radius)},t.prototype._collideWithWorld=function(t,i,n,r,o,s){"undefined"==typeof s&&(s=null);var a=10*e.Engine.CollisionsEpsilon;if(n.retry>=r)return void o.copyFrom(t);n._initialize(t,i,a);for(var h=0;h<this.meshes.length;h++){var c=this.meshes[h];c.isEnabled()&&c.checkCollisions&&c.subMeshes&&c!==s&&c._checkCollision(n)}return n.collisionFound?((0!=i.x||0!=i.y||0!=i.z)&&n._getResponse(t,i),i.length()<=a?void o.copyFrom(t):(n.retry++,void this._collideWithWorld(t,i,n,r,o,s))):void t.addToRef(i,o)},t.prototype.createOrUpdateSelectionOctree=function(t,i){"undefined"==typeof t&&(t=64),"undefined"==typeof i&&(i=2),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,t,i));for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=0;o<this.meshes.length;o++){var s=this.meshes[o];
s.computeWorldMatrix(!0);var a=s.getBoundingInfo().boundingBox.minimumWorld,h=s.getBoundingInfo().boundingBox.maximumWorld;e.Tools.CheckExtends(a,n,r),e.Tools.CheckExtends(h,n,r)}return this._selectionOctree.update(n,r,this.meshes),this._selectionOctree},t.prototype.createPickingRay=function(t,i,n,r){var o=this._engine;if(!r){if(!this.activeCamera)throw new Error("Active camera not set");r=this.activeCamera}var s=r.viewport,a=s.toGlobal(o);return t=t/this._engine.getHardwareScalingLevel()-a.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-a.y-a.height),e.Ray.CreateNew(t/window.devicePixelRatio,i/window.devicePixelRatio,a.width,a.height,n?n:e.Matrix.Identity(),r.getViewMatrix(),r.getProjectionMatrix())},t.prototype._internalPick=function(t,i,n){for(var r=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(i){if(!i(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=s.getWorldMatrix(),h=t(a),c=s.intersects(h,n);if(c&&c.hit&&(n||null==r||!(c.distance>=r.distance))&&(r=c,n))break}return r||new e.PickingInfo},t.prototype.pick=function(e,t,i,n,r){var o=this;return this._internalPick(function(i){return o.createPickingRay(e,t,i,r)},i,n)},t.prototype.pickWithRay=function(t,i,n){var r=this;return this._internalPick(function(i){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(r._pickWithRayInverseMatrix),e.Ray.Transform(t,r._pickWithRayInverseMatrix)},i,n)},t.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},t.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},t.prototype.getPhysicsEngine=function(){return this._physicsEngine},t.prototype.enablePhysics=function(t,i){return this._physicsEngine?!0:(this._physicsEngine=new e.PhysicsEngine(i),this._physicsEngine.isSupported()?(this._physicsEngine._initialize(t),!0):(this._physicsEngine=null,!1))},t.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},t.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},t.prototype.setGravity=function(e){this._physicsEngine&&this._physicsEngine._setGravity(e)},t.prototype.createCompoundImpostor=function(e,t){if(e.parts&&(t=e,e=e.parts),!this._physicsEngine)return null;for(var i=0;i<e.length;i++){var n=e[i].mesh;n._physicImpostor=e[i].impostor,n._physicsMass=t.mass/e.length,n._physicsFriction=t.friction,n._physicRestitution=t.restitution}return this._physicsEngine._registerMeshesAsCompound(e,t)},t.prototype.deleteCompoundImpostor=function(t){for(var i=0;i<t.parts.length;i++){var n=t.parts[i].mesh;n._physicImpostor=e.PhysicsEngine.NoImpostor,this._physicsEngine._unregisterMesh(n)}},t.prototype._getByTags=function(t,i){if(void 0===i)return t;var n=[];for(var r in t){var o=t[r];e.Tags.MatchesQuery(o,i)&&n.push(o)}return n},t.prototype.getMeshesByTags=function(e){return this._getByTags(this.meshes,e)},t.prototype.getCamerasByTags=function(e){return this._getByTags(this.cameras,e)},t.prototype.getLightsByTags=function(e){return this._getByTags(this.lights,e)},t.prototype.getMaterialByTags=function(e){return this._getByTags(this.materials,e).concat(this._getByTags(this.multiMaterials,e))},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}();e.Scene=t}(i||(i={}));var i;!function(e){var t=function(){function t(i,n,r,o,s){switch(this._engine=i instanceof e.Mesh?i.getScene().getEngine():i,this._updatable=o,this._data=n,s||this.create(),this._kind=r,r){case t.PositionKind:this._strideSize=3;break;case t.NormalKind:this._strideSize=3;break;case t.UVKind:this._strideSize=2;break;case t.UV2Kind:this._strideSize=2;break;case t.ColorKind:this._strideSize=3;break;case t.MatricesIndicesKind:this._strideSize=4;break;case t.MatricesWeightsKind:this._strideSize=4}}return t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.create=function(e){(e||!this._buffer)&&(e=e||this._data,this._buffer||(this._buffer=this._updatable?this._engine.createDynamicVertexBuffer(4*e.length):this._engine.createVertexBuffer(e)),this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e))},t.prototype.update=function(e){this.create(e)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Object.defineProperty(t,"PositionKind",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NormalKind",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UVKind",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV2Kind",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorKind",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesKind",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsKind",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),t._PositionKind="position",t._NormalKind="normal",t._UVKind="uv",t._UV2Kind="uv2",t._ColorKind="color",t._MatricesIndicesKind="matricesIndices",t._MatricesWeightsKind="matricesWeights",t}();e.VertexBuffer=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n){t.call(this,i,n),this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=e.AbstractMesh.BILLBOARDMODE_NONE,this.visibility=1,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.checkCollisions=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=4294967295,this._physicImpostor=e.PhysicsEngine.NoImpostor,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,n.meshes.push(this)}return n(i,t),Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(){return null},i.prototype.isVerticesDataPresent=function(){return!1},i.prototype.getBoundingInfo=function(){return this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo},i.prototype._preActivate=function(){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},Object.defineProperty(i.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,n){if(this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),n&&0!=n){if(this.parent){var r=this.parent.getWorldMatrix().clone();r.invert(),t=e.Vector3.TransformNormal(t,r)}o=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,i);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},i.prototype.translate=function(e,t,i){var n=e.scale(t);if(i&&0!=i)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var r=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(r)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,n,r;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],n=arguments[1],r=arguments[2]}else i=t.x,n=t.y,r=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,n,r);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=n,this.position.z=r}},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},i.prototype.markAsDirty=function(e){"rotation"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){if(this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.updateBoundingInfo(this.worldMatrixFromCache)}},i.prototype.computeWorldMatrix=function(t){if(!t&&(this._currentRenderId==this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var n=this.getScene().activeCamera,r=n.getWorldMatrix(),o=new e.Vector3(r.m[12],r.m[13],r.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==i.BILLBOARDMODE_NONE){var s=this.position.clone(),a=this.getScene().activeCamera.position.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&i.BILLBOARDMODE_ALL)===i.BILLBOARDMODE_ALL?a=this.getScene().activeCamera.position:(this.billboardMode&e.AbstractMesh.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&e.AbstractMesh.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&e.AbstractMesh.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}return this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===e.AbstractMesh.BILLBOARDMODE_NONE?this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._worldMatrix},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,n,r){i=i||0,n=n||0,r=r||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+n,r)},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)?!0:!1},i.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},i.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},i.prototype.setPhysicsState=function(t,i){var n=this.getScene().getPhysicsEngine();if(n){if(t.impostor&&(i=t,t=t.impostor),t=t||e.PhysicsEngine.NoImpostor,t===e.PhysicsEngine.NoImpostor)return void n._unregisterMesh(this);i.mass=i.mass||0,i.friction=i.friction||.2,i.restitution=i.restitution||.9,this._physicImpostor=t,this._physicsMass=i.mass,this._physicsFriction=i.friction,this._physicRestitution=i.restitution,n._registerMesh(this,t,i)}},i.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},i.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},i.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},i.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},i.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},i.prototype.setPhysicsLinkWith=function(e,t,i,n){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,i,n)},i.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},i.prototype.moveWithCollisions=function(t){var i=this.getAbsolutePosition();i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene()._getNewPosition(this._oldPositionForCollisions,t,this._collider,3,this._newPositionForCollisions,this),this._newPositionForCollisions.subtractToRef(this._oldPositionForCollisions,this._diffPositionForCollisions),this._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&this.position.addInPlace(this._diffPositionForCollisions)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){"undefined"==typeof t&&(t=64),"undefined"==typeof i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var n=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(n.minimumWorld,n.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,n){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var r=t.verticesStart,o=t.verticesStart+t.verticesCount,s=r;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}n._collide(t,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,n;if(this._submeshesOctree&&this.useOctreeForCollisions){var r=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,r);n=o.length,i=o.data}else i=this.subMeshes,n=i.length;for(var s=0;n>s;s++){var a=i[s];n>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){this._boundingInfo._checkCollision(t)&&(e.Matrix.ScalingToRef(1/t.radius.x,1/t.radius.y,1/t.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix))},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(t,i){var n=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return n;if(!this._generatePointsArray())return n;var r,o,s=null;if(this._submeshesOctree&&this.useOctreeForPicking){var a=e.Ray.Transform(t,this.getWorldMatrix()),h=this._submeshesOctree.intersectsRay(a);o=h.length,r=h.data}else r=this.subMeshes,o=r.length;for(var c=0;o>c;c++){var u=r[c];if(!(o>1)||u.canIntersects(t)){var l=u.intersects(t,this._positions,this.getIndices(),i);if(l&&(i||!s||l.distance<s.distance)&&(s=l,i))break}}if(s){var f=this.getWorldMatrix(),p=e.Vector3.TransformCoordinates(t.origin,f),d=t.direction.clone();d.normalize(),d=d.scale(s.distance);var m=e.Vector3.TransformNormal(d,f),g=p.add(m);return n.hit=!0,n.distance=e.Vector3.Distance(p,g),n.pickedPoint=g,n.pickedMesh=this,n.bu=s.bu,n.bv=s.bv,n.faceId=s.faceId,n}return n},i.prototype.clone=function(){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array},i.prototype.dispose=function(t){for(this.getPhysicsImpostor()!=e.PhysicsEngine.NoImpostor&&this.setPhysicsState(e.PhysicsEngine.NoImpostor),r=0;r<this._intersectionsInProgress.length;r++){var i=this._intersectionsInProgress[r],n=i._intersectionsInProgress.indexOf(this);i._intersectionsInProgress.splice(n,1)}this._intersectionsInProgress=[],this.releaseSubMeshes();var r=this.getScene().meshes.indexOf(this);if(this.getScene().meshes.splice(r,1),t)for(r=0;r<this.getScene().meshes.length;r++){var o=this.getScene().meshes[r];o.parent===this&&(o.parent=null,o.computeWorldMatrix(!0))}else{for(r=0;r<this.getScene().particleSystems.length;r++)this.getScene().particleSystems[r].emitter==this&&(this.getScene().particleSystems[r].dispose(),r--);var s=this.getScene().meshes.slice(0);for(r=0;r<s.length;r++)s[r].parent==this&&s[r].dispose()}this._isDisposed=!0,this.onDispose&&this.onDispose()},i._BILLBOARDMODE_NONE=0,i._BILLBOARDMODE_X=1,i._BILLBOARDMODE_Y=2,i._BILLBOARDMODE_Z=4,i._BILLBOARDMODE_ALL=7,i}(e.Node);e.AbstractMesh=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(){function e(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return e}();e._InstancesBatch=t;var i=function(i){function r(n,r){i.call(this,n,r),this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.instances=new Array,this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._visibleInstances={},this._renderIdForInstances=new Array,this._batchCache=new t,this._instancesBufferSize=2048}return n(r,i),r.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},r.prototype.getVerticesData=function(e){return this._geometry?this._geometry.getVerticesData(e):null},r.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):void 0},r.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},r.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=[];if(this._delayInfo)for(var t in this._delayInfo)e.push(t);return e}return this._geometry.getVerticesDataKinds()},r.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},r.prototype.getIndices=function(){return this._geometry?this._geometry.getIndices():[]},r.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isReady.call(this)},r.prototype.isDisposed=function(){return this._isDisposed},r.prototype._preActivate=function(){var e=this.getScene().getRenderId();this._preActivateId!=e&&(this._preActivateId=e,this._visibleInstances=null)},r.prototype._registerInstanceForRenderId=function(e,t){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[t]||(this._visibleInstances[t]=new Array),this._visibleInstances[t].push(e)},r.prototype.refreshBoundingInfo=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}if(this.subMeshes)for(var n=0;n<this.subMeshes.length;n++)this.subMeshes[n].refreshBoundingInfo();this._updateBoundingInfo()},r.prototype._createGlobalSubMesh=function(){var t=this.getTotalVertices();return t&&this.getIndices()?(this.releaseSubMeshes(),new e.SubMesh(0,0,t,0,this.getTotalIndices(),this)):null},r.prototype.subdivide=function(t){if(!(1>t)){for(var i=this.getTotalIndices(),n=i/t|0,r=0;n%3!=0;)n++;this.releaseSubMeshes();for(var o=0;t>o&&!(r>=i);o++)e.SubMesh.CreateFromIndices(0,r,Math.min(n,i-r),this),r+=n;this.synchronizeInstances()}},r.prototype.setVerticesData=function(t,i,n){if(t instanceof Array){var r=i;i=t,t=r,e.Tools.Warn("Deprecated usage of setVerticesData detected (since v1.12). Current signature is setVerticesData(kind, data, updatable).")}if(this._geometry)this._geometry.setVerticesData(t,i,n);else{var o=new e.VertexData;o.set(i,t);var s=this.getScene();new e.Geometry(e.Geometry.RandomId(),s,o,n,this)}},r.prototype.updateVerticesData=function(e,t,i,n){this._geometry&&(n?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i))},r.prototype.makeGeometryUnique=function(){if(this._geometry){var t=this._geometry.copy(e.Geometry.RandomId());t.applyToMesh(this)}},r.prototype.setIndices=function(t){if(this._geometry)this._geometry.setIndices(t);else{var i=new e.VertexData;i.indices=t;var n=this.getScene();new e.Geometry(e.Geometry.RandomId(),n,i,!1,this)}},r.prototype._bind=function(e,t,i){var n=this.getScene().getEngine(),r=this._geometry.getIndexBuffer();i&&(r=e.getLinesIndexBuffer(this.getIndices(),n)),n.bindMultiBuffers(this._geometry.getVertexBuffers(),r,t)},r.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var n=this.getScene().getEngine();n.draw(t,t?e.indexStart:0,t?e.indexCount:e.linesIndexCount,i)}},r.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},r.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},r.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},r.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},r.prototype._getInstancesRenderList=function(e){var t=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,this._visibleInstances){var i=t.getRenderId();this._batchCache.visibleInstances[e]=this._visibleInstances[i];var n=this._renderId;if(!this._batchCache.visibleInstances[e]&&this._visibleInstances.defaultRenderId&&(this._batchCache.visibleInstances[e]=this._visibleInstances[this._visibleInstances.defaultRenderId],i=this._visibleInstances.defaultRenderId,n=this._visibleInstances.selfDefaultRenderId),this._batchCache.visibleInstances[e]&&this._batchCache.visibleInstances[e].length){if(this._renderIdForInstances[e]===i)return this._batchCache.mustReturn=!0,this._batchCache;i!==n&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=i}return this._batchCache},r.prototype._renderWithInstances=function(e,t,i,n,r){for(var o=this.instances.length+1,s=16*o*4;this._instancesBufferSize<s;)this._instancesBufferSize*=2;(!this._worldMatricesInstancesBuffer||this._worldMatricesInstancesBuffer.capacity<this._instancesBufferSize)&&(this._worldMatricesInstancesBuffer&&r.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=r.createInstancesBuffer(this._instancesBufferSize),this._worldMatricesInstancesArray=new Float32Array(this._instancesBufferSize/4));var a=0,h=0,c=this.getWorldMatrix();i.renderSelf[e._id]&&(c.copyToArray(this._worldMatricesInstancesArray,a),a+=16,h++);var u=i.visibleInstances[e._id];if(u)for(var l=0;l<u.length;l++){var f=u[l];f.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray,a),a+=16,h++}var p=n.getAttributeLocationByName("world0"),d=n.getAttributeLocationByName("world1"),m=n.getAttributeLocationByName("world2"),g=n.getAttributeLocationByName("world3"),_=[p,d,m,g];r.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer,this._worldMatricesInstancesArray,_),this._draw(e,!t,h),r.unBindInstancesBuffer(this._worldMatricesInstancesBuffer,_)},r.prototype.render=function(e){var t=this.getScene(),i=this._getInstancesRenderList(e._id);if(!i.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){for(var n=0;n<this._onBeforeRenderCallbacks.length;n++)this._onBeforeRenderCallbacks[n]();var r=t.getEngine(),o=null!==r.getCaps().instancedArrays&&null!==i.visibleInstances[e._id],s=e.getMaterial();if(s&&s.isReady(this,o)){s._preBind();var a=s.getEffect(),h=r.forceWireframe||s.wireframe;this._bind(e,a,h);var c=this.getWorldMatrix();if(s.bind(c,this),o)this._renderWithInstances(e,h,i,a,r);else if(i.renderSelf[e._id]&&this._draw(e,!h),i.visibleInstances[e._id])for(var u=0;u<i.visibleInstances[e._id].length;u++){var l=i.visibleInstances[e._id][u];c=l.getWorldMatrix(),s.bindOnlyWorldMatrix(c),this._draw(e,!h)}for(s.unbind(),n=0;n<this._onAfterRenderCallbacks.length;n++)this._onAfterRenderCallbacks[n]()}}},r.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var i=this.getScene().particleSystems[t];i.emitter===this&&e.push(i)}return e},r.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var i=0;i<this.getScene().particleSystems.length;i++){var n=this.getScene().particleSystems[i];-1!==t.indexOf(n.emitter)&&e.push(n)}return e},r.prototype.getChildren=function(){for(var e=[],t=0;t<this.getScene().meshes.length;t++){var i=this.getScene().meshes[t];i.parent==this&&e.push(i)}return e},r.prototype._checkDelayState=function(){var t=this,i=this,n=this.getScene();this._geometry?this._geometry.load(n):i.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(i.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,n._addPendingData(i),e.Tools.LoadFile(this.delayLoadingFile,function(i){t._delayLoadingFunction(JSON.parse(i),t),t.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,n._removePendingData(t)},function(){},n.database))},r.prototype.isInFrustum=function(t){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:i.prototype.isInFrustum.call(this,t)?(this._checkDelayState(),!0):!1},r.prototype.setMaterialByID=function(e){for(var t=this.getScene().materials,i=0;i<t.length;i++)if(t[i].id==e)return void(this.material=t[i]);var n=this.getScene().multiMaterials;for(i=0;i<n.length;i++)if(n[i].id==e)return void(this.material=n[i])},r.prototype.getAnimatables=function(){var e=[];return this.material&&e.push(this.material),e},r.prototype.bakeTransformIntoVertices=function(t){if(this.isVerticesDataPresent(e.VertexBuffer.PositionKind)){this._resetPointsArrayCache();for(var i=this.getVerticesData(e.VertexBuffer.PositionKind),n=[],r=0;r<i.length;r+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(i,r),t).toArray(n,r);if(this.setVerticesData(e.VertexBuffer.PositionKind,n,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)){for(i=this.getVerticesData(e.VertexBuffer.NormalKind),r=0;r<i.length;r+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(i,r),t).toArray(n,r);this.setVerticesData(e.VertexBuffer.NormalKind,n,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable())}}},r.prototype._resetPointsArrayCache=function(){this._positions=null},r.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return!1;for(var i=0;i<t.length;i+=3)this._positions.push(e.Vector3.FromArray(t,i));return!0},r.prototype.clone=function(t,i,n){var r=new e.Mesh(t,this.getScene());if(this._geometry.applyToMesh(r),e.Tools.DeepCopy(this,r,["name","material","skeleton"],[]),r.material=this.material,i&&(r.parent=i),!n)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent==this&&s.clone(s.name,r)}for(o=0;o<this.getScene().particleSystems.length;o++){var a=this.getScene().particleSystems[o];a.emitter==this&&a.clone(a.name,r)}return r.computeWorldMatrix(!0),r},r.prototype.dispose=function(e){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._worldMatricesInstancesBuffer&&(this.getEngine().deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=null);this.instances.length;)this.instances[0].dispose();
i.prototype.dispose.call(this,e)},r.prototype.convertToFlatShadedMesh=function(){for(var t=this.getVerticesDataKinds(),i=[],n=[],r=[],o=!1,s=0;s<t.length;s++){var a=t[s],h=this.getVertexBuffer(a);a!==e.VertexBuffer.NormalKind?(i[a]=h,n[a]=i[a].getData(),r[a]=[]):(o=h.isUpdatable(),t.splice(s,1),s--)}var c=this.subMeshes.slice(0),u=this.getIndices(),l=this.getTotalIndices();for(_=0;l>_;_++){var f=u[_];for(s=0;s<t.length;s++){a=t[s];for(var p=i[a].getStrideSize(),d=0;p>d;d++)r[a].push(n[a][f*p+d])}}for(var m=[],g=r[e.VertexBuffer.PositionKind],_=0;l>_;_+=3){u[_]=_,u[_+1]=_+1,u[_+2]=_+2;for(var v=e.Vector3.FromArray(g,3*_),y=e.Vector3.FromArray(g,3*(_+1)),x=e.Vector3.FromArray(g,3*(_+2)),b=v.subtract(y),T=x.subtract(y),w=e.Vector3.Normalize(e.Vector3.Cross(b,T)),M=0;3>M;M++)m.push(w.x),m.push(w.y),m.push(w.z)}for(this.setIndices(u),this.setVerticesData(e.VertexBuffer.NormalKind,m,o),s=0;s<t.length;s++)a=t[s],this.setVerticesData(a,r[a],i[a].isUpdatable());this.releaseSubMeshes();for(var E=0;E<c.length;E++){var A=c[E];new e.SubMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}this.synchronizeInstances()},r.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},r.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){var t=this.instances[e];t._syncSubMeshes()}},r.CreateBox=function(t,i,n,r){var o=new e.Mesh(t,n),s=e.VertexData.CreateBox(i);return s.applyToMesh(o,r),o},r.CreateSphere=function(t,i,n,r,o){var s=new e.Mesh(t,r),a=e.VertexData.CreateSphere(i,n);return a.applyToMesh(s,o),s},r.CreateCylinder=function(t,i,n,r,o,s,a,h){void 0!==a&&a instanceof e.Scene||(void 0!==a&&(h=a),a=s,s=1);var c=new e.Mesh(t,a),u=e.VertexData.CreateCylinder(i,n,r,o,s);return u.applyToMesh(c,h),c},r.CreateTorus=function(t,i,n,r,o,s){var a=new e.Mesh(t,o),h=e.VertexData.CreateTorus(i,n,r);return h.applyToMesh(a,s),a},r.CreateTorusKnot=function(t,i,n,r,o,s,a,h,c){var u=new e.Mesh(t,h),l=e.VertexData.CreateTorusKnot(i,n,r,o,s,a);return l.applyToMesh(u,c),u},r.CreateLines=function(t,i,n,r){var o=new e.LinesMesh(t,n,r),s=e.VertexData.CreateLines(i);return s.applyToMesh(o,r),o},r.CreatePlane=function(t,i,n,r){var o=new e.Mesh(t,n),s=e.VertexData.CreatePlane(i);return s.applyToMesh(o,r),o},r.CreateGround=function(t,i,n,r,o,s){var a=new e.GroundMesh(t,o);a._setReady(!1),a._subdivisions=r;var h=e.VertexData.CreateGround(i,n,r);return h.applyToMesh(a,s),a._setReady(!0),a},r.CreateTiledGround=function(t,i,n,r,o,s,a,h,c){var u=new e.Mesh(t,h),l=e.VertexData.CreateTiledGround(i,n,r,o,s,a);return l.applyToMesh(u,c),u},r.CreateGroundFromHeightMap=function(t,i,n,r,o,s,a,h,c){var u=new e.GroundMesh(t,h);u._subdivisions=o,u._setReady(!1);var l=function(t){var i=document.createElement("canvas"),h=i.getContext("2d"),l=t.width,f=t.height;i.width=l,i.height=f,h.drawImage(t,0,0);var p=h.getImageData(0,0,l,f).data,d=e.VertexData.CreateGroundFromHeightMap(n,r,o,s,a,p,l,f);d.applyToMesh(u,c),u._setReady(!0)};return e.Tools.LoadImage(i,l,function(){},h.database),u},r.MinMax=function(e){var t=null,i=null;for(var n in e){var r=e[n],o=r.getBoundingInfo().boundingBox;t?(t.MinimizeInPlace(o.minimumWorld),i.MaximizeInPlace(o.maximumWorld)):(t=o.minimumWorld,i=o.maximumWorld)}return{min:t,max:i}},r.Center=function(t){var i=void 0!==t.min?t:e.Mesh.MinMax(t);return e.Vector3.Center(i.min,i.max)},r}(e.AbstractMesh);e.Mesh=i}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n){t.call(this,i,n),this.generateOctree=!1,this._worldInverse=new e.Matrix}return n(i,t),Object.defineProperty(i.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32)},i.prototype.getHeightAtCoordinates=function(t,i){var n=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,i),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),n=e.Ray.Transform(n,this._worldInverse);var r=this.intersects(n);return r.hit?r.pickedPoint.y:0},i}(e.Mesh);e.GroundMesh=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i){t.call(this,e,i.getScene()),i.instances.push(this),this._sourceMesh=i,this.position.copyFrom(i.position),this.rotation.copyFrom(i.rotation),this.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(this.rotationQuaternion=i.rotationQuaternion.clone()),this.infiniteDistance=i.infiniteDistance,this.setPivotMatrix(i.getPivotMatrix()),this.refreshBoundingInfo(),this._syncSubMeshes()}return n(i,t),Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.getVerticesData=function(e){return this._sourceMesh.getVerticesData(e)},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this._sourceMesh.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}this._updateBoundingInfo()},i.prototype._preActivate=function(){this.sourceMesh._preActivate()},i.prototype._activate=function(e){this.sourceMesh._registerInstanceForRenderId(this,e)},i.prototype._syncSubMeshes=function(){this.releaseSubMeshes();for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh)},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,n){var r=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,r,["name"],[]),this.refreshBoundingInfo(),i&&(r.parent=i),!n)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent==this&&s.clone(s.name,r)}return r.computeWorldMatrix(!0),r},i.prototype.dispose=function(e){var i=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(i,1),t.prototype.dispose.call(this,e)},i}(e.AbstractMesh);e.InstancedMesh=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t,i,n,r,o,s,a){"undefined"==typeof a&&(a=!0),this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=n,this.indexCount=r,this._renderId=0,this._mesh=o,this._renderingMesh=s||o,o.subMeshes.push(this),this._id=o.subMeshes.length-1,a&&this.refreshBoundingInfo()}return t.prototype.getBoundingInfo=function(){return this._boundingInfo},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var t=this._renderingMesh.material;if(t&&t instanceof e.MultiMaterial){var i=t;return i.getSubMaterial(this.materialIndex)}return t?t:this._mesh.getScene().defaultMaterial},t.prototype.refreshBoundingInfo=function(){var t=this._renderingMesh.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return void(this._boundingInfo=this._mesh._boundingInfo);var i,n=this._renderingMesh.getIndices();i=0===this.indexStart&&this.indexCount===n.length?e.Tools.ExtractMinAndMax(t,this.verticesStart,this.verticesCount):e.Tools.ExtractMinAndMaxIndexed(t,n,this.indexStart,this.indexCount),this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)},t.prototype._checkCollision=function(e){return this._boundingInfo._checkCollision(e)},t.prototype.updateBoundingInfo=function(e){this._boundingInfo||this.refreshBoundingInfo(),this._boundingInfo._update(e)},t.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},t.prototype.render=function(){this._renderingMesh.render(this)},t.prototype.getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)i.push(e[n],e[n+1],e[n+1],e[n+2],e[n+2],e[n]);this._linesIndexBuffer=t.createIndexBuffer(i),this.linesIndexCount=i.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(e){return e.intersectsBox(this._boundingInfo.boundingBox)},t.prototype.intersects=function(e,t,i,n){for(var r=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=3){var s=t[i[o]],a=t[i[o+1]],h=t[i[o+2]],c=e.intersectsTriangle(s,a,h);if(c&&(n||!r||c.distance<r.distance)&&(r=c,r.faceId=o/3,n))break}return r},t.prototype.clone=function(i,n){var r=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,i,n,!1);return r._boundingInfo=new e.BoundingInfo(this._boundingInfo.minimum,this._boundingInfo.maximum),r},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},t.CreateFromIndices=function(t,i,n,r,o){var s=Number.MAX_VALUE,a=-Number.MAX_VALUE;o=o||r;for(var h=o.getIndices(),c=i;i+n>c;c++){var u=h[c];s>u&&(s=u),u>a&&(a=u)}return new e.SubMesh(t,s,a-s+1,i,n,r,o)},t}();e.SubMesh=t}(i||(i={}));var i;!function(e){var t=function(){function t(t){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.isCube=!1,this.isRenderTarget=!1,this.animations=new Array,this.coordinatesIndex=0,this.coordinatesMode=e.Texture.EXPLICIT_MODE,this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this._scene=t,this._scene.textures.push(this)}return t.prototype.getScene=function(){return this._scene},t.prototype.getTextureMatrix=function(){return null},t.prototype.getReflectionTextureMatrix=function(){return null},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED?!0:this._texture?this._texture.isReady:!1},t.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},t.prototype.getBaseSize=function(){return this.isReady()?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},t.prototype._getFromCache=function(e,t){for(var i=this._scene.getEngine().getLoadedTexturesCache(),n=0;n<i.length;n++){var r=i[n];if(r.url===e&&r.noMipmap===t)return r.references++,r}return null},t.prototype.delayLoad=function(){},t.prototype.releaseInternalTexture=function(){if(this._texture){var e=this._scene.getEngine().getLoadedTexturesCache();if(this._texture.references--,0==this._texture.references){var t=e.indexOf(this._texture);e.splice(t,1),this._scene.getEngine()._releaseTexture(this._texture),delete this._texture}}},t.prototype.clone=function(){return null},t.prototype.dispose=function(){var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDispose&&this.onDispose())},t}();e.BaseTexture=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i){this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._scene=i}return t.prototype.render=function(t,i){if(t)return t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,i),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return!1;var n,r,o=this._scene.getEngine();for(n=0;n<this._opaqueSubMeshes.length;n++)r=this._opaqueSubMeshes.data[n],this._activeVertices+=r.verticesCount,r.render();for(o.setAlphaTesting(!0),n=0;n<this._alphaTestSubMeshes.length;n++)r=this._alphaTestSubMeshes.data[n],this._activeVertices+=r.verticesCount,r.render();if(o.setAlphaTesting(!1),i&&i(),this._transparentSubMeshes.length){for(n=0;n<this._transparentSubMeshes.length;n++)r=this._transparentSubMeshes.data[n],r._distanceToCamera=r.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.position).length();var s=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);for(s.sort(function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),o.setAlphaMode(e.Engine.ALPHA_COMBINE),n=0;n<s.length;n++)r=s[n],this._activeVertices+=r.verticesCount,r.render();o.setAlphaMode(e.Engine.ALPHA_DISABLE)}return!0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},t.prototype.dispatch=function(e){var t=e.getMaterial(),i=e.getMesh();t.needAlphaBlending()||i.visibility<1?(t.alpha>0||i.visibility<1)&&this._transparentSubMeshes.push(e):t.needAlphaTesting()?this._alphaTestSubMeshes.push(e):this._opaqueSubMeshes.push(e)},t}();e.RenderingGroup=t}(i||(i={}));var i;!function(e){var t=function(){function t(e){this._renderingGroups=new Array,this._scene=e}return t.prototype._renderParticles=function(e,t){if(0!==this._scene._activeParticleSystems.length){for(var i=(new Date).getTime(),n=0;n<this._scene._activeParticleSystems.length;n++){var r=this._scene._activeParticleSystems.data[n];r.renderingGroupId===e&&(this._clearDepthBuffer(),r.emitter.position&&t&&-1===t.indexOf(r.emitter)||(this._scene._activeParticles+=r.render()))}this._scene._particlesDuration+=(new Date).getTime()-i}},t.prototype._renderSprites=function(e){if(0!==this._scene.spriteManagers.length){for(var t=(new Date).getTime(),i=0;i<this._scene.spriteManagers.length;i++){var n=this._scene.spriteManagers[i];n.renderingGroupId===e&&(this._clearDepthBuffer(),n.render())}this._scene._spritesDuration+=(new Date).getTime()-t}},t.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},t.prototype.render=function(t,i,n,r){for(var o=this,s=0;s<e.RenderingManager.MAX_RENDERINGGROUPS;s++){this._depthBufferAlreadyCleaned=!1;var a=this._renderingGroups[s];a?(this._clearDepthBuffer(),a.render(t,function(){r&&o._renderSprites(s)})||this._renderingGroups.splice(s,1)):r&&this._renderSprites(s),n&&this._renderParticles(s,i)}},t.prototype.reset=function(){for(var e in this._renderingGroups){var t=this._renderingGroups[e];t.prepare()}},t.prototype.dispatch=function(t){var i=t.getMesh(),n=i.renderingGroupId||0;this._renderingGroups[n]||(this._renderingGroups[n]=new e.RenderingGroup(n,this._scene)),this._renderingGroups[n].dispatch(t)},t.MAX_RENDERINGGROUPS=4,t}();e.RenderingManager=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(n,r,o,s,a){"undefined"==typeof a&&(a=i.TRILINEAR_SAMPLINGMODE),t.call(this,r),this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.name=n,this.url=n,this._noMipmap=o,this._invertY=s,this._samplingMode=a,n&&(this._texture=this._getFromCache(n,o),this._texture||(r.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=r.getEngine().createTexture(n,o,s,r,this._samplingMode)))}return n(i,t),i.prototype.delayLoad=function(){this.delayLoadState==e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode)))},i.prototype._prepareRowForTextureGeneration=function(t,i,n,r){t-=this.uOffset+.5,i-=this.vOffset+.5,n-=.5,e.Vector3.TransformCoordinatesFromFloatsToRef(t,i,n,this._rowGenerationMatrix,r),r.x*=this.uScale,r.y*=this.vScale,r.x+=.5,r.y+=.5,r.z+=.5},i.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._rowGenerationMatrix=new e.Matrix,this._t0=e.Vector3.Zero(),this._t1=e.Vector3.Zero(),this._t2=e.Vector3.Zero()),e.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},i.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._projectionModeMatrix=e.Matrix.Zero()),this.coordinatesMode){case e.Texture.SPHERICAL_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=-.5*this.uScale,this._cachedTextureMatrix[5]=-.5*this.vScale,this._cachedTextureMatrix[12]=.5+this.uOffset,this._cachedTextureMatrix[13]=.5+this.vOffset;break;case e.Texture.PLANAR_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case e.Texture.PROJECTION_MODE:e.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1,this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:e.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},i.prototype.clone=function(){var t=new e.Texture(this._texture.url,this.getScene(),this._noMipmap,this._invertY);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t.uOffset=this.uOffset,t.vOffset=this.vOffset,t.uScale=this.uScale,t.vScale=this.vScale,t.uAng=this.uAng,t.vAng=this.vAng,t.wAng=this.wAng,t},i.NEAREST_SAMPLINGMODE=1,i.BILINEAR_SAMPLINGMODE=2,i.TRILINEAR_SAMPLINGMODE=3,i.EXPLICIT_MODE=0,i.SPHERICAL_MODE=1,i.PLANAR_MODE=2,i.CUBIC_MODE=3,i.PROJECTION_MODE=4,i.SKYBOX_MODE=5,i.CLAMP_ADDRESSMODE=0,i.WRAP_ADDRESSMODE=1,i.MIRROR_ADDRESSMODE=2,i}(e.BaseTexture);e.Texture=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o){t.call(this,n),this.coordinatesMode=e.Texture.CUBIC_MODE,this.name=i,this.url=i,this._noMipmap=o,this.hasAlpha=!1,this._texture=this._getFromCache(i,o),r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._extensions=r,this._texture||(n.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=n.getEngine().createCubeTexture(i,n,r,o)),this.isCube=!0,this._textureMatrix=e.Matrix.Identity()}return n(i,t),i.prototype.clone=function(){var t=new e.CubeTexture(this.url,this.getScene(),this._extensions,this._noMipmap);return t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t},i.prototype.delayLoad=function(){this.delayLoadState==e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i}(e.BaseTexture);e.CubeTexture=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o,s){"undefined"==typeof s&&(s=!0),t.call(this,null,r,!o),this.renderList=new Array,this.renderParticles=!0,this.renderSprites=!1,this.coordinatesMode=e.Texture.PROJECTION_MODE,this._currentRefreshId=-1,this._refreshRate=1,this.name=i,this.isRenderTarget=!0,this._size=n,this._generateMipMaps=o,this._doNotChangeAspectRatio=s,this._texture=r.getEngine().createRenderTargetTexture(n,o),this._renderingManager=new e.RenderingManager(r)}return n(i,t),i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate==this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},i.prototype.getRenderSize=function(){return this._size},i.prototype.resize=function(e,t){this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t)},i.prototype.render=function(e){var t=this.getScene(),i=t.getEngine();if(this._waitingRenderList){this.renderList=[];for(var n=0;n<this._waitingRenderList.length;n++){var r=this._waitingRenderList[n];this.renderList.push(t.getMeshByID(r))}delete this._waitingRenderList}if(this.renderList&&0!=this.renderList.length){e&&t.postProcessManager._prepareFrame(this._texture)||i.bindFramebuffer(this._texture),i.clear(t.clearColor,!0,!0),this._renderingManager.reset();for(var o=0;o<this.renderList.length;o++){var s=this.renderList[o];if(s){if(!s.isReady()||s.material&&!s.material.isReady()){this.resetRefreshCounter();continue}if(s.isEnabled()&&s.isVisible&&s.subMeshes&&0!=(s.layerMask&t.activeCamera.layerMask)){s._activate(t.getRenderId());for(var a=0;a<s.subMeshes.length;a++){var h=s.subMeshes[a];t._activeVertices+=h.verticesCount,this._renderingManager.dispatch(h)}}}}this._doNotChangeAspectRatio||t.updateTransformMatrix(!0),this.onBeforeRender&&this.onBeforeRender(),this._renderingManager.render(this.customRenderFunction,this.renderList,this.renderParticles,this.renderSprites),e&&t.postProcessManager._finalizeFrame(!1,this._texture),this.onAfterRender&&this.onAfterRender(),i.unBindFramebuffer(this._texture),this._doNotChangeAspectRatio||t.updateTransformMatrix(!0)}},i.prototype.clone=function(){var t=this.getSize(),i=new e.RenderTargetTexture(this.name,t.width,this.getScene(),this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.coordinatesMode=this.coordinatesMode,i.renderList=this.renderList.slice(0),i},i}(e.Texture);e.RenderTargetTexture=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o){var s=this;t.call(this,i,n,r,o,!0),this.mirrorPlane=new e.Plane(0,1,0,1),this._transformMatrix=e.Matrix.Zero(),this._mirrorMatrix=e.Matrix.Zero(),this.onBeforeRender=function(){e.Matrix.ReflectionToRef(s.mirrorPlane,s._mirrorMatrix),s._savedViewMatrix=r.getViewMatrix(),s._mirrorMatrix.multiplyToRef(s._savedViewMatrix,s._transformMatrix),r.setTransformMatrix(s._transformMatrix,r.getProjectionMatrix()),r.clipPlane=s.mirrorPlane,r.getEngine().cullBackFaces=!1},this.onAfterRender=function(){r.setTransformMatrix(s._savedViewMatrix,r.getProjectionMatrix()),r.getEngine().cullBackFaces=!0,delete r.clipPlane}}return n(i,t),i.prototype.clone=function(){var t=this.getSize(),i=new e.MirrorTexture(this.name,t.width,this.getScene(),this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.mirrorPlane=this.mirrorPlane.clone(),i.renderList=this.renderList.slice(0),i},i}(e.RenderTargetTexture);e.MirrorTexture=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o,s){"undefined"==typeof s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,r,!o),this.name=i,this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=o,n.getContext?(this._canvas=n,this._texture=r.getEngine().createDynamicTexture(n.width,n.height,o,s)):(this._canvas=document.createElement("canvas"),this._texture=n.width?r.getEngine().createDynamicTexture(n.width,n.height,o,s):r.getEngine().createDynamicTexture(n,n,o,s));var a=this.getSize();this._canvas.width=a.width,this._canvas.height=a.height,this._context=this._canvas.getContext("2d")}return n(i,t),i.prototype.getContext=function(){return this._context},i.prototype.update=function(e){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e?!0:e)},i.prototype.drawText=function(e,t,i,n,r,o,s){var a=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,a.width,a.height)),this._context.font=n,null===t){var h=this._context.measureText(e);t=(a.width-h.width)/2}this._context.fillStyle=r,this._context.fillText(e,t,i),this.update(s)},i.prototype.clone=function(){var t=this.getSize(),i=new e.DynamicTexture(this.name,t.width,this.getScene(),this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i},i}(e.Texture);e.DynamicTexture=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o,s,a,h){"undefined"==typeof h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE);var c=this;t.call(this,null,o,!s,a),this._autoLaunch=!0,this.name=i,this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE;var u=r.width||r,l=r.height||r;this._texture=o.getEngine().createDynamicTexture(u,l,s,h);var f=this.getSize();this.video=document.createElement("video"),this.video.width=f.width,this.video.height=f.height,this.video.autoplay=!1,this.video.loop=!0,this.video.addEventListener("canplaythrough",function(){c._texture&&(c._texture.isReady=!0)}),n.forEach(function(e){var t=document.createElement("source");t.src=e,c.video.appendChild(t)}),this._lastUpdate=(new Date).getTime()}return n(i,t),i.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var e=(new Date).getTime();return e-this._lastUpdate<15?!1:(this._lastUpdate=e,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},i}(e.Texture);e.VideoTexture=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t,i,n,r,o,s,a,h){var c=this;this._isReady=!1,this._compilationError="",this._valueCache=[],this._engine=r,this.name=e,this.defines=o,this._uniformsNames=i.concat(n),this._samplers=n,this._attributesNames=t,this.onError=h,this.onCompiled=a;var u,l;u=e.vertexElement?document.getElementById(e.vertexElement):e.vertex||e,l=e.fragmentElement?document.getElementById(e.fragmentElement):e.fragment||e,this._loadVertexShader(u,function(e){c._loadFragmentShader(l,function(i){c._prepareEffect(e,i,t,o,s)})})}return t.prototype.isReady=function(){return this._isReady},t.prototype.getProgram=function(){return this._program},t.prototype.getAttributesNames=function(){return this._attributesNames},t.prototype.getAttributeLocation=function(e){return this._attributes[e]},t.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},t.prototype.getAttributesCount=function(){return this._attributes.length},t.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},t.prototype.getUniform=function(e){return this._uniforms[this._uniformsNames.indexOf(e)]},t.prototype.getSamplers=function(){return this._samplers},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype._loadVertexShader=function(t,i){if(t instanceof HTMLElement){var n=e.Tools.GetDOMTextContent(t);return void i(n)}if(e.Effect.ShadersStore[t+"VertexShader"])return void i(e.Effect.ShadersStore[t+"VertexShader"]);var r;r="."===t[0]?t:e.Engine.ShadersRepository+t,e.Tools.LoadFile(r+".vertex.fx",i)},t.prototype._loadFragmentShader=function(t,i){if(t instanceof HTMLElement){var n=e.Tools.GetDOMTextContent(t);return void i(n)}if(e.Effect.ShadersStore[t+"PixelShader"])return void i(e.Effect.ShadersStore[t+"PixelShader"]);var r;r="."===t[0]?t:e.Engine.ShadersRepository+t,e.Tools.LoadFile(r+".fragment.fx",i)},t.prototype._prepareEffect=function(t,i,n,r,o,s){try{var a=this._engine;this._program=a.createShaderProgram(t,i,r),this._uniforms=a.getUniforms(this._program,this._uniformsNames),this._attributes=a.getAttributes(this._program,n);for(var h=0;h<this._samplers.length;h++){var c=this.getUniform(this._samplers[h]);null==c&&(this._samplers.splice(h,1),h--)}a.bindSamplers(this),this._isReady=!0,this.onCompiled&&this.onCompiled(this)}catch(u){if(!s&&o){for(h=0;h<o.length;h++)r=r.replace(o[h],"");this._prepareEffect(t,i,n,r,o,!0)}else e.Tools.Error("Unable to compile effect: "+this.name),e.Tools.Error("Defines: "+r),e.Tools.Error("Optional defines: "+o),e.Tools.Error("Error: "+u.message),this._compilationError=u.message,this.onError&&this.onError(this,this._compilationError)}},t.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers.indexOf(e),t)},t.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers.indexOf(e),t)},t.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(e),t)},t.prototype._cacheFloat2=function(e,t,i){return this._valueCache[e]?(this._valueCache[e][0]=t,void(this._valueCache[e][1]=i)):void(this._valueCache[e]=[t,i])
},t.prototype._cacheFloat3=function(e,t,i,n){return this._valueCache[e]?(this._valueCache[e][0]=t,this._valueCache[e][1]=i,void(this._valueCache[e][2]=n)):void(this._valueCache[e]=[t,i,n])},t.prototype._cacheFloat4=function(e,t,i,n,r){return this._valueCache[e]?(this._valueCache[e][0]=t,this._valueCache[e][1]=i,this._valueCache[e][2]=n,void(this._valueCache[e][3]=r)):void(this._valueCache[e]=[t,i,n,r])},t.prototype.setArray=function(e,t){return this._engine.setArray(this.getUniform(e),t),this},t.prototype.setMatrices=function(e,t){return this._engine.setMatrices(this.getUniform(e),t),this},t.prototype.setMatrix=function(e,t){return this._engine.setMatrix(this.getUniform(e),t),this},t.prototype.setFloat=function(e,t){return this._valueCache[e]&&this._valueCache[e]===t?this:(this._valueCache[e]=t,this._engine.setFloat(this.getUniform(e),t),this)},t.prototype.setBool=function(e,t){return this._valueCache[e]&&this._valueCache[e]===t?this:(this._valueCache[e]=t,this._engine.setBool(this.getUniform(e),t?1:0),this)},t.prototype.setVector2=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]==t.x&&this._valueCache[e][1]==t.y?this:(this._cacheFloat2(e,t.x,t.y),this._engine.setFloat2(this.getUniform(e),t.x,t.y),this)},t.prototype.setFloat2=function(e,t,i){return this._valueCache[e]&&this._valueCache[e][0]==t&&this._valueCache[e][1]==i?this:(this._cacheFloat2(e,t,i),this._engine.setFloat2(this.getUniform(e),t,i),this)},t.prototype.setVector3=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]==t.x&&this._valueCache[e][1]==t.y&&this._valueCache[e][2]==t.z?this:(this._cacheFloat3(e,t.x,t.y,t.z),this._engine.setFloat3(this.getUniform(e),t.x,t.y,t.z),this)},t.prototype.setFloat3=function(e,t,i,n){return this._valueCache[e]&&this._valueCache[e][0]==t&&this._valueCache[e][1]==i&&this._valueCache[e][2]==n?this:(this._cacheFloat3(e,t,i,n),this._engine.setFloat3(this.getUniform(e),t,i,n),this)},t.prototype.setFloat4=function(e,t,i,n,r){return this._valueCache[e]&&this._valueCache[e][0]==t&&this._valueCache[e][1]==i&&this._valueCache[e][2]==n&&this._valueCache[e][3]==r?this:(this._cacheFloat4(e,t,i,n,r),this._engine.setFloat4(this.getUniform(e),t,i,n,r),this)},t.prototype.setColor3=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]==t.r&&this._valueCache[e][1]==t.g&&this._valueCache[e][2]==t.b?this:(this._cacheFloat3(e,t.r,t.g,t.b),this._engine.setColor3(this.getUniform(e),t),this)},t.prototype.setColor4=function(e,t,i){return this._valueCache[e]&&this._valueCache[e][0]==t.r&&this._valueCache[e][1]==t.g&&this._valueCache[e][2]==t.b&&this._valueCache[e][3]==i?this:(this._cacheFloat4(e,t.r,t.g,t.b,i),this._engine.setColor4(this.getUniform(e),t,i),this)},t.ShadersStore={anaglyphPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\n\nvoid main(void)\n{\n    vec4 leftFrag = texture2D(leftSampler, vUV);\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\n\n	vec4 rightFrag = texture2D(textureSampler, vUV);\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\n\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\n}",blackAndWhitePixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nvoid main(void) \n{\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\n}",blurPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Parameters\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nvoid main(void)\n{\n	float weights[7];\n	weights[0] = 0.05;\n	weights[1] = 0.1;\n	weights[2] = 0.2;\n	weights[3] = 0.3;\n	weights[4] = 0.2;\n	weights[5] = 0.1;\n	weights[6] = 0.05;\n\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\n	vec2 texelStep = texelSize * direction * blurWidth;\n	vec2 start = vUV - 3.0 * texelStep;\n\n	vec4 baseColor = vec4(0., 0., 0., 0.);\n	vec2 texelOffset = vec2(0., 0.);\n\n	for (int i = 0; i < 7; i++)\n	{\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\n		texelOffset += texelStep;\n	}\n\n	gl_FragColor = baseColor;\n}",colorPixelShader:"precision mediump float;\n\nuniform vec3 color;\n\nvoid main(void) {\n	gl_FragColor = vec4(color, 1.);\n}",colorVertexShader:"precision mediump float;\n\n// Attributes\nattribute vec3 position;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\nvoid main(void) {\n	gl_Position = worldViewProjection * vec4(position, 1.0);\n}",convolutionPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform float kernel[9];\n\nvoid main(void)\n{\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\n	vec4 colorSum =\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\n\n	float kernelWeight =\n		kernel[0] +\n		kernel[1] +\n		kernel[2] +\n		kernel[3] +\n		kernel[4] +\n		kernel[5] +\n		kernel[6] +\n		kernel[7] +\n		kernel[8];\n\n	if (kernelWeight <= 0.0) {\n		kernelWeight = 1.0;\n	}\n\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\n}",defaultPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#define MAP_EXPLICIT	0.\n#define MAP_SPHERICAL	1.\n#define MAP_PLANAR		2.\n#define MAP_CUBIC		3.\n#define MAP_PROJECTION	4.\n#define MAP_SKYBOX		5.\n\n// Constants\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\nuniform vec4 vSpecularColor;\nuniform vec3 vEmissiveColor;\n\n// Input\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n// Lights\n#ifdef LIGHT0\nuniform vec4 vLightData0;\nuniform vec4 vLightDiffuse0;\nuniform vec3 vLightSpecular0;\n#ifdef SHADOW0\nvarying vec4 vPositionFromLight0;\nuniform sampler2D shadowSampler0;\nuniform float darkness0;\n#endif\n#ifdef SPOTLIGHT0\nuniform vec4 vLightDirection0;\n#endif\n#ifdef HEMILIGHT0\nuniform vec3 vLightGround0;\n#endif\n#endif\n\n#ifdef LIGHT1\nuniform vec4 vLightData1;\nuniform vec4 vLightDiffuse1;\nuniform vec3 vLightSpecular1;\n#ifdef SHADOW1\nvarying vec4 vPositionFromLight1;\nuniform sampler2D shadowSampler1;\nuniform float darkness1;\n#endif\n#ifdef SPOTLIGHT1\nuniform vec4 vLightDirection1;\n#endif\n#ifdef HEMILIGHT1\nuniform vec3 vLightGround1;\n#endif\n#endif\n\n#ifdef LIGHT2\nuniform vec4 vLightData2;\nuniform vec4 vLightDiffuse2;\nuniform vec3 vLightSpecular2;\n#ifdef SHADOW2\nvarying vec4 vPositionFromLight2;\nuniform sampler2D shadowSampler2;\nuniform float darkness2;\n#endif\n#ifdef SPOTLIGHT2\nuniform vec4 vLightDirection2;\n#endif\n#ifdef HEMILIGHT2\nuniform vec3 vLightGround2;\n#endif\n#endif\n\n#ifdef LIGHT3\nuniform vec4 vLightData3;\nuniform vec4 vLightDiffuse3;\nuniform vec3 vLightSpecular3;\n#ifdef SHADOW3\nvarying vec4 vPositionFromLight3;\nuniform sampler2D shadowSampler3;\nuniform float darkness3;\n#endif\n#ifdef SPOTLIGHT3\nuniform vec4 vLightDirection3;\n#endif\n#ifdef HEMILIGHT3\nuniform vec3 vLightGround3;\n#endif\n#endif\n\n// Samplers\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY	\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n// Reflection\n#ifdef REFLECTION\nvarying vec3 vPositionUVW;\nuniform samplerCube reflectionCubeSampler;\nuniform sampler2D reflection2DSampler;\nuniform vec3 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform mat4 view;\n\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\n{\n	if (mode == MAP_SPHERICAL)\n	{\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\n\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\n	}\n	else if (mode == MAP_PLANAR)\n	{\n		vec3 viewDir = worldPos.xyz - vEyePosition;\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\n\n		return vec3(reflectionMatrix * vec4(coords, 1));\n	}\n	else if (mode == MAP_CUBIC)\n	{\n		vec3 viewDir = worldPos.xyz - vEyePosition;\n		vec3 coords = reflect(viewDir, worldNormal);\n\n		return vec3(reflectionMatrix * vec4(coords, 0));\n	}\n	else if (mode == MAP_PROJECTION)\n	{\n		return vec3(reflectionMatrix * (view * worldPos));\n	}\n	else if (mode == MAP_SKYBOX)\n	{\n		return vPositionUVW;\n	}\n\n	return vec3(0, 0, 0);\n}\n#endif\n\n// Shadows\n#ifdef SHADOWS\n\nfloat unpack(vec4 color)\n{\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\n	return dot(color, bitShift);\n}\n\nfloat unpackHalf(vec2 color)\n{\n	return color.x + (color.y / 255.0);\n}\n\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness)\n{\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n	{\n		return 1.0;\n	}\n\n	float shadow = unpack(texture2D(shadowSampler, uv));\n\n	if (depth.z > shadow)\n	{\n		return darkness;\n	}\n	return 1.;\n}\n\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n	{\n		return 1.0;\n	}\n\n	float visibility = 1.;\n\n	vec2 poissonDisk[4];\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\n\n	// Poisson Sampling\n	for (int i = 0; i<4; i++){\n		if (unpack(texture2D(shadowSampler, uv + poissonDisk[i] / 1500.0))  <  depth.z){\n			visibility -= 0.2;\n		}\n	}\n	return visibility;\n}\n\n// Thanks to http://devmaster.net/\nfloat ChebychevInequality(vec2 moments, float t)\n{\n	if (t <= moments.x)\n	{\n		return 1.0;\n	}\n\n	float variance = moments.y - (moments.x * moments.x);\n	variance = max(variance, 0.);\n\n	float d = t - moments.x;\n	return variance / (variance + d * d);\n}\n\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n	{\n		return 1.0;\n	}\n\n	vec4 texel = texture2D(shadowSampler, uv);\n\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\n}\n#endif\n\n// Bump\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform sampler2D bumpSampler;\n\n// Thanks to http://www.thetenthplanet.de/archives/1180\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\n{\n	// get edge vectors of the pixel triangle\n	vec3 dp1 = dFdx(p);\n	vec3 dp2 = dFdy(p);\n	vec2 duv1 = dFdx(uv);\n	vec2 duv2 = dFdy(uv);\n\n	// solve the linear system\n	vec3 dp2perp = cross(dp2, normal);\n	vec3 dp1perp = cross(normal, dp1);\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\n\n	// construct a scale-invariant frame \n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\n	return mat3(tangent * invmax, binormal * invmax, normal);\n}\n\nvec3 perturbNormal(vec3 viewDir)\n{\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz * vBumpInfos.y;\n	map = map * 255. / 127. - 128. / 127.;\n	mat3 TBN = cotangent_frame(vNormalW, -viewDir, vBumpUV);\n	return normalize(TBN * map);\n}\n#endif\n\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n\n// Fog\n#ifdef FOG\n\n#define FOGMODE_NONE    0.\n#define FOGMODE_EXP     1.\n#define FOGMODE_EXP2    2.\n#define FOGMODE_LINEAR  3.\n#define E 2.71828\n\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\n\nfloat CalcFogFactor()\n{\n	float fogCoeff = 1.0;\n	float fogStart = vFogInfos.y;\n	float fogEnd = vFogInfos.z;\n	float fogDensity = vFogInfos.w;\n\n	if (FOGMODE_LINEAR == vFogInfos.x)\n	{\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\n	}\n	else if (FOGMODE_EXP == vFogInfos.x)\n	{\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\n	}\n	else if (FOGMODE_EXP2 == vFogInfos.x)\n	{\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\n	}\n\n	return clamp(fogCoeff, 0.0, 1.0);\n}\n#endif\n\n// Light Computing\nstruct lightingInfo\n{\n	vec3 diffuse;\n	vec3 specular;\n};\n\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\n	lightingInfo result;\n\n	vec3 lightVectorW;\n	float attenuation = 1.0;\n	if (lightData.w == 0.)\n	{\n		vec3 direction = lightData.xyz - vPositionW;\n\n		attenuation = max(0., 1.0 - length(direction) / range);\n		lightVectorW = normalize(direction);\n	}\n	else\n	{\n		lightVectorW = normalize(-lightData.xyz);\n	}\n\n	// diffuse\n	float ndl = max(0., dot(vNormal, lightVectorW));\n\n	// Specular\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\n	float specComp = max(0., dot(vNormal, angleW));\n	specComp = pow(specComp, max(1., vSpecularColor.a));\n\n	result.diffuse = ndl * diffuseColor * attenuation;\n	result.specular = specComp * specularColor * attenuation;\n\n	return result;\n}\n\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\n	lightingInfo result;\n\n	vec3 direction = lightData.xyz - vPositionW;\n	vec3 lightVectorW = normalize(direction);\n	float attenuation = max(0., 1.0 - length(direction) / range);\n\n	// diffuse\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\n	float spotAtten = 0.0;\n\n	if (cosAngle >= lightDirection.w)\n	{\n		cosAngle = max(0., pow(cosAngle, lightData.w));\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\n\n		// Diffuse\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\n\n		// Specular\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\n		float specComp = max(0., dot(vNormal, angleW));\n		specComp = pow(specComp, vSpecularColor.a);\n\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\n		result.specular = specComp * specularColor * spotAtten * attenuation;\n\n		return result;\n	}\n\n	result.diffuse = vec3(0.);\n	result.specular = vec3(0.);\n\n	return result;\n}\n\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\n	lightingInfo result;\n\n	// Diffuse\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\n\n	// Specular\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\n	float specComp = max(0., dot(vNormal, angleW));\n	specComp = pow(specComp, vSpecularColor.a);\n\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\n	result.specular = specComp * specularColor;\n\n	return result;\n}\n\nvoid main(void) {\n	// Clip plane\n#ifdef CLIPPLANE\n	if (fClipDistance > 0.0)\n		discard;\n#endif\n\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\n\n	// Base color\n	vec4 baseColor = vec4(1., 1., 1., 1.);\n	vec3 diffuseColor = vDiffuseColor.rgb;\n\n	// Alpha\n	float alpha = vDiffuseColor.a;\n\n#ifdef VERTEXCOLOR\n	diffuseColor *= vColor;\n#endif\n\n#ifdef DIFFUSE\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\n\n#ifdef ALPHATEST\n	if (baseColor.a < 0.4)\n		discard;\n#endif\n\n#ifdef ALPHAFROMDIFFUSE\n	alpha *= baseColor.a;\n#endif\n\n	baseColor.rgb *= vDiffuseInfos.y;\n#endif\n\n	// Bump\n	vec3 normalW = normalize(vNormalW);\n\n#ifdef BUMP\n	normalW = perturbNormal(viewDirectionW);\n#endif\n\n	// Ambient color\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\n\n#ifdef AMBIENT\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\n#endif\n\n	// Lighting\n	vec3 diffuseBase = vec3(0., 0., 0.);\n	vec3 specularBase = vec3(0., 0., 0.);\n	float shadow = 1.;\n\n#ifdef LIGHT0\n#ifdef SPOTLIGHT0\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\n#endif\n#ifdef HEMILIGHT0\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\n#endif\n#ifdef POINTDIRLIGHT0\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\n#endif\n#ifdef SHADOW0\n#ifdef SHADOWVSM0\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\n#else\n	#ifdef SHADOWPCF0\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0);\n	#else\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, darkness0);\n	#endif\n#endif\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info.diffuse * shadow;\n	specularBase += info.specular * shadow;\n#endif\n\n#ifdef LIGHT1\n#ifdef SPOTLIGHT1\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\n#endif\n#ifdef HEMILIGHT1\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\n#endif\n#ifdef POINTDIRLIGHT1\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\n#endif\n#ifdef SHADOW1\n#ifdef SHADOWVSM1\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\n#else\n	#ifdef SHADOWPCF1\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1);\n	#else\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, darkness1);\n	#endif\n#endif\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info.diffuse * shadow;\n	specularBase += info.specular * shadow;\n#endif\n\n#ifdef LIGHT2\n#ifdef SPOTLIGHT2\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\n#endif\n#ifdef HEMILIGHT2\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\n#endif\n#ifdef POINTDIRLIGHT2\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\n#endif\n#ifdef SHADOW2\n#ifdef SHADOWVSM2\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\n#else\n	#ifdef SHADOWPCF2\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2);\n	#else\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, darkness2);\n	#endif	\n#endif	\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info.diffuse * shadow;\n	specularBase += info.specular * shadow;\n#endif\n\n#ifdef LIGHT3\n#ifdef SPOTLIGHT3\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\n#endif\n#ifdef HEMILIGHT3\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\n#endif\n#ifdef POINTDIRLIGHT3\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\n#endif\n#ifdef SHADOW3\n#ifdef SHADOWVSM3\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\n#else\n	#ifdef SHADOWPCF3\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3);\n	#else\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, darkness3);\n	#endif	\n#endif	\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info.diffuse * shadow;\n	specularBase += info.specular * shadow;\n#endif\n\n	// Reflection\n	vec3 reflectionColor = vec3(0., 0., 0.);\n\n#ifdef REFLECTION\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\n\n	if (vReflectionInfos.z != 0.0)\n	{\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\n	}\n	else\n	{\n		vec2 coords = vReflectionUVW.xy;\n\n		if (vReflectionInfos.x == MAP_PROJECTION)\n		{\n			coords /= vReflectionUVW.z;\n		}\n\n		coords.y = 1.0 - coords.y;\n\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\n	}\n#endif\n\n#ifdef OPACITY\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\n\n#ifdef OPACITYRGB\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\n#else\n	alpha *= opacityMap.a * vOpacityInfos.y;\n#endif\n\n\n#endif\n\n	// Emissive\n	vec3 emissiveColor = vEmissiveColor;\n#ifdef EMISSIVE\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\n#endif\n\n	// Specular map\n	vec3 specularColor = vSpecularColor.rgb;\n#ifdef SPECULAR\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\n#endif\n\n	// Composition\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\n	vec3 finalSpecular = specularBase * specularColor;\n\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\n\n#ifdef FOG\n	float fog = CalcFogFactor();\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\n#endif\n\n	gl_FragColor = color;\n}",defaultVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec3 color;\n#endif\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniforms\n\n#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif\n\nuniform mat4 view;\nuniform mat4 viewProjection;\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n// Output\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n\n#ifdef FOG\nvarying float fFogDistance;\n#endif\n\n#ifdef SHADOWS\n#ifdef LIGHT0\nuniform mat4 lightMatrix0;\nvarying vec4 vPositionFromLight0;\n#endif\n#ifdef LIGHT1\nuniform mat4 lightMatrix1;\nvarying vec4 vPositionFromLight1;\n#endif\n#ifdef LIGHT2\nuniform mat4 lightMatrix2;\nvarying vec4 vPositionFromLight2;\n#endif\n#ifdef LIGHT3\nuniform mat4 lightMatrix3;\nvarying vec4 vPositionFromLight3;\n#endif\n#endif\n\n#ifdef REFLECTION\nvarying vec3 vPositionUVW;\n#endif\n\nvoid main(void) {\n	mat4 finalWorld;\n\n#ifdef REFLECTION\n	vPositionUVW = position;\n#endif \n\n#ifdef BONES\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n\n#ifdef BONES4\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n	finalWorld = world * (m0 + m1 + m2 + m3);\n#else\n	finalWorld = world * (m0 + m1 + m2);\n#endif \n\n#else\n#ifdef INSTANCES\n	finalWorld = mat4(world0, world1, world2, world3);\n#else\n	finalWorld = world;\n#endif\n#endif\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\n	vPositionW = vec3(worldPos);\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n\n	// Texture coordinates\n#ifndef UV1\n	vec2 uv = vec2(0., 0.);\n#endif\n#ifndef UV2\n	vec2 uv2 = vec2(0., 0.);\n#endif\n\n#ifdef DIFFUSE\n	if (vDiffuseInfos.x == 0.)\n	{\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef AMBIENT\n	if (vAmbientInfos.x == 0.)\n	{\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef OPACITY\n	if (vOpacityInfos.x == 0.)\n	{\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef EMISSIVE\n	if (vEmissiveInfos.x == 0.)\n	{\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef SPECULAR\n	if (vSpecularInfos.x == 0.)\n	{\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef BUMP\n	if (vBumpInfos.x == 0.)\n	{\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n	// Clip plane\n#ifdef CLIPPLANE\n	fClipDistance = dot(worldPos, vClipPlane);\n#endif\n\n	// Fog\n#ifdef FOG\n	fFogDistance = (view * worldPos).z;\n#endif\n\n	// Shadows\n#ifdef SHADOWS\n#ifdef LIGHT0\n	vPositionFromLight0 = lightMatrix0 * worldPos;\n#endif\n#ifdef LIGHT1\n	vPositionFromLight1 = lightMatrix1 * worldPos;\n#endif\n#ifdef LIGHT2\n	vPositionFromLight2 = lightMatrix2 * worldPos;\n#endif\n#ifdef LIGHT3\n	vPositionFromLight3 = lightMatrix3 * worldPos;\n#endif\n#endif\n\n	// Vertex color\n#ifdef VERTEXCOLOR\n	vColor = color;\n#endif\n}",displayPassPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(passSampler, vUV);\n}",filterPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform mat4 kernelMatrix;\n\nvoid main(void)\n{\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\n\n	gl_FragColor = vec4(updatedColor, 1.0);\n}",fxaaPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\n\nvoid main(){\n	vec2 localTexelSize = texelSize;\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\n	vec4 rgbM = texture2D(textureSampler, vUV);\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\n	float lumaNW = dot(rgbNW, luma);\n	float lumaNE = dot(rgbNE, luma);\n	float lumaSW = dot(rgbSW, luma);\n	float lumaSE = dot(rgbSE, luma);\n	float lumaM = dot(rgbM, luma);\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\n	float dirReduce = max(\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\n		FXAA_REDUCE_MIN);\n\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n		dir * rcpDirMin)) * localTexelSize;\n\n	vec4 rgbA = 0.5 * (\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\n\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\n		texture2D(textureSampler, vUV + dir *  -0.5) +\n		texture2D(textureSampler, vUV + dir * 0.5));\n	float lumaB = dot(rgbB, luma);\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\n		gl_FragColor = rgbA;\n	}\n	else {\n		gl_FragColor = rgbB;\n	}\n}",layerPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Color\nuniform vec4 color;\n\nvoid main(void) {\n	vec4 baseColor = texture2D(textureSampler, vUV);\n\n	gl_FragColor = baseColor * color;\n}",layerVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attributes\nattribute vec2 position;\n\n// Uniforms\nuniform mat4 textureMatrix;\n\n// Output\nvarying vec2 vUV;\n\nconst vec2 madd = vec2(0.5, 0.5);\n\nvoid main(void) {	\n\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\n	gl_Position = vec4(position, 0.0, 1.0);\n}",legacydefaultPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#define MAP_PROJECTION	4.\n\n// Constants\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\nuniform vec4 vSpecularColor;\nuniform vec3 vEmissiveColor;\n\n// Input\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n// Lights\n#ifdef LIGHT0\nuniform vec4 vLightData0;\nuniform vec4 vLightDiffuse0;\nuniform vec3 vLightSpecular0;\n#ifdef SHADOW0\nvarying vec4 vPositionFromLight0;\nuniform sampler2D shadowSampler0;\n#endif\n#ifdef SPOTLIGHT0\nuniform vec4 vLightDirection0;\n#endif\n#ifdef HEMILIGHT0\nuniform vec3 vLightGround0;\n#endif\n#endif\n\n#ifdef LIGHT1\nuniform vec4 vLightData1;\nuniform vec4 vLightDiffuse1;\nuniform vec3 vLightSpecular1;\n#ifdef SHADOW1\nvarying vec4 vPositionFromLight1;\nuniform sampler2D shadowSampler1;\n#endif\n#ifdef SPOTLIGHT1\nuniform vec4 vLightDirection1;\n#endif\n#ifdef HEMILIGHT1\nuniform vec3 vLightGround1;\n#endif\n#endif\n\n#ifdef LIGHT2\nuniform vec4 vLightData2;\nuniform vec4 vLightDiffuse2;\nuniform vec3 vLightSpecular2;\n#ifdef SHADOW2\nvarying vec4 vPositionFromLight2;\nuniform sampler2D shadowSampler2;\n#endif\n#ifdef SPOTLIGHT2\nuniform vec4 vLightDirection2;\n#endif\n#ifdef HEMILIGHT2\nuniform vec3 vLightGround2;\n#endif\n#endif\n\n#ifdef LIGHT3\nuniform vec4 vLightData3;\nuniform vec4 vLightDiffuse3;\nuniform vec3 vLightSpecular3;\n#ifdef SHADOW3\nvarying vec4 vPositionFromLight3;\nuniform sampler2D shadowSampler3;\n#endif\n#ifdef SPOTLIGHT3\nuniform vec4 vLightDirection3;\n#endif\n#ifdef HEMILIGHT3\nuniform vec3 vLightGround3;\n#endif\n#endif\n\n// Samplers\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY	\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\nuniform samplerCube reflectionCubeSampler;\nuniform sampler2D reflection2DSampler;\nuniform vec3 vReflectionInfos;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n// Shadows\n#ifdef SHADOWS\n\nfloat unpack(vec4 color)\n{\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\n	return dot(color, bitShift);\n}\n\nfloat unpackHalf(vec2 color)\n{\n	return color.x + (color.y / 255.0);\n}\n\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n	{\n		return 1.0;\n	}\n\n	float shadow = unpack(texture2D(shadowSampler, uv));\n\n	if (depth.z > shadow)\n	{\n		return 0.;\n	}\n	return 1.;\n}\n\n// Thanks to http://devmaster.net/\nfloat ChebychevInequality(vec2 moments, float t)\n{\n	if (t <= moments.x)\n	{\n		return 1.0;\n	}\n\n	float variance = moments.y - (moments.x * moments.x);\n	variance = max(variance, 0.);\n\n	float d = t - moments.x;\n	return variance / (variance + d * d);\n}\n\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\n{\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\n\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n	{\n		return 1.0;\n	}\n\n	vec4 texel = texture2D(shadowSampler, uv);\n\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\n}\n#endif\n\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n\n// Fog\n#ifdef FOG\n\n#define FOGMODE_NONE    0.\n#define FOGMODE_EXP     1.\n#define FOGMODE_EXP2    2.\n#define FOGMODE_LINEAR  3.\n#define E 2.71828\n\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\n\nfloat CalcFogFactor()\n{\n	float fogCoeff = 1.0;\n	float fogStart = vFogInfos.y;\n	float fogEnd = vFogInfos.z;\n	float fogDensity = vFogInfos.w;\n\n	if (FOGMODE_LINEAR == vFogInfos.x)\n	{\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\n	}\n	else if (FOGMODE_EXP == vFogInfos.x)\n	{\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\n	}\n	else if (FOGMODE_EXP2 == vFogInfos.x)\n	{\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\n	}\n\n	return clamp(fogCoeff, 0.0, 1.0);\n}\n#endif\n\n// Light Computing\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\n	mat3 result;\n\n	vec3 lightVectorW;\n	if (lightData.w == 0.)\n	{\n		lightVectorW = normalize(lightData.xyz - vPositionW);\n	}\n	else\n	{\n		lightVectorW = normalize(-lightData.xyz);\n	}\n\n	// diffuse\n	float ndl = max(0., dot(vNormal, lightVectorW));\n\n	// Specular\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\n	float specComp = max(0., dot(vNormal, angleW));\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\n\n	result[0] = ndl * diffuseColor.rgb;\n	result[1] = specComp * specularColor;\n	result[2] = vec3(0.);\n\n	return result;\n}\n\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\n	mat3 result;\n\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\n\n	// diffuse\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\n	float spotAtten = 0.0;\n\n	if (cosAngle >= lightDirection.w)\n	{\n		cosAngle = max(0., pow(cosAngle, lightData.w));\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\n\n		// Diffuse\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\n\n		// Specular\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\n		float specComp = max(0., dot(vNormal, angleW));\n		specComp = pow(specComp, vSpecularColor.a);\n\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\n		result[1] = specComp * specularColor * spotAtten;\n		result[2] = vec3(0.);\n\n		return result;\n	}\n\n	result[0] = vec3(0.);\n	result[1] = vec3(0.);\n	result[2] = vec3(0.);\n\n	return result;\n}\n\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\n	mat3 result;\n\n	// Diffuse\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\n\n	// Specular\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\n	float specComp = max(0., dot(vNormal, angleW));\n	specComp = pow(specComp, vSpecularColor.a);\n\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\n	result[1] = specComp * specularColor;\n	result[2] = vec3(0.);\n\n	return result;\n}\n\nvoid main(void) {\n	// Clip plane\n#ifdef CLIPPLANE\n	if (fClipDistance > 0.0)\n		discard;\n#endif\n\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\n\n	// Base color\n	vec4 baseColor = vec4(1., 1., 1., 1.);\n	vec3 diffuseColor = vDiffuseColor.rgb;\n\n#ifdef VERTEXCOLOR\n	diffuseColor *= vColor;\n#endif\n\n#ifdef DIFFUSE\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\n\n#ifdef ALPHATEST\n	if (baseColor.a < 0.4)\n		discard;\n#endif\n\n	baseColor.rgb *= vDiffuseInfos.y;\n#endif\n\n	// Bump\n	vec3 normalW = normalize(vNormalW);\n\n	// Ambient color\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\n\n#ifdef AMBIENT\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\n#endif\n\n	// Lighting\n	vec3 diffuseBase = vec3(0., 0., 0.);\n	vec3 specularBase = vec3(0., 0., 0.);\n	float shadow = 1.;\n\n#ifdef LIGHT0\n#ifdef SPOTLIGHT0\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\n#endif\n#ifdef HEMILIGHT0\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\n#endif\n#ifdef POINTDIRLIGHT0\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\n#endif\n#ifdef SHADOW0\n#ifdef SHADOWVSM0\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\n#else\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\n#endif\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info[0] * shadow;\n	specularBase += info[1] * shadow;\n#endif\n\n#ifdef LIGHT1\n#ifdef SPOTLIGHT1\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\n#endif\n#ifdef HEMILIGHT1\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\n#endif\n#ifdef POINTDIRLIGHT1\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\n#endif\n#ifdef SHADOW1\n#ifdef SHADOWVSM1\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\n#else\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\n#endif\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info[0] * shadow;\n	specularBase += info[1] * shadow;\n#endif\n\n#ifdef LIGHT2\n#ifdef SPOTLIGHT2\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\n#endif\n#ifdef HEMILIGHT2\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\n#endif\n#ifdef POINTDIRLIGHT2\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\n#endif\n#ifdef SHADOW2\n#ifdef SHADOWVSM2\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\n#else\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\n#endif	\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info[0] * shadow;\n	specularBase += info[1] * shadow;\n#endif\n\n#ifdef LIGHT3\n#ifdef SPOTLIGHT3\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\n#endif\n#ifdef HEMILIGHT3\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\n#endif\n#ifdef POINTDIRLIGHT3\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\n#endif\n#ifdef SHADOW3\n#ifdef SHADOWVSM3\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\n#else\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\n#endif	\n#else\n	shadow = 1.;\n#endif\n	diffuseBase += info[0] * shadow;\n	specularBase += info[1] * shadow;\n#endif\n\n	// Reflection\n	vec3 reflectionColor = vec3(0., 0., 0.);\n\n#ifdef REFLECTION\n	if (vReflectionInfos.z != 0.0)\n	{\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\n	}\n	else\n	{\n		vec2 coords = vReflectionUVW.xy;\n\n		if (vReflectionInfos.x == MAP_PROJECTION)\n		{\n			coords /= vReflectionUVW.z;\n		}\n\n		coords.y = 1.0 - coords.y;\n\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\n	}\n#endif\n\n	// Alpha\n	float alpha = vDiffuseColor.a;\n\n#ifdef OPACITY\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\n#ifdef OPACITYRGB\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\n#else\n	alpha *= opacityMap.a * vOpacityInfos.y;\n#endif\n#endif\n\n	// Emissive\n	vec3 emissiveColor = vEmissiveColor;\n#ifdef EMISSIVE\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\n#endif\n\n	// Specular map\n	vec3 specularColor = vSpecularColor.rgb;\n#ifdef SPECULAR\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\n#endif\n\n	// Composition\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\n	vec3 finalSpecular = specularBase * specularColor;\n\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\n\n#ifdef FOG\n	float fog = CalcFogFactor();\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\n#endif\n\n	gl_FragColor = color;\n}",legacydefaultVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n#define MAP_EXPLICIT	0.\n#define MAP_SPHERICAL	1.\n#define MAP_PLANAR		2.\n#define MAP_CUBIC		3.\n#define MAP_PROJECTION	4.\n#define MAP_SKYBOX		5.\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec3 color;\n#endif\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniforms\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform vec3 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n\n#ifdef SPECULAR\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n// Output\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n\n#ifdef VERTEXCOLOR\nvarying vec3 vColor;\n#endif\n\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n\n#ifdef FOG\nvarying float fFogDistance;\n#endif\n\n#ifdef SHADOWS\n#ifdef LIGHT0\nuniform mat4 lightMatrix0;\nvarying vec4 vPositionFromLight0;\n#endif\n#ifdef LIGHT1\nuniform mat4 lightMatrix1;\nvarying vec4 vPositionFromLight1;\n#endif\n#ifdef LIGHT2\nuniform mat4 lightMatrix2;\nvarying vec4 vPositionFromLight2;\n#endif\n#ifdef LIGHT3\nuniform mat4 lightMatrix3;\nvarying vec4 vPositionFromLight3;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\n{\n	if (mode == MAP_SPHERICAL)\n	{\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\n\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\n	}\n	else if (mode == MAP_PLANAR)\n	{\n		vec3 viewDir = worldPos.xyz - vEyePosition;\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\n\n		return vec3(reflectionMatrix * vec4(coords, 1));\n	}\n	else if (mode == MAP_CUBIC)\n	{\n		vec3 viewDir = worldPos.xyz - vEyePosition;\n		vec3 coords = reflect(viewDir, worldNormal);\n\n		return vec3(reflectionMatrix * vec4(coords, 0));\n	}\n	else if (mode == MAP_PROJECTION)\n	{\n		return vec3(reflectionMatrix * (view * worldPos));\n	}\n	else if (mode == MAP_SKYBOX)\n	{\n		return position;\n	}\n\n	return vec3(0, 0, 0);\n}\n#endif\n\nvoid main(void) {\n	mat4 finalWorld;\n\n#ifdef BONES\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n\n#ifdef BONES4\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n	finalWorld = world * (m0 + m1 + m2 + m3);\n#else\n	finalWorld = world * (m0 + m1 + m2);\n#endif \n\n#else\n	finalWorld = world;\n#endif\n\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\n	vPositionW = vec3(worldPos);\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n\n	// Texture coordinates\n#ifndef UV1\n	vec2 uv = vec2(0., 0.);\n#endif\n#ifndef UV2\n	vec2 uv2 = vec2(0., 0.);\n#endif\n\n#ifdef DIFFUSE\n	if (vDiffuseInfos.x == 0.)\n	{\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef AMBIENT\n	if (vAmbientInfos.x == 0.)\n	{\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef OPACITY\n	if (vOpacityInfos.x == 0.)\n	{\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef REFLECTION\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\n#endif\n\n#ifdef EMISSIVE\n	if (vEmissiveInfos.x == 0.)\n	{\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef SPECULAR\n	if (vSpecularInfos.x == 0.)\n	{\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n#ifdef BUMP\n	if (vBumpInfos.x == 0.)\n	{\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\n	}\n	else\n	{\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\n	}\n#endif\n\n	// Clip plane\n#ifdef CLIPPLANE\n	fClipDistance = dot(worldPos, vClipPlane);\n#endif\n\n	// Fog\n#ifdef FOG\n	fFogDistance = (view * worldPos).z;\n#endif\n\n	// Shadows\n#ifdef SHADOWS\n#ifdef LIGHT0\n	vPositionFromLight0 = lightMatrix0 * worldPos;\n#endif\n#ifdef LIGHT1\n	vPositionFromLight1 = lightMatrix1 * worldPos;\n#endif\n#ifdef LIGHT2\n	vPositionFromLight2 = lightMatrix2 * worldPos;\n#endif\n#ifdef LIGHT3\n	vPositionFromLight3 = lightMatrix3 * worldPos;\n#endif\n#endif\n\n	// Vertex color\n#ifdef VERTEXCOLOR\n	vColor = color;\n#endif\n}",lensFlarePixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Color\nuniform vec4 color;\n\nvoid main(void) {\n	vec4 baseColor = texture2D(textureSampler, vUV);\n\n	gl_FragColor = baseColor * color;\n}",lensFlareVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attributes\nattribute vec2 position;\n\n// Uniforms\nuniform mat4 viewportMatrix;\n\n// Output\nvarying vec2 vUV;\n\nconst vec2 madd = vec2(0.5, 0.5);\n\nvoid main(void) {	\n\n	vUV = position * madd + madd;\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\n}",oculusDistortionCorrectionPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\n\nvec2 HmdWarp(vec2 in01) {\n\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\n	float rSq = theta.x * theta.x + theta.y * theta.y;\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\n	return LensCenter + Scale * rvector;\n}\n\n\n\nvoid main(void)\n{\n	vec2 tc = HmdWarp(vUV);\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n	else{\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\n	}\n}",particlesPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n\nvoid main(void) {\n#ifdef CLIPPLANE\n	if (fClipDistance > 0.0)\n		discard;\n#endif\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\n\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\n}",particlesVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attributes\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\n// Uniforms\nuniform mat4 view;\nuniform mat4 projection;\n\n// Output\nvarying vec2 vUV;\nvarying vec4 vColor;\n\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\n\nvoid main(void) {	\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \n	vec3 cornerPos;\n	float size = options.y;\n	float angle = options.x;\n	vec2 offset = options.zw;\n\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\n\n	// Rotate\n	vec3 rotatedCorner;\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\n	rotatedCorner.z = 0.;\n\n	// Position\n	viewPos += rotatedCorner;\n	gl_Position = projection * vec4(viewPos, 1.0);   \n	\n	vColor = color;\n	vUV = offset;\n\n	// Clip plane\n#ifdef CLIPPLANE\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\n	fClipDistance = dot(worldPos, vClipPlane);\n#endif\n}",passPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nvoid main(void) \n{\n	gl_FragColor = texture2D(textureSampler, vUV);\n}",postprocessVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attributes\nattribute vec2 position;\n\n// Output\nvarying vec2 vUV;\n\nconst vec2 madd = vec2(0.5, 0.5);\n\nvoid main(void) {	\n\n	vUV = position * madd + madd;\n	gl_Position = vec4(position, 0.0, 1.0);\n}",refractionPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\n// Parameters\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\n\nvoid main() {\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\n\n	vec2 uv = vUV - vec2(0.5);\n	vec2 offset = uv * depth * ref;\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\n\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\n}",shadowMapPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvec4 pack(float depth)\n{\n	const vec4 bitOffset = vec4(255. * 255. * 255., 255. * 255., 255., 1.);\n	const vec4 bitMask = vec4(0., 1. / 255., 1. / 255., 1. / 255.);\n	\n	vec4 comp = mod(depth * bitOffset * vec4(254.), vec4(255.)) / vec4(254.);\n	comp -= comp.xxyz * bitMask;\n	\n	return comp;\n}\n\n// Thanks to http://devmaster.net/\nvec2 packHalf(float depth) \n{ \n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\n	vec2 color = vec2(depth, fract(depth * 255.));\n\n	return color - (color.yy * bitOffset);\n}\n\n#ifndef VSM\nvarying vec4 vPosition;\n#endif\n\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n\nvoid main(void)\n{\n#ifdef ALPHATEST\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\n		discard;\n#endif\n\n#ifdef VSM\n	float moment1 = gl_FragCoord.z / gl_FragCoord.w;\n	float moment2 = moment1 * moment1;\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\n#else\n	gl_FragColor = pack(vPosition.z / vPosition.w);\n#endif\n}",shadowMapVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attribute\nattribute vec3 position;\n#ifdef BONES\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#endif\n\n// Uniform\n#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif\n\nuniform mat4 viewProjection;\n#ifdef BONES\nuniform mat4 mBones[BonesPerMesh];\n#endif\n\n#ifndef VSM\nvarying vec4 vPosition;\n#endif\n\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nvoid main(void)\n{\n#ifdef INSTANCES\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\n#else\n	mat4 finalWorld = world;\n#endif\n\n#ifdef BONES\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n#else\n#ifndef VSM\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\n#endif\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\n#endif\n\n#ifdef ALPHATEST\n#ifdef UV1\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\n#endif\n#ifdef UV2\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\n#endif\n#endif\n}",spritesPixelShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform bool alphaTest;\n\nvarying vec4 vColor;\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n// Fog\n#ifdef FOG\n\n#define FOGMODE_NONE    0.\n#define FOGMODE_EXP     1.\n#define FOGMODE_EXP2    2.\n#define FOGMODE_LINEAR  3.\n#define E 2.71828\n\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\n\nfloat CalcFogFactor()\n{\n	float fogCoeff = 1.0;\n	float fogStart = vFogInfos.y;\n	float fogEnd = vFogInfos.z;\n	float fogDensity = vFogInfos.w;\n\n	if (FOGMODE_LINEAR == vFogInfos.x)\n	{\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\n	}\n	else if (FOGMODE_EXP == vFogInfos.x)\n	{\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\n	}\n	else if (FOGMODE_EXP2 == vFogInfos.x)\n	{\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\n	}\n\n	return min(1., max(0., fogCoeff));\n}\n#endif\n\n\nvoid main(void) {\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\n\n	if (alphaTest) \n	{\n		if (baseColor.a < 0.95)\n			discard;\n	}\n\n	baseColor *= vColor;\n\n#ifdef FOG\n	float fog = CalcFogFactor();\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\n#endif\n\n	gl_FragColor = baseColor;\n}",spritesVertexShader:"#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// Attributes\nattribute vec3 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\n// Uniforms\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\n// Output\nvarying vec2 vUV;\nvarying vec4 vColor;\n\n#ifdef FOG\nvarying float fFogDistance;\n#endif\n\nvoid main(void) {	\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \n	vec3 cornerPos;\n	\n	float angle = options.x;\n	float size = options.y;\n	vec2 offset = options.zw;\n	vec2 uvScale = textureInfos.xy;\n\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\n\n	// Rotate\n	vec3 rotatedCorner;\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\n	rotatedCorner.z = 0.;\n\n	// Position\n	viewPos += rotatedCorner;\n	gl_Position = projection * vec4(viewPos, 1.0);   \n\n	// Color\n	vColor = color;\n	\n	// Texture\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\n\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\n\n	// Fog\n#ifdef FOG\n	fFogDistance = viewPos.z;\n#endif\n}"},t
}();e.Effect=t}(i||(i={}));var i;!function(e){var t=function(){function e(e,t,i){this.name=e,this.checkReadyOnEveryCall=!0,this.checkReadyOnlyOnce=!1,this.state="",this.alpha=1,this.wireframe=!1,this.backFaceCulling=!0,this._wasPreviouslyReady=!1,this.id=e,this._scene=t,i||t.materials.push(this)}return e.prototype.isReady=function(){return!0},e.prototype.getEffect=function(){return this._effect},e.prototype.getScene=function(){return this._scene},e.prototype.needAlphaBlending=function(){return this.alpha<1},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.trackCreation=function(){},e.prototype._preBind=function(){var e=this._scene.getEngine();e.enableEffect(this._effect),e.setState(this.backFaceCulling)},e.prototype.bind=function(){},e.prototype.bindOnlyWorldMatrix=function(){},e.prototype.unbind=function(){},e.prototype.dispose=function(e){var t=this._scene.materials.indexOf(this);this._scene.materials.splice(t,1),e&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDispose&&this.onDispose()},e}();e.Material=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=4,i=function(i){function r(t,n){var r=this;i.call(this,t,n),this.ambientColor=new e.Color3(0,0,0),this.diffuseColor=new e.Color3(1,1,1),this.specularColor=new e.Color3(1,1,1),this.specularPower=64,this.emissiveColor=new e.Color3(0,0,0),this.useAlphaFromDiffuseTexture=!1,this._cachedDefines=null,this._renderTargets=new e.SmartArray(16),this._worldViewProjectionMatrix=e.Matrix.Zero(),this._globalAmbientColor=new e.Color3(0,0,0),this._baseColor=new e.Color3,this._scaledDiffuse=new e.Color3,this._scaledSpecular=new e.Color3,this.getRenderTargetTextures=function(){return r._renderTargets.reset(),r.reflectionTexture&&r.reflectionTexture.isRenderTarget&&r._renderTargets.push(r.reflectionTexture),r._renderTargets}}return n(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()},r.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&!this.diffuseTexture.getAlphaFromRGB},r.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},r.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},r.prototype.isReady=function(i,n){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var r=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===r.getRenderId())return!0;var o=r.getEngine(),s=[],a=new Array;if(r.texturesEnabled){if(this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;s.push("#define DIFFUSE")}if(this.ambientTexture&&e.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;s.push("#define AMBIENT")}if(this.opacityTexture&&e.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;s.push("#define OPACITY"),this.opacityTexture.getAlphaFromRGB&&s.push("#define OPACITYRGB")}if(this.reflectionTexture&&e.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;s.push("#define REFLECTION")}if(this.emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;s.push("#define EMISSIVE")}if(this.specularTexture&&e.StandardMaterial.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;s.push("#define SPECULAR"),a.push(s[s.length-1])}}if(r.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&e.StandardMaterial.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;s.push("#define BUMP"),a.push(s[s.length-1])}r.clipPlane&&s.push("#define CLIPPLANE"),o.getAlphaTesting()&&s.push("#define ALPHATEST"),this._shouldUseAlphaFromDiffuseTexture()&&s.push("#define ALPHAFROMDIFFUSE"),r.fogMode!==e.Scene.FOGMODE_NONE&&(s.push("#define FOG"),a.push(s[s.length-1]));var h=!1,c=0;if(r.lightsEnabled)for(var u=0;u<r.lights.length;u++){var l=r.lights[u];if(l.isEnabled()){if(l._excludedMeshesIds.length>0){for(var f=0;f<l._excludedMeshesIds.length;f++){var p=r.getMeshByID(l._excludedMeshesIds[f]);p&&l.excludedMeshes.push(p)}l._excludedMeshesIds=[]}if(!i||-1===l.excludedMeshes.indexOf(i)){s.push("#define LIGHT"+c),c>0&&a.push(s[s.length-1]);var d;d=l instanceof e.SpotLight?"#define SPOTLIGHT"+c:l instanceof e.HemisphericLight?"#define HEMILIGHT"+c:"#define POINTDIRLIGHT"+c,s.push(d),c>0&&a.push(s[s.length-1]);var m=l.getShadowGenerator();if(i&&i.receiveShadows&&m&&(s.push("#define SHADOW"+c),c>0&&a.push(s[s.length-1]),h||(s.push("#define SHADOWS"),h=!0),m.useVarianceShadowMap&&(s.push("#define SHADOWVSM"+c),c>0&&a.push(s[s.length-1])),m.usePoissonSampling&&(s.push("#define SHADOWPCF"+c),c>0&&a.push(s[s.length-1]))),c++,c==t)break}}}var g=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind];i&&(i.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(g.push(e.VertexBuffer.UVKind),s.push("#define UV1")),i.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(g.push(e.VertexBuffer.UV2Kind),s.push("#define UV2")),i.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(g.push(e.VertexBuffer.ColorKind),s.push("#define VERTEXCOLOR")),i.skeleton&&i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(g.push(e.VertexBuffer.MatricesIndicesKind),g.push(e.VertexBuffer.MatricesWeightsKind),s.push("#define BONES"),s.push("#define BonesPerMesh "+(i.skeleton.bones.length+1)),s.push("#define BONES4"),a.push(s[s.length-1])),n&&(s.push("#define INSTANCES"),g.push("world0"),g.push("world1"),g.push("world2"),g.push("world3")));var _=s.join("\n");if(this._cachedDefines!=_){this._cachedDefines=_;var v="default";r.getEngine().getCaps().standardDerivatives||(v="legacydefault"),this._effect=r.getEngine().createEffect(v,g,["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vLightData0","vLightDiffuse0","vLightSpecular0","vLightDirection0","vLightGround0","lightMatrix0","vLightData1","vLightDiffuse1","vLightSpecular1","vLightDirection1","vLightGround1","lightMatrix1","vLightData2","vLightDiffuse2","vLightSpecular2","vLightDirection2","vLightGround2","lightMatrix2","vLightData3","vLightDiffuse3","vLightSpecular3","vLightDirection3","vLightGround3","lightMatrix3","vFogInfos","vFogColor","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","darkness0","darkness1","darkness2","darkness3"],["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","shadowSampler0","shadowSampler1","shadowSampler2","shadowSampler3"],_,a,this.onCompiled,this.onError)}return this._effect.isReady()?(this._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,!0):!1},r.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null)},r.prototype.bindOnlyWorldMatrix=function(e){this._effect.setMatrix("world",e)},r.prototype.bind=function(i,n){var r=this.getScene();if(this._baseColor.copyFrom(this.diffuseColor),this.bindOnlyWorldMatrix(i),this._effect.setMatrix("viewProjection",r.getTransformMatrix()),n.skeleton&&n.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&n.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&this._effect.setMatrices("mBones",n.skeleton.getTransformMatrices()),this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix()),this._baseColor.copyFromFloats(1,1,1)),this.ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&e.StandardMaterial.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat3("vReflectionInfos",this.reflectionTexture.coordinatesMode,this.reflectionTexture.level,this.reflectionTexture.isCube?1:0)),this.emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.specularTexture&&e.StandardMaterial.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&r.getEngine().getCaps().standardDerivatives&&e.StandardMaterial.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat2("vBumpInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this._effect.setVector3("vEyePosition",r.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._effect.setColor4("vDiffuseColor",this._baseColor,this.alpha*n.visibility),this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower),this._effect.setColor3("vEmissiveColor",this.emissiveColor),r.lightsEnabled)for(var o=0,s=0;s<r.lights.length;s++){var a=r.lights[s];if(a.isEnabled()&&(!n||-1===a.excludedMeshes.indexOf(n))){a instanceof e.PointLight?a.transferToEffect(this._effect,"vLightData"+o):a instanceof e.DirectionalLight?a.transferToEffect(this._effect,"vLightData"+o):a instanceof e.SpotLight?a.transferToEffect(this._effect,"vLightData"+o,"vLightDirection"+o):a instanceof e.HemisphericLight&&a.transferToEffect(this._effect,"vLightData"+o,"vLightGround"+o),a.diffuse.scaleToRef(a.intensity,this._scaledDiffuse),a.specular.scaleToRef(a.intensity,this._scaledSpecular),this._effect.setColor4("vLightDiffuse"+o,this._scaledDiffuse,a.range),this._effect.setColor3("vLightSpecular"+o,this._scaledSpecular);var h=a.getShadowGenerator();if(n.receiveShadows&&h&&(this._effect.setMatrix("lightMatrix"+o,h.getTransformMatrix()),this._effect.setTexture("shadowSampler"+o,h.getShadowMap()),this._effect.setFloat("darkness"+o,h.getDarkness())),o++,o==t)break}}if(r.clipPlane){var c=r.clipPlane;this._effect.setFloat4("vClipPlane",c.normal.x,c.normal.y,c.normal.z,c.d)}(r.fogMode!==e.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",r.getViewMatrix()),r.fogMode!==e.Scene.FOGMODE_NONE&&(this._effect.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),this._effect.setColor3("vFogColor",r.fogColor))},r.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&e.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&e.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&e.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&e.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&this.specularTexture.animations.length>0&&e.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),e},r.prototype.dispose=function(e){this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=new e.StandardMaterial(t,this.getScene());return i.checkReadyOnEveryCall=this.checkReadyOnEveryCall,i.alpha=this.alpha,i.wireframe=this.wireframe,i.backFaceCulling=this.backFaceCulling,this.diffuseTexture&&this.diffuseTexture.clone&&(i.diffuseTexture=this.diffuseTexture.clone()),this.ambientTexture&&this.ambientTexture.clone&&(i.ambientTexture=this.ambientTexture.clone()),this.opacityTexture&&this.opacityTexture.clone&&(i.opacityTexture=this.opacityTexture.clone()),this.reflectionTexture&&this.reflectionTexture.clone&&(i.reflectionTexture=this.reflectionTexture.clone()),this.emissiveTexture&&this.emissiveTexture.clone&&(i.emissiveTexture=this.emissiveTexture.clone()),this.specularTexture&&this.specularTexture.clone&&(i.specularTexture=this.specularTexture.clone()),this.bumpTexture&&this.bumpTexture.clone&&(i.bumpTexture=this.bumpTexture.clone()),i.ambientColor=this.ambientColor.clone(),i.diffuseColor=this.diffuseColor.clone(),i.specularColor=this.specularColor.clone(),i.specularPower=this.specularPower,i.emissiveColor=this.emissiveColor.clone(),i},r.DiffuseTextureEnabled=!0,r.AmbientTextureEnabled=!0,r.OpacityTextureEnabled=!0,r.ReflectionTextureEnabled=!0,r.EmissiveTextureEnabled=!0,r.SpecularTextureEnabled=!0,r.BumpTextureEnabled=!0,r}(e.Material);e.StandardMaterial=i}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i){e.call(this,t,i,!0),this.subMaterials=new Array,i.multiMaterials.push(this)}return n(t,e),t.prototype.getSubMaterial=function(e){return 0>e||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.isReady=function(e){for(var t=0;t<this.subMaterials.length;t++){var i=this.subMaterials[t];if(i&&!this.subMaterials[t].isReady(e))return!1}return!0},t}(e.Material);e.MultiMaterial=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=e.Database.ReturnFullUrlLocation(t),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,this.checkManifestFile()}return t.prototype.checkManifestFile=function(){function t(){e.Tools.Log("Valid manifest file not found. Scene & textures will be loaded directly from the web server."),n.enableSceneOffline=!1,n.enableTexturesOffline=!1,n.callbackManifestChecked(!1)}var i=this,n=this,r=this.currentSceneUrl+".manifest",o=new XMLHttpRequest,s=r+(null==r.match(/\?/)?"?":"&")+(new Date).getTime();o.open("GET",s,!0),o.addEventListener("load",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var n=JSON.parse(o.response);i.enableSceneOffline=n.enableSceneOffline,i.enableTexturesOffline=n.enableTexturesOffline,n.version&&!isNaN(parseInt(n.version))&&(i.manifestVersionFound=n.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(r){t()}else t()},!1),o.addEventListener("error",function(){t()},!1);try{o.send()}catch(a){e.Tools.Error("Error on XHR send request."),n.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function n(){o.isSupported=!1,i&&i()}var r=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open("babylonjs",1);s.onerror=function(){n()},s.onblocked=function(){e.Tools.Error("IDB request blocked. Please reload the page."),n()},s.onsuccess=function(){r.db=s.result,t()},s.onupgradeneeded=function(t){r.db=t.target.result;try{t.oldVersion>0&&(r.db.deleteObjectStore("scenes"),r.db.deleteObjectStore("versions"),r.db.deleteObjectStore("textures")),r.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),r.db.createObjectStore("versions",{keyPath:"sceneUrl"}),r.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(i){e.Tools.Error("Error while creating object stores. Exception: "+i.message),n()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(t,i){var n=this,r=e.Database.ReturnFullUrlLocation(t),o=function(){n.hasReachedQuota||null===n.db?i.src=t:n._saveImageIntoDBAsync(r,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(r,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,n){if(this.isSupported&&null!==this.db){var r,o=this.db.transaction(["textures"]);o.onabort=function(){i.src=t},o.oncomplete=function(){var o;if(r){var s=window.URL||window.webkitURL;o=s.createObjectURL(r.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error("Error loading image from blob URL: "+o+" switching back to web url: "+t),i.src=t},i.src=o}else n()};var s=o.objectStore("textures").get(t);s.onsuccess=function(e){r=e.target.result},s.onerror=function(){e.Tools.Error("Error loading texture "+t+" from DB."),i.src=t}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t},t.prototype._saveImageIntoDBAsync=function(t,i){var n=this;if(this.isSupported){var r=function(){var e;if(o){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(o,{oneTimeOnly:!0})}catch(n){e=t.createObjectURL(o)}}i.src=e};if(e.Database.isUASupportingBlobStorage){var o,s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.addEventListener("load",function(){if(200===s.status){o=s.response;var a=n.db.transaction(["textures"],"readwrite");a.onabort=function(e){try{"QuotaExceededError"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}r()},a.oncomplete=function(){r()};var h={textureUrl:t,data:o};try{var c=a.objectStore("textures").put(h);c.onsuccess=function(){},c.onerror=function(){r()}}catch(u){25===u.code&&(e.Database.isUASupportingBlobStorage=!1),i.src=t}}else i.src=t},!1),s.addEventListener("error",function(){e.Tools.Error("Error in XHR request in BABYLON.Database."),i.src=t},!1),s.send()}else i.src=t}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t},t.prototype._checkVersionFromDB=function(e,t){var i=this,n=function(){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,n)},t.prototype._loadVersionFromDBAsync=function(t,i,n){var r=this;if(this.isSupported){var o;try{var s=this.db.transaction(["versions"]);s.oncomplete=function(){o?r.manifestVersionFound>o.data?(r.mustUpdateRessources=!0,n()):i(o.data):(r.mustUpdateRessources=!0,n())},s.onabort=function(){i(-1)};var a=s.objectStore("versions").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(){e.Tools.Error("Error loading version for scene "+t+" from DB."),i(-1)}}catch(h){e.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+h.message),i(-1)}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var n=this;if(this.isSupported&&!this.hasReachedQuota)try{var r=this.db.transaction(["versions"],"readwrite");r.onabort=function(e){try{"QuotaExceededError"===e.srcElement.error.name&&(n.hasReachedQuota=!0)}catch(t){}i(-1)},r.oncomplete=function(){i(n.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=r.objectStore("versions").put(o);s.onsuccess=function(){},s.onerror=function(){e.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(a){e.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+a.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(t,i,n,r,o){var s=this,a=e.Database.ReturnFullUrlLocation(t),h=function(){s._saveFileIntoDBAsync(a,i,n)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,n,o):s._loadFileFromDBAsync(a,i,h,o):r()})},t.prototype._loadFileFromDBAsync=function(t,i,n){if(this.isSupported){var r;r=-1!==t.indexOf(".babylon")?"scenes":"textures";var o,s=this.db.transaction([r]);s.oncomplete=function(){o?i(o.data):n()},s.onabort=function(){n()};var a=s.objectStore(r).get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(){e.Tools.Error("Error loading file "+t+" from DB."),n()}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.prototype._saveFileIntoDBAsync=function(t,i,n,r){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var a,h=new XMLHttpRequest;h.open("GET",t,!0),r&&(h.responseType="arraybuffer"),h.onprogress=n,h.addEventListener("load",function(){if(200===h.status||e.Tools.ValidateXHRData(h,r?6:1))if(a=r?h.response:h.responseText,o.hasReachedQuota)i(a);else{var n=o.db.transaction([s],"readwrite");n.onabort=function(e){try{"QuotaExceededError"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}i(a)},n.oncomplete=function(){i(a)};var c;c="scenes"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var u=n.objectStore(s).put(c);u.onsuccess=function(){},u.onerror=function(){e.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(l){i(a)}}else i()},!1),h.addEventListener("error",function(){e.Tools.Error("error on XHR request."),i()},!1),h.send()}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.isUASupportingBlobStorage=!0,t.parseURL=function(e){var t=document.createElement("a");t.href=e;var i=e.substring(e.lastIndexOf("/")+1,e.length),n=e.substring(0,e.indexOf(i,0));return n},t.ReturnFullUrlLocation=function(t){return-1===t.indexOf("http:/")?e.Database.parseURL(window.location.href)+t:t},t}();e.Database=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n,r,o,s){this.name=t,this.cellSize=r,this.sprites=new Array,this.renderingGroupId=0,this._vertexDeclaration=[3,4,4,4],this._vertexStrideSize=60,this._capacity=n,this._spriteTexture=new e.Texture(i,o,!0,!1),this._spriteTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._epsilon=void 0===s?.01:s,this._scene=o,this._scene.spriteManagers.push(this),this._vertexDeclaration=[3,4,4,4],this._vertexStrideSize=60,this._vertexBuffer=o.getEngine().createDynamicVertexBuffer(n*this._vertexStrideSize*4);for(var a=[],h=0,c=0;n>c;c++)a.push(h),a.push(h+1),a.push(h+2),a.push(h),a.push(h+2),a.push(h+3),h+=4;this._indexBuffer=o.getEngine().createIndexBuffer(a),this._vertices=new Float32Array(n*this._vertexStrideSize),this._effectBase=this._scene.getEngine().createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return t.prototype._appendSpriteVertex=function(e,t,i,n,r){var o=15*e;0==i?i=this._epsilon:1==i&&(i=1-this._epsilon),0==n?n=this._epsilon:1==n&&(n=1-this._epsilon),this._vertices[o]=t.position.x,this._vertices[o+1]=t.position.y,this._vertices[o+2]=t.position.z,this._vertices[o+3]=t.angle,this._vertices[o+4]=t.size,this._vertices[o+5]=i,this._vertices[o+6]=n,this._vertices[o+7]=t.invertU?1:0,this._vertices[o+8]=t.invertV?1:0;var s=t.cellIndex/r>>0;this._vertices[o+9]=t.cellIndex-s*r,this._vertices[o+10]=s,this._vertices[o+11]=t.color.r,this._vertices[o+12]=t.color.g,this._vertices[o+13]=t.color.b,this._vertices[o+14]=t.color.a},t.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var t=this._scene.getEngine(),i=this._spriteTexture.getBaseSize(),n=e.Tools.GetDeltaTime(),r=Math.min(this._capacity,this.sprites.length),o=i.width/this.cellSize,s=0,a=0;r>a;a++){var h=this.sprites[a];h&&(h._animate(n),this._appendSpriteVertex(s++,h,0,0,o),this._appendSpriteVertex(s++,h,1,0,o),this._appendSpriteVertex(s++,h,1,1,o),this._appendSpriteVertex(s++,h,0,1,o))}t.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices,r*this._vertexStrideSize);var c=this._effectBase;this._scene.fogMode!==e.Scene.FOGMODE_NONE&&(c=this._effectFog),t.enableEffect(c);var u=this._scene.getViewMatrix();c.setTexture("diffuseSampler",this._spriteTexture),c.setMatrix("view",u),c.setMatrix("projection",this._scene.getProjectionMatrix()),c.setFloat2("textureInfos",this.cellSize/i.width,this.cellSize/i.height),this._scene.fogMode!==e.Scene.FOGMODE_NONE&&(c.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),c.setColor3("vFogColor",this._scene.fogColor)),t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,c),c.setBool("alphaTest",!0),t.setColorWrite(!1),t.draw(!0,0,6*r),t.setColorWrite(!0),c.setBool("alphaTest",!1),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.draw(!0,0,6*r),t.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDispose&&this.onDispose()},t}();e.SpriteManager=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i){this.name=t,this.color=new e.Color4(1,1,1,1),this.size=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._frameCount=0,this._time=0,this._manager=i,this._manager.sprites.push(this),this.position=e.Vector3.Zero()}return t.prototype.playAnimation=function(e,t,i,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=n,this._animationStarted=!0,this._direction=t>e?1:-1,this.cellIndex=e,this._time=0},t.prototype.stopAnimation=function(){this._animationStarted=!1},t.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1)},t}();e.Sprite=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n,r,o){this.name=t,this._vertexDeclaration=[2],this._vertexStrideSize=8,this.texture=i?new e.Texture(i,n,!0):null,this.isBackground=void 0===r?!0:r,this.color=void 0===o?new e.Color4(1,1,1,1):o,this._scene=n,this._scene.layers.push(this);var s=[];s.push(1,1),s.push(-1,1),s.push(-1,-1),s.push(1,-1),this._vertexBuffer=n.getEngine().createVertexBuffer(s);var a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=n.getEngine().createIndexBuffer(a),this._effect=this._scene.getEngine().createEffect("layer",["position"],["textureMatrix","color"],["textureSampler"],"")}return t.prototype.render=function(){if(this._effect.isReady()&&this.texture&&this.texture.isReady()){var t=this._scene.getEngine();t.enableEffect(this._effect),t.setState(!1),this._effect.setTexture("textureSampler",this.texture),this._effect.setMatrix("textureMatrix",this.texture.getTextureMatrix()),this._effect.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.draw(!0,0,6),t.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1),this.onDispose&&this.onDispose()},t}();e.Layer=t}(i||(i={}));var i;!function(e){var t=function(){function t(){this.position=e.Vector3.Zero(),this.direction=e.Vector3.Zero(),this.color=new e.Color4(0,0,0,0),this.colorStep=new e.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.angle=0,this.angularSpeed=0}return t}();e.Particle=t}(i||(i={}));var i;!function(e){var t=function(e,t){if(e==t)return e;var i=Math.random();return i*(t-e)+e},i=function(){function i(i,n,r,o){var s=this;this.name=i,this.fragmentElement=o,this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.blendMode=e.ParticleSystem.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.gravity=e.Vector3.Zero(),this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0),this.minEmitBox=new e.Vector3(-.5,-.5,-.5),this.maxEmitBox=new e.Vector3(.5,.5,.5),this.color1=new e.Color4(1,1,1,1),this.color2=new e.Color4(1,1,1,1),this.colorDead=new e.Color4(0,0,0,1),this.textureMask=new e.Color4(1,1,1,1),this.particles=new Array,this._vertexDeclaration=[3,4,4],this._vertexStrideSize=44,this._stockParticles=new Array,this._newPartsExcess=0,this._scaledColorStep=new e.Color4(0,0,0,0),this._colorDiff=new e.Color4(0,0,0,0),this._scaledDirection=e.Vector3.Zero(),this._scaledGravity=e.Vector3.Zero(),this._currentRenderId=-1,this._started=!1,this._stopped=!1,this._actualFrame=0,this.id=i,this._capacity=n,this._scene=r,r.particleSystems.push(this),this._vertexBuffer=r.getEngine().createDynamicVertexBuffer(n*this._vertexStrideSize*4);for(var a=[],h=0,c=0;n>c;c++)a.push(h),a.push(h+1),a.push(h+2),a.push(h),a.push(h+2),a.push(h+3),h+=4;this._indexBuffer=r.getEngine().createIndexBuffer(a),this._vertices=new Float32Array(n*this._vertexStrideSize),this.startDirectionFunction=function(i,n,r){var o=t(s.direction1.x,s.direction2.x),a=t(s.direction1.y,s.direction2.y),h=t(s.direction1.z,s.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(o*i,a*i,h*i,n,r)},this.startPositionFunction=function(i,n){var r=t(s.minEmitBox.x,s.maxEmitBox.x),o=t(s.minEmitBox.y,s.maxEmitBox.y),a=t(s.minEmitBox.z,s.maxEmitBox.z);
e.Vector3.TransformCoordinatesFromFloatsToRef(r,o,a,i,n)}}return i.prototype.getCapacity=function(){return this._capacity},i.prototype.isAlive=function(){return this._alive},i.prototype.isStarted=function(){return this._started},i.prototype.start=function(){this._started=!0,this._stopped=!1,this._actualFrame=0},i.prototype.stop=function(){this._stopped=!0},i.prototype._appendParticleVertex=function(e,t,i,n){var r=11*e;this._vertices[r]=t.position.x,this._vertices[r+1]=t.position.y,this._vertices[r+2]=t.position.z,this._vertices[r+3]=t.color.r,this._vertices[r+4]=t.color.g,this._vertices[r+5]=t.color.b,this._vertices[r+6]=t.color.a,this._vertices[r+7]=t.angle,this._vertices[r+8]=t.size,this._vertices[r+9]=i,this._vertices[r+10]=n},i.prototype._update=function(i){this._alive=this.particles.length>0;for(var n=0;n<this.particles.length;n++){var r=this.particles[n];r.age+=this._scaledUpdateSpeed,r.age>=r.lifeTime?(this._stockParticles.push(this.particles.splice(n,1)[0]),n--):(r.colorStep.scaleToRef(this._scaledUpdateSpeed,this._scaledColorStep),r.color.addInPlace(this._scaledColorStep),r.color.a<0&&(r.color.a=0),r.angle+=r.angularSpeed*this._scaledUpdateSpeed,r.direction.scaleToRef(this._scaledUpdateSpeed,this._scaledDirection),r.position.addInPlace(this._scaledDirection),this.gravity.scaleToRef(this._scaledUpdateSpeed,this._scaledGravity),r.direction.addInPlace(this._scaledGravity))}var o;for(o=this.emitter.position?this.emitter.getWorldMatrix():e.Matrix.Translation(this.emitter.x,this.emitter.y,this.emitter.z),n=0;i>n&&this.particles.length!=this._capacity;n++){0!==this._stockParticles.length?(r=this._stockParticles.pop(),r.age=0):r=new e.Particle,this.particles.push(r);var s=t(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(s,o,r.direction),r.lifeTime=t(this.minLifeTime,this.maxLifeTime),r.size=t(this.minSize,this.maxSize),r.angularSpeed=t(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(o,r.position);var a=t(0,1);e.Color4.LerpToRef(this.color1,this.color2,a,r.color),this.colorDead.subtractToRef(r.color,this._colorDiff),this._colorDiff.scaleToRef(1/r.lifeTime,r.colorStep)}},i.prototype._getEffect=function(){var e=[];this._scene.clipPlane&&e.push("#define CLIPPLANE");var t=e.join("\n");if(this._cachedDefines!=t){this._cachedDefines=t;var i;i=this.fragmentElement?{vertex:"particles",fragmentElement:this.fragmentElement}:"particles",this._effect=this._scene.getEngine().createEffect(i,["position","color","options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],t)}return this._effect},i.prototype.animate=function(){if(this._started){var e=this._getEffect();if(this.emitter&&e.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var t;this.manualEmitCount>-1?(t=this.manualEmitCount,this.manualEmitCount=0):t=this.emitRate;var i=t*this._scaledUpdateSpeed>>0;this._newPartsExcess+=t*this._scaledUpdateSpeed-i,this._newPartsExcess>1&&(i+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?i=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(i),this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(var n=0,r=0;r<this.particles.length;r++){var o=this.particles[r];this._appendParticleVertex(n++,o,0,0),this._appendParticleVertex(n++,o,1,0),this._appendParticleVertex(n++,o,1,1),this._appendParticleVertex(n++,o,0,1)}var s=this._scene.getEngine();s.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices,this.particles.length*this._vertexStrideSize)}}},i.prototype.render=function(){var t=this._getEffect();if(!(this.emitter&&t.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length))return 0;var i=this._scene.getEngine();i.enableEffect(t);var n=this._scene.getViewMatrix();if(t.setTexture("diffuseSampler",this.particleTexture),t.setMatrix("view",n),t.setMatrix("projection",this._scene.getProjectionMatrix()),t.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var r=this._scene.clipPlane,o=n.clone();o.invert(),t.setMatrix("invView",o),t.setFloat4("vClipPlane",r.normal.x,r.normal.y,r.normal.z,r.d)}return i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,t),i.setAlphaMode(this.blendMode===e.ParticleSystem.BLENDMODE_ONEONE?e.Engine.ALPHA_ADD:e.Engine.ALPHA_COMBINE),this.forceDepthWrite&&i.setDepthWrite(!0),i.draw(!0,0,6*this.particles.length),i.setAlphaMode(e.Engine.ALPHA_DISABLE),this.particles.length},i.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var e=this._scene.particleSystems.indexOf(this);this._scene.particleSystems.splice(e,1),this.onDispose&&this.onDispose()},i.prototype.clone=function(t,i){var n=new e.ParticleSystem(t,this._capacity,this._scene);return e.Tools.DeepCopy(this,n,["particles"],["_vertexDeclaration","_vertexStrideSize"]),void 0===i&&(i=this.emitter),n.emitter=i,this.particleTexture&&(n.particleTexture=new e.Texture(this.particleTexture.url,this._scene)),n.start(),n},i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,i}();e.ParticleSystem=i}(i||(i={}));var i;!function(e){var t=function(){function t(e,i,n,r,o){this.name=e,this.targetProperty=i,this.framePerSecond=n,this.dataType=r,this.loopMode=o,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this.targetPropertyPath=i.split("."),this.dataType=r,this.loopMode=void 0===o?t.ANIMATIONLOOPMODE_CYCLE:o}return t.prototype.isStopped=function(){return this._stopped},t.prototype.getKeys=function(){return this._keys},t.prototype.floatInterpolateFunction=function(e,t,i){return e+(t-e)*i},t.prototype.quaternionInterpolateFunction=function(t,i,n){return e.Quaternion.Slerp(t,i,n)},t.prototype.vector3InterpolateFunction=function(t,i,n){return e.Vector3.Lerp(t,i,n)},t.prototype.color3InterpolateFunction=function(t,i,n){return e.Color3.Lerp(t,i,n)},t.prototype.clone=function(){var e=new t(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);return e.setKeys(this._keys),e},t.prototype.setKeys=function(e){this._keys=e.slice(0),this._offsetsCache={},this._highLimitsCache={}},t.prototype._interpolate=function(e,i,n,r,o){if(n===t.ANIMATIONLOOPMODE_CONSTANT&&i>0)return o.clone?o.clone():o;this.currentFrame=e;for(var s=0;s<this._keys.length;s++)if(this._keys[s+1].frame>=e){var a=this._keys[s].value,h=this._keys[s+1].value,c=(e-this._keys[s].frame)/(this._keys[s+1].frame-this._keys[s].frame);switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(a,h,c);case t.ANIMATIONLOOPMODE_RELATIVE:return r*i+this.floatInterpolateFunction(a,h,c)}break;case t.ANIMATIONTYPE_QUATERNION:var u=null;switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:u=this.quaternionInterpolateFunction(a,h,c);break;case t.ANIMATIONLOOPMODE_RELATIVE:u=this.quaternionInterpolateFunction(a,h,c).add(r.scale(i))}return u;case t.ANIMATIONTYPE_VECTOR3:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(a,h,c);case t.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(a,h,c).add(r.scale(i))}case t.ANIMATIONTYPE_COLOR3:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(a,h,c);case t.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(a,h,c).add(r.scale(i))}case t.ANIMATIONTYPE_MATRIX:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:case t.ANIMATIONLOOPMODE_RELATIVE:return a}}break}return this._keys[this._keys.length-1].value},t.prototype.animate=function(e,i,n,r,o){if(!this.targetPropertyPath||this.targetPropertyPath.length<1)return this._stopped=!0,!1;var s=!0;if(0!=this._keys[0].frame){var a={frame:0,value:this._keys[0].value};this._keys.splice(0,0,a)}(i<this._keys[0].frame||i>this._keys[this._keys.length-1].frame)&&(i=this._keys[0].frame),(n<this._keys[0].frame||n>this._keys[this._keys.length-1].frame)&&(n=this._keys[this._keys.length-1].frame);var h=n-i,c=e*this.framePerSecond*o/1e3;if(c>h&&!r)u=0,s=!1,l=this._keys[this._keys.length-1].value;else{var u=0,l=0;if(this.loopMode!=t.ANIMATIONLOOPMODE_CYCLE){var f=n.toString()+i.toString();if(!this._offsetsCache[f]){var p=this._interpolate(i,0,t.ANIMATIONLOOPMODE_CYCLE),d=this._interpolate(n,0,t.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:this._offsetsCache[f]=d-p;break;case t.ANIMATIONTYPE_QUATERNION:this._offsetsCache[f]=d.subtract(p);break;case t.ANIMATIONTYPE_VECTOR3:this._offsetsCache[f]=d.subtract(p);case t.ANIMATIONTYPE_COLOR3:this._offsetsCache[f]=d.subtract(p)}this._highLimitsCache[f]=d}l=this._highLimitsCache[f],u=this._offsetsCache[f]}}var m=c/h>>0,g=s?i+c%h:n,_=this._interpolate(g,m,this.loopMode,u,l);if(this.targetPropertyPath.length>1){for(var v=this._target[this.targetPropertyPath[0]],y=1;y<this.targetPropertyPath.length-1;y++)v=v[this.targetPropertyPath[y]];v[this.targetPropertyPath[this.targetPropertyPath.length-1]]=_}else this._target[this.targetPropertyPath[0]]=_;return this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty),s||(this._stopped=!0),s},Object.defineProperty(t,"ANIMATIONTYPE_FLOAT",{get:function(){return t._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_VECTOR3",{get:function(){return t._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_QUATERNION",{get:function(){return t._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_MATRIX",{get:function(){return t._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_COLOR3",{get:function(){return t._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return t._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return t._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return t._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),t._ANIMATIONTYPE_FLOAT=0,t._ANIMATIONTYPE_VECTOR3=1,t._ANIMATIONTYPE_QUATERNION=2,t._ANIMATIONTYPE_MATRIX=3,t._ANIMATIONTYPE_COLOR3=4,t._ANIMATIONLOOPMODE_RELATIVE=0,t._ANIMATIONLOOPMODE_CYCLE=1,t._ANIMATIONLOOPMODE_CONSTANT=2,t}();e.Animation=t}(i||(i={}));var i;!function(e){var t=function(){function e(e,t,i,n,r,o,s,a){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=100),"undefined"==typeof r&&(r=!1),"undefined"==typeof o&&(o=1),this.target=t,this.fromFrame=i,this.toFrame=n,this.loopAnimation=r,this.speedRatio=o,this.onAnimationEnd=s,this._animations=new Array,this._paused=!1,this.animationStarted=!1,a&&this.appendAnimations(t,a),this._scene=e,e._activeAnimatables.push(this)}return e.prototype.appendAnimations=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n._target=e,this._animations.push(n)}},e.prototype.getAnimationByTargetProperty=function(e){for(var t=this._animations,i=0;i<t.length;i++)if(t[i].targetProperty===e)return t[i];return null},e.prototype.pause=function(){this._paused=!0},e.prototype.restart=function(){this._paused=!1},e.prototype.stop=function(){var e=this._scene._activeAnimatables.indexOf(this);e>-1&&this._scene._activeAnimatables.splice(e,1),this.onAnimationEnd&&this.onAnimationEnd()},e.prototype._animate=function(e){if(this._paused)return!0;this._localDelayOffset||(this._localDelayOffset=e);for(var t=!1,i=this._animations,n=0;n<i.length;n++){var r=i[n],o=r.animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio);t=t||o}return!t&&this.onAnimationEnd&&this.onAnimationEnd(),t},e}();e.Animatable=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n){"undefined"==typeof n&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=i||64,this._selectionContent=new e.SmartArray(1024),this._creationFunc=t}return t.prototype.update=function(e,i,n){t._CreateBlocks(e,i,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.addEntry(e)}},t.prototype.select=function(e,t){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){var n=this.blocks[i];n.select(e,this._selectionContent,t)}return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(e,t,i){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++){var r=this.blocks[n];r.intersects(e,t,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t._CreateBlocks=function(t,i,n,r,o,s,a,h){a.blocks=new Array;for(var c=new e.Vector3((i.x-t.x)/2,(i.y-t.y)/2,(i.z-t.z)/2),u=0;2>u;u++)for(var l=0;2>l;l++)for(var f=0;2>f;f++){var p=t.add(c.multiplyByFloats(u,l,f)),d=t.add(c.multiplyByFloats(u+1,l+1,f+1)),m=new e.OctreeBlock(p,d,r,o+1,s,h);m.addEntries(n),a.blocks.push(m)}},t.CreationFuncForMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t}();e.Octree=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t,i,n,r,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=n,this._maxDepth=r,this._creationFunc=o,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[2].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[3].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[4].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[5].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[6].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[7].y=e.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.addEntries=function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addEntry(i)}},t.prototype.select=function(t,i,n){if(e.BoundingBox.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var r=0;r<this.blocks.length;r++){var o=this.blocks[r];o.select(t,i,n)}return}n?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,i,n,r){if(e.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,t,i)){if(this.blocks){for(var o=0;o<this.blocks.length;o++){var s=this.blocks[o];s.intersects(t,i,n,r)}return}r?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){var n=this.blocks[i];n.intersectsRay(e,t)}return}t.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){e.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t}();e.OctreeBlock=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n,r){this.name=t,this.children=new Array,this.animations=new Array,this._worldTransform=new e.Matrix,this._absoluteTransform=new e.Matrix,this._invertedAbsoluteTransform=new e.Matrix,this._skeleton=i,this._matrix=r,this._baseMatrix=r,i.bones.push(this),n?(this._parent=n,n.children.push(this)):this._parent=null,this._updateDifferenceMatrix()}return t.prototype.getParent=function(){return this._parent},t.prototype.getLocalMatrix=function(){return this._matrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteMatrix=function(){for(var e=this._matrix.clone(),t=this._parent;t;)e=e.multiply(t.getLocalMatrix()),t=t.getParent();return e},t.prototype.updateMatrix=function(e){this._matrix=e,this._skeleton._markAsDirty(),this._updateDifferenceMatrix()},t.prototype._updateDifferenceMatrix=function(){this._parent?this._matrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(this._matrix),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var e=0;e<this.children.length;e++)this.children[e]._updateDifferenceMatrix()},t.prototype.markAsDirty=function(){this._skeleton._markAsDirty()},t}();e.Bone=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n){this.name=t,this.id=i,this.bones=new Array,this._isDirty=!0,this._identity=e.Matrix.Identity(),this.bones=[],this._scene=n,n.skeletons.push(this)}return t.prototype.getTransformMatrices=function(){return this._transformMatrices},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype.prepare=function(){if(this._isDirty){this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)));for(var e=0;e<this.bones.length;e++){var t=this.bones[e],i=t.getParent();i?t.getLocalMatrix().multiplyToRef(i.getWorldMatrix(),t.getWorldMatrix()):t.getWorldMatrix().copyFrom(t.getLocalMatrix()),t.getInvertedAbsoluteTransform().multiplyToArray(t.getWorldMatrix(),this._transformMatrices,16*e)}this._identity.copyToArray(this._transformMatrices,16*this.bones.length),this._isDirty=!1}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!=this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},t.prototype.clone=function(t,i){for(var n=new e.Skeleton(t,i||t,this._scene),r=0;r<this.bones.length;r++){var o=this.bones[r],s=null;if(o.getParent()){var a=this.bones.indexOf(o.getParent());s=n.bones[a]}var h=new e.Bone(o.name,n,s,o.getBaseMatrix());e.Tools.DeepCopy(o.animations,h.animations)}return n},t}();e.Skeleton=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n,r,o,s,a,h,c){this.name=t,this.width=-1,this.height=-1,this._reusable=!1,this._textures=new e.SmartArray(2),this._currentRenderTextureInd=0,null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=h,this._renderRatio=o,this.renderTargetSamplingMode=a?a:e.Texture.NEAREST_SAMPLINGMODE,this._reusable=c||!1,r=r||[],r.push("textureSampler"),this._effect=this._engine.createEffect({vertex:"postprocess",fragment:i},["position"],n||[],r,"")}return t.prototype.isReusable=function(){return this._reusable},t.prototype.activate=function(e,t){e=e||this._camera;var i=e.getScene(),n=(t?t._width:this._engine.getRenderingCanvas().width)*this._renderRatio,r=(t?t._height:this._engine.getRenderingCanvas().height)*this._renderRatio;if(this.width!==n||this.height!==r){if(this._textures.length>0){for(var o=0;o<this._textures.length;o++)this._engine._releaseTexture(this._textures.data[o]);this._textures.reset()}this.width=n,this.height=r,this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:e._postProcesses.indexOf(this)===e._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode})),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:e._postProcesses.indexOf(this)===e._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode})),this.onSizeChanged&&this.onSizeChanged()}this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]),this.onActivate&&this.onActivate(e),this._engine.clear(i.clearColor,i.autoClear||i.forceWireframe,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},t.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(e.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),this.onApply&&this.onApply(this._effect),this._effect):null},t.prototype.dispose=function(e){if(e=e||this._camera,this._textures.length>0){for(var t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.reset()}e.detachPostProcess(this);var i=e._postProcesses.indexOf(this);i===e._postProcessesTakenIndices[0]&&e._postProcessesTakenIndices.length>0&&(this._camera._postProcesses[e._postProcessesTakenIndices[0]].width=-1)},t}();e.PostProcess=t}(i||(i={}));var i;!function(e){var t=function(){function e(e){this._vertexDeclaration=[2],this._vertexStrideSize=8,this._scene=e;var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffer=e.getEngine().createVertexBuffer(t);var i=[];i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),this._indexBuffer=e.getEngine().createIndexBuffer(i)}return e.prototype._prepareFrame=function(e){var t=this._scene.activeCamera._postProcesses,i=this._scene.activeCamera._postProcessesTakenIndices;return 0!==i.length&&this._scene.postProcessesEnabled?(t[this._scene.activeCamera._postProcessesTakenIndices[0]].activate(this._scene.activeCamera,e),!0):!1},e.prototype._finalizeFrame=function(e,t){var i=this._scene.activeCamera._postProcesses,n=this._scene.activeCamera._postProcessesTakenIndices;if(0!==n.length&&this._scene.postProcessesEnabled){for(var r=this._scene.getEngine(),o=0;o<n.length&&(o<n.length-1?i[n[o+1]].activate(this._scene.activeCamera):t?r.bindFramebuffer(t):r.restoreDefaultFramebuffer(),!e);o++){var s=i[n[o]].apply();s&&(r.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,s),r.draw(!0,0,6))}r.setDepthBuffer(!0),r.setDepthWrite(!0)}},e.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}();e.PostProcessManager=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"pass",null,null,i,n,r,o,s)}return n(t,e),t}(e.PostProcess);e.PassPostProcess=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o,s,a,h,c){"undefined"==typeof a&&(a=e.Texture.BILINEAR_SAMPLINGMODE);var u=this;t.call(this,i,"blur",["screenSize","direction","blurWidth"],null,o,s,a,h,c),this.direction=n,this.blurWidth=r,this.onApply=function(e){e.setFloat2("screenSize",u.width,u.height),e.setVector2("direction",u.direction),e.setFloat("blurWidth",u.blurWidth)}}return n(i,t),i}(e.PostProcess);e.BlurPostProcess=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s,a){var h=this;e.call(this,t,"filter",["kernelMatrix"],null,n,r,o,s,a),this.kernelMatrix=i,this.onApply=function(e){e.setMatrix("kernelMatrix",h.kernelMatrix)}}return n(t,e),t}(e.PostProcess);e.FilterPostProcess=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o,s,a,h,c,u,l){var f=this;t.call(this,i,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],a,h,c,u,l),this.color=r,this.depth=o,this.colorLevel=s,this.onActivate=function(t){f._refRexture=f._refRexture||new e.Texture(n,t.getScene())},this.onApply=function(e){e.setColor3("baseColor",f.color),e.setFloat("depth",f.depth),e.setFloat("colorLevel",f.colorLevel),e.setTexture("refractionSampler",f._refRexture)}}return n(i,t),i.prototype.dispose=function(e){this._refRexture&&this._refRexture.dispose(),t.prototype.dispose.call(this,e)},i}(e.PostProcess);e.RefractionPostProcess=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"blackAndWhite",null,null,i,n,r,o,s)}return n(t,e),t}(e.PostProcess);e.BlackAndWhitePostProcess=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s,a){var h=this;e.call(this,t,"convolution",["kernel","screenSize"],null,n,r,o,s,a),this.kernel=i,this.onApply=function(e){e.setFloat2("screenSize",h.width,h.height),e.setArray("kernel",h.kernel)}}return n(t,e),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(e.PostProcess);e.ConvolutionPostProcess=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s){var a=this;e.call(this,t,"fxaa",["texelSize"],null,i,n,r,o,s),this.onSizeChanged=function(){a.texelWidth=1/a.width,a.texelHeight=1/a.height},this.onApply=function(e){e.setFloat2("texelSize",a.texelWidth,a.texelHeight)}}return n(t,e),t}(e.PostProcess);e.FxaaPostProcess=t}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n,r,o){this.size=t,this.position=i,this.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},this.color=n||new e.Color3(1,1,1),this.texture=r?new e.Texture(r,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return t}();e.LensFlare=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t,i){this.name=e,this.lensFlares=new Array,this.borderLimit=300,this._vertexDeclaration=[2],this._vertexStrideSize=8,this._isEnabled=!0,this._scene=i,this._emitter=t,i.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return e.material&&e.isVisible&&e.isEnabled()&&e.checkCollisions&&0!=(e.layerMask&i.activeCamera.layerMask)};var n=[];n.push(1,1),n.push(-1,1),n.push(-1,-1),n.push(1,-1),this._vertexBuffer=i.getEngine().createVertexBuffer(n);var r=[];r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),this._indexBuffer=i.getEngine().createIndexBuffer(r),this._effect=this._scene.getEngine().createEffect("lensFlare",["position"],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEmitter=function(){return this._emitter},t.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},t.prototype.computeEffectivePosition=function(t){var i=this.getEmitterPosition();return i=e.Vector3.Project(i,e.Matrix.Identity(),this._scene.getTransformMatrix(),t),this._positionX=i.x,this._positionY=i.y,i=e.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),i.z>0&&this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&this._positionY<t.y+t.height?!0:!1},t.prototype._isVisible=function(){if(!this._isEnabled)return!1;var t=this.getEmitterPosition(),i=t.subtract(this._scene.activeCamera.position),n=i.length();i.normalize();var r=new e.Ray(this._scene.activeCamera.position,i),o=this._scene.pickWithRay(r,this.meshesSelectionPredicate,!0);return!o.hit||o.distance>n},t.prototype.render=function(){if(!this._effect.isReady())return!1;var t=this._scene.getEngine(),i=this._scene.activeCamera.viewport,n=i.toGlobal(t);if(!this.computeEffectivePosition(n))return!1;if(!this._isVisible())return!1;var r,o;r=this._positionX<this.borderLimit+n.x?this.borderLimit+n.x-this._positionX:this._positionX>n.x+n.width-this.borderLimit?this._positionX-n.x-n.width+this.borderLimit:0,o=this._positionY<this.borderLimit+n.y?this.borderLimit+n.y-this._positionY:this._positionY>n.y+n.height-this.borderLimit?this._positionY-n.y-n.height+this.borderLimit:0;var s=r>o?r:o;s>this.borderLimit&&(s=this.borderLimit);var a=1-s/this.borderLimit;if(0>a)return!1;a>1&&(a=1);var h=n.x+n.width/2,c=n.y+n.height/2,u=h-this._positionX,l=c-this._positionY;t.enableEffect(this._effect),t.setState(!1),t.setDepthBuffer(!1),t.setAlphaMode(e.Engine.ALPHA_ADD),t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect);for(var f=0;f<this.lensFlares.length;f++){var p=this.lensFlares[f],d=h-u*p.position,m=c-l*p.position,g=p.size,_=p.size*t.getAspectRatio(this._scene.activeCamera),v=2*(d/n.width)-1,y=1-2*(m/n.height),x=e.Matrix.FromValues(g/2,0,0,0,0,_/2,0,0,0,0,1,0,v,y,0,1);this._effect.setMatrix("viewportMatrix",x),this._effect.setTexture("textureSampler",p.texture),this._effect.setFloat4("color",p.color.r*a,p.color.g*a,p.color.b*a,1),t.draw(!0,0,6)}return t.setDepthBuffer(!0),t.setAlphaMode(e.Engine.ALPHA_DISABLE),!0},t.prototype.dispose=function(){for(this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var e=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(e,1)},t}();e.LensFlareSystem=t}(i||(i={}));var i;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0}return e}();
e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1}return t.prototype.getNormal=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),n=e.Vector3.FromArray(i,3*t[3*this.faceId]),r=e.Vector3.FromArray(i,3*t[3*this.faceId+1]),o=e.Vector3.FromArray(i,3*t[3*this.faceId+2]);return n=n.scale(this.bu),r=r.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector3(n.x+r.x+o.x,n.y+r.y+o.y,n.z+r.z+o.z)},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),n=e.Vector2.FromArray(i,2*t[3*this.faceId]),r=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(this.bu),r=r.scale(this.bv),o=o.scale(1-this.bu-this.bv),new e.Vector2(n.x+r.x+o.x,n.y+r.y+o.y)},t}();e.PickingInfo=i}(i||(i={}));var i;!function(e){var t=function(){function t(e,t,i,n,r,o,s,a){this.engine=e,this.canvas=i,this.currentScene=t,this.sceneLoadedCallback=n,this.progressCallback=r,this.additionnalRenderLoopLogicCallback=o,this.textureLoadingCallback=s,this.startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this.elementToMonitor=e,this.elementToMonitor.addEventListener("dragenter",function(e){t.drag(e)},!1),this.elementToMonitor.addEventListener("dragover",function(e){t.drag(e)},!1),this.elementToMonitor.addEventListener("drop",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this.additionnalRenderLoopLogicCallback&&this.additionnalRenderLoopLogicCallback(),this.currentScene){if(this.textureLoadingCallback){var e=this.currentScene.getWaitingItemsCount();e>0&&this.textureLoadingCallback(e)}this.currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(t){var i=this,n=this;this.startingProcessingFilesCallback&&this.startingProcessingFilesCallback();var r,o;if(t&&t.dataTransfer&&t.dataTransfer.files&&(o=t.dataTransfer.files),t&&t.target&&t.target.files&&(o=t.target.files),o&&o.length>0){for(var s=0;s<o.length;s++)switch(o[s].type){case"image/jpeg":case"image/png":e.FilesInput.FilesTextures[o[s].name]=o[s];break;case"image/targa":case"image/vnd.ms-dds":e.FilesInput.FilesToLoad[o[s].name]=o[s];break;default:-1!==o[s].name.indexOf(".babylon")&&-1===o[s].name.indexOf(".manifest")&&-1===o[s].name.indexOf(".incremental")&&-1===o[s].name.indexOf(".babylonmeshdata")&&-1===o[s].name.indexOf(".babylongeometrydata")&&(r=o[s])}r?(this.currentScene&&(this.engine.stopRenderLoop(),this.currentScene.dispose()),e.SceneLoader.Load("file:",r,this.engine,function(e){n.currentScene=e,n.currentScene.executeWhenReady(function(){n.currentScene.activeCamera&&n.currentScene.activeCamera.attachControl(n.canvas),n.sceneLoadedCallback&&n.sceneLoadedCallback(r,n.currentScene),n.engine.runRenderLoop(function(){n.renderFunction()})})},function(e){i.progressCallback&&i.progressCallback(e)})):e.Tools.Error("Please provide a valid .babylon file.")}},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(i||(i={}));var i;!function(e){var t=function(){function t(){this._registeredMeshes=[],this.updateBodyPosition=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var i=this._registeredMeshes[t];if(i.mesh===e||i.mesh===e.parent){var n=i.body.body;return n.setPosition(e.position.x,e.position.y,e.position.z),void n.setOrientation(e.rotation.x,e.rotation.y,e.rotation.z)}if(i.mesh.parent===e){e.computeWorldMatrix(!0),i.mesh.computeWorldMatrix(!0);var r=i.mesh.getAbsolutePosition(),o=e.rotation;return n=i.body.body,n.setPosition(r.x,r.y,r.z),void n.setOrientation(o.x,o.y,o.z)}}}}return t.prototype._checkWithEpsilon=function(t){return t<e.PhysicsEngine.Epsilon?e.PhysicsEngine.Epsilon:t},t.prototype.initialize=function(){this._world=new OIMO.World,this._world.clear()},t.prototype.setGravity=function(e){this._world.gravity=e},t.prototype.registerMesh=function(t,i,n){var r=null;switch(this.unregisterMesh(t),t.computeWorldMatrix(!0),i){case e.PhysicsEngine.SphereImpostor:var o=t.getBoundingInfo().boundingBox,s=o.maximumWorld.x-o.minimumWorld.x,a=o.maximumWorld.y-o.minimumWorld.y,h=o.maximumWorld.z-o.minimumWorld.z,c=Math.max(this._checkWithEpsilon(s),this._checkWithEpsilon(a),this._checkWithEpsilon(h))/2;r=new OIMO.Body({type:"sphere",size:[c],pos:[t.position.x,t.position.y,t.position.z],rot:[t.rotation.x/OIMO.TO_RAD,t.rotation.y/OIMO.TO_RAD,t.rotation.z/OIMO.TO_RAD],move:0!=n.mass,config:[n.mass,n.friction,n.restitution],world:this._world}),this._registeredMeshes.push({mesh:t,body:r});break;case e.PhysicsEngine.PlaneImpostor:case e.PhysicsEngine.BoxImpostor:o=t.getBoundingInfo().boundingBox;var u=o.minimumWorld,l=o.maximumWorld,f=l.subtract(u),p=this._checkWithEpsilon(f.x),d=this._checkWithEpsilon(f.y),m=this._checkWithEpsilon(f.z);r=new OIMO.Body({type:"box",size:[p,d,m],pos:[t.position.x,t.position.y,t.position.z],rot:[t.rotation.x/OIMO.TO_RAD,t.rotation.y/OIMO.TO_RAD,t.rotation.z/OIMO.TO_RAD],move:0!=n.mass,config:[n.mass,n.friction,n.restitution],world:this._world}),this._registeredMeshes.push({mesh:t,body:r})}return r},t.prototype.registerMeshesAsCompound=function(e,t){for(var i=[],n=[],r=[],o=[],s=e[0].mesh,a=0;a<e.length;a++){var h=e[a],c=this._createBodyAsCompound(h,t,s);i.push(c.type),n.push.apply(n,c.size),r.push.apply(r,c.pos),o.push.apply(o,c.rot)}var u=new OIMO.Body({type:i,size:n,pos:r,rot:o,move:0!=t.mass,config:[t.mass,t.friction,t.restitution],world:this._world});return this._registeredMeshes.push({mesh:s,body:u}),u},t.prototype._createBodyAsCompound=function(t){var i=null,n=t.mesh;switch(t.impostor){case e.PhysicsEngine.SphereImpostor:var r=n.getBoundingInfo().boundingBox,o=r.maximumWorld.x-r.minimumWorld.x,s=r.maximumWorld.y-r.minimumWorld.y,a=r.maximumWorld.z-r.minimumWorld.z,h=Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(s),this._checkWithEpsilon(a))/2;i={type:"sphere",size:[h,-1,-1],pos:[n.position.x,n.position.y,n.position.z],rot:[n.rotation.x/OIMO.TO_RAD,n.rotation.y/OIMO.TO_RAD,n.rotation.z/OIMO.TO_RAD]};break;case e.PhysicsEngine.PlaneImpostor:case e.PhysicsEngine.BoxImpostor:r=n.getBoundingInfo().boundingBox;var c=r.minimumWorld,u=r.maximumWorld,l=u.subtract(c),f=this._checkWithEpsilon(l.x),p=this._checkWithEpsilon(l.y),d=this._checkWithEpsilon(l.z),m=n.position;i={type:"box",size:[f,p,d],pos:[m.x,m.y,m.z],rot:[n.rotation.x/OIMO.TO_RAD,n.rotation.y/OIMO.TO_RAD,n.rotation.z/OIMO.TO_RAD]}}return i},t.prototype.unregisterMesh=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var i=this._registeredMeshes[t];if(i.mesh===e||i.mesh===e.parent)return i.body&&(this._world.removeRigidBody(i.body.body),this._unbindBody(i.body)),void this._registeredMeshes.splice(t,1)}},t.prototype._unbindBody=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var i=this._registeredMeshes[t];i.body===e&&(i.body=null)}},t.prototype.applyImpulse=function(e,t,i){for(var n=0;n<this._registeredMeshes.length;n++){var r=this._registeredMeshes[n];if(r.mesh===e||r.mesh===e.parent)return void r.body.body.applyImpulse(i.scale(OIMO.INV_SCALE),t.scale(OIMO.INV_SCALE))}},t.prototype.createLink=function(e,t,i,n,r){for(var o=null,s=null,a=0;a<this._registeredMeshes.length;a++){var h=this._registeredMeshes[a];h.mesh===e?o=h.body.body:h.mesh===t&&(s=h.body.body)}return o&&s?(r||(r={}),new OIMO.Link({type:r.type,body1:o,body2:s,min:r.min,max:r.max,axe1:r.axe1,axe2:r.axe2,pos1:[i.x,i.y,i.z],pos2:[n.x,n.y,n.z],collision:r.collision,spring:r.spring,world:this._world}),!0):!1},t.prototype.dispose=function(){for(this._world.clear();this._registeredMeshes.length;)this.unregisterMesh(this._registeredMeshes[0].mesh)},t.prototype.isSupported=function(){return void 0!==OIMO},t.prototype._getLastShape=function(e){for(var t=e.shapes;t.next;)t=t.next;return t},t.prototype.runOneStep=function(){this._world.step();for(var t,i=this._registeredMeshes.length;i--;){var n=this._registeredMeshes[i].body.body,r=this._registeredMeshes[i].mesh;if(!n.sleeping)if(n.shapes.next){var o=this._getLastShape(n);r.position.x=o.position.x*OIMO.WORLD_SCALE,r.position.y=o.position.y*OIMO.WORLD_SCALE,r.position.z=o.position.z*OIMO.WORLD_SCALE;var s=e.Matrix.FromArray(n.getMatrix());r.rotationQuaternion||(r.rotationQuaternion=new e.Quaternion(0,0,0,1)),r.rotationQuaternion.fromRotationMatrix(s)}else t=n.getMatrix(),s=e.Matrix.FromArray(t),r.position.x=s.m[12],r.position.y=s.m[13],r.position.z=s.m[14],r.rotationQuaternion||(r.rotationQuaternion=new e.Quaternion(0,0,0,1)),r.rotationQuaternion.fromRotationMatrix(s)}},t}();e.OimoJSPlugin=t}(i||(i={}));var i;!function(e){var t=function(){function t(t){this._currentPlugin=t||new e.OimoJSPlugin}return t.prototype._initialize=function(e){this._currentPlugin.initialize(),this._setGravity(e)},t.prototype._runOneStep=function(e){e>.1?e=.1:0>=e&&(e=1/60),this._currentPlugin.runOneStep(e)},t.prototype._setGravity=function(t){this.gravity=t||new e.Vector3(0,-9.82,0),this._currentPlugin.setGravity(this.gravity)},t.prototype._registerMesh=function(e,t,i){return this._currentPlugin.registerMesh(e,t,i)},t.prototype._registerMeshesAsCompound=function(e,t){return this._currentPlugin.registerMeshesAsCompound(e,t)},t.prototype._unregisterMesh=function(e){this._currentPlugin.unregisterMesh(e)},t.prototype._applyImpulse=function(e,t,i){this._currentPlugin.applyImpulse(e,t,i)},t.prototype._createLink=function(e,t,i,n,r){return this._currentPlugin.createLink(e,t,i,n,r)},t.prototype._updateBodyPosition=function(e){this._currentPlugin.updateBodyPosition(e)},t.prototype.dispose=function(){this._currentPlugin.dispose()},t.prototype.isSupported=function(){return this._currentPlugin.isSupported()},t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.CompoundImpostor=4,t.MeshImpostor=4,t.CapsuleImpostor=5,t.ConeImpostor=6,t.CylinderImpostor=7,t.ConvexHullImpostor=8,t.Epsilon=.001,t}();e.PhysicsEngine=t}(i||(i={}));var i;!function(e){var t=function(t){var i={};if(i.name=t.name,i.id=t.id,i.tags=e.Tags.GetTags(t),t instanceof e.PointLight)i.type=0,i.position=t.position.asArray();else if(t instanceof e.DirectionalLight){i.type=1;var n=t;i.position=n.position.asArray(),i.direction=n.direction.asArray()}else if(t instanceof e.SpotLight){i.type=2;var r=t;i.position=r.position.asArray(),i.direction=r.position.asArray(),i.angle=r.angle,i.exponent=r.exponent}else if(t instanceof e.HemisphericLight){i.type=3;var o=t;i.direction=o.direction.asArray(),i.groundColor=o.groundColor.asArray()}return t.intensity&&(i.intensity=t.intensity),i.range=t.range,i.diffuse=t.diffuse.asArray(),i.specular=t.specular.asArray(),i},i=function(t){var i={};return i.name=t.name,i.tags=e.Tags.GetTags(t),i.id=t.id,i.position=t.position.asArray(),t.parent&&(i.parentId=t.parent.id),i.rotation=t.rotation.asArray(),t.lockedTarget&&t.lockedTarget.id&&(i.lockedTargetId=t.lockedTarget.id),i.fov=t.fov,i.minZ=t.minZ,i.maxZ=t.maxZ,i.speed=t.speed,i.inertia=t.inertia,i.checkCollisions=t.checkCollisions,i.applyGravity=t.applyGravity,t.ellipsoid&&(i.ellipsoid=t.ellipsoid.asArray()),n(t,i),i.layerMask=t.layerMask,i},n=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var n=e.animations[i];t.animations.push(r(n))}}},r=function(t){var i={};i.name=t.name,i.property=t.targetProperty,i.framePerSecond=t.framePerSecond,i.dataType=t.dataType,i.loopBehavior=t.loopMode;var n=t.dataType;i.keys=[];for(var r=t.getKeys(),o=0;o<r.length;o++){var s=r[o],a={};switch(a.frame=s.frame,n){case e.Animation.ANIMATIONTYPE_FLOAT:a.values=[s.value];break;case e.Animation.ANIMATIONTYPE_QUATERNION:case e.Animation.ANIMATIONTYPE_MATRIX:case e.Animation.ANIMATIONTYPE_VECTOR3:a.values=s.value.asArray()}i.keys.push(a)}return i},o=function(t){var i={};i.name=t.name,i.id=t.id,i.tags=e.Tags.GetTags(t),i.materials=[];for(var n=0;n<t.subMaterials.length;n++){var r=t.subMaterials[n];i.materials.push(r?r.id:null)}return i},s=function(t){var i={};return i.name=t.name,i.ambient=t.ambientColor.asArray(),i.diffuse=t.diffuseColor.asArray(),i.specular=t.specularColor.asArray(),i.specularPower=t.specularPower,i.emissive=t.emissiveColor.asArray(),i.alpha=t.alpha,i.id=t.id,i.tags=e.Tags.GetTags(t),i.backFaceCulling=t.backFaceCulling,t.diffuseTexture&&(i.diffuseTexture=a(t.diffuseTexture)),t.ambientTexture&&(i.ambientTexture=a(t.ambientTexture)),t.opacityTexture&&(i.opacityTexture=a(t.opacityTexture)),t.reflectionTexture&&(i.reflectionTexture=a(t.reflectionTexture)),t.emissiveTexture&&(i.emissiveTexture=a(t.emissiveTexture)),t.specularTexture&&(i.specularTexture=a(t.specularTexture)),t.bumpTexture&&(i.bumpTexture=a(t.bumpTexture)),i},a=function(t){var i={};if(!t.name)return null;if(t instanceof e.CubeTexture)return i.name=t.name,i.hasAlpha=t.hasAlpha,i.level=t.level,i.coordinatesMode=t.coordinatesMode,i;if(t instanceof e.MirrorTexture){var r=t;i.renderTargetSize=r.getRenderSize(),i.renderList=[];for(var o=0;o<r.renderList.length;o++)i.renderList.push(r.renderList[o].id);i.mirrorPlane=r.mirrorPlane.asArray()}else if(t instanceof e.RenderTargetTexture){var s=t;for(i.renderTargetSize=s.getRenderSize(),i.renderList=[],o=0;o<s.renderList.length;o++)i.renderList.push(s.renderList[o].id)}var a=t;return i.name=t.name,i.hasAlpha=t.hasAlpha,i.level=t.level,i.coordinatesIndex=t.coordinatesIndex,i.coordinatesMode=t.coordinatesMode,i.uOffset=a.uOffset,i.vOffset=a.vOffset,i.uScale=a.uScale,i.vScale=a.vScale,i.uAng=a.uAng,i.vAng=a.vAng,i.wAng=a.wAng,i.wrapU=t.wrapU,i.wrapV=t.wrapV,n(t,i),i},h=function(e){var t={};t.name=e.name,t.id=e.id,t.bones=[];for(var i=0;i<e.bones.length;i++){var n=e.bones[i],o={parentBoneIndex:n.getParent()?e.bones.indexOf(n.getParent()):-1,name:n.name,matrix:n.getLocalMatrix().toArray()};t.bones.push(o),n.animations&&n.animations.length>0&&(o.animation=r(n.animations[0]))}return t},c=function(e){var t={};return t.emitterId=e.emitter.id,t.capacity=e.getCapacity(),e.particleTexture&&(t.textureName=e.particleTexture.name),t.minAngularSpeed=e.minAngularSpeed,t.maxAngularSpeed=e.maxAngularSpeed,t.minSize=e.minSize,t.maxSize=e.maxSize,t.minLifeTime=e.minLifeTime,t.maxLifeTime=e.maxLifeTime,t.emitRate=e.emitRate,t.minEmitBox=e.minEmitBox.asArray(),t.maxEmitBox=e.maxEmitBox.asArray(),t.gravity=e.gravity.asArray(),t.direction1=e.direction1.asArray(),t.direction2=e.direction2.asArray(),t.color1=e.color1.asArray(),t.color2=e.color2.asArray(),t.colorDead=e.colorDead.asArray(),t.updateSpeed=e.updateSpeed,t.targetStopDuration=e.targetStopDuration,t.textureMask=e.textureMask.asArray(),t.blendMode=e.blendMode,t},u=function(t){var i={};i.emitterId=t.getEmitter().id,i.borderLimit=t.borderLimit,i.flares=[];for(var n=0;n<t.lensFlares.length;n++){var r=t.lensFlares[n];i.flares.push({size:r.size,position:r.position,color:r.color.asArray(),textureName:e.Tools.GetFilename(r.texture.name)})}return i},l=function(e){var t={},i=e.getShadowGenerator();t.lightId=e.id,t.mapSize=i.getShadowMap().getRenderSize(),t.useVarianceShadowMap=i.useVarianceShadowMap,t.usePoissonSampling=i.usePoissonSampling,t.renderList=[];for(var n=0;n<i.getShadowMap().renderList.length;n++){var r=i.getShadowMap().renderList[n];t.renderList.push(r.id)}return t},f=[],p=function(t,i){if(!f[t.id]){if(t instanceof e.Geometry.Primitives.Box)i.boxes.push(_(t));else if(t instanceof e.Geometry.Primitives.Sphere)i.spheres.push(v(t));else if(t instanceof e.Geometry.Primitives.Cylinder)i.cylinders.push(y(t));else if(t instanceof e.Geometry.Primitives.Torus)i.toruses.push(x(t));else if(t instanceof e.Geometry.Primitives.Ground)i.grounds.push(b(t));else if(t instanceof e.Geometry.Primitives.Plane)i.planes.push(T(t));else if(t instanceof e.Geometry.Primitives.TorusKnot)i.torusKnots.push(w(t));else{if(t instanceof e.Geometry.Primitives._Primitive)throw new Error("Unknow primitive type");i.vertexData.push(m(t))}f[t.id]=!0}},d=function(t){var i={};return i.id=t.id,e.Tags.HasTags(t)&&(i.tags=e.Tags.GetTags(t)),i},m=function(t){var i=d(t);return t.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(i.positions=t.getVerticesData(e.VertexBuffer.PositionKind)),t.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(i.normals=t.getVerticesData(e.VertexBuffer.NormalKind)),t.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(i.uvs=t.getVerticesData(e.VertexBuffer.UVKind)),t.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(i.uvs2=t.getVerticesData(e.VertexBuffer.UV2Kind)),t.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(i.colors=t.getVerticesData(e.VertexBuffer.ColorKind)),t.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(i.matricesIndices=t.getVerticesData(e.VertexBuffer.MatricesIndicesKind),i.matricesIndices._isExpanded=!0),t.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(i.matricesWeights=t.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),i.indices=t.getIndices(),i},g=function(e){var t=d(e);return t.canBeRegenerated=e.canBeRegenerated(),t},_=function(e){var t=g(e);return t.size=e.size,t},v=function(e){var t=g(e);return t.segments=e.segments,t.diameter=e.diameter,t},y=function(e){var t=g(e);return t.height=e.height,t.diameterTop=e.diameterTop,t.diameterBottom=e.diameterBottom,t.tessellation=e.tessellation,t},x=function(e){var t=g(e);return t.diameter=e.diameter,t.thickness=e.thickness,t.tessellation=e.tessellation,t},b=function(e){var t=g(e);return t.width=e.width,t.height=e.height,t.subdivisions=e.subdivisions,t},T=function(e){var t=g(e);return t.size=e.size,t},w=function(e){var t=g(e);return t.radius=e.radius,t.tube=e.tube,t.radialSegments=e.radialSegments,t.tubularSegments=e.tubularSegments,t.p=e.p,t.q=e.q,t},M=function(t,i){var r={};r.name=t.name,r.id=t.id,e.Tags.HasTags(t)&&(r.tags=e.Tags.GetTags(t)),r.position=t.position.asArray(),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.asArray():t.rotation&&(r.rotation=t.rotation.asArray()),r.scaling=t.scaling.asArray(),r.localMatrix=t.getPivotMatrix().asArray(),r.isEnabled=t.isEnabled(),r.isVisible=t.isVisible,r.infiniteDistance=t.infiniteDistance,r.pickable=t.isPickable,r.receiveShadows=t.receiveShadows,r.billboardMode=t.billboardMode,r.visibility=t.visibility,r.checkCollisions=t.checkCollisions,t.parent&&(r.parentId=t.parent.id);var o=t._geometry;if(o){var s=o.id;r.geometryId=s,t.getScene().getGeometryByID(s)||p(o,i.geometries),r.subMeshes=[];for(var a=0;a<t.subMeshes.length;a++){var h=t.subMeshes[a];r.subMeshes.push({materialIndex:h.materialIndex,verticesStart:h.verticesStart,verticesCount:h.verticesCount,indexStart:h.indexStart,indexCount:h.indexCount})}}if(t.material?r.materialId=t.material.id:t.material=null,t.skeleton&&(r.skeletonId=t.skeleton.id),t.getPhysicsImpostor()!==e.PhysicsEngine.NoImpostor)switch(r.physicsMass=t.getPhysicsMass(),r.physicsFriction=t.getPhysicsFriction(),r.physicsRestitution=t.getPhysicsRestitution(),t.getPhysicsImpostor()){case e.PhysicsEngine.BoxImpostor:r.physicsImpostor=1;break;case e.PhysicsEngine.SphereImpostor:r.physicsImpostor=2}return n(t,r),r.layerMask=t.layerMask,r},E=function(){function n(){}return n.Serialize=function(n){var r={};r.useDelayedTextureLoading=n.useDelayedTextureLoading,r.autoClear=n.autoClear,r.clearColor=n.clearColor.asArray(),r.ambientColor=n.ambientColor.asArray(),r.gravity=n.gravity.asArray(),n.fogMode&&0!==n.fogMode&&(r.fogMode=n.fogMode,r.fogColor=n.fogColor.asArray(),r.fogStart=n.fogStart,r.fogEnd=n.fogEnd,r.fogDensity=n.fogDensity),r.lights=[];for(var a=0;a<n.lights.length;a++){var d=n.lights[a];r.lights.push(t(d))}for(r.cameras=[],a=0;a<n.cameras.length;a++){var m=n.cameras[a];m instanceof e.FreeCamera&&r.cameras.push(i(m))}for(n.activeCamera&&(r.activeCameraID=n.activeCamera.id),r.materials=[],r.multiMaterials=[],a=0;a<n.materials.length;a++){var g=n.materials[a];g instanceof e.StandardMaterial?r.materials.push(s(g)):g instanceof e.MultiMaterial&&r.multiMaterials.push(o(g))}for(r.skeletons=[],a=0;a<n.skeletons.length;a++)r.skeletons.push(h(n.skeletons[a]));r.geometries={},r.geometries.boxes=[],r.geometries.spheres=[],r.geometries.cylinders=[],r.geometries.toruses=[],r.geometries.grounds=[],r.geometries.planes=[],r.geometries.torusKnots=[],r.geometries.vertexData=[],f=[];for(var _=n.getGeometries(),a=0;a<_.length;a++){var v=_[a];v.isReady()&&p(v,r.geometries)}for(r.meshes=[],a=0;a<n.meshes.length;a++){var y=n.meshes[a];if(y instanceof e.Mesh){var x=y;(x.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||x.delayLoadState===e.Engine.DELAYLOADSTATE_NONE)&&r.meshes.push(M(x,r))}}for(r.particleSystems=[],a=0;a<n.particleSystems.length;a++)r.particleSystems.push(c(n.particleSystems[a]));for(r.lensFlareSystems=[],a=0;a<n.lensFlareSystems.length;a++)r.lensFlareSystems.push(u(n.lensFlareSystems[a]));for(r.shadowGenerators=[],a=0;a<n.lights.length;a++)d=n.lights[a],d.getShadowGenerator()&&r.shadowGenerators.push(l(d));return r},n}();e.SceneSerializer=E}(i||(i={}));var i;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"ForceFullSceneLoadingForIncremental",{get:function(){return t._ForceFullSceneLoadingForIncremental},set:function(e){t._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),t._getPluginForFilename=function(e){for(var t=e.lastIndexOf("."),i=e.substring(t).toLowerCase(),n=0;n<this._registeredPlugins.length;n++){var r=this._registeredPlugins[n];if(-1!==r.extensions.indexOf(i))return r}return this._registeredPlugins[this._registeredPlugins.length-1]},t.RegisterPlugin=function(e){e.extensions=e.extensions.toLowerCase(),t._registeredPlugins.push(e)},t.ImportMesh=function(t,i,n,r,o,s,a){var h=this,c=function(){r.database=u;var c=h._getPluginForFilename(n),l=function(e){var s=[],h=[],u=[];return c.importMesh(t,r,e,i,s,h,u)?void(o&&(r.importedMeshesFiles.push(i+n),o(s,h,u))):void(a&&a(r))};return n.substr&&"data:"===n.substr(0,5)?void l(n.substr(5)):void e.Tools.LoadFile(i+n,function(e){l(e)},s,u)},u=new e.Database(i+n,c)},t.Load=function(t,i,n,r,o,s){var a,h=this._getPluginForFilename(i.name||i),c=function(i){var o=new e.Scene(n);return o.database=a,h.load(o,i,t)?void(r&&r(o)):void(s&&s(o))},u=function(){e.Tools.LoadFile(t+i,c,o,a)};return i.substr&&"data:"===i.substr(0,5)?void c(i.substr(5)):void(-1===t.indexOf("file:")?a=new e.Database(t+i,u):e.Tools.ReadFile(i,c,o))},t._ForceFullSceneLoadingForIncremental=!1,t._registeredPlugins=new Array,t}();e.SceneLoader=t}(i||(i={}));var i;!function(e){!function(){var t=function(t,i,n){var r=new e.CubeTexture(t+i.name,n);return r.name=i.name,r.hasAlpha=i.hasAlpha,r.level=i.level,r.coordinatesMode=i.coordinatesMode,r},i=function(i,n,r){if(!n.name&&!n.isRenderTarget)return null;if(n.isCube)return t(i,n,r);var o;if(n.mirrorPlane?(o=new e.MirrorTexture(n.name,n.renderTargetSize,r),o._waitingRenderList=n.renderList,o.mirrorPlane=e.Plane.FromArray(n.mirrorPlane)):n.isRenderTarget?(o=new e.RenderTargetTexture(n.name,n.renderTargetSize,r),o._waitingRenderList=n.renderList):o=new e.Texture(i+n.name,r),o.name=n.name,o.hasAlpha=n.hasAlpha,o.getAlphaFromRGB=n.getAlphaFromRGB,o.level=n.level,o.coordinatesIndex=n.coordinatesIndex,o.coordinatesMode=n.coordinatesMode,o.uOffset=n.uOffset,o.vOffset=n.vOffset,o.uScale=n.uScale,o.vScale=n.vScale,o.uAng=n.uAng,o.vAng=n.vAng,o.wAng=n.wAng,o.wrapU=n.wrapU,o.wrapV=n.wrapV,n.animations)for(var s=0;s<n.animations.length;s++){var a=n.animations[s];o.animations.push(u(a))}return o},n=function(t,i){for(var n=new e.Skeleton(t.name,t.id,i),r=0;r<t.bones.length;r++){var o=t.bones[r],s=null;o.parentBoneIndex>-1&&(s=n.bones[o.parentBoneIndex]);var a=new e.Bone(o.name,n,s,e.Matrix.FromArray(o.matrix));o.animation&&a.animations.push(u(o.animation))}return n},r=function(t,n,r){var o;return o=new e.StandardMaterial(t.name,n),o.ambientColor=e.Color3.FromArray(t.ambient),o.diffuseColor=e.Color3.FromArray(t.diffuse),o.specularColor=e.Color3.FromArray(t.specular),o.specularPower=t.specularPower,o.emissiveColor=e.Color3.FromArray(t.emissive),o.alpha=t.alpha,o.id=t.id,e.Tags.AddTagsTo(o,t.tags),o.backFaceCulling=t.backFaceCulling,o.wireframe=t.wireframe,t.diffuseTexture&&(o.diffuseTexture=i(r,t.diffuseTexture,n)),t.ambientTexture&&(o.ambientTexture=i(r,t.ambientTexture,n)),t.opacityTexture&&(o.opacityTexture=i(r,t.opacityTexture,n)),t.reflectionTexture&&(o.reflectionTexture=i(r,t.reflectionTexture,n)),t.emissiveTexture&&(o.emissiveTexture=i(r,t.emissiveTexture,n)),t.specularTexture&&(o.specularTexture=i(r,t.specularTexture,n)),t.bumpTexture&&(o.bumpTexture=i(r,t.bumpTexture,n)),o},o=function(e,t,i,n){for(var o=0;o<t.materials.length;o++){var s=t.materials[o];if(s.id===e)return r(s,i,n)}return null},s=function(t,i){var n=new e.MultiMaterial(t.name,i);n.id=t.id,e.Tags.AddTagsTo(n,t.tags);for(var r=0;r<t.materials.length;r++){var o=t.materials[r];n.subMaterials.push(o?i.getMaterialByID(o):null)}return n},a=function(t,i,n){var r=i.getLastEntryByID(t.emitterId),o=new e.LensFlareSystem("lensFlareSystem#"+t.emitterId,r,i);o.borderLimit=t.borderLimit;for(var s=0;s<t.flares.length;s++){var a=t.flares[s];new e.LensFlare(a.size,a.position,e.Color3.FromArray(a.color),n+a.textureName,o)}return o},h=function(t,i,n){var r=i.getLastMeshByID(t.emitterId),o=new e.ParticleSystem("particles#"+r.name,t.capacity,i);return t.textureName&&(o.particleTexture=new e.Texture(n+t.textureName,i),o.particleTexture.name=t.textureName),o.minAngularSpeed=t.minAngularSpeed,o.maxAngularSpeed=t.maxAngularSpeed,o.minSize=t.minSize,o.maxSize=t.maxSize,o.minLifeTime=t.minLifeTime,o.maxLifeTime=t.maxLifeTime,o.emitter=r,o.emitRate=t.emitRate,o.minEmitBox=e.Vector3.FromArray(t.minEmitBox),o.maxEmitBox=e.Vector3.FromArray(t.maxEmitBox),o.gravity=e.Vector3.FromArray(t.gravity),o.direction1=e.Vector3.FromArray(t.direction1),o.direction2=e.Vector3.FromArray(t.direction2),o.color1=e.Color4.FromArray(t.color1),o.color2=e.Color4.FromArray(t.color2),o.colorDead=e.Color4.FromArray(t.colorDead),o.updateSpeed=t.updateSpeed,o.targetStopDuration=t.targetStopFrame,o.textureMask=e.Color4.FromArray(t.textureMask),o.blendMode=t.blendMode,o.start(),o},c=function(t,i){for(var n=i.getLightByID(t.lightId),r=new e.ShadowGenerator(t.mapSize,n),o=0;o<t.renderList.length;o++){var s=i.getMeshByID(t.renderList[o]);r.getShadowMap().renderList.push(s)}return t.usePoissonSampling?r.usePoissonSampling=!0:r.useVarianceShadowMap=t.useVarianceShadowMap,r},u=function(t){for(var i=new e.Animation(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),n=t.dataType,r=[],o=0;o<t.keys.length;o++){var s,a=t.keys[o];switch(n){case e.Animation.ANIMATIONTYPE_FLOAT:s=a.values[0];break;case e.Animation.ANIMATIONTYPE_QUATERNION:s=e.Quaternion.FromArray(a.values);break;case e.Animation.ANIMATIONTYPE_MATRIX:s=e.Matrix.FromArray(a.values);break;case e.Animation.ANIMATIONTYPE_VECTOR3:default:s=e.Vector3.FromArray(a.values)}r.push({frame:a.frame,value:s})}return i.setKeys(r),i},l=function(t,i){var n;switch(t.type){case 0:n=new e.PointLight(t.name,e.Vector3.FromArray(t.position),i);break;case 1:n=new e.DirectionalLight(t.name,e.Vector3.FromArray(t.direction),i),n.position=e.Vector3.FromArray(t.position);break;case 2:n=new e.SpotLight(t.name,e.Vector3.FromArray(t.position),e.Vector3.FromArray(t.direction),t.angle,t.exponent,i);break;case 3:n=new e.HemisphericLight(t.name,e.Vector3.FromArray(t.direction),i),n.groundColor=e.Color3.FromArray(t.groundColor)}if(n.id=t.id,e.Tags.AddTagsTo(n,t.tags),void 0!==t.intensity&&(n.intensity=t.intensity),t.range&&(n.range=t.range),n.diffuse=e.Color3.FromArray(t.diffuse),n.specular=e.Color3.FromArray(t.specular),t.excludedMeshesIds&&(n._excludedMeshesIds=t.excludedMeshesIds),t.animations)for(var r=0;r<t.animations.length;r++){var o=t.animations[r];n.animations.push(u(o))}t.autoAnimate&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1)},f=function(t,i){var n=new e.FreeCamera(t.name,e.Vector3.FromArray(t.position),i);if(n.id=t.id,e.Tags.AddTagsTo(n,t.tags),t.parentId&&(n._waitingParentId=t.parentId),t.target?n.setTarget(e.Vector3.FromArray(t.target)):n.rotation=e.Vector3.FromArray(t.rotation),t.lockedTargetId&&(n._waitingLockedTargetId=t.lockedTargetId),n.fov=t.fov,n.minZ=t.minZ,n.maxZ=t.maxZ,n.speed=t.speed,n.inertia=t.inertia,n.checkCollisions=t.checkCollisions,n.applyGravity=t.applyGravity,t.ellipsoid&&(n.ellipsoid=e.Vector3.FromArray(t.ellipsoid)),t.animations)for(var r=0;r<t.animations.length;r++){var o=t.animations[r];n.animations.push(u(o))}return t.autoAnimate&&i.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1),n.layerMask=t.layerMask&&!isNaN(t.layerMask)?Math.abs(parseInt(t.layerMask)):4294967295,n},p=function(e,t){var i=e.id;return t.getGeometryByID(i)},d=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.Box(t.id,i,t.size,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},m=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.Sphere(t.id,i,t.segments,t.diameter,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},g=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.Cylinder(t.id,i,t.height,t.diameterTop,t.diameterBottom,t.tessellation,t.subdivisions,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},_=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.Torus(t.id,i,t.diameter,t.thickness,t.tessellation,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},v=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.Ground(t.id,i,t.width,t.height,t.subdivisions,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},y=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.Plane(t.id,i,t.size,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},x=function(t,i){if(p(t,i))return null;var n=new e.Geometry.Primitives.TorusKnot(t.id,i,t.radius,t.tube,t.radialSegments,t.tubularSegments,t.p,t.q,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),i.pushGeometry(n,!0),n},b=function(t,i,n){if(p(t,i))return null;var r=new e.Geometry(t.id,i);return e.Tags.AddTagsTo(r,t.tags),t.delayLoadingFile?(r.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,r.delayLoadingFile=n+t.delayLoadingFile,r._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),r._delayInfo=[],t.hasUVs&&r._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&r._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasColors&&r._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&r._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&r._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),r._delayLoadingFunction=M):M(t,r),i.pushGeometry(r,!0),r},T=function(t,i,n){var r=new e.Mesh(t.name,i);if(r.id=t.id,e.Tags.AddTagsTo(r,t.tags),r.position=e.Vector3.FromArray(t.position),t.rotationQuaternion?r.rotationQuaternion=e.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(r.rotation=e.Vector3.FromArray(t.rotation)),r.scaling=e.Vector3.FromArray(t.scaling),t.localMatrix?r.setPivotMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&r.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),r.setEnabled(t.isEnabled),r.isVisible=t.isVisible,r.infiniteDistance=t.infiniteDistance,r.showBoundingBox=t.showBoundingBox,r.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.pickable&&(r.isPickable=t.pickable),r.receiveShadows=t.receiveShadows,r.billboardMode=t.billboardMode,void 0!==t.visibility&&(r.visibility=t.visibility),r.checkCollisions=t.checkCollisions,r._shouldGenerateFlatShading=t.useFlatShading,t.parentId&&(r.parent=i.getLastEntryByID(t.parentId)),t.delayLoadingFile?(r.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,r.delayLoadingFile=n+t.delayLoadingFile,r._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),r._delayInfo=[],t.hasUVs&&r._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&r._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasColors&&r._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&r._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&r._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),r._delayLoadingFunction=E,e.SceneLoader.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):E(t,r),t.materialId?r.setMaterialByID(t.materialId):r.material=null,t.skeletonId>-1&&(r.skeleton=i.getLastSkeletonByID(t.skeletonId)),t.physicsImpostor&&(i.isPhysicsEnabled()||i.enablePhysics(),r.setPhysicsState({impostor:t.physicsImpostor,mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution})),t.animations)for(var o=0;o<t.animations.length;o++){var s=t.animations[o];
r.animations.push(u(s))}if(t.autoAnimate&&i.beginAnimation(r,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1),r.layerMask=t.layerMask&&!isNaN(t.layerMask)?Math.abs(parseInt(t.layerMask)):4294967295,t.instances)for(var a=0;a<t.instances.length;a++){var h=t.instances[a],c=r.createInstance(h.name);if(e.Tags.AddTagsTo(c,h.tags),c.position=e.Vector3.FromArray(h.position),h.rotationQuaternion?c.rotationQuaternion=e.Quaternion.FromArray(h.rotationQuaternion):h.rotation&&(c.rotation=e.Vector3.FromArray(h.rotation)),c.scaling=e.Vector3.FromArray(h.scaling),c.checkCollisions=r.checkCollisions,t.animations)for(o=0;o<t.animations.length;o++)s=t.animations[o],c.animations.push(u(s))}return r},w=function(e,t,i){t=t instanceof Array?t:[t];for(var n in t)if(e.name===t[n])return i.push(e.id),!0;return e.parentId&&-1!==i.indexOf(e.parentId)?(i.push(e.id),!0):!1},M=function(t,i){var n=new e.VertexData,r=t.positions;r&&n.set(r,e.VertexBuffer.PositionKind);var o=t.normals;o&&n.set(o,e.VertexBuffer.NormalKind);var s=t.uvs;s&&n.set(s,e.VertexBuffer.UVKind);var a=t.uv2s;a&&n.set(a,e.VertexBuffer.UV2Kind);var h=t.colors;h&&n.set(h,e.VertexBuffer.ColorKind);var c=t.matricesIndices;c&&n.set(c,e.VertexBuffer.MatricesIndicesKind);var u=t.matricesWeights;u&&n.set(u,e.VertexBuffer.MatricesWeightsKind);var l=t.indices;l&&(n.indices=l),i.setAllVerticesData(n,t.updatable)},E=function(t,i){var n=i.getScene(),r=t.geometryId;if(r){var o=n.getGeometryByID(r);o&&o.applyToMesh(i)}else if(t.positions&&t.normals&&t.indices){if(i.setVerticesData(e.VertexBuffer.PositionKind,t.positions,!1),i.setVerticesData(e.VertexBuffer.NormalKind,t.normals,!1),t.uvs&&i.setVerticesData(e.VertexBuffer.UVKind,t.uvs,!1),t.uvs2&&i.setVerticesData(e.VertexBuffer.UV2Kind,t.uvs2,!1),t.colors&&i.setVerticesData(e.VertexBuffer.ColorKind,t.colors,!1),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,t.matricesIndices,!1);else{for(var s=[],a=0;a<t.matricesIndices.length;a++){var h=t.matricesIndices[a];s.push(255&h),s.push((65280&h)>>8),s.push((16711680&h)>>16),s.push(h>>24)}i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,s,!1)}t.matricesWeights&&i.setVerticesData(e.VertexBuffer.MatricesWeightsKind,t.matricesWeights,!1),i.setIndices(t.indices)}if(t.subMeshes){i.subMeshes=[];for(var c=0;c<t.subMeshes.length;c++){var u=t.subMeshes[c];new e.SubMesh(u.materialIndex,u.verticesStart,u.verticesCount,u.indexStart,u.indexCount,i)}}i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),delete i._shouldGenerateFlatShading),i.computeWorldMatrix(!0),n._selectionOctree&&n._selectionOctree.addMesh(i)};e.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(e,t,i,r,a,c,u){for(var l=JSON.parse(i),f=[],p=[],d=[],m=0;m<l.meshes.length;m++){var g=l.meshes[m];if(!e||w(g,e,d)){if(e instanceof Array&&delete e[e.indexOf(g.name)],g.materialId){var _=-1!==p.indexOf(g.materialId);if(!_)for(var v=0;v<l.multiMaterials.length;v++){var y=l.multiMaterials[v];if(y.id==g.materialId){for(var x=0;x<y.materials.length;x++){var b=y.materials[x];p.push(b),o(b,l,t,r)}p.push(y.id),s(y,t),_=!0;break}}_||(p.push(g.materialId),o(g.materialId,l,t,r))}if(g.skeletonId>-1&&t.skeletons){var M=f.indexOf(g.skeletonId)>-1;if(!M)for(var E=0;E<l.skeletons.length;E++){var A=l.skeletons[E];A.id===g.skeletonId&&(u.push(n(A,t)),f.push(A.id))}}var P=T(g,t,r);a.push(P)}}if(l.particleSystems)for(m=0;m<l.particleSystems.length;m++){var S=l.particleSystems[m];-1!==d.indexOf(S.emitterId)&&c.push(h(S,t,r))}return!0},load:function(t,i,o){var u=JSON.parse(i);t.useDelayedTextureLoading=u.useDelayedTextureLoading&&!e.SceneLoader.ForceFullSceneLoadingForIncremental,t.autoClear=u.autoClear,t.clearColor=e.Color3.FromArray(u.clearColor),t.ambientColor=e.Color3.FromArray(u.ambientColor),t.gravity=e.Vector3.FromArray(u.gravity),u.fogMode&&0!==u.fogMode&&(t.fogMode=u.fogMode,t.fogColor=e.Color3.FromArray(u.fogColor),t.fogStart=u.fogStart,t.fogEnd=u.fogEnd,t.fogDensity=u.fogDensity);for(var p=0;p<u.lights.length;p++){var w=u.lights[p];l(w,t)}for(p=0;p<u.cameras.length;p++){var M=u.cameras[p];f(M,t)}if(u.activeCameraID&&t.setActiveCameraByID(u.activeCameraID),u.materials)for(p=0;p<u.materials.length;p++){var E=u.materials[p];r(E,t,o)}if(u.multiMaterials)for(p=0;p<u.multiMaterials.length;p++){var A=u.multiMaterials[p];s(A,t)}if(u.skeletons)for(p=0;p<u.skeletons.length;p++){var P=u.skeletons[p];n(P,t)}var S=u.geometries;if(S){var C=S.boxes;if(C)for(p=0;p<C.length;p++){var D=C[p];d(D,t)}var I=S.spheres;if(I)for(p=0;p<I.length;p++){var R=I[p];m(R,t)}var L=S.cylinders;if(L)for(p=0;p<L.length;p++){var O=L[p];g(O,t)}var V=S.toruses;if(V)for(p=0;p<V.length;p++){var B=V[p];_(B,t)}var F=S.grounds;if(F)for(p=0;p<F.length;p++){var k=F[p];v(k,t)}var N=S.planes;if(N)for(p=0;p<N.length;p++){var z=N[p];y(z,t)}var U=S.torusKnots;if(U)for(p=0;p<U.length;p++){var W=U[p];x(W,t)}var G=S.vertexData;if(G)for(p=0;p<G.length;p++){var j=G[p];b(j,t,o)}}for(p=0;p<u.meshes.length;p++){var H=u.meshes[p];T(H,t,o)}for(p=0;p<t.cameras.length;p++){var X=t.cameras[p];if(X._waitingParentId&&(X.parent=t.getLastEntryByID(X._waitingParentId),delete X._waitingParentId),X instanceof e.FreeCamera){var Y=X;Y._waitingLockedTargetId&&(Y.lockedTarget=t.getLastEntryByID(Y._waitingLockedTargetId),delete Y._waitingLockedTargetId)}}if(u.particleSystems)for(p=0;p<u.particleSystems.length;p++){var q=u.particleSystems[p];h(q,t,o)}if(u.lensFlareSystems)for(p=0;p<u.lensFlareSystems.length;p++){var K=u.lensFlareSystems[p];a(K,t,o)}if(u.shadowGenerators)for(p=0;p<u.shadowGenerators.length;p++){var Z=u.shadowGenerators[p];c(Z,t)}return!0}})}(e.Internals||(e.Internals={})),e.Internals}(i||(i={}));var i;!function(e){var t=0,i=function(){function t(e,t,i){this.pos=e,this.normal=t,this.uv=i}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(i,n){return new t(e.Vector3.Lerp(this.pos,i.pos,n),e.Vector3.Lerp(this.normal,i.normal,n),e.Vector2.Lerp(this.uv,i.uv,n))},t}(),n=function(){function t(e,t){this.normal=e,this.w=t}return t.FromPoints=function(i,n,r){var o=r.subtract(i),s=n.subtract(i);if(0===o.lengthSquared()||0===s.lengthSquared())return null;var a=e.Vector3.Normalize(e.Vector3.Cross(o,s));return new t(a,e.Vector3.Dot(a,i))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},t.prototype.splitPolygon=function(i,n,o,s,a){for(var h=0,c=1,u=2,l=3,f=0,p=[],d=0;d<i.vertices.length;d++){var m=e.Vector3.Dot(this.normal,i.vertices[d].pos)-this.w,g=m<-t.EPSILON?u:m>t.EPSILON?c:h;f|=g,p.push(g)}switch(f){case h:(e.Vector3.Dot(this.normal,i.plane.normal)>0?n:o).push(i);break;case c:s.push(i);break;case u:a.push(i);break;case l:var _=[],v=[];for(d=0;d<i.vertices.length;d++){var y=(d+1)%i.vertices.length,x=p[d],b=p[y],T=i.vertices[d],w=i.vertices[y];if(x!=u&&_.push(T),x!=c&&v.push(x!=u?T.clone():T),(x|b)==l){m=(this.w-e.Vector3.Dot(this.normal,T.pos))/e.Vector3.Dot(this.normal,w.pos.subtract(T.pos));var M=T.interpolate(w,m);_.push(M),v.push(M.clone())}}if(_.length>=3){var E=new r(_,i.shared);E.plane&&s.push(E)}v.length>=3&&(E=new r(v,i.shared),E.plane&&a.push(E))}},t.EPSILON=1e-5,t}(),r=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=n.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){var t=this.vertices.map(function(e){return e.clone()});return new e(t,this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),o=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=[],i=[],n=0;n<e.length;n++)this.plane.splitPolygon(e[n],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var i=[],n=[],r=0;r<t.length;r++)this.plane.splitPolygon(t[r],this.polygons,this.polygons,i,n);i.length&&(this.front||(this.front=new e),this.front.build(i)),n.length&&(this.back||(this.back=new e),this.back.build(n))}},e}(),s=function(){function n(){this.polygons=new Array}return n.FromMesh=function(o){var s,a,h,c,u,l,f=[];if(!(o instanceof e.Mesh))throw"BABYLON.CSG:Wrong Mesh type,must be BABYLON.Mesh";o.computeWorldMatrix(!0);for(var p=o.getWorldMatrix(),d=o.position.clone(),m=o.rotation.clone(),g=o.scaling.clone(),_=o.getIndices(),v=o.getVerticesData(e.VertexBuffer.PositionKind),y=o.getVerticesData(e.VertexBuffer.NormalKind),x=o.getVerticesData(e.VertexBuffer.UVKind),b=o.subMeshes,T=0,w=b.length;w>T;T++)for(var M=b[T].indexStart,E=b[T].indexCount+b[T].indexStart;E>M;M+=3){l=[];for(var A=0;3>A;A++)a=new e.Vector3(y[3*_[M+A]],y[3*_[M+A]+1],y[3*_[M+A]+2]),h=new e.Vector2(x[2*_[M+A]],x[2*_[M+A]+1]),c=new e.Vector3(v[3*_[M+A]],v[3*_[M+A]+1],v[3*_[M+A]+2]),e.Vector3.TransformCoordinatesToRef(c,p,c),e.Vector3.TransformNormalToRef(a,p,a),s=new i(c,a,h),l.push(s);u=new r(l,{subMeshId:T,meshId:t,materialIndex:b[T].materialIndex}),u.plane&&f.push(u)}var P=n.FromPolygons(f);return P.matrix=p,P.position=d,P.rotation=m,P.scaling=g,t++,P},n.FromPolygons=function(t){var i=new e.CSG;return i.polygons=t,i},n.prototype.clone=function(){var t=new e.CSG;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},n.prototype.toPolygons=function(){return this.polygons},n.prototype.union=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.unionInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this.polygons=t.allPolygons()},n.prototype.subtract=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.subtractInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},n.prototype.intersect=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.intersectInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},n.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},n.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},n.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this},n.prototype.buildMeshGeometry=function(t,i,n){var r=this.matrix.clone();r.invert();var o,s,a,h=new e.Mesh(t,i),c=[],u=[],l=[],f=[],p=e.Vector3.Zero(),d=e.Vector3.Zero(),m=e.Vector2.Zero(),g=this.polygons,_=[0,0,0],v={},y=0,x={};n&&g.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var b=0,T=g.length;T>b;b++){o=g[b],x[o.shared.meshId]||(x[o.shared.meshId]={}),x[o.shared.meshId][o.shared.subMeshId]||(x[o.shared.meshId][o.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:o.shared.materialIndex}),a=x[o.shared.meshId][o.shared.subMeshId];for(var w=2,M=o.vertices.length;M>w;w++){_[0]=0,_[1]=w-1,_[2]=w;for(var E=0;3>E;E++)p.copyFrom(o.vertices[_[E]].pos),d.copyFrom(o.vertices[_[E]].normal),m.copyFrom(o.vertices[_[E]].uv),e.Vector3.TransformCoordinatesToRef(p,r,p),e.Vector3.TransformNormalToRef(d,r,d),s=v[p.x+","+p.y+","+p.z],("undefined"==typeof s||l[3*s]!==d.x||l[3*s+1]!==d.y||l[3*s+2]!==d.z||f[2*s]!==m.x||f[2*s+1]!==m.y)&&(c.push(p.x,p.y,p.z),f.push(m.x,m.y),l.push(d.x,d.y,d.z),s=v[p.x+","+p.y+","+p.z]=c.length/3-1),u.push(s),a.indexStart=Math.min(y,a.indexStart),a.indexEnd=Math.max(y,a.indexEnd),y++}}if(h.setVerticesData(e.VertexBuffer.PositionKind,c),h.setVerticesData(e.VertexBuffer.NormalKind,l),h.setVerticesData(e.VertexBuffer.UVKind,f),h.setIndices(u),n){var A,P=0;h.subMeshes.length=0;for(var S in x){A=-1;for(var C in x[S])a=x[S][C],e.SubMesh.CreateFromIndices(a.materialIndex+P,a.indexStart,a.indexEnd-a.indexStart+1,h),A=Math.max(a.materialIndex,A);P+=++A}}return h},n.prototype.toMesh=function(e,t,i,n){var r=this.buildMeshGeometry(e,i,n);return r.material=t,r.position.copyFrom(this.position),r.rotation.copyFrom(this.rotation),r.scaling.copyFrom(this.scaling),r.computeWorldMatrix(!0),r},n}();e.CSG=s}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o){var s=this;t.call(this,i,"oculusDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.PostProcessScaleFactor,n,e.Texture.BILINEAR_SAMPLINGMODE,null,null),this._isRightEye=r,this._distortionFactors=o.DistortionK,this._postProcessScaleFactor=o.PostProcessScaleFactor,this._lensCenterOffset=o.LensCenterOffset,this.onSizeChanged=function(){s.aspectRatio=.5*s.width/s.height,s._scaleIn=new e.Vector2(2,2/s.aspectRatio),s._scaleFactor=new e.Vector2(.5*(1/s._postProcessScaleFactor),.5*(1/s._postProcessScaleFactor)*s.aspectRatio),s._lensCenter=new e.Vector2(s._isRightEye?.5-.5*s._lensCenterOffset:.5+.5*s._lensCenterOffset,.5)},this.onApply=function(e){e.setFloat2("LensCenter",s._lensCenter.x,s._lensCenter.y),e.setFloat2("Scale",s._scaleFactor.x,s._scaleFactor.y),e.setFloat2("ScaleIn",s._scaleIn.x,s._scaleIn.y),e.setFloat4("HmdWarpParam",s._distortionFactors[0],s._distortionFactors[1],s._distortionFactors[2],s._distortionFactors[3])}}return n(i,t),i}(e.PostProcess);e.OculusDistortionCorrectionPostProcess=t}(i||(i={}));var i;!function(e){!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(e.JoystickAxis||(e.JoystickAxis={}));var t=(e.JoystickAxis,function(){function t(i){var n=this;this._leftJoystick=i?!0:!1,this._joystickIndex=t._globalJoystickIndex,t._globalJoystickIndex++,this._axisTargetedByLeftAndRight=0,this._axisTargetedByUpAndDown=1,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new e.VirtualJoystick.Collection,this.deltaPosition=e.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._rotationSpeed=25,this._inverseRotationSpeed=1/(this._rotationSpeed/1e3),this._rotateOnAxisRelativeToMesh=!1,t.vjCanvas||(window.addEventListener("resize",function(){t.vjCanvasWidth=window.innerWidth,t.vjCanvasHeight=window.innerHeight,t.vjCanvas.width=t.vjCanvasWidth,t.vjCanvas.height=t.vjCanvasHeight,t.halfWidth=t.vjCanvasWidth/2,t.halfHeight=t.vjCanvasHeight/2},!1),t.vjCanvas=document.createElement("canvas"),t.vjCanvasWidth=window.innerWidth,t.vjCanvasHeight=window.innerHeight,t.vjCanvas.width=window.innerWidth,t.vjCanvas.height=window.innerHeight,t.vjCanvas.style.width="100%",t.vjCanvas.style.height="100%",t.vjCanvas.style.position="absolute",t.vjCanvas.style.backgroundColor="transparent",t.vjCanvas.style.top="0px",t.vjCanvas.style.left="0px",t.vjCanvas.style.zIndex="5",t.vjCanvas.style.msTouchAction="none",t.vjCanvasContext=t.vjCanvas.getContext("2d"),t.vjCanvasContext.strokeStyle="#ffffff",t.vjCanvasContext.lineWidth=2,document.body.appendChild(t.vjCanvas)),t.halfWidth=t.vjCanvas.width/2,t.halfHeight=t.vjCanvas.height/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new e.Vector2(0,0),this._joystickPointerStartPos=new e.Vector2(0,0),this._deltaJoystickVector=new e.Vector2(0,0),t.vjCanvas.addEventListener("pointerdown",function(e){n._onPointerDown(e)},!1),t.vjCanvas.addEventListener("pointermove",function(e){n._onPointerMove(e)},!1),t.vjCanvas.addEventListener("pointerup",function(e){n._onPointerUp(e)},!1),t.vjCanvas.addEventListener("pointerout",function(e){n._onPointerUp(e)},!1),t.vjCanvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return t.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},t.prototype._onPointerDown=function(e){var i;e.preventDefault(),i=this._leftJoystick===!0?e.clientX<t.halfWidth:e.clientX>t.halfWidth,i&&this._joystickPointerID<0?(this._joystickPointerID=e.pointerId,this._joystickPointerStartPos.x=e.clientX,this._joystickPointerStartPos.y=e.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(e.pointerId.toString(),e)):t._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(e.pointerId.toString(),e))},t.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var t=this.reverseLeftRight?-1:1,i=t*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case 0:this.deltaPosition.x=Math.min(1,Math.max(-1,i));break;case 1:this.deltaPosition.y=Math.min(1,Math.max(-1,i));break;case 2:this.deltaPosition.z=Math.min(1,Math.max(-1,i))}var n=this.reverseUpDown?1:-1,r=n*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case 0:this.deltaPosition.x=Math.min(1,Math.max(-1,r));break;case 1:this.deltaPosition.y=Math.min(1,Math.max(-1,r));break;case 2:this.deltaPosition.z=Math.min(1,Math.max(-1,r))}}else this._touches.item(e.pointerId.toString())&&(this._touches.item(e.pointerId.toString()).x=e.clientX,this._touches.item(e.pointerId.toString()).y=e.clientY)},t.prototype._onPointerUp=function(e){this._clearCanvas(),this._joystickPointerID==e.pointerId&&(this._joystickPointerID=-1,this.pressed=!1),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(e.pointerId.toString())},t.prototype.setJoystickColor=function(e){this._joystickColor=e},t.prototype.setActionOnTouch=function(e){this._action=e},t.prototype.setAxisForLeftRight=function(e){switch(e){case 0:case 1:case 2:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=0}},t.prototype.setAxisForUpDown=function(e){switch(e){case 0:case 1:case 2:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=1}},t.prototype._clearCanvas=function(){this._leftJoystick?t.vjCanvasContext.clearRect(0,0,t.vjCanvasWidth/2,t.vjCanvasHeight):t.vjCanvasContext.clearRect(t.vjCanvasWidth/2,0,t.vjCanvasWidth,t.vjCanvasHeight)},t.prototype._drawVirtualJoystick=function(){var e=this;this.pressed&&(this._clearCanvas(),this._touches.forEach(function(i){i.pointerId===e._joystickPointerID?(t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle=e._joystickColor,t.vjCanvasContext.lineWidth=6,t.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,40,0,2*Math.PI,!0),t.vjCanvasContext.stroke(),t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle=e._joystickColor,t.vjCanvasContext.lineWidth=2,t.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,60,0,2*Math.PI,!0),t.vjCanvasContext.stroke(),t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle=e._joystickColor,t.vjCanvasContext.arc(e._joystickPointerPos.x,e._joystickPointerPos.y,40,0,2*Math.PI,!0),t.vjCanvasContext.stroke()):(t.vjCanvasContext.beginPath(),t.vjCanvasContext.fillStyle="white",t.vjCanvasContext.beginPath(),t.vjCanvasContext.strokeStyle="red",t.vjCanvasContext.lineWidth=6,t.vjCanvasContext.arc(i.x,i.y,40,0,2*Math.PI,!0),t.vjCanvasContext.stroke())})),requestAnimationFrame(function(){e._drawVirtualJoystick()})},t.prototype.releaseCanvas=function(){t.vjCanvas&&(document.body.removeChild(t.vjCanvas),t.vjCanvas=null)},t._globalJoystickIndex=0,t}());e.VirtualJoystick=t}(i||(i={}));var i;!function(e){!function(e){var t=function(){function e(){this._count=0,this._collection=new Array}return e.prototype.Count=function(){return this._count},e.prototype.add=function(e,t){return void 0!=this._collection[e]?void 0:(this._collection[e]=t,++this._count)},e.prototype.remove=function(e){return void 0==this._collection[e]?void 0:(delete this._collection[e],--this._count)},e.prototype.item=function(e){return this._collection[e]},e.prototype.forEach=function(e){var t;for(t in this._collection)this._collection.hasOwnProperty(t)&&e(this._collection[t])},e}();e.Collection=t}(e.VirtualJoystick||(e.VirtualJoystick={})),e.VirtualJoystick}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t={HResolution:1280,VResolution:800,HScreenSize:.149759993,VScreenSize:.0935999975,VScreenCenter:.0467999987,EyeToScreenDistance:.0410000011,LensSeparationDistance:.063500002,InterpupillaryDistance:.064000003,DistortionK:[1,.219999999,.239999995,0],ChromaAbCorrection:[.995999992,-.00400000019,1.01400006,0],PostProcessScaleFactor:1.714605507808412,LensCenterOffset:.151976421},i=function(i){function r(n,r,o,s){i.call(this,n,r,o),this._workMatrix=new e.Matrix,this._actualUp=new e.Vector3(0,0,0),this._aspectRatioAspectRatio=t.HResolution/(2*t.VResolution),this._aspectRatioFov=2*Math.atan(t.PostProcessScaleFactor*t.VScreenSize/(2*t.EyeToScreenDistance));var a=t.HScreenSize/4-t.LensSeparationDistance/2,h=4*a/t.HScreenSize;this._hMatrix=e.Matrix.Translation(s?h:-h,0,0),this.viewport=new e.Viewport(s?0:.5,0,.5,1),this._preViewMatrix=e.Matrix.Translation(s?.5*t.InterpupillaryDistance:-.5*t.InterpupillaryDistance,0,0),new e.OculusDistortionCorrectionPostProcess("Oculus Distortion",this,!s,t)}return n(r,i),r.prototype.getProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._aspectRatioFov,this._aspectRatioAspectRatio,this.minZ,this.maxZ,this._workMatrix),this._workMatrix.multiplyToRef(this._hMatrix,this._projectionMatrix),this._projectionMatrix},r.prototype._getViewMatrix=function(){return e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),e.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._actualUp),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._actualUp,this._workMatrix),this._workMatrix.multiplyToRef(this._preViewMatrix,this._viewMatrix),this._viewMatrix},r}(e.FreeCamera),r=function(e){function t(t,n,r){e.call(this,t,n,r),this._leftCamera=new i(t+"_left",n.clone(),r,!0),this._rightCamera=new i(t+"_right",n.clone(),r,!1),this.subCameras.push(this._leftCamera),this.subCameras.push(this._rightCamera),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return n(t,e),t.prototype._update=function(){this._leftCamera.position.copyFrom(this.position),this._rightCamera.position.copyFrom(this.position),this._updateCamera(this._leftCamera),this._updateCamera(this._rightCamera),e.prototype._update.call(this)},t.prototype._updateCamera=function(e){e.minZ=this.minZ,e.maxZ=this.maxZ,e.rotation.x=this.rotation.x,e.rotation.y=this.rotation.y,e.rotation.z=this.rotation.z},t.prototype._onOrientationEvent=function(e){var t=e.alpha/180*Math.PI,i=e.beta/180*Math.PI,n=e.gamma/180*Math.PI;return this._offsetOrientation?(this.rotation.y+=t-this._offsetOrientation.yaw,this.rotation.x+=i-this._offsetOrientation.pitch,this.rotation.z+=this._offsetOrientation.roll-n,this._offsetOrientation.yaw=t,this._offsetOrientation.pitch=i,void(this._offsetOrientation.roll=n)):void(this._offsetOrientation={yaw:t,pitch:i,roll:n})},t.prototype.attachControl=function(t,i){e.prototype.attachControl.call(this,t,i),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype.detachControl=function(t){e.prototype.detachControl.call(this,t),window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},t}(e.FreeCamera);e.OculusCamera=r}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r){t.call(this,i,n,r),this._leftjoystick=new e.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(2),this._leftjoystick.setAxisForLeftRight(0),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new e.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(0),this._rightjoystick.setAxisForLeftRight(1),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")}return n(i,t),i.prototype._checkInputs=function(){var t=e.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),i=e.Vector3.TransformCoordinates(this._leftjoystick.deltaPosition,t);this.cameraDirection=this.cameraDirection.add(i),this.cameraRotation=this.cameraRotation.add(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))},i.prototype.dispose=function(){this._leftjoystick.releaseCanvas()},i}(e.FreeCamera);e.VirtualJoysticksCamera=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r,o){t.call(this,i,n),this._textures=new Array,this._floats=new Array,this._floatsArrays={},this._colors3=new Array,this._colors4=new Array,this._vectors2=new Array,this._vectors3=new Array,this._matrices=new Array,this._cachedWorldViewMatrix=new e.Matrix,this._shaderPath=r,o.needAlphaBlending=o.needAlphaBlending||!1,o.needAlphaTesting=o.needAlphaTesting||!1,o.attributes=o.attributes||["position","normal","uv"],o.uniforms=o.uniforms||["worldViewProjection"],o.samplers=o.samplers||[],this._options=o}return n(i,t),i.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},i.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},i.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},i.prototype.isReady=function(){var e=this.getScene().getEngine();return this._effect=e.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,"",null,this.onCompiled,this.onError),this._effect.isReady()?!0:!1},i.prototype.bind=function(e){-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(this.getScene().getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(this.getScene().getTransformMatrix()));for(var t in this._textures)this._effect.setTexture(t,this._textures[t]);for(t in this._floats)this._effect.setFloat(t,this._floats[t]);for(t in this._floatsArrays)this._effect.setArray(t,this._floatsArrays[t]);for(t in this._colors3)this._effect.setColor3(t,this._colors3[t]);for(t in this._colors4){var i=this._colors4[t];this._effect.setFloat4(t,i.r,i.g,i.b,i.a)}for(t in this._vectors2)this._effect.setVector2(t,this._vectors2[t]);for(t in this._vectors3)this._effect.setVector3(t,this._vectors3[t]);for(t in this._matrices)this._effect.setMatrix(t,this._matrices[t])},i.prototype.dispose=function(e){for(var i in this._textures)this._textures[i].dispose();this._textures=[],t.prototype.dispose.call(this,e)},i}(e.Material);e.ShaderMaterial=t}(i||(i={}));var i;!function(e){var t=function(){function t(){}return t.prototype.set=function(t,i){switch(i){case e.VertexBuffer.PositionKind:this.positions=t;break;case e.VertexBuffer.NormalKind:this.normals=t;break;case e.VertexBuffer.UVKind:this.uvs=t;break;case e.VertexBuffer.UV2Kind:this.uv2s=t;break;case e.VertexBuffer.ColorKind:this.colors=t;break;case e.VertexBuffer.MatricesIndicesKind:this.matricesIndices=t;break;case e.VertexBuffer.MatricesWeightsKind:this.matricesWeights=t}},t.prototype.applyToMesh=function(e,t){this._applyTo(e,t)},t.prototype.applyToGeometry=function(e,t){this._applyTo(e,t)},t.prototype.updateMesh=function(e){this._update(e)},t.prototype.updateGeometry=function(e){this._update(e)},t.prototype._applyTo=function(t,i){this.positions&&t.setVerticesData(e.VertexBuffer.PositionKind,this.positions,i),this.normals&&t.setVerticesData(e.VertexBuffer.NormalKind,this.normals,i),this.uvs&&t.setVerticesData(e.VertexBuffer.UVKind,this.uvs,i),this.uv2s&&t.setVerticesData(e.VertexBuffer.UV2Kind,this.uv2s,i),this.colors&&t.setVerticesData(e.VertexBuffer.ColorKind,this.colors,i),this.matricesIndices&&t.setVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&t.setVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i),this.indices&&t.setIndices(this.indices)},t.prototype._update=function(t,i,n){this.positions&&t.updateVerticesData(e.VertexBuffer.PositionKind,this.positions,i,n),this.normals&&t.updateVerticesData(e.VertexBuffer.NormalKind,this.normals,i,n),this.uvs&&t.updateVerticesData(e.VertexBuffer.UVKind,this.uvs,i,n),this.uv2s&&t.updateVerticesData(e.VertexBuffer.UV2Kind,this.uv2s,i,n),this.colors&&t.updateVerticesData(e.VertexBuffer.ColorKind,this.colors,i,n),this.matricesIndices&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,n),this.matricesWeights&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,n),this.indices&&t.setIndices(this.indices)
},t.prototype.transform=function(t){var i=e.Vector3.Zero();if(this.positions)for(var n=e.Vector3.Zero(),r=0;r<this.positions.length;r+=3)e.Vector3.FromArrayToRef(this.positions,r,n),e.Vector3.TransformCoordinatesToRef(n,t,i),this.positions[r]=i.x,this.positions[r+1]=i.y,this.positions[r+2]=i.z;if(this.normals){var o=e.Vector3.Zero();for(r=0;r<this.normals.length;r+=3)e.Vector3.FromArrayToRef(this.normals,r,o),e.Vector3.TransformNormalToRef(o,t,i),this.normals[r]=i.x,this.normals[r+1]=i.y,this.normals[r+2]=i.z}},t.prototype.merge=function(e){if(e.indices){this.indices||(this.indices=[]);for(var t=this.positions?this.positions.length/3:0,i=0;i<e.indices.length;i++)this.indices.push(e.indices[i]+t)}if(e.positions)for(this.positions||(this.positions=[]),i=0;i<e.positions.length;i++)this.positions.push(e.positions[i]);if(e.normals)for(this.normals||(this.normals=[]),i=0;i<e.normals.length;i++)this.normals.push(e.normals[i]);if(e.uvs)for(this.uvs||(this.uvs=[]),i=0;i<e.uvs.length;i++)this.uvs.push(e.uvs[i]);if(e.uv2s)for(this.uv2s||(this.uv2s=[]),i=0;i<e.uv2s.length;i++)this.uv2s.push(e.uv2s[i]);if(e.matricesIndices)for(this.matricesIndices||(this.matricesIndices=[]),i=0;i<e.matricesIndices.length;i++)this.matricesIndices.push(e.matricesIndices[i]);if(e.matricesWeights)for(this.matricesWeights||(this.matricesWeights=[]),i=0;i<e.matricesWeights.length;i++)this.matricesWeights.push(e.matricesWeights[i]);if(e.colors)for(this.colors||(this.colors=[]),i=0;i<e.colors.length;i++)this.colors.push(e.colors[i])},t.ExtractFromMesh=function(e){return t._ExtractFrom(e)},t.ExtractFromGeometry=function(e){return t._ExtractFrom(e)},t._ExtractFrom=function(t){var i=new e.VertexData;return t.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(i.positions=t.getVerticesData(e.VertexBuffer.PositionKind)),t.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(i.normals=t.getVerticesData(e.VertexBuffer.NormalKind)),t.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(i.uvs=t.getVerticesData(e.VertexBuffer.UVKind)),t.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(i.uv2s=t.getVerticesData(e.VertexBuffer.UV2Kind)),t.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(i.colors=t.getVerticesData(e.VertexBuffer.ColorKind)),t.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(i.matricesIndices=t.getVerticesData(e.VertexBuffer.MatricesIndicesKind)),t.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(i.matricesWeights=t.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),i.indices=t.getIndices(),i},t.CreateBox=function(t){var i=[new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],n=[],r=[],o=[],s=[];t=t||1;for(var a=0;a<i.length;a++){var h=i[a],c=new e.Vector3(h.y,h.z,h.x),u=e.Vector3.Cross(h,c),l=r.length/3;n.push(l),n.push(l+1),n.push(l+2),n.push(l),n.push(l+2),n.push(l+3);var f=h.subtract(c).subtract(u).scale(t/2);r.push(f.x,f.y,f.z),o.push(h.x,h.y,h.z),s.push(1,1),f=h.subtract(c).add(u).scale(t/2),r.push(f.x,f.y,f.z),o.push(h.x,h.y,h.z),s.push(0,1),f=h.add(c).add(u).scale(t/2),r.push(f.x,f.y,f.z),o.push(h.x,h.y,h.z),s.push(0,0),f=h.add(c).subtract(u).scale(t/2),r.push(f.x,f.y,f.z),o.push(h.x,h.y,h.z),s.push(1,0)}var p=new e.VertexData;return p.indices=n,p.positions=r,p.normals=o,p.uvs=s,p},t.CreateSphere=function(t,i){t=t||32,i=i||1;for(var n=i/2,r=2+t,o=2*r,s=[],a=[],h=[],c=[],u=0;r>=u;u++){for(var l=u/r,f=l*Math.PI,p=0;o>=p;p++){var d=p/o,m=d*Math.PI*2,g=e.Matrix.RotationZ(-f),_=e.Matrix.RotationY(m),v=e.Vector3.TransformCoordinates(e.Vector3.Up(),g),y=e.Vector3.TransformCoordinates(v,_),x=y.scale(n),b=e.Vector3.Normalize(x);a.push(x.x,x.y,x.z),h.push(b.x,b.y,b.z),c.push(l,d)}if(u>0)for(var T=a.length/3,w=T-2*(o+1);T>w+o+2;w++)s.push(w),s.push(w+1),s.push(w+o+1),s.push(w+o+1),s.push(w+1),s.push(w+o+2)}var M=new e.VertexData;return M.indices=s,M.positions=a,M.normals=h,M.uvs=c,M},t.CreateCylinder=function(t,i,n,r,o){"undefined"==typeof o&&(o=1);var s=i/2,a=n/2,h=[],c=[],u=[],l=[];t=t||1,i=i||.5,n=n||1,r=r||16,o=o||1,o=1>o?1:o;for(var f=function(t){var i=2*t*Math.PI/r,n=Math.cos(i),o=Math.sin(i);return new e.Vector3(n,0,o)},p=function(i){var n=i?s:a;if(0!=n){var o=c.length/3,u=new e.Vector3(0,t/2,0),p=new e.Vector2(.5,.5);for(i||(u.scaleInPlace(-1),p.x=-p.x),_=0;r>_;_++){var d=f(_),m=d.scale(n).add(u),g=new e.Vector2(d.x*p.x+.5,d.z*p.y+.5);c.push(m.x,m.y,m.z),l.push(g.x,g.y)}for(var _=0;r-2>_;_++)i?(h.push(o),h.push(o+(_+1)%r),h.push(o+(_+2)%r)):(h.push(o),h.push(o+(_+2)%r),h.push(o+(_+1)%r))}},d=new e.Vector3(0,-1,0).scale(t/2),m=new e.Vector3(0,1,0).scale(t/o),g=r+1,_=0;r>=_;_++)for(var v,y=f(_),x=new e.Vector2(_/r,0),b=a,T=0;o>=T;T++)v=y.scale(b),v.addInPlace(d.add(m.scale(T))),x.y+=1/o,b+=(s-a)/o,c.push(v.x,v.y,v.z),l.push(x.x,x.y);o+=1;for(var T=0;o-1>T;T++)for(var _=0;r>=_;_++)h.push(_*o+T),h.push((_*o+(T+o))%(g*o)),h.push(_*o+(T+1)),h.push(_*o+(T+1)),h.push((_*o+(T+o))%(g*o)),h.push((_*o+(T+o+1))%(g*o));p(!0),p(!1),e.VertexData.ComputeNormals(c,h,u);var w=new e.VertexData;return w.indices=h,w.positions=c,w.normals=u,w.uvs=l,w},t.CreateTorus=function(t,i,n){var r=[],o=[],s=[],a=[];t=t||1,i=i||.5,n=n||16;for(var h=n+1,c=0;n>=c;c++)for(var u=c/n,l=c*Math.PI*2/n-Math.PI/2,f=e.Matrix.Translation(t/2,0,0).multiply(e.Matrix.RotationY(l)),p=0;n>=p;p++){var d=1-p/n,m=p*Math.PI*2/n+Math.PI,g=Math.cos(m),_=Math.sin(m),v=new e.Vector3(g,_,0),y=v.scale(i/2),x=new e.Vector2(u,d);y=e.Vector3.TransformCoordinates(y,f),v=e.Vector3.TransformNormal(v,f),o.push(y.x,y.y,y.z),s.push(v.x,v.y,v.z),a.push(x.x,x.y);var b=(c+1)%h,T=(p+1)%h;r.push(c*h+p),r.push(c*h+T),r.push(b*h+p),r.push(c*h+T),r.push(b*h+T),r.push(b*h+p)}var w=new e.VertexData;return w.indices=r,w.positions=o,w.normals=s,w.uvs=a,w},t.CreateLines=function(t){for(var i=[],n=[],r=0;r<t.length;r++)n.push(t[r].x,t[r].y,t[r].z),r>0&&(i.push(r-1),i.push(r));var o=new e.VertexData;return o.indices=i,o.positions=n,o},t.CreateGround=function(t,i,n){var r,o,s=[],a=[],h=[],c=[];for(t=t||1,i=i||1,n=n||1,r=0;n>=r;r++)for(o=0;n>=o;o++){var u=new e.Vector3(o*t/n-t/2,0,(n-r)*i/n-i/2),l=new e.Vector3(0,1,0);a.push(u.x,u.y,u.z),h.push(l.x,l.y,l.z),c.push(o/n,1-r/n)}for(r=0;n>r;r++)for(o=0;n>o;o++)s.push(o+1+(r+1)*(n+1)),s.push(o+1+r*(n+1)),s.push(o+r*(n+1)),s.push(o+(r+1)*(n+1)),s.push(o+1+(r+1)*(n+1)),s.push(o+r*(n+1));var f=new e.VertexData;return f.indices=s,f.positions=a,f.normals=h,f.uvs=c,f},t.CreateTiledGround=function(t,i,n,r,o,s){function a(t,i,n,r){var o=p.length/3,a=s.w+1;for(h=0;h<s.h;h++)for(c=0;c<s.w;c++){var u=[o+c+h*a,o+(c+1)+h*a,o+(c+1)+(h+1)*a,o+c+(h+1)*a];f.push(u[1]),f.push(u[2]),f.push(u[3]),f.push(u[0]),f.push(u[1]),f.push(u[3])}var l=e.Vector3.Zero(),g=new e.Vector3(0,1,0);for(h=0;h<=s.h;h++)for(l.z=h*(r-i)/s.h+i,c=0;c<=s.w;c++)l.x=c*(n-t)/s.w+t,l.y=0,p.push(l.x,l.y,l.z),d.push(g.x,g.y,g.z),m.push(c/s.w,h/s.h)}"undefined"==typeof o&&(o={w:1,h:1}),"undefined"==typeof s&&(s={w:1,h:1});var h,c,u,l,f=[],p=[],d=[],m=[];o.h=o.w<1?1:o.h,o.w=o.w<1?1:o.w,s.w=s.w<1?1:s.w,s.h=s.h<1?1:s.h;var g={w:(n-t)/o.w,h:(r-i)/o.h};for(u=0;u<o.h;u++)for(l=0;l<o.w;l++)a(t+l*g.w,i+u*g.h,t+(l+1)*g.w,i+(u+1)*g.h);var _=new e.VertexData;return _.indices=f,_.positions=p,_.normals=d,_.uvs=m,_},t.CreateGroundFromHeightMap=function(t,i,n,r,o,s,a,h){var c,u,l=[],f=[],p=[],d=[];for(c=0;n>=c;c++)for(u=0;n>=u;u++){var m=new e.Vector3(u*t/n-t/2,0,(n-c)*i/n-i/2),g=(m.x+t/2)/t*(a-1)|0,_=(1-(m.z+i/2)/i)*(h-1)|0,v=4*(g+_*a),y=s[v]/255,x=s[v+1]/255,b=s[v+2]/255,T=.3*y+.59*x+.11*b;m.y=r+(o-r)*T,f.push(m.x,m.y,m.z),p.push(0,0,0),d.push(u/n,1-c/n)}for(c=0;n>c;c++)for(u=0;n>u;u++)l.push(u+1+(c+1)*(n+1)),l.push(u+1+c*(n+1)),l.push(u+c*(n+1)),l.push(u+(c+1)*(n+1)),l.push(u+1+(c+1)*(n+1)),l.push(u+c*(n+1));e.VertexData.ComputeNormals(f,l,p);var w=new e.VertexData;return w.indices=l,w.positions=f,w.normals=p,w.uvs=d,w},t.CreatePlane=function(t){var i=[],n=[],r=[],o=[];t=t||1;var s=t/2;n.push(-s,-s,0),r.push(0,0,-1),o.push(0,0),n.push(s,-s,0),r.push(0,0,-1),o.push(1,0),n.push(s,s,0),r.push(0,0,-1),o.push(1,1),n.push(-s,s,0),r.push(0,0,-1),o.push(0,1),i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3);var a=new e.VertexData;return a.indices=i,a.positions=n,a.normals=r,a.uvs=o,a},t.CreateTorusKnot=function(t,i,n,r,o,s){var a=[],h=[],c=[],u=[];t=t||2,i=i||.5,n=n||32,r=r||32,o=o||2,s=s||3;for(var l=function(i){var n=Math.cos(i),r=Math.sin(i),a=s/o*i,h=Math.cos(a),c=t*(2+h)*.5*n,u=t*(2+h)*r*.5,l=t*Math.sin(a)*.5;return new e.Vector3(c,u,l)},f=0;n>=f;f++){var p=f%n,d=p/n*2*o*Math.PI,m=l(d),g=l(d+.01),_=g.subtract(m),v=g.add(m),y=e.Vector3.Cross(_,v);v=e.Vector3.Cross(y,_),y.normalize(),v.normalize();for(var x=0;r>x;x++){var b=x%r,T=b/r*2*Math.PI,w=-i*Math.cos(T),M=i*Math.sin(T);h.push(m.x+w*v.x+M*y.x),h.push(m.y+w*v.y+M*y.y),h.push(m.z+w*v.z+M*y.z),u.push(f/n),u.push(x/r)}}for(f=0;n>f;f++)for(x=0;r>x;x++){var E=(x+1)%r,A=f*r+x,P=(f+1)*r+x,S=(f+1)*r+E,C=f*r+E;a.push(C),a.push(P),a.push(A),a.push(C),a.push(S),a.push(P)}e.VertexData.ComputeNormals(h,a,c);var D=new e.VertexData;return D.indices=a,D.positions=h,D.normals=c,D.uvs=u,D},t.ComputeNormals=function(t,i,n){var r,o=[],s=[];for(r=0;r<t.length;r+=3){var a=new e.Vector3(t[r],t[r+1],t[r+2]);o.push(a),s.push([])}var h=[];for(r=0;r<i.length/3;r++){var c=i[3*r],u=i[3*r+1],l=i[3*r+2],f=o[c],p=o[u],d=o[l],m=f.subtract(p),g=d.subtract(p);h[r]=e.Vector3.Normalize(e.Vector3.Cross(m,g)),s[c].push(r),s[u].push(r),s[l].push(r)}for(r=0;r<o.length;r++){for(var _=s[r],v=e.Vector3.Zero(),y=0;y<_.length;y++)v.addInPlace(h[_[y]]);v=e.Vector3.Normalize(v.scale(1/_.length)),n[3*r]=v.x,n[3*r+1]=v.y,n[3*r+2]=v.z}},t}();e.VertexData=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t,i){t._leftCamera.isIntermediate=!0,t.subCameras.push(t._leftCamera),t.subCameras.push(t._rightCamera),t._leftTexture=new e.PassPostProcess(i+"_leftTexture",1,t._leftCamera),t._anaglyphPostProcess=new e.AnaglyphPostProcess(i+"_anaglyph",1,t._rightCamera),t._anaglyphPostProcess.onApply=function(e){e.setTextureFromPostProcess("leftSampler",t._leftTexture)},t._update()},i=function(i){function r(n,r,o,s,a,h,c){i.call(this,n,r,o,s,a,c),this._eyeSpace=e.Tools.ToRadians(h),this._leftCamera=new e.ArcRotateCamera(n+"_left",r-this._eyeSpace,o,s,a,c),this._rightCamera=new e.ArcRotateCamera(n+"_right",r+this._eyeSpace,o,s,a,c),t(this,n)}return n(r,i),r.prototype._update=function(){this._updateCamera(this._leftCamera),this._updateCamera(this._rightCamera),this._leftCamera.alpha=this.alpha-this._eyeSpace,this._rightCamera.alpha=this.alpha+this._eyeSpace,i.prototype._update.call(this)},r.prototype._updateCamera=function(e){e.beta=this.beta,e.radius=this.radius,e.minZ=this.minZ,e.maxZ=this.maxZ,e.fov=this.fov,e.target=this.target},r}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(i){function r(n,r,o,s){i.call(this,n,r,s),this._eyeSpace=e.Tools.ToRadians(o),this._transformMatrix=new e.Matrix,this._leftCamera=new e.FreeCamera(n+"_left",r.clone(),s),this._rightCamera=new e.FreeCamera(n+"_right",r.clone(),s),t(this,n)}return n(r,i),r.prototype._getSubCameraPosition=function(t,i){var n=this.getTarget();e.Matrix.Translation(-n.x,-n.y,-n.z).multiplyToRef(e.Matrix.RotationY(t),this._transformMatrix),this._transformMatrix=this._transformMatrix.multiply(e.Matrix.Translation(n.x,n.y,n.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._transformMatrix,i)},r.prototype._update=function(){this._getSubCameraPosition(-this._eyeSpace,this._leftCamera.position),this._getSubCameraPosition(this._eyeSpace,this._rightCamera.position),this._updateCamera(this._leftCamera),this._updateCamera(this._rightCamera),i.prototype._update.call(this)},r.prototype._updateCamera=function(e){e.minZ=this.minZ,e.maxZ=this.maxZ,e.fov=this.fov,e.viewport=this.viewport,e.setTarget(this.getTarget())},r}(e.FreeCamera);e.AnaglyphFreeCamera=r}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"anaglyph",null,["leftSampler"],i,n,r,o,s)}return n(t,e),t}(e.PostProcess);e.AnaglyphPostProcess=t}(i||(i={}));var i;!function(e){var t=function(){function t(){}return t.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return t.HasTags(e)},e.addTags=function(i){return t.AddTagsTo(e,i)},e.removeTags=function(i){return t.RemoveTagsFrom(e,i)},e.matchesTagsQuery=function(i){return t.MatchesQuery(e,i)}},t.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},t.HasTags=function(t){return t._tags?!e.Tools.IsEmpty(t._tags):!1},t.GetTags=function(e){return e._tags?e._tags:null},t.AddTagsTo=function(e,i){if(i){var n=i.split(" ");for(var r in n)t._AddTagTo(e,n[r])}},t._AddTagTo=function(e,i){i=i.trim(),""!==i&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(e),e._tags[i]=!0))},t.RemoveTagsFrom=function(e,i){if(t.HasTags(e)){var n=i.split(" ");for(var r in n)t._RemoveTagFrom(e,n[r])}},t._RemoveTagFrom=function(e,t){delete e._tags[t]},t.MatchesQuery=function(i,n){return void 0===n?!0:""===n?t.HasTags(i):e.Internals.AndOrNotEvaluator.Eval(n,function(e){return t.HasTags(i)&&i._tags[e]})},t}();e.Tags=t}(i||(i={}));var i;!function(e){!function(e){var t=function(){function e(){}return e.Eval=function(t,i){return t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)}):e._HandleParenthesisContent(t,i),"true"===t?!0:"false"===t?!1:e.Eval(t,i)},e._HandleParenthesisContent=function(t,i){i=i||function(e){return"true"===e?!0:!1};var n,r=t.split("||");for(var o in r){var s=e._SimplifyNegation(r[o].trim()),a=s.split("&&");if(a.length>1)for(var h=0;h<a.length;++h){var c=e._SimplifyNegation(a[h].trim());if(n="true"!==c&&"false"!==c?"!"===c[0]?!i(c.substring(1)):i(c):"true"===c?!0:!1,!n){s="false";break}}if(n||"true"===s){n=!0;break}n="true"!==s&&"false"!==s?"!"===s[0]?!i(s.substring(1)):i(s):"true"===s?!0:!1}return n?"true":"false"},e._SimplifyNegation=function(e){return e=e.replace(/^[\s!]+/,function(e){return e=e.replace(/[\s]/g,function(){return""}),e.length%2?"!":""}),e=e.trim(),"!true"===e?e="false":"!false"===e&&(e="true"),e},e}();e.AndOrNotEvaluator=t}(e.Internals||(e.Internals={})),e.Internals}(i||(i={}));var i;!function(e){var t=function(){function t(t,i,n,r,o,s){this._enabled=!0,this._refCount=0,this._name=i,this._renderTexture=new e.RenderTargetTexture(i,n,t),this.setRenderList(r),this._renderTexture.onBeforeRender=o,this._renderTexture.onAfterRender=s,this._scene=t}return t.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},t.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},t.prototype._update=function(){this.setRenderList(this._renderList)},t.prototype.setRenderList=function(e){this._renderTexture.renderList=e},t.prototype.getRenderTexture=function(){return this._renderTexture},t}();e.PostProcessRenderPass=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t,i,n,r,o){this._engine=e,this._name=t,this._postProcessType=i,this._ratio=n||1,this._samplingMode=r||null,this._singleInstance=o||!0,this._cameras=[],this._postProcesses=[],this._indicesForCamera=[],this._renderPasses=[],this._renderEffectAsPasses=[],this.parameters=function(){}}return t._GetInstance=function(e,i,n,r){for(var o,s,a=[],h=t._GetParametersNames(i),c=0;c<h.length;c++)switch(h[c]){case"name":a[c]=i.toString();break;case"ratio":a[c]=n;break;case"camera":a[c]=null;break;case"samplingMode":a[c]=r;break;case"engine":a[c]=e;break;case"reusable":a[c]=!0;break;default:a[c]=null}return o=function(){},o.prototype=i.prototype,s=new o,i.apply(s,a),s},t._GetParametersNames=function(e){var t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,i=e.toString().replace(t,""),n=i.slice(i.indexOf("(")+1,i.indexOf(")")).match(/([^\s,]+)/g);return null===n&&(n=[]),n},t.prototype._update=function(){for(var e in this._renderPasses)this._renderPasses[e]._update()},t.prototype.addPass=function(e){this._renderPasses[e._name]=e,this._linkParameters()},t.prototype.removePass=function(e){delete this._renderPasses[e._name],this._linkParameters()},t.prototype.addRenderEffectAsPass=function(e){this._renderEffectAsPasses[e._name]=e,this._linkParameters()},t.prototype.getPass=function(e){for(var t in this._renderPasses)if(t===e)return this._renderPasses[e]},t.prototype.emptyPasses=function(){this._renderPasses.length=0,this._linkParameters()},t.prototype._attachCameras=function(i){for(var n,r=e.Tools.MakeArray(i||this._cameras),o=0;o<r.length;o++){var s=r[o],a=s.name;n=this._singleInstance?0:a,this._postProcesses[n]=this._postProcesses[n]||t._GetInstance(this._engine,this._postProcessType,this._ratio,this._samplingMode);var h=s.attachPostProcess(this._postProcesses[n]);null===this._indicesForCamera[a]&&(this._indicesForCamera[a]=[]),this._indicesForCamera[a].push(h),-1===this._cameras.indexOf(s)&&(this._cameras[a]=s);for(var c in this._renderPasses)this._renderPasses[c]._incRefCount()}this._linkParameters()},t.prototype._detachCameras=function(t){for(var i=e.Tools.MakeArray(t||this._cameras),n=0;n<i.length;n++){var r=i[n],o=r.name;r.detachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o]);var s=this._cameras.indexOf(o);this._indicesForCamera.splice(s,1),this._cameras.splice(s,1);for(var a in this._renderPasses)this._renderPasses[a]._decRefCount()}},t.prototype._enable=function(t){for(var i=e.Tools.MakeArray(t||this._cameras),n=0;n<i.length;n++){for(var r=i[n],o=r.name,s=0;s<this._indicesForCamera[o].length;s++)void 0===r._postProcesses[this._indicesForCamera[o][s]]&&t[n].attachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o][s]);for(var a in this._renderPasses)this._renderPasses[a]._incRefCount()}},t.prototype._disable=function(t){for(var i=e.Tools.MakeArray(t||this._cameras),n=0;n<i.length;n++){var r=i[n],o=r.Name;r.detachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o]);for(var s in this._renderPasses)this._renderPasses[s]._decRefCount()}},t.prototype.getPostProcess=function(e){return this._singleInstance?this._postProcesses[0]:this._postProcesses[e.name]},t.prototype._linkParameters=function(){var e=this;for(var t in this._postProcesses)this._postProcesses[t].onApply=function(t){e.parameters(t),e._linkTextures(t)}},t.prototype._linkTextures=function(e){for(var t in this._renderPasses)e.setTexture(t,this._renderPasses[t].getRenderTexture());for(var i in this._renderEffectAsPasses)e.setTextureFromPostProcess(i+"Sampler",this._renderEffectAsPasses[i].getPostProcess())},t}();e.PostProcessRenderEffect=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t){this._engine=e,this._name=t,this._renderEffects=[],this._renderEffectsForIsolatedPass=[],this._cameras=[]}return t.prototype.addEffect=function(e){this._renderEffects[e._name]=e},t.prototype._enableEffect=function(t,i){var n=this._renderEffects[t];n&&n.enable(e.Tools.MakeArray(i||this._cameras))},t.prototype._disableEffect=function(t,i){var n=this._renderEffects[t];n&&n.disable(e.Tools.MakeArray(i||this._cameras))},t.prototype._attachCameras=function(t,i){for(var n=e.Tools.MakeArray(t||this._cameras),r=[],o=0;o<n.length;o++){var s=n[o],a=s.name;-1===this._cameras.indexOf(s)?this._cameras[a]=s:i&&r.push(o)}for(var o=0;o<r.length;o++)t.splice(r[o],1);for(var h in this._renderEffects)this._renderEffects[h]._attachCameras(n)},t.prototype._detachCameras=function(t){var i=e.Tools.MakeArray(t||this._cameras);for(var n in this._renderEffects)this._renderEffects[n]._detachCameras(i);for(var r=0;r<i.length;r++)this._cameras.splice(this._cameras.indexOf(i[r]),1)},t.prototype._enableDisplayOnlyPass=function(i,n){var r=e.Tools.MakeArray(n||this._cameras),o=null;for(var s in this._renderEffects)if(o=this._renderEffects[s].getPass(i),null!=o)break;if(null!==o){for(var s in this._renderEffects)this._renderEffects[s]._disable(r);o._name=t.PASS_SAMPLER_NAME;for(var a=0;a<r.length;a++){var h=r[a],c=h.name;this._renderEffectsForIsolatedPass[c]=this._renderEffectsForIsolatedPass[c]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,"BABYLON.DisplayPassPostProcess",1,null,null),this._renderEffectsForIsolatedPass[c].emptyPasses(),this._renderEffectsForIsolatedPass[c].addPass(o),this._renderEffectsForIsolatedPass[c]._attachCameras(h)}}},t.prototype._disableDisplayOnlyPass=function(i){for(var n=e.Tools.MakeArray(i||this._cameras),r=0;r<n.length;r++){var o=n[r],s=o.name;this._renderEffectsForIsolatedPass[s]=this._renderEffectsForIsolatedPass[s]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,"BABYLON.DisplayPassPostProcess",1,null,null),this._renderEffectsForIsolatedPass[s]._disable(o)}for(var a in this._renderEffects)this._renderEffects[a]._enable(n)},t.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t].name;this._renderEffectsForIsolatedPass[i]&&this._renderEffectsForIsolatedPass[i]._update()}},t.PASS_EFFECT_NAME="passEffect",t.PASS_SAMPLER_NAME="passSampler",t}();e.PostProcessRenderPipeline=t}(i||(i={}));var i;!function(e){var t=function(){function e(){this._renderPipelines=[]}return e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n.attachCameras(t,i)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var i=this._renderPipelines[e];i&&i.detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n.enableEffect(t,i)},e.prototype.disableEffectInPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n.disableEffect(t,i)},e.prototype.enableDisplayOnlyPassInPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n.enableDisplayOnlyPass(t,i)},e.prototype.disableDisplayOnlyPassInPipeline=function(e,t){var i=this._renderPipelines[e];i&&i.disableDisplayOnlyPass(t)},e.prototype.update=function(){for(var e in this._renderPipelines)this._renderPipelines[e]._update()},e}();e.PostProcessRenderPipelineManager=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"displayPass",["passSampler"],["passSampler"],i,n,r,o,s)}return n(t,e),t}(e.PostProcess);e.DisplayPassPostProcess=t}(i||(i={}));var i;!function(e){var t=function(){function t(t){this.frontColor=new e.Color3(1,1,1),this.backColor=new e.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new e.SmartArray(32),this._scene=t,this._colorShader=new e.ShaderMaterial("colorShader",t,"color",{attributes:["position"],uniforms:["worldViewProjection","color"]});var i=this._scene.getEngine(),n=e.VertexData.CreateBox(1);this._vb=new e.VertexBuffer(i,n.positions,e.VertexBuffer.PositionKind,!1),this._ib=i.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}return t.prototype.reset=function(){this.renderList.reset()},t.prototype.render=function(){if(0!=this.renderList.length&&this._colorShader.isReady()){var t=this._scene.getEngine();t.setDepthWrite(!1),this._colorShader._preBind();for(var i=0;i<this.renderList.length;i++){var n=this.renderList.data[i],r=n.minimum,o=n.maximum,s=o.subtract(r),a=r.add(s.scale(.5)),h=e.Matrix.Scaling(s.x,s.y,s.z).multiply(e.Matrix.Translation(a.x,a.y,a.z)).multiply(n.getWorldMatrix());t.bindBuffers(this._vb.getBuffer(),this._ib,[3],12,this._colorShader.getEffect()),this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this._colorShader.setColor3("color",this.backColor),this._colorShader.bind(h),t.draw(!1,0,24)),t.setDepthFunctionToLess(),this._colorShader.setColor3("color",this.frontColor),this._colorShader.bind(h),t.draw(!1,0,24)}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}},t.prototype.dispose=function(){this._colorShader.dispose(),this._vb.dispose(),this._scene.getEngine()._releaseBuffer(this._ib)},t}();e.BoundingBoxRenderer=t}(i||(i={}));var i;!function(e){!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,n){if(n.length<19)return void e.Tools.Error("Unable to load TGA file - Not enough data to contain header");var r=18,o=t.GetTGAHeader(n);if(o.id_length+r>n.length)return void e.Tools.Error("Unable to load TGA file - Not enough data");r+=o.id_length;var s=!1,a=!1,h=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var u,l,f=(15&o.flags,o.pixel_size>>3),p=o.width*o.height*f;if(a&&(l=n.subarray(r,r+=o.colormap_length*(o.colormap_size>>3))),s){u=new Uint8Array(p);for(var d,m,g,_=0,v=new Uint8Array(f);p>r;)if(d=n[r++],m=(127&d)+1,128&d){for(g=0;f>g;++g)v[g]=n[r++];for(g=0;m>g;++g)u.set(v,_+g*f);_+=f*m}else{for(m*=f,g=0;m>g;++g)u[_+g]=n[r++];_+=m}}else u=n.subarray(r,r+=a?o.width*o.height:p);var y,x,b,T,w,M;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,M=o.width,x=0,T=1,w=o.height;break;case t._ORIGIN_BL:y=0,b=1,M=o.width,x=o.height-1,T=-1,w=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,M=-1,x=0,T=1,w=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,M=-1,x=o.height-1,T=-1,w=-1}var E="_getImageData"+(c?"Grey":"")+o.pixel_size+"bits",A=t[E](o,l,u,x,T,w,y,b,M);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,A)},t._getImageData8bits=function(e,t,i,n,r,o,s,a,h){var c,u,l,f=i,p=t,d=e.width,m=e.height,g=0,_=new Uint8Array(d*m*4);for(l=n;l!==o;l+=r)for(u=s;u!==h;u+=a,g++)c=f[g],_[4*(u+d*l)+3]=255,_[4*(u+d*l)+2]=p[3*c+0],_[4*(u+d*l)+1]=p[3*c+1],_[4*(u+d*l)+0]=p[3*c+2];return _},t._getImageData16bits=function(e,t,i,n,r,o,s,a,h){var c,u,l,f=i,p=e.width,d=e.height,m=0,g=new Uint8Array(p*d*4);for(l=n;l!==o;l+=r)for(u=s;u!==h;u+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(u+p*l)+0]=(31744&c)>>7,g[4*(u+p*l)+1]=(992&c)>>2,g[4*(u+p*l)+2]=(31&c)>>3,g[4*(u+p*l)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,i,n,r,o,s,a,h){var c,u,l=i,f=e.width,p=e.height,d=0,m=new Uint8Array(f*p*4);for(u=n;u!==o;u+=r)for(c=s;c!==h;c+=a,d+=3)m[4*(c+f*u)+3]=255,m[4*(c+f*u)+2]=l[d+0],m[4*(c+f*u)+1]=l[d+1],m[4*(c+f*u)+0]=l[d+2];return m},t._getImageData32bits=function(e,t,i,n,r,o,s,a,h){var c,u,l=i,f=e.width,p=e.height,d=0,m=new Uint8Array(f*p*4);for(u=n;u!==o;u+=r)for(c=s;c!==h;c+=a,d+=4)m[4*(c+f*u)+2]=l[d+0],m[4*(c+f*u)+1]=l[d+1],m[4*(c+f*u)+0]=l[d+2],m[4*(c+f*u)+3]=l[d+3];return m},t._getImageDataGrey8bits=function(e,t,i,n,r,o,s,a,h){var c,u,l,f=i,p=e.width,d=e.height,m=0,g=new Uint8Array(p*d*4);for(l=n;l!==o;l+=r)for(u=s;u!==h;u+=a,m++)c=f[m],g[4*(u+p*l)+0]=c,g[4*(u+p*l)+1]=c,g[4*(u+p*l)+2]=c,g[4*(u+p*l)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,n,r,o,s,a,h){var c,u,l=i,f=e.width,p=e.height,d=0,m=new Uint8Array(f*p*4);for(u=n;u!==o;u+=r)for(c=s;c!==h;c+=a,d+=2)m[4*(c+f*u)+0]=l[d+0],m[4*(c+f*u)+1]=l[d+0],m[4*(c+f*u)+2]=l[d+0],m[4*(c+f*u)+3]=l[d+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(e.Internals||(e.Internals={})),e.Internals}(i||(i={}));var i;!function(e){!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var r=542327876,o=131072,s=512,a=4,h=64,c=131072,u=i("DXT1"),l=i("DXT3"),f=i("DXT5"),p=31,d=0,m=1,g=2,_=3,v=4,y=7,x=20,b=21,T=22,w=28,M=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,p),i=1;return t[g]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[_],mipmapCount:i,isFourCC:(t[x]&a)===a,isRGB:(t[x]&h)===h,isLuminance:(t[x]&c)===c,isCube:(t[w]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,n,r){for(var o=new Uint8Array(n),s=new Uint8Array(r),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var u=i+4*(c+h*e);o[a+2]=s[u],o[a+1]=s[u+1],o[a]=s[u+2],o[a+3]=s[u+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,n,r){for(var o=new Uint8Array(n),s=new Uint8Array(r),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var u=i+3*(c+h*e);o[a+2]=s[u],o[a+1]=s[u+1],o[a]=s[u+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,n,r){for(var o=new Uint8Array(n),s=new Uint8Array(r),a=0,h=t-1;h>=0;h--)for(var c=0;e>c;c++){var u=i+(c+h*e);o[a]=s[u],a++}return o},t.UploadDDSLevels=function(i,s,a,h,c,x){var w,M,E,A,P,S,C,D,I,R,L=new Int32Array(a,0,p);if(L[d]!=r)return void e.Tools.Error("Invalid magic number in DDS header");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(h.isFourCC)switch(w=L[b]){case u:M=8,E=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case l:M=16,E=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:M=16,E=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",n(w))}I=1,L[g]&o&&c!==!1&&(I=Math.max(1,L[y]));for(var O=L[T],V=0;x>V;V++){var B=1==x?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+V;for(A=L[v],P=L[_],C=L[m]+4,R=0;I>R;++R){if(h.isRGB)24==O?(S=A*P*3,D=t.GetRGBArrayBuffer(A,P,C,S,a),i.texImage2D(B,R,i.RGB,A,P,0,i.RGB,i.UNSIGNED_BYTE,D)):(S=A*P*4,D=t.GetRGBAArrayBuffer(A,P,C,S,a),i.texImage2D(B,R,i.RGBA,A,P,0,i.RGBA,i.UNSIGNED_BYTE,D));else if(h.isLuminance){var F=i.getParameter(i.UNPACK_ALIGNMENT),k=A,N=Math.floor((A+F-1)/F)*F;S=N*(P-1)+k,D=t.GetLuminanceArrayBuffer(A,P,C,S,a),i.texImage2D(B,R,i.LUMINANCE,A,P,0,i.LUMINANCE,i.UNSIGNED_BYTE,D)}else S=Math.max(4,A)/4*Math.max(4,P)/4*M,D=new Uint8Array(a,C,S),i.compressedTexImage2D(B,R,E,A,P,0,D);C+=S,A*=.5,P*=.5,A=Math.max(1,A),P=Math.max(1,P)}}},t}();t.DDSTools=M}(e.Internals||(e.Internals={})),e.Internals}(i||(i={}));var i;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(i||(i={}));var i;!function(e){var t=function(){function t(){this._registeredMeshes=[],this._physicsMaterials=[],this.updateBodyPosition=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var i=this._registeredMeshes[t];
if(i.mesh===e||i.mesh===e.parent){var n=i.body.body;return n.position.set(e.position.x,e.position.z,e.position.y),n.quaternion.x=e.rotationQuaternion.x,n.quaternion.z=e.rotationQuaternion.y,n.quaternion.y=e.rotationQuaternion.z,void(n.quaternion.w=-e.rotationQuaternion.w)}}}}return t.prototype.initialize=function(e){"undefined"==typeof e&&(e=10),this._world=new CANNON.World,this._world.broadphase=new CANNON.NaiveBroadphase,this._world.solver.iterations=e},t.prototype._checkWithEpsilon=function(t){return t<e.PhysicsEngine.Epsilon?e.PhysicsEngine.Epsilon:t},t.prototype.runOneStep=function(t){this._world.step(t);for(var i=0;i<this._registeredMeshes.length;i++){var n=this._registeredMeshes[i];n.isChild||(n.mesh.position.x=n.body.position.x,n.mesh.position.y=n.body.position.z,n.mesh.position.z=n.body.position.y,n.mesh.rotationQuaternion||(n.mesh.rotationQuaternion=new e.Quaternion(0,0,0,1)),n.mesh.rotationQuaternion.x=n.body.quaternion.x,n.mesh.rotationQuaternion.y=n.body.quaternion.z,n.mesh.rotationQuaternion.z=n.body.quaternion.y,n.mesh.rotationQuaternion.w=-n.body.quaternion.w)}},t.prototype.setGravity=function(e){this._world.gravity.set(e.x,e.z,e.y)},t.prototype.registerMesh=function(t,i,n){switch(this.unregisterMesh(t),t.computeWorldMatrix(!0),i){case e.PhysicsEngine.SphereImpostor:var r=t.getBoundingInfo().boundingBox,o=r.maximumWorld.x-r.minimumWorld.x,s=r.maximumWorld.y-r.minimumWorld.y,a=r.maximumWorld.z-r.minimumWorld.z;return this._createSphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(s),this._checkWithEpsilon(a))/2,t,n);case e.PhysicsEngine.BoxImpostor:r=t.getBoundingInfo().boundingBox;var h=r.minimumWorld,c=r.maximumWorld,u=c.subtract(h).scale(.5);return this._createBox(this._checkWithEpsilon(u.x),this._checkWithEpsilon(u.y),this._checkWithEpsilon(u.z),t,n);case e.PhysicsEngine.PlaneImpostor:return this._createPlane(t,n);case e.PhysicsEngine.MeshImpostor:var l=t.getVerticesData(e.VertexBuffer.PositionKind),f=t.getIndices();return this._createConvexPolyhedron(l,f,t,n)}return null},t.prototype._createSphere=function(e,t,i){var n=new CANNON.Sphere(e);return i?this._createRigidBodyFromShape(n,t,i.mass,i.friction,i.restitution):n},t.prototype._createBox=function(e,t,i,n,r){var o=new CANNON.Box(new CANNON.Vec3(e,i,t));return r?this._createRigidBodyFromShape(o,n,r.mass,r.friction,r.restitution):o},t.prototype._createPlane=function(e,t){var i=new CANNON.Plane;return t?this._createRigidBodyFromShape(i,e,t.mass,t.friction,t.restitution):i},t.prototype._createConvexPolyhedron=function(t,i,n,r){var o=[],s=[];n.computeWorldMatrix(!0);for(var a=0;a<t.length;a+=3){var h=e.Vector3.Zero();e.Vector3.TransformNormalFromFloatsToRef(t[a],t[a+1],t[a+2],n.getWorldMatrix(),h),o.push(new CANNON.Vec3(h.x,h.z,h.y))}for(var c=0;c<i.length;c+=3)s.push([i[c],i[c+2],i[c+1]]);var u=new CANNON.ConvexPolyhedron(o,s);return r?this._createRigidBodyFromShape(u,n,r.mass,r.friction,r.restitution):u},t.prototype._addMaterial=function(e,t){var i,n;for(i=0;i<this._physicsMaterials.length;i++)if(n=this._physicsMaterials[i],n.friction===e&&n.restitution===t)return n;var r=new CANNON.Material;for(r.friction=e,r.restitution=t,this._physicsMaterials.push(r),i=0;i<this._physicsMaterials.length;i++){n=this._physicsMaterials[i];var o=new CANNON.ContactMaterial(n,r,n.friction*r.friction,n.restitution*r.restitution);o.contactEquationStiffness=1e10,o.contactEquationRegularizationTime=10,this._world.addContactMaterial(o)}return r},t.prototype._createRigidBodyFromShape=function(t,i,n,r,o){var s=null;i.rotationQuaternion&&(s=i.rotationQuaternion.clone(),i.rotationQuaternion=new e.Quaternion(0,0,0,1));var a=this._addMaterial(r,o),h=new CANNON.RigidBody(n,t,a);return s&&(h.quaternion.x=s.x,h.quaternion.z=s.y,h.quaternion.y=s.z,h.quaternion.w=-s.w),h.position.set(i.position.x,i.position.z,i.position.y),this._world.add(h),this._registeredMeshes.push({mesh:i,body:h,material:a}),h},t.prototype.registerMeshesAsCompound=function(e,t){for(var i=new CANNON.Compound,n=0;n<e.length;n++){var r=e[n].mesh,o=this.registerMesh(r,e[n].impostor);0==n?i.addChild(o,new CANNON.Vec3(0,0,0)):i.addChild(o,new CANNON.Vec3(r.position.x,r.position.z,r.position.y))}var s=e[0].mesh,a=this._createRigidBodyFromShape(i,s,t.mass,t.friction,t.restitution);return a.parts=e,a},t.prototype._unbindBody=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var i=this._registeredMeshes[t];i.body===e&&(i.body=null)}},t.prototype.unregisterMesh=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var i=this._registeredMeshes[t];if(i.mesh===e)return i.body&&(this._world.remove(i.body),this._unbindBody(i.body)),void this._registeredMeshes.splice(t,1)}},t.prototype.applyImpulse=function(e,t,i){for(var n=new CANNON.Vec3(i.x,i.z,i.y),r=new CANNON.Vec3(t.x,t.z,t.y),o=0;o<this._registeredMeshes.length;o++){var s=this._registeredMeshes[o];if(s.mesh===e)return void s.body.applyImpulse(r,n)}},t.prototype.createLink=function(e,t,i,n){for(var r=null,o=null,s=0;s<this._registeredMeshes.length;s++){var a=this._registeredMeshes[s];a.mesh===e?r=a.body:a.mesh===t&&(o=a.body)}if(!r||!o)return!1;var h=new CANNON.PointToPointConstraint(r,new CANNON.Vec3(i.x,i.z,i.y),o,new CANNON.Vec3(n.x,n.z,n.y));return this._world.addConstraint(h),!0},t.prototype.dispose=function(){for(;this._registeredMeshes.length;)this.unregisterMesh(this._registeredMeshes[0].mesh)},t.prototype.isSupported=function(){return void 0!==window.CANNON},t}();e.CannonJSPlugin=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e}();e.Condition=t;var i=function(e){function t(i,n,r,o,s){"undefined"==typeof s&&(s=t.IsEqual),e.call(this,i),this.propertyPath=r,this.value=o,this.operator=s,this._target=this._getEffectiveTarget(n,this.propertyPath),this._property=this._getProperty(this.propertyPath)}return n(t,e),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!0,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._target[this._property]>this.value;case t.IsLesser:return this._target[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._target[this._property]):this.value===this._target[this._property],this.operator===t.IsEqual?e:!e}return!1},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(t);e.ValueCondition=i;var r=function(e){function t(t,i){e.call(this,t),this.predicate=i}return n(t,e),t.prototype.isValid=function(){return this.predicate()},t}(t);e.PredicateCondition=r;var o=function(e){function t(t,i,n){e.call(this,t),this.value=n,this._target=i}return n(t,e),t.prototype.isValid=function(){return this._target.state===this.value},t}(t);e.StateCondition=o}(i||(i={}));var i;!function(e){var t=function(){function e(e,t){this.triggerOptions=e,e.parameter?(this.trigger=e.trigger,this._triggerParameter=e.parameter):this.trigger=e,this._nextActiveAction=this,this._condition=t}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(e){if(this._condition){var t=this._actionManager.getScene().getRenderId();if(this._condition._evaluationId===t){if(!this._condition._currentResult)return}else{if(this._condition._evaluationId=t,!this._condition.isValid())return void(this._condition._currentResult=!1);this._condition._currentResult=!0}}this._nextActiveAction.execute(e),this._nextActiveAction=this._nextActiveAction._child?this._nextActiveAction._child:this},e.prototype.execute=function(){},e.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e}();e.Action=t}(i||(i={}));var i;!function(e){var t=function(){function e(e,t,i,n,r){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=r}return e.CreateNew=function(t){var i=t.getScene();return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer)},e.CreateNewFromScene=function(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)},e}();e.ActionEvent=t;var i=function(){function t(e){this.actions=new Array,this._scene=e,e._actionManagers.push(this)}return Object.defineProperty(t,"NothingTrigger",{get:function(){return t._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickTrigger",{get:function(){return t._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnLeftPickTrigger",{get:function(){return t._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnRightPickTrigger",{get:function(){return t._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnCenterPickTrigger",{get:function(){return t._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOverTrigger",{get:function(){return t._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOutTrigger",{get:function(){return t._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnEveryFrameTrigger",{get:function(){return t._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionEnterTrigger",{get:function(){return t._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionExitTrigger",{get:function(){return t._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyDownTrigger",{get:function(){return t._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyUpTrigger",{get:function(){return t._OnKeyUpTrigger},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this._scene._actionManagers.indexOf(this);e>-1&&this._scene._actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++){var i=this.actions[t];if(e.indexOf(i.trigger)>-1)return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[e];if(i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[e];if(i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnCenterPickTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(i){return i.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(i),i._actionManager=this,i._prepare(),i)},t.prototype.processTrigger=function(e,i){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(r.trigger===e){if(e==t.OnKeyUpTrigger||e==t.OnKeyDownTrigger){var o=r.getTriggerParameter();if(o&&i.sourceEvent.key!==o)continue}r._executeCurrent(i)}}},t.prototype._getEffectiveTarget=function(e,t){for(var i=t.split("."),n=0;n<i.length-1;n++)e=e[i[n]];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[t.length-1]},t._NothingTrigger=0,t._OnPickTrigger=1,t._OnLeftPickTrigger=2,t._OnRightPickTrigger=3,t._OnCenterPickTrigger=4,t._OnPointerOverTrigger=5,t._OnPointerOutTrigger=6,t._OnEveryFrameTrigger=7,t._OnIntersectionEnterTrigger=8,t._OnIntersectionExitTrigger=9,t._OnKeyDownTrigger=10,t._OnKeyUpTrigger=11,t}();e.ActionManager=i}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(e,i,n,r,o,s,a){"undefined"==typeof o&&(o=1e3),t.call(this,e,s),this.propertyPath=n,this.value=r,this.duration=o,this.stopOtherAnimations=a,this._target=i}return n(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){var t,i=this._actionManager.getScene(),n=[{frame:0,value:this._target[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)t=e.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");t=e.Animation.ANIMATIONTYPE_QUATERNION}var r=new e.Animation("InterpolateValueAction",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);r.setKeys(n),this.stopOtherAnimations&&i.stopAnimation(this._target),i.beginDirectAnimation(this._target,[r],0,100)},i}(e.Action);e.InterpolateValueAction=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(e){function t(t,i,n,r){e.call(this,t,r),this.propertyPath=n,this._target=i}return n(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var i=function(e){function t(t,i,n,r){e.call(this,t,r),this.value=n,this._target=i}return n(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=i;var r=function(e){function t(t,i,n,r,o){e.call(this,t,o),this.propertyPath=n,this.value=r,this._target=i}return n(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=r;var o=function(t){function i(e,i,n,r,o){t.call(this,e,o),this.propertyPath=n,this.value=r,this._target=i}return n(i,t),i.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._target[this._property]&&e.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},i.prototype.execute=function(){this._target[this._property]+=this.value},i}(e.Action);e.IncrementValueAction=o;var s=function(e){function t(t,i,n,r,o,s){e.call(this,t,s),this.from=n,this.to=r,this.loop=o,this._target=i}return n(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=s;var a=function(e){function t(t,i,n){e.call(this,t,n),this._target=i}return n(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=a;var h=function(t){function i(i,n){"undefined"==typeof i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,n)}return n(i,t),i.prototype.execute=function(){},i}(e.Action);e.DoNothingAction=h;var c=function(e){function t(t,i,n){e.call(this,t,n),this.children=i}return n(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=c;var u=function(e){function t(t,i,n){e.call(this,t,n),this.func=i}return n(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=u;var l=function(t){function i(e,i,n,r){t.call(this,e,r),this._target=i,this._parent=n}return n(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i}(e.Action);e.SetParentAction=l}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(){function t(t,i,n,r,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,n?this.setAllVerticesData(n,r):(this._totalVertices=0,this._indices=[]),o&&this.applyToMesh(o)}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t)},t.prototype.setVerticesData=function(t,i,n){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,i,t,n,0===this._meshes.length),t===e.VertexBuffer.PositionKind){var r=this._vertexBuffers[t].getStrideSize();this._totalVertices=i.length/r;for(var o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices),s=this._meshes,a=s.length,h=0;a>h;h++){var c=s[h];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}},t.prototype.updateVerticesData=function(t,i,n){var r=this.getVertexBuffer(t);if(r&&(r.update(i),t===e.VertexBuffer.PositionKind)){var o;if(n){var s=r.getStrideSize();this._totalVertices=i.length/s,o=e.Tools.ExtractMinAndMax(i,0,this._totalVertices)}for(var a=this._meshes,h=a.length,c=0;h>c;c++){var u=a[c];u._resetPointsArrayCache(),n&&(u._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum))}}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e){var t=this.getVertexBuffer(e);return t?t.getData():null},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var t=this._meshes,i=t.length,n=0;i>n;n++)t[n]._createGlobalSubMesh()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(){return this.isReady()?this._indices:null},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,n=i.indexOf(e);if(-1!==n){for(var r in this._vertexBuffers)this._vertexBuffers[r].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(n,1),e._geometry=null,0==i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var n in this._vertexBuffers)if(1===i&&this._vertexBuffers[n].create(),this._vertexBuffers[n]._buffer.references=i,n===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var r=e.Tools.ExtractMinAndMax(this._vertexBuffers[n].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(r.minimum,r.maximum),t._createGlobalSubMesh()}1===i&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.load=function(t,i){var n=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(r){n._delayLoadingFunction(JSON.parse(r),n),n.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,n._delayInfo=[],t._removePendingData(n);for(var o=n._meshes,s=o.length,a=0;s>a;a++)n._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.dispose=function(){for(var t=this._meshes,i=t.length,n=0;i>n;n++)this.releaseForMesh(t[n]);this._meshes=[];for(var r in this._vertexBuffers)this._vertexBuffers[r].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null;var o=this._scene.getGeometries();n=o.indexOf(this),n>-1&&o.splice(n,1)},t.prototype.copy=function(t){var i=new e.VertexData;i.indices=[];for(var n=this.getIndices(),r=0;r<n.length;r++)i.indices.push(n[r]);var o=!1,s=!1;for(var a in this._vertexBuffers)i.set(this.getVerticesData(a),a),s||(o=this.getVertexBuffer(a).isUpdatable(),s=!o);var h=new e.Geometry(t,this._scene,i,o,null);h.delayLoadState=this.delayLoadState,h.delayLoadingFile=this.delayLoadingFile,h._delayLoadingFunction=this._delayLoadingFunction;for(a in this._delayInfo)h._delayInfo=h._delayInfo||[],h._delayInfo.push(a);var c=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return h._boundingInfo=new e.BoundingInfo(c.minimum,c.maximum),h},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},t}();e.Geometry=t,function(t){!function(i){var r=function(e){function t(t,i,n,r,o){this._beingRegenerated=!0,this._canBeRegenerated=r,e.call(this,t,i,n,!1,o),this._beingRegenerated=!1}return n(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},t.prototype.copy=function(){throw new Error("Must be overriden in sub-classes.")},t}(t);i._Primitive=r;var o=function(t){function i(e,i,n,r,o){this.size=n,t.call(this,e,i,this._regenerateVertexData(),r,o)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null)},i}(r);i.Box=o;var s=function(t){function i(e,i,n,r,o,s){this.segments=n,this.diameter=r,t.call(this,e,i,this._regenerateVertexData(),o,s)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null)},i}(r);i.Sphere=s;var a=function(t){function i(e,i,n,r,o,s,a,h,c){"undefined"==typeof a&&(a=1),this.height=n,this.diameterTop=r,this.diameterBottom=o,this.tessellation=s,this.subdivisions=a,t.call(this,e,i,this._regenerateVertexData(),h,c)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Cylinder=a;var h=function(t){function i(e,i,n,r,o,s,a){this.diameter=n,this.thickness=r,this.tessellation=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null)},i}(r);i.Torus=h;var c=function(t){function i(e,i,n,r,o,s,a){this.width=n,this.height=r,this.subdivisions=o,t.call(this,e,i,this._regenerateVertexData(),s,a)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i}(r);i.Ground=c;var u=function(t){function i(e,i,n,r,o,s,a,h,c,u){this.xmin=n,this.zmin=r,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h,t.call(this,e,i,this._regenerateVertexData(),c,u)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=u;var l=function(t){function i(e,i,n,r,o){this.size=n,t.call(this,e,i,this._regenerateVertexData(),r,o)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null)},i}(r);i.Plane=l;var f=function(t){function i(e,i,n,r,o,s,a,h,c,u){this.radius=n,this.tube=r,this.radialSegments=o,this.tubularSegments=s,this.p=a,this.q=h,t.call(this,e,i,this._regenerateVertexData(),c,u)}return n(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q)},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null)},i}(r);i.TorusKnot=f}(t.Primitives||(t.Primitives={})),t.Primitives}(e.Geometry||(e.Geometry={}));var t=e.Geometry}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(){function t(e){var t=this;this.babylonGamepads=[],this.oneGamepadConnected=!1,this.isMonitoring=!1,this.gamepadEventSupported="GamepadEvent"in window,this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads,this.buttonADataURL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=",this._callbackGamepadConnected=e,this.gamepadSupportAvailable?(this.gamepadEventSupported?(window.addEventListener("gamepadconnected",function(e){t._onGamepadConnected(e)
},!1),window.addEventListener("gamepaddisconnected",function(e){t._onGamepadDisconnected(e)},!1)):this._startMonitoringGamepads(),this.oneGamepadConnected||this._insertGamepadDOMInstructions()):this._insertGamepadDOMNotSupported()}return t.prototype._insertGamepadDOMInstructions=function(){t.gamepadDOMInfo=document.createElement("div");var e=document.createElement("img");e.src=this.buttonADataURL;var i=document.createElement("span");i.innerHTML="<strong>to activate gamepad</strong>",t.gamepadDOMInfo.appendChild(e),t.gamepadDOMInfo.appendChild(i),t.gamepadDOMInfo.style.position="absolute",t.gamepadDOMInfo.style.width="100%",t.gamepadDOMInfo.style.height="48px",t.gamepadDOMInfo.style.bottom="0px",t.gamepadDOMInfo.style.backgroundColor="rgba(1, 1, 1, 0.15)",t.gamepadDOMInfo.style.textAlign="center",t.gamepadDOMInfo.style.zIndex="10",e.style.position="relative",e.style.bottom="8px",i.style.position="relative",i.style.fontSize="32px",i.style.bottom="32px",i.style.color="green",document.body.appendChild(t.gamepadDOMInfo)},t.prototype._insertGamepadDOMNotSupported=function(){t.gamepadDOMInfo=document.createElement("div");var e=document.createElement("span");e.innerHTML="<strong>gamepad not supported</strong>",t.gamepadDOMInfo.appendChild(e),t.gamepadDOMInfo.style.position="absolute",t.gamepadDOMInfo.style.width="100%",t.gamepadDOMInfo.style.height="40px",t.gamepadDOMInfo.style.bottom="0px",t.gamepadDOMInfo.style.backgroundColor="rgba(1, 1, 1, 0.15)",t.gamepadDOMInfo.style.textAlign="center",t.gamepadDOMInfo.style.zIndex="10",e.style.position="relative",e.style.fontSize="32px",e.style.color="red",document.body.appendChild(t.gamepadDOMInfo)},t.prototype.dispose=function(){document.body.removeChild(t.gamepadDOMInfo)},t.prototype._onGamepadConnected=function(e){var t=this._addNewGamepad(e.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(t),this._startMonitoringGamepads()},t.prototype._addNewGamepad=function(i){this.oneGamepadConnected||(this.oneGamepadConnected=!0,t.gamepadDOMInfo&&(document.body.removeChild(t.gamepadDOMInfo),t.gamepadDOMInfo=null));var n;return n=-1!==i.id.search("Xbox 360")||-1!==i.id.search("xinput")?new e.Xbox360Pad(i.id,i.index,i):new e.GenericPad(i.id,i.index,i),this.babylonGamepads.push(n),n},t.prototype._onGamepadDisconnected=function(e){for(var t in this.babylonGamepads)if(this.babylonGamepads[t].index==e.gamepad.index){this.babylonGamepads.splice(t,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},t.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},t.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},t.prototype._checkGamepadsStatus=function(){var e=this;this._updateGamepadObjects();for(var t in this.babylonGamepads)this.babylonGamepads[t].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){e._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){e._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){e._checkGamepadsStatus()}))},t.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)if(e[t])if(e[t].index in this.babylonGamepads)this.babylonGamepads[t].browserGamepad=e[t];else{var i=this._addNewGamepad(e[t]);this._callbackGamepadConnected&&this._callbackGamepadConnected(i)}},t}();e.Gamepads=t;var i=function(){function e(e,t){this.x=e,this.y=t}return e}();e.StickValues=i;var r=function(){function e(e,t,i){this.id=e,this.index=t,this.browserGamepad=i,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},e}();e.Gamepad=r;var o=function(e){function t(t,i,n){e.call(this,t,i,n),this.id=t,this.index=i,this.gamepad=n,this._buttons=new Array(n.buttons.length)}return n(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.gamepad.buttons[t].value,this._buttons[t],t)},t}(r);e.GenericPad=o,function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(e.Xbox360Button||(e.Xbox360Button={})),e.Xbox360Button,!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(e.Xbox360Dpad||(e.Xbox360Dpad={}));var s=(e.Xbox360Dpad,function(e){function t(){e.apply(this,arguments),this._leftTrigger=0,this._rightTrigger=0,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0}return n(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype._setDPadValue=function(e,t,i){return e!==t&&(this._ondpaddown&&1===e&&this._ondpaddown(i),this._ondpadup&&0===e&&this._ondpadup(i)),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,4)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,5)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,6)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,7)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,8)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,9)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,3)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t}(r));e.Xbox360Pad=s}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r){var o=this;t.call(this,i,n,r),this.angularSensibility=200,this.moveSensibility=75,this._gamepads=new e.Gamepads(function(e){o._onNewGameConnected(e)})}return n(i,t),i.prototype._onNewGameConnected=function(e){0===e.index&&(this._gamepad=e)},i.prototype._checkInputs=function(){if(this._gamepad){var t=this._gamepad.leftStick,i=t.x/this.moveSensibility,n=t.y/this.moveSensibility;t.x=Math.abs(i)>.005?0+i:0,t.y=Math.abs(n)>.005?0+n:0;var r=this._gamepad.rightStick,o=r.x/this.angularSensibility,s=r.y/this.angularSensibility;r.x=Math.abs(o)>.001?0+o:0,r.y=Math.abs(s)>.001?0+s:0;var a=e.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),h=e.Vector3.TransformCoordinates(new e.Vector3(t.x,0,-t.y),a);this.cameraDirection=this.cameraDirection.add(h),this.cameraRotation=this.cameraRotation.add(new e.Vector3(r.y,r.x,0))}},i.prototype.dispose=function(){this._gamepads.dispose()},i}(e.FreeCamera);e.GamepadCamera=t}(i||(i={}));var i,n=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};!function(e){var t=function(t){function i(i,n,r){"undefined"==typeof r&&(r=!1),t.call(this,i,n),this.color=new e.Color3(1,1,1),this._indices=new Array,this._colorShader=new e.ShaderMaterial("colorShader",n,"color",{attributes:["position"],uniforms:["worldViewProjection","color"]})}return n(i,t),Object.defineProperty(i.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPickable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(){var t=this.getScene().getEngine(),i=this._geometry.getIndexBuffer();t.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),i,[3],12,this._colorShader.getEffect()),this._colorShader.setColor3("color",this.color)},i.prototype._draw=function(e){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var t=this.getScene().getEngine();t.draw(!1,e.indexStart,e.indexCount)}},i.prototype.intersects=function(){return null},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i}(e.Mesh);e.LinesMesh=t}(i||(i={})),t.exports=i},{}],jQuery:[function(e,t){!function(e,i){"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?i(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(e)}("undefined"!=typeof window?window:this,function(e,t){function i(e){var t=e.length,i=rt.type(e);return"function"===i||rt.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e}function n(e,t,i){if(rt.isFunction(t))return rt.grep(e,function(e,n){return!!t.call(e,n,e)!==i});if(t.nodeType)return rt.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(ft.test(t))return rt.filter(t,e,i);t=rt.filter(t,e)}return rt.grep(e,function(e){return rt.inArray(e,t)>=0!==i})}function r(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function o(e){var t=xt[e]={};return rt.each(e.match(yt)||[],function(e,i){t[i]=!0}),t}function s(){dt.addEventListener?(dt.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1)):(dt.detachEvent("onreadystatechange",a),e.detachEvent("onload",a))}function a(){(dt.addEventListener||"load"===event.type||"complete"===dt.readyState)&&(s(),rt.ready())}function h(e,t,i){if(void 0===i&&1===e.nodeType){var n="data-"+t.replace(Et,"-$1").toLowerCase();if(i=e.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:Mt.test(i)?rt.parseJSON(i):i}catch(r){}rt.data(e,t,i)}else i=void 0}return i}function c(e){var t;for(t in e)if(("data"!==t||!rt.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function u(e,t,i,n){if(rt.acceptData(e)){var r,o,s=rt.expando,a=e.nodeType,h=a?rt.cache:e,c=a?e[s]:e[s]&&s;if(c&&h[c]&&(n||h[c].data)||void 0!==i||"string"!=typeof t)return c||(c=a?e[s]=q.pop()||rt.guid++:s),h[c]||(h[c]=a?{}:{toJSON:rt.noop}),("object"==typeof t||"function"==typeof t)&&(n?h[c]=rt.extend(h[c],t):h[c].data=rt.extend(h[c].data,t)),o=h[c],n||(o.data||(o.data={}),o=o.data),void 0!==i&&(o[rt.camelCase(t)]=i),"string"==typeof t?(r=o[t],null==r&&(r=o[rt.camelCase(t)])):r=o,r}}function l(e,t,i){if(rt.acceptData(e)){var n,r,o=e.nodeType,s=o?rt.cache:e,a=o?e[rt.expando]:rt.expando;if(s[a]){if(t&&(n=i?s[a]:s[a].data)){rt.isArray(t)?t=t.concat(rt.map(t,rt.camelCase)):t in n?t=[t]:(t=rt.camelCase(t),t=t in n?[t]:t.split(" ")),r=t.length;for(;r--;)delete n[t[r]];if(i?!c(n):!rt.isEmptyObject(n))return}(i||(delete s[a].data,c(s[a])))&&(o?rt.cleanData([e],!0):it.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function f(){return!0}function p(){return!1}function d(){try{return dt.activeElement}catch(e){}}function m(e){var t=Bt.split("|"),i=e.createDocumentFragment();if(i.createElement)for(;t.length;)i.createElement(t.pop());return i}function g(e,t){var i,n,r=0,o=typeof e.getElementsByTagName!==wt?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==wt?e.querySelectorAll(t||"*"):void 0;if(!o)for(o=[],i=e.childNodes||e;null!=(n=i[r]);r++)!t||rt.nodeName(n,t)?o.push(n):rt.merge(o,g(n,t));return void 0===t||t&&rt.nodeName(e,t)?rt.merge([e],o):o}function _(e){Dt.test(e.type)&&(e.defaultChecked=e.checked)}function v(e,t){return rt.nodeName(e,"table")&&rt.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function y(e){return e.type=(null!==rt.find.attr(e,"type"))+"/"+e.type,e}function x(e){var t=Yt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function b(e,t){for(var i,n=0;null!=(i=e[n]);n++)rt._data(i,"globalEval",!t||rt._data(t[n],"globalEval"))}function T(e,t){if(1===t.nodeType&&rt.hasData(e)){var i,n,r,o=rt._data(e),s=rt._data(t,o),a=o.events;if(a){delete s.handle,s.events={};for(i in a)for(n=0,r=a[i].length;r>n;n++)rt.event.add(t,i,a[i][n])}s.data&&(s.data=rt.extend({},s.data))}}function w(e,t){var i,n,r;if(1===t.nodeType){if(i=t.nodeName.toLowerCase(),!it.noCloneEvent&&t[rt.expando]){r=rt._data(t);for(n in r.events)rt.removeEvent(t,n,r.handle);t.removeAttribute(rt.expando)}"script"===i&&t.text!==e.text?(y(t).text=e.text,x(t)):"object"===i?(t.parentNode&&(t.outerHTML=e.outerHTML),it.html5Clone&&e.innerHTML&&!rt.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&Dt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.defaultSelected=t.selected=e.defaultSelected:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}}function M(t,i){var n,r=rt(i.createElement(t)).appendTo(i.body),o=e.getDefaultComputedStyle&&(n=e.getDefaultComputedStyle(r[0]))?n.display:rt.css(r[0],"display");return r.detach(),o}function E(e){var t=dt,i=$t[e];return i||(i=M(e,t),"none"!==i&&i||(Jt=(Jt||rt("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Jt[0].contentWindow||Jt[0].contentDocument).document,t.write(),t.close(),i=M(e,t),Jt.detach()),$t[e]=i),i}function A(e,t){return{get:function(){var i=e();if(null!=i)return i?void delete this.get:(this.get=t).apply(this,arguments)}}}function P(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),n=t,r=fi.length;r--;)if(t=fi[r]+i,t in e)return t;return n}function S(e,t){for(var i,n,r,o=[],s=0,a=e.length;a>s;s++)n=e[s],n.style&&(o[s]=rt._data(n,"olddisplay"),i=n.style.display,t?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&St(n)&&(o[s]=rt._data(n,"olddisplay",E(n.nodeName)))):(r=St(n),(i&&"none"!==i||!r)&&rt._data(n,"olddisplay",r?i:rt.css(n,"display"))));for(s=0;a>s;s++)n=e[s],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[s]||"":"none"));return e}function C(e,t,i){var n=hi.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function D(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===i&&(s+=rt.css(e,i+Pt[o],!0,r)),n?("content"===i&&(s-=rt.css(e,"padding"+Pt[o],!0,r)),"margin"!==i&&(s-=rt.css(e,"border"+Pt[o]+"Width",!0,r))):(s+=rt.css(e,"padding"+Pt[o],!0,r),"padding"!==i&&(s+=rt.css(e,"border"+Pt[o]+"Width",!0,r)));return s}function I(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=ei(e),s=it.boxSizing&&"border-box"===rt.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=ti(e,t,o),(0>r||null==r)&&(r=e.style[t]),ni.test(r))return r;n=s&&(it.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+D(e,t,i||(s?"border":"content"),n,o)+"px"}function R(e,t,i,n,r){return new R.prototype.init(e,t,i,n,r)}function L(){return setTimeout(function(){pi=void 0}),pi=rt.now()}function O(e,t){var i,n={height:e},r=0;for(t=t?1:0;4>r;r+=2-t)i=Pt[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function V(e,t,i){for(var n,r=(yi[t]||[]).concat(yi["*"]),o=0,s=r.length;s>o;o++)if(n=r[o].call(i,t,e))return n}function B(e,t,i){var n,r,o,s,a,h,c,u,l=this,f={},p=e.style,d=e.nodeType&&St(e),m=rt._data(e,"fxshow");i.queue||(a=rt._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,h=a.empty.fire,a.empty.fire=function(){a.unqueued||h()}),a.unqueued++,l.always(function(){l.always(function(){a.unqueued--,rt.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],c=rt.css(e,"display"),u="none"===c?rt._data(e,"olddisplay")||E(e.nodeName):c,"inline"===u&&"none"===rt.css(e,"float")&&(it.inlineBlockNeedsLayout&&"inline"!==E(e.nodeName)?p.zoom=1:p.display="inline-block")),i.overflow&&(p.overflow="hidden",it.shrinkWrapBlocks()||l.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}));for(n in t)if(r=t[n],mi.exec(r)){if(delete t[n],o=o||"toggle"===r,r===(d?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;d=!0}f[n]=m&&m[n]||rt.style(e,n)}else c=void 0;if(rt.isEmptyObject(f))"inline"===("none"===c?E(e.nodeName):c)&&(p.display=c);else{m?"hidden"in m&&(d=m.hidden):m=rt._data(e,"fxshow",{}),o&&(m.hidden=!d),d?rt(e).show():l.done(function(){rt(e).hide()}),l.done(function(){var t;rt._removeData(e,"fxshow");for(t in f)rt.style(e,t,f[t])});for(n in f)s=V(d?m[n]:0,n,l),n in m||(m[n]=s.start,d&&(s.end=s.start,s.start="width"===n||"height"===n?1:0))}}function F(e,t){var i,n,r,o,s;for(i in e)if(n=rt.camelCase(i),r=t[n],o=e[i],rt.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),s=rt.cssHooks[n],s&&"expand"in s){o=s.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function k(e,t,i){var n,r,o=0,s=vi.length,a=rt.Deferred().always(function(){delete h.elem}),h=function(){if(r)return!1;for(var t=pi||L(),i=Math.max(0,c.startTime+c.duration-t),n=i/c.duration||0,o=1-n,s=0,h=c.tweens.length;h>s;s++)c.tweens[s].run(o);return a.notifyWith(e,[c,o,i]),1>o&&h?i:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:rt.extend({},t),opts:rt.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:pi||L(),duration:i.duration,tweens:[],createTween:function(t,i){var n=rt.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var i=0,n=t?c.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)c.tweens[i].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),u=c.props;for(F(u,c.opts.specialEasing);s>o;o++)if(n=vi[o].call(c,e,u,c.opts))return n;return rt.map(u,V,c),rt.isFunction(c.opts.start)&&c.opts.start.call(e,c),rt.fx.timer(rt.extend(h,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function N(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(yt)||[];if(rt.isFunction(i))for(;n=o[r++];)"+"===n.charAt(0)?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function z(e,t,i,n){function r(a){var h;return o[a]=!0,rt.each(e[a]||[],function(e,a){var c=a(t,i,n);return"string"!=typeof c||s||o[c]?s?!(h=c):void 0:(t.dataTypes.unshift(c),r(c),!1)}),h}var o={},s=e===Gi;return r(t.dataTypes[0])||!o["*"]&&r("*")}function U(e,t){var i,n,r=rt.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i||(i={}))[n]=t[n]);return i&&rt.extend(!0,e,i),e}function W(e,t,i){for(var n,r,o,s,a=e.contents,h=e.dataTypes;"*"===h[0];)h.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(s in a)if(a[s]&&a[s].test(r)){h.unshift(s);break}if(h[0]in i)o=h[0];else{for(s in i){if(!h[0]||e.converters[s+" "+h[0]]){o=s;break}n||(n=s)}o=o||n}return o?(o!==h[0]&&h.unshift(o),i[o]):void 0}function G(e,t,i,n){var r,o,s,a,h,c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(o=u.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!h&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),h=o,o=u.shift())if("*"===o)o=h;else if("*"!==h&&h!==o){if(s=c[h+" "+o]||c["* "+o],!s)for(r in c)if(a=r.split(" "),a[1]===o&&(s=c[h+" "+a[0]]||c["* "+a[0]])){s===!0?s=c[r]:c[r]!==!0&&(o=a[0],u.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(l){return{state:"parsererror",error:s?l:"No conversion from "+h+" to "+o}}}return{state:"success",data:t}}function j(e,t,i,n){var r;if(rt.isArray(t))rt.each(t,function(t,r){i||Yi.test(e)?n(e,r):j(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==rt.type(t))n(e,t);else for(r in t)j(e+"["+r+"]",t[r],i,n)}function H(){try{return new e.XMLHttpRequest}catch(t){}}function X(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Y(e){return rt.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var q=[],K=q.slice,Z=q.concat,Q=q.push,J=q.indexOf,$={},et=$.toString,tt=$.hasOwnProperty,it={},nt="1.11.2",rt=function(e,t){return new rt.fn.init(e,t)},ot=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,st=/^-ms-/,at=/-([\da-z])/gi,ht=function(e,t){return t.toUpperCase()};rt.fn=rt.prototype={jquery:nt,constructor:rt,selector:"",length:0,toArray:function(){return K.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:K.call(this)},pushStack:function(e){var t=rt.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return rt.each(this,e,t)},map:function(e){return this.pushStack(rt.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(K.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:Q,sort:q.sort,splice:q.splice},rt.extend=rt.fn.extend=function(){var e,t,i,n,r,o,s=arguments[0]||{},a=1,h=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||rt.isFunction(s)||(s={}),a===h&&(s=this,a--);h>a;a++)if(null!=(r=arguments[a]))for(n in r)e=s[n],i=r[n],s!==i&&(c&&i&&(rt.isPlainObject(i)||(t=rt.isArray(i)))?(t?(t=!1,o=e&&rt.isArray(e)?e:[]):o=e&&rt.isPlainObject(e)?e:{},s[n]=rt.extend(c,o,i)):void 0!==i&&(s[n]=i));return s},rt.extend({expando:"jQuery"+(nt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===rt.type(e)},isArray:Array.isArray||function(e){return"array"===rt.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!rt.isArray(e)&&e-parseFloat(e)+1>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==rt.type(e)||e.nodeType||rt.isWindow(e))return!1;try{if(e.constructor&&!tt.call(e,"constructor")&&!tt.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}if(it.ownLast)for(t in e)return tt.call(e,t);for(t in e);return void 0===t||tt.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?$[et.call(e)]||"object":typeof e},globalEval:function(t){t&&rt.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(st,"ms-").replace(at,ht)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,s=e.length,a=i(e);if(n){if(a)for(;s>o&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(a)for(;s>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ot,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?rt.merge(n,"string"==typeof e?[e]:e):Q.call(n,e)),n},inArray:function(e,t,i){var n;if(t){if(J)return J.call(t,e,i);for(n=t.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;i>n;)e[r++]=t[n++];if(i!==i)for(;void 0!==t[n];)e[r++]=t[n++];return e.length=r,e},grep:function(e,t,i){for(var n,r=[],o=0,s=e.length,a=!i;s>o;o++)n=!t(e[o],o),n!==a&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,s=e.length,a=i(e),h=[];if(a)for(;s>o;o++)r=t(e[o],o,n),null!=r&&h.push(r);else for(o in e)r=t(e[o],o,n),null!=r&&h.push(r);return Z.apply([],h)},guid:1,proxy:function(e,t){var i,n,r;return"string"==typeof t&&(r=e[t],t=e,e=r),rt.isFunction(e)?(i=K.call(arguments,2),n=function(){return e.apply(t||this,i.concat(K.call(arguments)))},n.guid=e.guid=e.guid||rt.guid++,n):void 0},now:function(){return+new Date},support:it}),rt.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){$["[object "+t+"]"]=t.toLowerCase()});var ct=function(e){function t(e,t,i,n){var r,o,s,a,h,c,l,p,d,m;if((t?t.ownerDocument||t:z)!==R&&I(t),t=t||R,i=i||[],a=t.nodeType,"string"!=typeof e||!e||1!==a&&9!==a&&11!==a)return i;if(!n&&O){if(11!==a&&(r=vt.exec(e)))if(s=r[1]){if(9===a){if(o=t.getElementById(s),!o||!o.parentNode)return i;if(o.id===s)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&k(t,o)&&o.id===s)return i.push(o),i}else{if(r[2])return J.apply(i,t.getElementsByTagName(e)),i;if((s=r[3])&&b.getElementsByClassName)return J.apply(i,t.getElementsByClassName(s)),i}if(b.qsa&&(!V||!V.test(e))){if(p=l=N,d=t,m=1!==a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=E(e),(l=t.getAttribute("id"))?p=l.replace(xt,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",h=c.length;h--;)c[h]=p+f(c[h]);d=yt.test(e)&&u(t.parentNode)||t,m=c.join(",")}if(m)try{return J.apply(i,d.querySelectorAll(m)),i}catch(g){}finally{l||t.removeAttribute("id")}}}return P(e.replace(ht,"$1"),t,i,n)}function i(){function e(i,n){return t.push(i+" ")>T.cacheLength&&delete e[t.shift()],e[i+" "]=n}var t=[];return e}function n(e){return e[N]=!0,e}function r(e){var t=R.createElement("div");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var i=e.split("|"),n=e.length;n--;)T.attrHandle[i[n]]=t}function s(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function a(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function h(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function c(e){return n(function(t){return t=+t,n(function(i,n){for(var r,o=e([],i.length,t),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function l(){}function f(e){for(var t=0,i=e.length,n="";i>t;t++)n+=e[t].value;return n}function p(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=W++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,s){var a,h,c=[U,o];if(s){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,s))return!0}else for(;t=t[n];)if(1===t.nodeType||r){if(h=t[N]||(t[N]={}),(a=h[n])&&a[0]===U&&a[1]===o)return c[2]=a[2];if(h[n]=c,c[2]=e(t,i,s))return!0}}}function d(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function m(e,i,n){for(var r=0,o=i.length;o>r;r++)t(e,i[r],n);return n}function g(e,t,i,n,r){for(var o,s=[],a=0,h=e.length,c=null!=t;h>a;a++)(o=e[a])&&(!i||i(o,n,r))&&(s.push(o),c&&t.push(a));return s}function _(e,t,i,r,o,s){return r&&!r[N]&&(r=_(r)),o&&!o[N]&&(o=_(o,s)),n(function(n,s,a,h){var c,u,l,f=[],p=[],d=s.length,_=n||m(t||"*",a.nodeType?[a]:a,[]),v=!e||!n&&t?_:g(_,f,e,a,h),y=i?o||(n?e:d||r)?[]:s:v;if(i&&i(v,y,a,h),r)for(c=g(y,p),r(c,[],a,h),u=c.length;u--;)(l=c[u])&&(y[p[u]]=!(v[p[u]]=l));
if(n){if(o||e){if(o){for(c=[],u=y.length;u--;)(l=y[u])&&c.push(v[u]=l);o(null,y=[],c,h)}for(u=y.length;u--;)(l=y[u])&&(c=o?et(n,l):f[u])>-1&&(n[c]=!(s[c]=l))}}else y=g(y===s?y.splice(d,y.length):y),o?o(null,s,y,h):J.apply(s,y)})}function v(e){for(var t,i,n,r=e.length,o=T.relative[e[0].type],s=o||T.relative[" "],a=o?1:0,h=p(function(e){return e===t},s,!0),c=p(function(e){return et(t,e)>-1},s,!0),u=[function(e,i,n){var r=!o&&(n||i!==S)||((t=i).nodeType?h(e,i,n):c(e,i,n));return t=null,r}];r>a;a++)if(i=T.relative[e[a].type])u=[p(d(u),i)];else{if(i=T.filter[e[a].type].apply(null,e[a].matches),i[N]){for(n=++a;r>n&&!T.relative[e[n].type];n++);return _(a>1&&d(u),a>1&&f(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(ht,"$1"),i,n>a&&v(e.slice(a,n)),r>n&&v(e=e.slice(n)),r>n&&f(e))}u.push(i)}return d(u)}function y(e,i){var r=i.length>0,o=e.length>0,s=function(n,s,a,h,c){var u,l,f,p=0,d="0",m=n&&[],_=[],v=S,y=n||o&&T.find.TAG("*",c),x=U+=null==v?1:Math.random()||.1,b=y.length;for(c&&(S=s!==R&&s);d!==b&&null!=(u=y[d]);d++){if(o&&u){for(l=0;f=e[l++];)if(f(u,s,a)){h.push(u);break}c&&(U=x)}r&&((u=!f&&u)&&p--,n&&m.push(u))}if(p+=d,r&&d!==p){for(l=0;f=i[l++];)f(m,_,s,a);if(n){if(p>0)for(;d--;)m[d]||_[d]||(_[d]=Z.call(h));_=g(_)}J.apply(h,_),c&&!n&&_.length>0&&p+i.length>1&&t.uniqueSort(h)}return c&&(U=x,S=v),m};return r?n(s):s}var x,b,T,w,M,E,A,P,S,C,D,I,R,L,O,V,B,F,k,N="sizzle"+1*new Date,z=e.document,U=0,W=0,G=i(),j=i(),H=i(),X=function(e,t){return e===t&&(D=!0),0},Y=1<<31,q={}.hasOwnProperty,K=[],Z=K.pop,Q=K.push,J=K.push,$=K.slice,et=function(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1},tt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",rt=nt.replace("w","w#"),ot="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+rt+"))|)"+it+"*\\]",st=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ot+")*)|.*)\\)|)",at=new RegExp(it+"+","g"),ht=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),ct=new RegExp("^"+it+"*,"+it+"*"),ut=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),lt=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),ft=new RegExp(st),pt=new RegExp("^"+rt+"$"),dt={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt.replace("w","w*")+")"),ATTR:new RegExp("^"+ot),PSEUDO:new RegExp("^"+st),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+tt+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},mt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,_t=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,xt=/'|\\/g,bt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),Tt=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},wt=function(){I()};try{J.apply(K=$.call(z.childNodes),z.childNodes),K[z.childNodes.length].nodeType}catch(Mt){J={apply:K.length?function(e,t){Q.apply(e,$.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}b=t.support={},M=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},I=t.setDocument=function(e){var t,i,n=e?e.ownerDocument||e:z;return n!==R&&9===n.nodeType&&n.documentElement?(R=n,L=n.documentElement,i=n.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),O=!M(n),b.attributes=r(function(e){return e.className="i",!e.getAttribute("className")}),b.getElementsByTagName=r(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),b.getElementsByClassName=_t.test(n.getElementsByClassName),b.getById=r(function(e){return L.appendChild(e).id=N,!n.getElementsByName||!n.getElementsByName(N).length}),b.getById?(T.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&O){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},T.filter.ID=function(e){var t=e.replace(bt,Tt);return function(e){return e.getAttribute("id")===t}}):(delete T.find.ID,T.filter.ID=function(e){var t=e.replace(bt,Tt);return function(e){var i="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}}),T.find.TAG=b.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):b.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},T.find.CLASS=b.getElementsByClassName&&function(e,t){return O?t.getElementsByClassName(e):void 0},B=[],V=[],(b.qsa=_t.test(n.querySelectorAll))&&(r(function(e){L.appendChild(e).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&V.push("[*^$]="+it+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||V.push("\\["+it+"*(?:value|"+tt+")"),e.querySelectorAll("[id~="+N+"-]").length||V.push("~="),e.querySelectorAll(":checked").length||V.push(":checked"),e.querySelectorAll("a#"+N+"+*").length||V.push(".#.+[+~]")}),r(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&V.push("name"+it+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||V.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),V.push(",.*:")})),(b.matchesSelector=_t.test(F=L.matches||L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&r(function(e){b.disconnectedMatch=F.call(e,"div"),F.call(e,"[s!='']:x"),B.push("!=",st)}),V=V.length&&new RegExp(V.join("|")),B=B.length&&new RegExp(B.join("|")),t=_t.test(L.compareDocumentPosition),k=t||_t.test(L.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},X=t?function(e,t){if(e===t)return D=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!b.sortDetached&&t.compareDocumentPosition(e)===i?e===n||e.ownerDocument===z&&k(z,e)?-1:t===n||t.ownerDocument===z&&k(z,t)?1:C?et(C,e)-et(C,t):0:4&i?-1:1)}:function(e,t){if(e===t)return D=!0,0;var i,r=0,o=e.parentNode,a=t.parentNode,h=[e],c=[t];if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:C?et(C,e)-et(C,t):0;if(o===a)return s(e,t);for(i=e;i=i.parentNode;)h.unshift(i);for(i=t;i=i.parentNode;)c.unshift(i);for(;h[r]===c[r];)r++;return r?s(h[r],c[r]):h[r]===z?-1:c[r]===z?1:0},n):R},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==R&&I(e),i=i.replace(lt,"='$1']"),!(!b.matchesSelector||!O||B&&B.test(i)||V&&V.test(i)))try{var n=F.call(e,i);if(n||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return t(i,R,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==R&&I(e),k(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==R&&I(e);var i=T.attrHandle[t.toLowerCase()],n=i&&q.call(T.attrHandle,t.toLowerCase())?i(e,t,!O):void 0;return void 0!==n?n:b.attributes||!O?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],n=0,r=0;if(D=!b.detectDuplicates,C=!b.sortStable&&e.slice(0),e.sort(X),D){for(;t=e[r++];)t===e[r]&&(n=i.push(r));for(;n--;)e.splice(i[n],1)}return C=null,e},w=t.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=w(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n++];)i+=w(t);return i},T=t.selectors={cacheLength:50,createPseudo:n,match:dt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(bt,Tt),e[3]=(e[3]||e[4]||e[5]||"").replace(bt,Tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return dt.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ft.test(i)&&(t=E(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(bt,Tt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=G[e+" "];return t||(t=new RegExp("(^|"+it+")"+e+"("+it+"|$)"))&&G(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(r){var o=t.attr(r,e);return null==o?"!="===i:i?(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o.replace(at," ")+" ").indexOf(n)>-1:"|="===i?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,h){var c,u,l,f,p,d,m=o!==s?"nextSibling":"previousSibling",g=t.parentNode,_=a&&t.nodeName.toLowerCase(),v=!h&&!a;if(g){if(o){for(;m;){for(l=t;l=l[m];)if(a?l.nodeName.toLowerCase()===_:1===l.nodeType)return!1;d=m="only"===e&&!d&&"nextSibling"}return!0}if(d=[s?g.firstChild:g.lastChild],s&&v){for(u=g[N]||(g[N]={}),c=u[e]||[],p=c[0]===U&&c[1],f=c[0]===U&&c[2],l=p&&g.childNodes[p];l=++p&&l&&l[m]||(f=p=0)||d.pop();)if(1===l.nodeType&&++f&&l===t){u[e]=[U,p,f];break}}else if(v&&(c=(t[N]||(t[N]={}))[e])&&c[0]===U)f=c[1];else for(;(l=++p&&l&&l[m]||(f=p=0)||d.pop())&&((a?l.nodeName.toLowerCase()!==_:1!==l.nodeType)||!++f||(v&&((l[N]||(l[N]={}))[e]=[U,f]),l!==t)););return f-=r,f===n||f%n===0&&f/n>=0}}},PSEUDO:function(e,i){var r,o=T.pseudos[e]||T.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[N]?o(i):o.length>1?(r=[e,e,"",i],T.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n,r=o(e,i),s=r.length;s--;)n=et(e,r[s]),e[n]=!(t[n]=r[s])}):function(e){return o(e,0,r)}):o}},pseudos:{not:n(function(e){var t=[],i=[],r=A(e.replace(ht,"$1"));return r[N]?n(function(e,t,i,n){for(var o,s=r(e,null,n,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,n,o){return t[0]=e,r(t,null,o,i),t[0]=null,!i.pop()}}),has:n(function(e){return function(i){return t(e,i).length>0}}),contains:n(function(e){return e=e.replace(bt,Tt),function(t){return(t.textContent||t.innerText||w(t)).indexOf(e)>-1}}),lang:n(function(e){return pt.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(bt,Tt).toLowerCase(),function(t){var i;do if(i=O?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===L},focus:function(e){return e===R.activeElement&&(!R.hasFocus||R.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!T.pseudos.empty(e)},header:function(e){return gt.test(e.nodeName)},input:function(e){return mt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,i){return[0>i?i+t:i]}),even:c(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:c(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:c(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:c(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}},T.pseudos.nth=T.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})T.pseudos[x]=a(x);for(x in{submit:!0,reset:!0})T.pseudos[x]=h(x);return l.prototype=T.filters=T.pseudos,T.setFilters=new l,E=t.tokenize=function(e,i){var n,r,o,s,a,h,c,u=j[e+" "];if(u)return i?0:u.slice(0);for(a=e,h=[],c=T.preFilter;a;){(!n||(r=ct.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),h.push(o=[])),n=!1,(r=ut.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(ht," ")}),a=a.slice(n.length));for(s in T.filter)!(r=dt[s].exec(a))||c[s]&&!(r=c[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?t.error(e):j(e,h).slice(0)},A=t.compile=function(e,t){var i,n=[],r=[],o=H[e+" "];if(!o){for(t||(t=E(e)),i=t.length;i--;)o=v(t[i]),o[N]?n.push(o):r.push(o);o=H(e,y(r,n)),o.selector=e}return o},P=t.select=function(e,t,i,n){var r,o,s,a,h,c="function"==typeof e&&e,l=!n&&E(e=c.selector||e);if(i=i||[],1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&b.getById&&9===t.nodeType&&O&&T.relative[o[1].type]){if(t=(T.find.ID(s.matches[0].replace(bt,Tt),t)||[])[0],!t)return i;c&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=dt.needsContext.test(e)?0:o.length;r--&&(s=o[r],!T.relative[a=s.type]);)if((h=T.find[a])&&(n=h(s.matches[0].replace(bt,Tt),yt.test(o[0].type)&&u(t.parentNode)||t))){if(o.splice(r,1),e=n.length&&f(o),!e)return J.apply(i,n),i;break}}return(c||A(e,l))(n,t,!O,i,yt.test(e)&&u(t.parentNode)||t),i},b.sortStable=N.split("").sort(X).join("")===N,b.detectDuplicates=!!D,I(),b.sortDetached=r(function(e){return 1&e.compareDocumentPosition(R.createElement("div"))}),r(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),b.attributes&&r(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),r(function(e){return null==e.getAttribute("disabled")})||o(tt,function(e,t,i){var n;return i?void 0:e[t]===!0?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),t}(e);rt.find=ct,rt.expr=ct.selectors,rt.expr[":"]=rt.expr.pseudos,rt.unique=ct.uniqueSort,rt.text=ct.getText,rt.isXMLDoc=ct.isXML,rt.contains=ct.contains;var ut=rt.expr.match.needsContext,lt=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ft=/^.[^:#\[\.,]*$/;rt.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?rt.find.matchesSelector(n,e)?[n]:[]:rt.find.matches(e,rt.grep(t,function(e){return 1===e.nodeType}))},rt.fn.extend({find:function(e){var t,i=[],n=this,r=n.length;if("string"!=typeof e)return this.pushStack(rt(e).filter(function(){for(t=0;r>t;t++)if(rt.contains(n[t],this))return!0}));for(t=0;r>t;t++)rt.find(e,n[t],i);return i=this.pushStack(r>1?rt.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(n(this,e||[],!1))},not:function(e){return this.pushStack(n(this,e||[],!0))},is:function(e){return!!n(this,"string"==typeof e&&ut.test(e)?rt(e):e||[],!1).length}});var pt,dt=e.document,mt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,gt=rt.fn.init=function(e,t){var i,n;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:mt.exec(e),!i||!i[1]&&t)return!t||t.jquery?(t||pt).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof rt?t[0]:t,rt.merge(this,rt.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:dt,!0)),lt.test(i[1])&&rt.isPlainObject(t))for(i in t)rt.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}if(n=dt.getElementById(i[2]),n&&n.parentNode){if(n.id!==i[2])return pt.find(e);this.length=1,this[0]=n}return this.context=dt,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):rt.isFunction(e)?"undefined"!=typeof pt.ready?pt.ready(e):e(rt):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),rt.makeArray(e,this))};gt.prototype=rt.fn,pt=rt(dt);var _t=/^(?:parents|prev(?:Until|All))/,vt={children:!0,contents:!0,next:!0,prev:!0};rt.extend({dir:function(e,t,i){for(var n=[],r=e[t];r&&9!==r.nodeType&&(void 0===i||1!==r.nodeType||!rt(r).is(i));)1===r.nodeType&&n.push(r),r=r[t];return n},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}}),rt.fn.extend({has:function(e){var t,i=rt(e,this),n=i.length;return this.filter(function(){for(t=0;n>t;t++)if(rt.contains(this,i[t]))return!0})},closest:function(e,t){for(var i,n=0,r=this.length,o=[],s=ut.test(e)||"string"!=typeof e?rt(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&rt.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?rt.unique(o):o)},index:function(e){return e?"string"==typeof e?rt.inArray(this[0],rt(e)):rt.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(rt.unique(rt.merge(this.get(),rt(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),rt.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return rt.dir(e,"parentNode")},parentsUntil:function(e,t,i){return rt.dir(e,"parentNode",i)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return rt.dir(e,"nextSibling")},prevAll:function(e){return rt.dir(e,"previousSibling")},nextUntil:function(e,t,i){return rt.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return rt.dir(e,"previousSibling",i)},siblings:function(e){return rt.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return rt.sibling(e.firstChild)},contents:function(e){return rt.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:rt.merge([],e.childNodes)}},function(e,t){rt.fn[e]=function(i,n){var r=rt.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=rt.filter(n,r)),this.length>1&&(vt[e]||(r=rt.unique(r)),_t.test(e)&&(r=r.reverse())),this.pushStack(r)}});var yt=/\S+/g,xt={};rt.Callbacks=function(e){e="string"==typeof e?xt[e]||o(e):rt.extend({},e);var t,i,n,r,s,a,h=[],c=!e.once&&[],u=function(o){for(i=e.memory&&o,n=!0,s=a||0,a=0,r=h.length,t=!0;h&&r>s;s++)if(h[s].apply(o[0],o[1])===!1&&e.stopOnFalse){i=!1;break}t=!1,h&&(c?c.length&&u(c.shift()):i?h=[]:l.disable())},l={add:function(){if(h){var n=h.length;!function o(t){rt.each(t,function(t,i){var n=rt.type(i);"function"===n?e.unique&&l.has(i)||h.push(i):i&&i.length&&"string"!==n&&o(i)})}(arguments),t?r=h.length:i&&(a=n,u(i))}return this},remove:function(){return h&&rt.each(arguments,function(e,i){for(var n;(n=rt.inArray(i,h,n))>-1;)h.splice(n,1),t&&(r>=n&&r--,s>=n&&s--)}),this},has:function(e){return e?rt.inArray(e,h)>-1:!(!h||!h.length)},empty:function(){return h=[],r=0,this},disable:function(){return h=c=i=void 0,this},disabled:function(){return!h},lock:function(){return c=void 0,i||l.disable(),this},locked:function(){return!c},fireWith:function(e,i){return!h||n&&!c||(i=i||[],i=[e,i.slice?i.slice():i],t?c.push(i):u(i)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},rt.extend({Deferred:function(e){var t=[["resolve","done",rt.Callbacks("once memory"),"resolved"],["reject","fail",rt.Callbacks("once memory"),"rejected"],["notify","progress",rt.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return rt.Deferred(function(i){rt.each(t,function(t,o){var s=rt.isFunction(e[t])&&e[t];r[o[1]](function(){var e=s&&s.apply(this,arguments);e&&rt.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===n?i.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?rt.extend(e,n):n}},r={};return n.pipe=n.then,rt.each(t,function(e,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=K.call(arguments),s=o.length,a=1!==s||e&&rt.isFunction(e.promise)?s:0,h=1===a?e:rt.Deferred(),c=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?K.call(arguments):r,n===t?h.notifyWith(i,n):--a||h.resolveWith(i,n)}};if(s>1)for(t=new Array(s),i=new Array(s),n=new Array(s);s>r;r++)o[r]&&rt.isFunction(o[r].promise)?o[r].promise().done(c(r,n,o)).fail(h.reject).progress(c(r,i,t)):--a;return a||h.resolveWith(n,o),h.promise()}});var bt;rt.fn.ready=function(e){return rt.ready.promise().done(e),this},rt.extend({isReady:!1,readyWait:1,holdReady:function(e){e?rt.readyWait++:rt.ready(!0)},ready:function(e){if(e===!0?!--rt.readyWait:!rt.isReady){if(!dt.body)return setTimeout(rt.ready);rt.isReady=!0,e!==!0&&--rt.readyWait>0||(bt.resolveWith(dt,[rt]),rt.fn.triggerHandler&&(rt(dt).triggerHandler("ready"),rt(dt).off("ready")))}}}),rt.ready.promise=function(t){if(!bt)if(bt=rt.Deferred(),"complete"===dt.readyState)setTimeout(rt.ready);else if(dt.addEventListener)dt.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1);else{dt.attachEvent("onreadystatechange",a),e.attachEvent("onload",a);var i=!1;try{i=null==e.frameElement&&dt.documentElement}catch(n){}i&&i.doScroll&&!function r(){if(!rt.isReady){try{i.doScroll("left")}catch(e){return setTimeout(r,50)}s(),rt.ready()}}()}return bt.promise(t)};var Tt,wt="undefined";for(Tt in rt(it))break;it.ownLast="0"!==Tt,it.inlineBlockNeedsLayout=!1,rt(function(){var e,t,i,n;i=dt.getElementsByTagName("body")[0],i&&i.style&&(t=dt.createElement("div"),n=dt.createElement("div"),n.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(t),typeof t.style.zoom!==wt&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",it.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(i.style.zoom=1)),i.removeChild(n))}),function(){var e=dt.createElement("div");if(null==it.deleteExpando){it.deleteExpando=!0;try{delete e.test}catch(t){it.deleteExpando=!1}}e=null}(),rt.acceptData=function(e){var t=rt.noData[(e.nodeName+" ").toLowerCase()],i=+e.nodeType||1;return 1!==i&&9!==i?!1:!t||t!==!0&&e.getAttribute("classid")===t};var Mt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Et=/([A-Z])/g;rt.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?rt.cache[e[rt.expando]]:e[rt.expando],!!e&&!c(e)},data:function(e,t,i){return u(e,t,i)},removeData:function(e,t){return l(e,t)},_data:function(e,t,i){return u(e,t,i,!0)},_removeData:function(e,t){return l(e,t,!0)}}),rt.fn.extend({data:function(e,t){var i,n,r,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(r=rt.data(o),1===o.nodeType&&!rt._data(o,"parsedAttrs"))){for(i=s.length;i--;)s[i]&&(n=s[i].name,0===n.indexOf("data-")&&(n=rt.camelCase(n.slice(5)),h(o,n,r[n])));rt._data(o,"parsedAttrs",!0)}return r}return"object"==typeof e?this.each(function(){rt.data(this,e)}):arguments.length>1?this.each(function(){rt.data(this,e,t)}):o?h(o,e,rt.data(o,e)):void 0},removeData:function(e){return this.each(function(){rt.removeData(this,e)})}}),rt.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=rt._data(e,t),i&&(!n||rt.isArray(i)?n=rt._data(e,t,rt.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=rt.queue(e,t),n=i.length,r=i.shift(),o=rt._queueHooks(e,t),s=function(){rt.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return rt._data(e,i)||rt._data(e,i,{empty:rt.Callbacks("once memory").add(function(){rt._removeData(e,t+"queue"),rt._removeData(e,i)})})}}),rt.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?rt.queue(this[0],e):void 0===t?this:this.each(function(){var i=rt.queue(this,e,t);rt._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&rt.dequeue(this,e)})},dequeue:function(e){return this.each(function(){rt.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=rt.Deferred(),o=this,s=this.length,a=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)i=rt._data(o[s],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(t)}});var At=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Pt=["Top","Right","Bottom","Left"],St=function(e,t){return e=t||e,"none"===rt.css(e,"display")||!rt.contains(e.ownerDocument,e)},Ct=rt.access=function(e,t,i,n,r,o,s){var a=0,h=e.length,c=null==i;if("object"===rt.type(i)){r=!0;for(a in i)rt.access(e,t,a,i[a],!0,o,s)}else if(void 0!==n&&(r=!0,rt.isFunction(n)||(s=!0),c&&(s?(t.call(e,n),t=null):(c=t,t=function(e,t,i){return c.call(rt(e),i)})),t))for(;h>a;a++)t(e[a],i,s?n:n.call(e[a],a,t(e[a],i)));return r?e:c?t.call(e):h?t(e[0],i):o},Dt=/^(?:checkbox|radio)$/i;!function(){var e=dt.createElement("input"),t=dt.createElement("div"),i=dt.createDocumentFragment();if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",it.leadingWhitespace=3===t.firstChild.nodeType,it.tbody=!t.getElementsByTagName("tbody").length,it.htmlSerialize=!!t.getElementsByTagName("link").length,it.html5Clone="<:nav></:nav>"!==dt.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,i.appendChild(e),it.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",it.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,i.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",it.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,it.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){it.noCloneEvent=!1}),t.cloneNode(!0).click()),null==it.deleteExpando){it.deleteExpando=!0;try{delete t.test}catch(n){it.deleteExpando=!1}}}(),function(){var t,i,n=dt.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})i="on"+t,(it[t+"Bubbles"]=i in e)||(n.setAttribute(i,"t"),it[t+"Bubbles"]=n.attributes[i].expando===!1);n=null}();var It=/^(?:input|select|textarea)$/i,Rt=/^key/,Lt=/^(?:mouse|pointer|contextmenu)|click/,Ot=/^(?:focusinfocus|focusoutblur)$/,Vt=/^([^.]*)(?:\.(.+)|)$/;rt.event={global:{},add:function(e,t,i,n,r){var o,s,a,h,c,u,l,f,p,d,m,g=rt._data(e);if(g){for(i.handler&&(h=i,i=h.handler,r=h.selector),i.guid||(i.guid=rt.guid++),(s=g.events)||(s=g.events={}),(u=g.handle)||(u=g.handle=function(e){return typeof rt===wt||e&&rt.event.triggered===e.type?void 0:rt.event.dispatch.apply(u.elem,arguments)},u.elem=e),t=(t||"").match(yt)||[""],a=t.length;a--;)o=Vt.exec(t[a])||[],p=m=o[1],d=(o[2]||"").split(".").sort(),p&&(c=rt.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,c=rt.event.special[p]||{},l=rt.extend({type:p,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&rt.expr.match.needsContext.test(r),namespace:d.join(".")},h),(f=s[p])||(f=s[p]=[],f.delegateCount=0,c.setup&&c.setup.call(e,n,d,u)!==!1||(e.addEventListener?e.addEventListener(p,u,!1):e.attachEvent&&e.attachEvent("on"+p,u))),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=i.guid)),r?f.splice(f.delegateCount++,0,l):f.push(l),rt.event.global[p]=!0);e=null}},remove:function(e,t,i,n,r){var o,s,a,h,c,u,l,f,p,d,m,g=rt.hasData(e)&&rt._data(e);if(g&&(u=g.events)){for(t=(t||"").match(yt)||[""],c=t.length;c--;)if(a=Vt.exec(t[c])||[],p=m=a[1],d=(a[2]||"").split(".").sort(),p){for(l=rt.event.special[p]||{},p=(n?l.delegateType:l.bindType)||p,f=u[p]||[],a=a[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),h=o=f.length;o--;)s=f[o],!r&&m!==s.origType||i&&i.guid!==s.guid||a&&!a.test(s.namespace)||n&&n!==s.selector&&("**"!==n||!s.selector)||(f.splice(o,1),s.selector&&f.delegateCount--,l.remove&&l.remove.call(e,s));h&&!f.length&&(l.teardown&&l.teardown.call(e,d,g.handle)!==!1||rt.removeEvent(e,p,g.handle),delete u[p])}else for(p in u)rt.event.remove(e,p+t[c],i,n,!0);rt.isEmptyObject(u)&&(delete g.handle,rt._removeData(e,"events"))}},trigger:function(t,i,n,r){var o,s,a,h,c,u,l,f=[n||dt],p=tt.call(t,"type")?t.type:t,d=tt.call(t,"namespace")?t.namespace.split("."):[];if(a=u=n=n||dt,3!==n.nodeType&&8!==n.nodeType&&!Ot.test(p+rt.event.triggered)&&(p.indexOf(".")>=0&&(d=p.split("."),p=d.shift(),d.sort()),s=p.indexOf(":")<0&&"on"+p,t=t[rt.expando]?t:new rt.Event(p,"object"==typeof t&&t),t.isTrigger=r?2:3,t.namespace=d.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:rt.makeArray(i,[t]),c=rt.event.special[p]||{},r||!c.trigger||c.trigger.apply(n,i)!==!1)){if(!r&&!c.noBubble&&!rt.isWindow(n)){for(h=c.delegateType||p,Ot.test(h+p)||(a=a.parentNode);a;a=a.parentNode)f.push(a),u=a;u===(n.ownerDocument||dt)&&f.push(u.defaultView||u.parentWindow||e)}for(l=0;(a=f[l++])&&!t.isPropagationStopped();)t.type=l>1?h:c.bindType||p,o=(rt._data(a,"events")||{})[t.type]&&rt._data(a,"handle"),o&&o.apply(a,i),o=s&&a[s],o&&o.apply&&rt.acceptData(a)&&(t.result=o.apply(a,i),t.result===!1&&t.preventDefault());if(t.type=p,!r&&!t.isDefaultPrevented()&&(!c._default||c._default.apply(f.pop(),i)===!1)&&rt.acceptData(n)&&s&&n[p]&&!rt.isWindow(n)){u=n[s],u&&(n[s]=null),rt.event.triggered=p;try{n[p]()}catch(m){}rt.event.triggered=void 0,u&&(n[s]=u)}return t.result}},dispatch:function(e){e=rt.event.fix(e);var t,i,n,r,o,s=[],a=K.call(arguments),h=(rt._data(this,"events")||{})[e.type]||[],c=rt.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=rt.event.handlers.call(this,e,h),t=0;(r=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,o=0;(n=r.handlers[o++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(n.namespace))&&(e.handleObj=n,e.data=n.data,i=((rt.event.special[n.origType]||{}).handle||n.handler).apply(r.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,n,r,o,s=[],a=t.delegateCount,h=e.target;if(a&&h.nodeType&&(!e.button||"click"!==e.type))for(;h!=this;h=h.parentNode||this)if(1===h.nodeType&&(h.disabled!==!0||"click"!==e.type)){for(r=[],o=0;a>o;o++)n=t[o],i=n.selector+" ",void 0===r[i]&&(r[i]=n.needsContext?rt(i,this).index(h)>=0:rt.find(i,this,null,[h]).length),r[i]&&r.push(n);r.length&&s.push({elem:h,handlers:r})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},fix:function(e){if(e[rt.expando])return e;var t,i,n,r=e.type,o=e,s=this.fixHooks[r];
for(s||(this.fixHooks[r]=s=Lt.test(r)?this.mouseHooks:Rt.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,e=new rt.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=o.srcElement||dt),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,n,r,o=t.button,s=t.fromElement;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||dt,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==d()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===d()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return rt.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return rt.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=rt.extend(new rt.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?rt.event.trigger(r,null,t):rt.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},rt.removeEvent=dt.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var n="on"+t;e.detachEvent&&(typeof e[n]===wt&&(e[n]=null),e.detachEvent(n,i))},rt.Event=function(e,t){return this instanceof rt.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?f:p):this.type=e,t&&rt.extend(this,t),this.timeStamp=e&&e.timeStamp||rt.now(),void(this[rt.expando]=!0)):new rt.Event(e,t)},rt.Event.prototype={isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=f,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=f,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=f,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},rt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){rt.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==n&&!rt.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),it.submitBubbles||(rt.event.special.submit={setup:function(){return rt.nodeName(this,"form")?!1:void rt.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,i=rt.nodeName(t,"input")||rt.nodeName(t,"button")?t.form:void 0;i&&!rt._data(i,"submitBubbles")&&(rt.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),rt._data(i,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&rt.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return rt.nodeName(this,"form")?!1:void rt.event.remove(this,"._submit")}}),it.changeBubbles||(rt.event.special.change={setup:function(){return It.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(rt.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),rt.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),rt.event.simulate("change",this,e,!0)})),!1):void rt.event.add(this,"beforeactivate._change",function(e){var t=e.target;It.test(t.nodeName)&&!rt._data(t,"changeBubbles")&&(rt.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||rt.event.simulate("change",this.parentNode,e,!0)}),rt._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return rt.event.remove(this,"._change"),!It.test(this.nodeName)}}),it.focusinBubbles||rt.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){rt.event.simulate(t,e.target,rt.event.fix(e),!0)};rt.event.special[t]={setup:function(){var n=this.ownerDocument||this,r=rt._data(n,t);r||n.addEventListener(e,i,!0),rt._data(n,t,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=rt._data(n,t)-1;r?rt._data(n,t,r):(n.removeEventListener(e,i,!0),rt._removeData(n,t))}}}),rt.fn.extend({on:function(e,t,i,n,r){var o,s;if("object"==typeof e){"string"!=typeof t&&(i=i||t,t=void 0);for(o in e)this.on(o,t,i,e[o],r);return this}if(null==i&&null==n?(n=t,i=t=void 0):null==n&&("string"==typeof t?(n=i,i=void 0):(n=i,i=t,t=void 0)),n===!1)n=p;else if(!n)return this;return 1===r&&(s=n,n=function(e){return rt().off(e),s.apply(this,arguments)},n.guid=s.guid||(s.guid=rt.guid++)),this.each(function(){rt.event.add(this,e,n,i,t)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,rt(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(t===!1||"function"==typeof t)&&(i=t,t=void 0),i===!1&&(i=p),this.each(function(){rt.event.remove(this,e,i,t)})},trigger:function(e,t){return this.each(function(){rt.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?rt.event.trigger(e,t,i,!0):void 0}});var Bt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Ft=/ jQuery\d+="(?:null|\d+)"/g,kt=new RegExp("<(?:"+Bt+")[\\s/>]","i"),Nt=/^\s+/,zt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ut=/<([\w:]+)/,Wt=/<tbody/i,Gt=/<|&#?\w+;/,jt=/<(?:script|style|link)/i,Ht=/checked\s*(?:[^=]|=\s*.checked.)/i,Xt=/^$|\/(?:java|ecma)script/i,Yt=/^true\/(.*)/,qt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Kt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:it.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Zt=m(dt),Qt=Zt.appendChild(dt.createElement("div"));Kt.optgroup=Kt.option,Kt.tbody=Kt.tfoot=Kt.colgroup=Kt.caption=Kt.thead,Kt.th=Kt.td,rt.extend({clone:function(e,t,i){var n,r,o,s,a,h=rt.contains(e.ownerDocument,e);if(it.html5Clone||rt.isXMLDoc(e)||!kt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Qt.innerHTML=e.outerHTML,Qt.removeChild(o=Qt.firstChild)),!(it.noCloneEvent&&it.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||rt.isXMLDoc(e)))for(n=g(o),a=g(e),s=0;null!=(r=a[s]);++s)n[s]&&w(r,n[s]);if(t)if(i)for(a=a||g(e),n=n||g(o),s=0;null!=(r=a[s]);s++)T(r,n[s]);else T(e,o);return n=g(o,"script"),n.length>0&&b(n,!h&&g(e,"script")),n=a=r=null,o},buildFragment:function(e,t,i,n){for(var r,o,s,a,h,c,u,l=e.length,f=m(t),p=[],d=0;l>d;d++)if(o=e[d],o||0===o)if("object"===rt.type(o))rt.merge(p,o.nodeType?[o]:o);else if(Gt.test(o)){for(a=a||f.appendChild(t.createElement("div")),h=(Ut.exec(o)||["",""])[1].toLowerCase(),u=Kt[h]||Kt._default,a.innerHTML=u[1]+o.replace(zt,"<$1></$2>")+u[2],r=u[0];r--;)a=a.lastChild;if(!it.leadingWhitespace&&Nt.test(o)&&p.push(t.createTextNode(Nt.exec(o)[0])),!it.tbody)for(o="table"!==h||Wt.test(o)?"<table>"!==u[1]||Wt.test(o)?0:a:a.firstChild,r=o&&o.childNodes.length;r--;)rt.nodeName(c=o.childNodes[r],"tbody")&&!c.childNodes.length&&o.removeChild(c);for(rt.merge(p,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=f.lastChild}else p.push(t.createTextNode(o));for(a&&f.removeChild(a),it.appendChecked||rt.grep(g(p,"input"),_),d=0;o=p[d++];)if((!n||-1===rt.inArray(o,n))&&(s=rt.contains(o.ownerDocument,o),a=g(f.appendChild(o),"script"),s&&b(a),i))for(r=0;o=a[r++];)Xt.test(o.type||"")&&i.push(o);return a=null,f},cleanData:function(e,t){for(var i,n,r,o,s=0,a=rt.expando,h=rt.cache,c=it.deleteExpando,u=rt.event.special;null!=(i=e[s]);s++)if((t||rt.acceptData(i))&&(r=i[a],o=r&&h[r])){if(o.events)for(n in o.events)u[n]?rt.event.remove(i,n):rt.removeEvent(i,n,o.handle);h[r]&&(delete h[r],c?delete i[a]:typeof i.removeAttribute!==wt?i.removeAttribute(a):i[a]=null,q.push(r))}}}),rt.fn.extend({text:function(e){return Ct(this,function(e){return void 0===e?rt.text(this):this.empty().append((this[0]&&this[0].ownerDocument||dt).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=v(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=v(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=e?rt.filter(e,this):this,r=0;null!=(i=n[r]);r++)t||1!==i.nodeType||rt.cleanData(g(i)),i.parentNode&&(t&&rt.contains(i.ownerDocument,i)&&b(g(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&rt.cleanData(g(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&rt.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return rt.clone(this,e,t)})},html:function(e){return Ct(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Ft,""):void 0;if(!("string"!=typeof e||jt.test(e)||!it.htmlSerialize&&kt.test(e)||!it.leadingWhitespace&&Nt.test(e)||Kt[(Ut.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(zt,"<$1></$2>");try{for(;n>i;i++)t=this[i]||{},1===t.nodeType&&(rt.cleanData(g(t,!1)),t.innerHTML=e);t=0}catch(r){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,rt.cleanData(g(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=Z.apply([],e);var i,n,r,o,s,a,h=0,c=this.length,u=this,l=c-1,f=e[0],p=rt.isFunction(f);if(p||c>1&&"string"==typeof f&&!it.checkClone&&Ht.test(f))return this.each(function(i){var n=u.eq(i);p&&(e[0]=f.call(this,i,n.html())),n.domManip(e,t)});if(c&&(a=rt.buildFragment(e,this[0].ownerDocument,!1,this),i=a.firstChild,1===a.childNodes.length&&(a=i),i)){for(o=rt.map(g(a,"script"),y),r=o.length;c>h;h++)n=a,h!==l&&(n=rt.clone(n,!0,!0),r&&rt.merge(o,g(n,"script"))),t.call(this[h],n,h);if(r)for(s=o[o.length-1].ownerDocument,rt.map(o,x),h=0;r>h;h++)n=o[h],Xt.test(n.type||"")&&!rt._data(n,"globalEval")&&rt.contains(s,n)&&(n.src?rt._evalUrl&&rt._evalUrl(n.src):rt.globalEval((n.text||n.textContent||n.innerHTML||"").replace(qt,"")));a=i=null}return this}}),rt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){rt.fn[e]=function(e){for(var i,n=0,r=[],o=rt(e),s=o.length-1;s>=n;n++)i=n===s?this:this.clone(!0),rt(o[n])[t](i),Q.apply(r,i.get());return this.pushStack(r)}});var Jt,$t={};!function(){var e;it.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,i,n;return i=dt.getElementsByTagName("body")[0],i&&i.style?(t=dt.createElement("div"),n=dt.createElement("div"),n.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(t),typeof t.style.zoom!==wt&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(dt.createElement("div")).style.width="5px",e=3!==t.offsetWidth),i.removeChild(n),e):void 0}}();var ei,ti,ii=/^margin/,ni=new RegExp("^("+At+")(?!px)[a-z%]+$","i"),ri=/^(top|right|bottom|left)$/;e.getComputedStyle?(ei=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)},ti=function(e,t,i){var n,r,o,s,a=e.style;return i=i||ei(e),s=i?i.getPropertyValue(t)||i[t]:void 0,i&&(""!==s||rt.contains(e.ownerDocument,e)||(s=rt.style(e,t)),ni.test(s)&&ii.test(t)&&(n=a.width,r=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=n,a.minWidth=r,a.maxWidth=o)),void 0===s?s:s+""}):dt.documentElement.currentStyle&&(ei=function(e){return e.currentStyle},ti=function(e,t,i){var n,r,o,s,a=e.style;return i=i||ei(e),s=i?i[t]:void 0,null==s&&a&&a[t]&&(s=a[t]),ni.test(s)&&!ri.test(t)&&(n=a.left,r=e.runtimeStyle,o=r&&r.left,o&&(r.left=e.currentStyle.left),a.left="fontSize"===t?"1em":s,s=a.pixelLeft+"px",a.left=n,o&&(r.left=o)),void 0===s?s:s+""||"auto"}),function(){function t(){var t,i,n,r;i=dt.getElementsByTagName("body")[0],i&&i.style&&(t=dt.createElement("div"),n=dt.createElement("div"),n.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",i.appendChild(n).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",o=s=!1,h=!0,e.getComputedStyle&&(o="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,r=t.appendChild(dt.createElement("div")),r.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",r.style.marginRight=r.style.width="0",t.style.width="1px",h=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight),t.removeChild(r)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=t.getElementsByTagName("td"),r[0].style.cssText="margin:0;border:0;padding:0;display:none",a=0===r[0].offsetHeight,a&&(r[0].style.display="",r[1].style.display="none",a=0===r[0].offsetHeight),i.removeChild(n))}var i,n,r,o,s,a,h;i=dt.createElement("div"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=i.getElementsByTagName("a")[0],n=r&&r.style,n&&(n.cssText="float:left;opacity:.5",it.opacity="0.5"===n.opacity,it.cssFloat=!!n.cssFloat,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",it.clearCloneStyle="content-box"===i.style.backgroundClip,it.boxSizing=""===n.boxSizing||""===n.MozBoxSizing||""===n.WebkitBoxSizing,rt.extend(it,{reliableHiddenOffsets:function(){return null==a&&t(),a},boxSizingReliable:function(){return null==s&&t(),s},pixelPosition:function(){return null==o&&t(),o},reliableMarginRight:function(){return null==h&&t(),h}}))}(),rt.swap=function(e,t,i,n){var r,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=s[o];return r};var oi=/alpha\([^)]*\)/i,si=/opacity\s*=\s*([^)]*)/,ai=/^(none|table(?!-c[ea]).+)/,hi=new RegExp("^("+At+")(.*)$","i"),ci=new RegExp("^([+-])=("+At+")","i"),ui={position:"absolute",visibility:"hidden",display:"block"},li={letterSpacing:"0",fontWeight:"400"},fi=["Webkit","O","Moz","ms"];rt.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=ti(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":it.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,s,a=rt.camelCase(t),h=e.style;if(t=rt.cssProps[a]||(rt.cssProps[a]=P(h,a)),s=rt.cssHooks[t]||rt.cssHooks[a],void 0===i)return s&&"get"in s&&void 0!==(r=s.get(e,!1,n))?r:h[t];if(o=typeof i,"string"===o&&(r=ci.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(rt.css(e,t)),o="number"),null!=i&&i===i&&("number"!==o||rt.cssNumber[a]||(i+="px"),it.clearCloneStyle||""!==i||0!==t.indexOf("background")||(h[t]="inherit"),!(s&&"set"in s&&void 0===(i=s.set(e,i,n)))))try{h[t]=i}catch(c){}}},css:function(e,t,i,n){var r,o,s,a=rt.camelCase(t);return t=rt.cssProps[a]||(rt.cssProps[a]=P(e.style,a)),s=rt.cssHooks[t]||rt.cssHooks[a],s&&"get"in s&&(o=s.get(e,!0,i)),void 0===o&&(o=ti(e,t,n)),"normal"===o&&t in li&&(o=li[t]),""===i||i?(r=parseFloat(o),i===!0||rt.isNumeric(r)?r||0:o):o}}),rt.each(["height","width"],function(e,t){rt.cssHooks[t]={get:function(e,i,n){return i?ai.test(rt.css(e,"display"))&&0===e.offsetWidth?rt.swap(e,ui,function(){return I(e,t,n)}):I(e,t,n):void 0},set:function(e,i,n){var r=n&&ei(e);return C(e,i,n?D(e,t,n,it.boxSizing&&"border-box"===rt.css(e,"boxSizing",!1,r),r):0)}}}),it.opacity||(rt.cssHooks.opacity={get:function(e,t){return si.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,r=rt.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,(t>=1||""===t)&&""===rt.trim(o.replace(oi,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===t||n&&!n.filter)||(i.filter=oi.test(o)?o.replace(oi,r):o+" "+r)}}),rt.cssHooks.marginRight=A(it.reliableMarginRight,function(e,t){return t?rt.swap(e,{display:"inline-block"},ti,[e,"marginRight"]):void 0}),rt.each({margin:"",padding:"",border:"Width"},function(e,t){rt.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[e+Pt[n]+t]=o[n]||o[n-2]||o[0];return r}},ii.test(e)||(rt.cssHooks[e+t].set=C)}),rt.fn.extend({css:function(e,t){return Ct(this,function(e,t,i){var n,r,o={},s=0;if(rt.isArray(t)){for(n=ei(e),r=t.length;r>s;s++)o[t[s]]=rt.css(e,t[s],!1,n);return o}return void 0!==i?rt.style(e,t,i):rt.css(e,t)},e,t,arguments.length>1)},show:function(){return S(this,!0)},hide:function(){return S(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){St(this)?rt(this).show():rt(this).hide()})}}),rt.Tween=R,R.prototype={constructor:R,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(rt.cssNumber[i]?"":"px")},cur:function(){var e=R.propHooks[this.prop];return e&&e.get?e.get(this):R.propHooks._default.get(this)},run:function(e){var t,i=R.propHooks[this.prop];return this.pos=t=this.options.duration?rt.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):R.propHooks._default.set(this),this}},R.prototype.init.prototype=R.prototype,R.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=rt.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){rt.fx.step[e.prop]?rt.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[rt.cssProps[e.prop]]||rt.cssHooks[e.prop])?rt.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},rt.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},rt.fx=R.prototype.init,rt.fx.step={};var pi,di,mi=/^(?:toggle|show|hide)$/,gi=new RegExp("^(?:([+-])=|)("+At+")([a-z%]*)$","i"),_i=/queueHooks$/,vi=[B],yi={"*":[function(e,t){var i=this.createTween(e,t),n=i.cur(),r=gi.exec(t),o=r&&r[3]||(rt.cssNumber[e]?"":"px"),s=(rt.cssNumber[e]||"px"!==o&&+n)&&gi.exec(rt.css(i.elem,e)),a=1,h=20;if(s&&s[3]!==o){o=o||s[3],r=r||[],s=+n||1;do a=a||".5",s/=a,rt.style(i.elem,e,s+o);while(a!==(a=i.cur()/n)&&1!==a&&--h)}return r&&(s=i.start=+s||+n||0,i.unit=o,i.end=r[1]?s+(r[1]+1)*r[2]:+r[2]),i}]};rt.Animation=rt.extend(k,{tweener:function(e,t){rt.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],yi[i]=yi[i]||[],yi[i].unshift(t)},prefilter:function(e,t){t?vi.unshift(e):vi.push(e)}}),rt.speed=function(e,t,i){var n=e&&"object"==typeof e?rt.extend({},e):{complete:i||!i&&t||rt.isFunction(e)&&e,duration:e,easing:i&&t||t&&!rt.isFunction(t)&&t};return n.duration=rt.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in rt.fx.speeds?rt.fx.speeds[n.duration]:rt.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){rt.isFunction(n.old)&&n.old.call(this),n.queue&&rt.dequeue(this,n.queue)},n},rt.fn.extend({fadeTo:function(e,t,i,n){return this.filter(St).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=rt.isEmptyObject(e),o=rt.speed(t,i,n),s=function(){var t=k(this,rt.extend({},e),o);(r||rt._data(this,"finish"))&&t.stop(!0)};return s.finish=s,r||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",o=rt.timers,s=rt._data(this);if(r)s[r]&&s[r].stop&&n(s[r]);else for(r in s)s[r]&&s[r].stop&&_i.test(r)&&n(s[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(i),t=!1,o.splice(r,1));(t||!i)&&rt.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=rt._data(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=rt.timers,s=n?n.length:0;for(i.finish=!0,rt.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),rt.each(["toggle","show","hide"],function(e,t){var i=rt.fn[t];rt.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(O(t,!0),e,n,r)}}),rt.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){rt.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),rt.timers=[],rt.fx.tick=function(){var e,t=rt.timers,i=0;for(pi=rt.now();i<t.length;i++)e=t[i],e()||t[i]!==e||t.splice(i--,1);t.length||rt.fx.stop(),pi=void 0},rt.fx.timer=function(e){rt.timers.push(e),e()?rt.fx.start():rt.timers.pop()},rt.fx.interval=13,rt.fx.start=function(){di||(di=setInterval(rt.fx.tick,rt.fx.interval))},rt.fx.stop=function(){clearInterval(di),di=null},rt.fx.speeds={slow:600,fast:200,_default:400},rt.fn.delay=function(e,t){return e=rt.fx?rt.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},function(){var e,t,i,n,r;t=dt.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=t.getElementsByTagName("a")[0],i=dt.createElement("select"),r=i.appendChild(dt.createElement("option")),e=t.getElementsByTagName("input")[0],n.style.cssText="top:1px",it.getSetAttribute="t"!==t.className,it.style=/top/.test(n.getAttribute("style")),it.hrefNormalized="/a"===n.getAttribute("href"),it.checkOn=!!e.value,it.optSelected=r.selected,it.enctype=!!dt.createElement("form").enctype,i.disabled=!0,it.optDisabled=!r.disabled,e=dt.createElement("input"),e.setAttribute("value",""),it.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),it.radioValue="t"===e.value}();var xi=/\r/g;rt.fn.extend({val:function(e){var t,i,n,r=this[0];{if(arguments.length)return n=rt.isFunction(e),this.each(function(i){var r;1===this.nodeType&&(r=n?e.call(this,i,rt(this).val()):e,null==r?r="":"number"==typeof r?r+="":rt.isArray(r)&&(r=rt.map(r,function(e){return null==e?"":e+""})),t=rt.valHooks[this.type]||rt.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))});if(r)return t=rt.valHooks[r.type]||rt.valHooks[r.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:(i=r.value,"string"==typeof i?i.replace(xi,""):null==i?"":i)}}}),rt.extend({valHooks:{option:{get:function(e){var t=rt.find.attr(e,"value");return null!=t?t:rt.trim(rt.text(e))}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,s=o?null:[],a=o?r+1:n.length,h=0>r?a:o?r:0;a>h;h++)if(i=n[h],!(!i.selected&&h!==r||(it.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&rt.nodeName(i.parentNode,"optgroup"))){if(t=rt(i).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var i,n,r=e.options,o=rt.makeArray(t),s=r.length;s--;)if(n=r[s],rt.inArray(rt.valHooks.option.get(n),o)>=0)try{n.selected=i=!0}catch(a){n.scrollHeight}else n.selected=!1;return i||(e.selectedIndex=-1),r}}}}),rt.each(["radio","checkbox"],function(){rt.valHooks[this]={set:function(e,t){return rt.isArray(t)?e.checked=rt.inArray(rt(e).val(),t)>=0:void 0}},it.checkOn||(rt.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var bi,Ti,wi=rt.expr.attrHandle,Mi=/^(?:checked|selected)$/i,Ei=it.getSetAttribute,Ai=it.input;rt.fn.extend({attr:function(e,t){return Ct(this,rt.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){rt.removeAttr(this,e)})}}),rt.extend({attr:function(e,t,i){var n,r,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===wt?rt.prop(e,t,i):(1===o&&rt.isXMLDoc(e)||(t=t.toLowerCase(),n=rt.attrHooks[t]||(rt.expr.match.bool.test(t)?Ti:bi)),void 0===i?n&&"get"in n&&null!==(r=n.get(e,t))?r:(r=rt.find.attr(e,t),null==r?void 0:r):null!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):void rt.removeAttr(e,t))},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(yt);if(o&&1===e.nodeType)for(;i=o[r++];)n=rt.propFix[i]||i,rt.expr.match.bool.test(i)?Ai&&Ei||!Mi.test(i)?e[n]=!1:e[rt.camelCase("default-"+i)]=e[n]=!1:rt.attr(e,i,""),e.removeAttribute(Ei?i:n)},attrHooks:{type:{set:function(e,t){if(!it.radioValue&&"radio"===t&&rt.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}}}),Ti={set:function(e,t,i){return t===!1?rt.removeAttr(e,i):Ai&&Ei||!Mi.test(i)?e.setAttribute(!Ei&&rt.propFix[i]||i,i):e[rt.camelCase("default-"+i)]=e[i]=!0,i}},rt.each(rt.expr.match.bool.source.match(/\w+/g),function(e,t){var i=wi[t]||rt.find.attr;wi[t]=Ai&&Ei||!Mi.test(t)?function(e,t,n){var r,o;return n||(o=wi[t],wi[t]=r,r=null!=i(e,t,n)?t.toLowerCase():null,wi[t]=o),r}:function(e,t,i){return i?void 0:e[rt.camelCase("default-"+t)]?t.toLowerCase():null}}),Ai&&Ei||(rt.attrHooks.value={set:function(e,t,i){return rt.nodeName(e,"input")?void(e.defaultValue=t):bi&&bi.set(e,t,i)}}),Ei||(bi={set:function(e,t,i){var n=e.getAttributeNode(i);return n||e.setAttributeNode(n=e.ownerDocument.createAttribute(i)),n.value=t+="","value"===i||t===e.getAttribute(i)?t:void 0}},wi.id=wi.name=wi.coords=function(e,t,i){var n;return i?void 0:(n=e.getAttributeNode(t))&&""!==n.value?n.value:null},rt.valHooks.button={get:function(e,t){var i=e.getAttributeNode(t);return i&&i.specified?i.value:void 0},set:bi.set},rt.attrHooks.contenteditable={set:function(e,t,i){bi.set(e,""===t?!1:t,i)}},rt.each(["width","height"],function(e,t){rt.attrHooks[t]={set:function(e,i){return""===i?(e.setAttribute(t,"auto"),i):void 0}}})),it.style||(rt.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var Pi=/^(?:input|select|textarea|button|object)$/i,Si=/^(?:a|area)$/i;rt.fn.extend({prop:function(e,t){return Ct(this,rt.prop,e,t,arguments.length>1)},removeProp:function(e){return e=rt.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),rt.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,i){var n,r,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!rt.isXMLDoc(e),o&&(t=rt.propFix[t]||t,r=rt.propHooks[t]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=rt.find.attr(e,"tabindex");return t?parseInt(t,10):Pi.test(e.nodeName)||Si.test(e.nodeName)&&e.href?0:-1}}}}),it.hrefNormalized||rt.each(["href","src"],function(e,t){rt.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),it.optSelected||(rt.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),rt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){rt.propFix[this.toLowerCase()]=this}),it.enctype||(rt.propFix.enctype="encoding");var Ci=/[\t\r\n\f]/g;rt.fn.extend({addClass:function(e){var t,i,n,r,o,s,a=0,h=this.length,c="string"==typeof e&&e;if(rt.isFunction(e))return this.each(function(t){rt(this).addClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(yt)||[];h>a;a++)if(i=this[a],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Ci," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");s=rt.trim(n),i.className!==s&&(i.className=s)}return this},removeClass:function(e){var t,i,n,r,o,s,a=0,h=this.length,c=0===arguments.length||"string"==typeof e&&e;if(rt.isFunction(e))return this.each(function(t){rt(this).removeClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(yt)||[];h>a;a++)if(i=this[a],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Ci," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");s=e?rt.trim(n):"",i.className!==s&&(i.className=s)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):this.each(rt.isFunction(e)?function(i){rt(this).toggleClass(e.call(this,i,this.className,t),t)}:function(){if("string"===i)for(var t,n=0,r=rt(this),o=e.match(yt)||[];t=o[n++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(i===wt||"boolean"===i)&&(this.className&&rt._data(this,"__className__",this.className),this.className=this.className||e===!1?"":rt._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Ci," ").indexOf(t)>=0)return!0;return!1}}),rt.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){rt.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),rt.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)
}});var Di=rt.now(),Ii=/\?/,Ri=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;rt.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var i,n=null,r=rt.trim(t+"");return r&&!rt.trim(r.replace(Ri,function(e,t,r,o){return i&&t&&(n=0),0===n?e:(i=r||t,n+=!o-!r,"")}))?Function("return "+r)():rt.error("Invalid JSON: "+t)},rt.parseXML=function(t){var i,n;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(n=new DOMParser,i=n.parseFromString(t,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(t))}catch(r){i=void 0}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||rt.error("Invalid XML: "+t),i};var Li,Oi,Vi=/#.*$/,Bi=/([?&])_=[^&]*/,Fi=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,ki=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ni=/^(?:GET|HEAD)$/,zi=/^\/\//,Ui=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Wi={},Gi={},ji="*/".concat("*");try{Oi=location.href}catch(Hi){Oi=dt.createElement("a"),Oi.href="",Oi=Oi.href}Li=Ui.exec(Oi.toLowerCase())||[],rt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Oi,type:"GET",isLocal:ki.test(Li[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ji,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":rt.parseJSON,"text xml":rt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?U(U(e,rt.ajaxSettings),t):U(rt.ajaxSettings,e)},ajaxPrefilter:N(Wi),ajaxTransport:N(Gi),ajax:function(e,t){function i(e,t,i,n){var r,u,_,v,x,T=t;2!==y&&(y=2,a&&clearTimeout(a),c=void 0,s=n||"",b.readyState=e>0?4:0,r=e>=200&&300>e||304===e,i&&(v=W(l,b,i)),v=G(l,v,b,r),r?(l.ifModified&&(x=b.getResponseHeader("Last-Modified"),x&&(rt.lastModified[o]=x),x=b.getResponseHeader("etag"),x&&(rt.etag[o]=x)),204===e||"HEAD"===l.type?T="nocontent":304===e?T="notmodified":(T=v.state,u=v.data,_=v.error,r=!_)):(_=T,(e||!T)&&(T="error",0>e&&(e=0))),b.status=e,b.statusText=(t||T)+"",r?d.resolveWith(f,[u,T,b]):d.rejectWith(f,[b,T,_]),b.statusCode(g),g=void 0,h&&p.trigger(r?"ajaxSuccess":"ajaxError",[b,l,r?u:_]),m.fireWith(f,[b,T]),h&&(p.trigger("ajaxComplete",[b,l]),--rt.active||rt.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,o,s,a,h,c,u,l=rt.ajaxSetup({},t),f=l.context||l,p=l.context&&(f.nodeType||f.jquery)?rt(f):rt.event,d=rt.Deferred(),m=rt.Callbacks("once memory"),g=l.statusCode||{},_={},v={},y=0,x="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===y){if(!u)for(u={};t=Fi.exec(s);)u[t[1].toLowerCase()]=t[2];t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===y?s:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return y||(e=v[i]=v[i]||e,_[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>y)for(t in e)g[t]=[g[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||x;return c&&c.abort(t),i(0,t),this}};if(d.promise(b).complete=m.add,b.success=b.done,b.error=b.fail,l.url=((e||l.url||Oi)+"").replace(Vi,"").replace(zi,Li[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=rt.trim(l.dataType||"*").toLowerCase().match(yt)||[""],null==l.crossDomain&&(n=Ui.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Li[1]&&n[2]===Li[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Li[3]||("http:"===Li[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=rt.param(l.data,l.traditional)),z(Wi,l,t,b),2===y)return b;h=rt.event&&l.global,h&&0===rt.active++&&rt.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Ni.test(l.type),o=l.url,l.hasContent||(l.data&&(o=l.url+=(Ii.test(o)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Bi.test(o)?o.replace(Bi,"$1_="+Di++):o+(Ii.test(o)?"&":"?")+"_="+Di++)),l.ifModified&&(rt.lastModified[o]&&b.setRequestHeader("If-Modified-Since",rt.lastModified[o]),rt.etag[o]&&b.setRequestHeader("If-None-Match",rt.etag[o])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&b.setRequestHeader("Content-Type",l.contentType),b.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+ji+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)b.setRequestHeader(r,l.headers[r]);if(l.beforeSend&&(l.beforeSend.call(f,b,l)===!1||2===y))return b.abort();x="abort";for(r in{success:1,error:1,complete:1})b[r](l[r]);if(c=z(Gi,l,t,b)){b.readyState=1,h&&p.trigger("ajaxSend",[b,l]),l.async&&l.timeout>0&&(a=setTimeout(function(){b.abort("timeout")},l.timeout));try{y=1,c.send(_,i)}catch(T){if(!(2>y))throw T;i(-1,T)}}else i(-1,"No Transport");return b},getJSON:function(e,t,i){return rt.get(e,t,i,"json")},getScript:function(e,t){return rt.get(e,void 0,t,"script")}}),rt.each(["get","post"],function(e,t){rt[t]=function(e,i,n,r){return rt.isFunction(i)&&(r=r||n,n=i,i=void 0),rt.ajax({url:e,type:t,dataType:r,data:i,success:n})}}),rt._evalUrl=function(e){return rt.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},rt.fn.extend({wrapAll:function(e){if(rt.isFunction(e))return this.each(function(t){rt(this).wrapAll(e.call(this,t))});if(this[0]){var t=rt(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(rt.isFunction(e)?function(t){rt(this).wrapInner(e.call(this,t))}:function(){var t=rt(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=rt.isFunction(e);return this.each(function(i){rt(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){rt.nodeName(this,"body")||rt(this).replaceWith(this.childNodes)}).end()}}),rt.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!it.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||rt.css(e,"display"))},rt.expr.filters.visible=function(e){return!rt.expr.filters.hidden(e)};var Xi=/%20/g,Yi=/\[\]$/,qi=/\r?\n/g,Ki=/^(?:submit|button|image|reset|file)$/i,Zi=/^(?:input|select|textarea|keygen)/i;rt.param=function(e,t){var i,n=[],r=function(e,t){t=rt.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=rt.ajaxSettings&&rt.ajaxSettings.traditional),rt.isArray(e)||e.jquery&&!rt.isPlainObject(e))rt.each(e,function(){r(this.name,this.value)});else for(i in e)j(i,e[i],t,r);return n.join("&").replace(Xi,"+")},rt.fn.extend({serialize:function(){return rt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=rt.prop(this,"elements");return e?rt.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!rt(this).is(":disabled")&&Zi.test(this.nodeName)&&!Ki.test(e)&&(this.checked||!Dt.test(e))}).map(function(e,t){var i=rt(this).val();return null==i?null:rt.isArray(i)?rt.map(i,function(e){return{name:t.name,value:e.replace(qi,"\r\n")}}):{name:t.name,value:i.replace(qi,"\r\n")}}).get()}}),rt.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&H()||X()}:H;var Qi=0,Ji={},$i=rt.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Ji)Ji[e](void 0,!0)}),it.cors=!!$i&&"withCredentials"in $i,$i=it.ajax=!!$i,$i&&rt.ajaxTransport(function(e){if(!e.crossDomain||it.cors){var t;return{send:function(i,n){var r,o=e.xhr(),s=++Qi;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)o[r]=e.xhrFields[r];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)void 0!==i[r]&&o.setRequestHeader(r,i[r]+"");o.send(e.hasContent&&e.data||null),t=function(i,r){var a,h,c;if(t&&(r||4===o.readyState))if(delete Ji[s],t=void 0,o.onreadystatechange=rt.noop,r)4!==o.readyState&&o.abort();else{c={},a=o.status,"string"==typeof o.responseText&&(c.text=o.responseText);try{h=o.statusText}catch(u){h=""}a||!e.isLocal||e.crossDomain?1223===a&&(a=204):a=c.text?200:404}c&&n(a,h,c,o.getAllResponseHeaders())},e.async?4===o.readyState?setTimeout(t):o.onreadystatechange=Ji[s]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),rt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return rt.globalEval(e),e}}}),rt.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),rt.ajaxTransport("script",function(e){if(e.crossDomain){var t,i=dt.head||rt("head")[0]||dt.documentElement;return{send:function(n,r){t=dt.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,i){(i||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,i||r(200,"success"))},i.insertBefore(t,i.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var en=[],tn=/(=)\?(?=&|$)|\?\?/;rt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=en.pop()||rt.expando+"_"+Di++;return this[e]=!0,e}}),rt.ajaxPrefilter("json jsonp",function(t,i,n){var r,o,s,a=t.jsonp!==!1&&(tn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tn.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(r=t.jsonpCallback=rt.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(tn,"$1"+r):t.jsonp!==!1&&(t.url+=(Ii.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return s||rt.error(r+" was not called"),s[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){s=arguments},n.always(function(){e[r]=o,t[r]&&(t.jsonpCallback=i.jsonpCallback,en.push(r)),s&&rt.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),rt.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||dt;var n=lt.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=rt.buildFragment([e],t,r),r&&r.length&&rt(r).remove(),rt.merge([],n.childNodes))};var nn=rt.fn.load;rt.fn.load=function(e,t,i){if("string"!=typeof e&&nn)return nn.apply(this,arguments);var n,r,o,s=this,a=e.indexOf(" ");return a>=0&&(n=rt.trim(e.slice(a,e.length)),e=e.slice(0,a)),rt.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(o="POST"),s.length>0&&rt.ajax({url:e,type:o,dataType:"html",data:t}).done(function(e){r=arguments,s.html(n?rt("<div>").append(rt.parseHTML(e)).find(n):e)}).complete(i&&function(e,t){s.each(i,r||[e.responseText,t,e])}),this},rt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){rt.fn[t]=function(e){return this.on(t,e)}}),rt.expr.filters.animated=function(e){return rt.grep(rt.timers,function(t){return e===t.elem}).length};var rn=e.document.documentElement;rt.offset={setOffset:function(e,t,i){var n,r,o,s,a,h,c,u=rt.css(e,"position"),l=rt(e),f={};"static"===u&&(e.style.position="relative"),a=l.offset(),o=rt.css(e,"top"),h=rt.css(e,"left"),c=("absolute"===u||"fixed"===u)&&rt.inArray("auto",[o,h])>-1,c?(n=l.position(),s=n.top,r=n.left):(s=parseFloat(o)||0,r=parseFloat(h)||0),rt.isFunction(t)&&(t=t.call(e,i,a)),null!=t.top&&(f.top=t.top-a.top+s),null!=t.left&&(f.left=t.left-a.left+r),"using"in t?t.using.call(e,f):l.css(f)}},rt.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){rt.offset.setOffset(this,e,t)});var t,i,n={top:0,left:0},r=this[0],o=r&&r.ownerDocument;if(o)return t=o.documentElement,rt.contains(t,r)?(typeof r.getBoundingClientRect!==wt&&(n=r.getBoundingClientRect()),i=Y(o),{top:n.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0),left:n.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):n},position:function(){if(this[0]){var e,t,i={top:0,left:0},n=this[0];return"fixed"===rt.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),rt.nodeName(e[0],"html")||(i=e.offset()),i.top+=rt.css(e[0],"borderTopWidth",!0),i.left+=rt.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-rt.css(n,"marginTop",!0),left:t.left-i.left-rt.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||rn;e&&!rt.nodeName(e,"html")&&"static"===rt.css(e,"position");)e=e.offsetParent;return e||rn})}}),rt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i=/Y/.test(t);rt.fn[e]=function(n){return Ct(this,function(e,n,r){var o=Y(e);return void 0===r?o?t in o?o[t]:o.document.documentElement[n]:e[n]:void(o?o.scrollTo(i?rt(o).scrollLeft():r,i?r:rt(o).scrollTop()):e[n]=r)},e,n,arguments.length,null)}}),rt.each(["top","left"],function(e,t){rt.cssHooks[t]=A(it.pixelPosition,function(e,i){return i?(i=ti(e,t),ni.test(i)?rt(e).position()[t]+"px":i):void 0})}),rt.each({Height:"height",Width:"width"},function(e,t){rt.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){rt.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),s=i||(n===!0||r===!0?"margin":"border");return Ct(this,function(t,i,n){var r;return rt.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===n?rt.css(t,i,s):rt.style(t,i,n,s)},t,o?n:void 0,o,null)}})}),rt.fn.size=function(){return this.length},rt.fn.andSelf=rt.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return rt});var on=e.jQuery,sn=e.$;return rt.noConflict=function(t){return e.$===rt&&(e.$=sn),t&&e.jQuery===rt&&(e.jQuery=on),rt},typeof t===wt&&(e.jQuery=e.$=rt),rt})},{}],lodash:[function(e,t,i){(function(e){(function(){function n(e,t){if(e!==t){var i=e===e,n=t===t;if(e>t||!i||"undefined"==typeof e&&n)return 1;if(t>e||!n||"undefined"==typeof t&&i)return-1}return 0}function r(e,t,i){for(var n=e.length,r=i?n:-1;i?r--:++r<n;)if(t(e[r],r,e))return r;return-1}function o(e,t,i){if(t!==t)return g(e,i);for(var n=i-1,r=e.length;++n<r;)if(e[n]===t)return n;return-1}function s(e){return"function"==typeof e||!1}function a(e){return"string"==typeof e?e:null==e?"":e+""}function h(e){return e.charCodeAt(0)}function c(e,t){for(var i=-1,n=e.length;++i<n&&t.indexOf(e.charAt(i))>-1;);return i}function u(e,t){for(var i=e.length;i--&&t.indexOf(e.charAt(i))>-1;);return i}function l(e,t){return n(e.criteria,t.criteria)||e.index-t.index}function f(e,t,i){for(var r=-1,o=e.criteria,s=t.criteria,a=o.length,h=i.length;++r<a;){var c=n(o[r],s[r]);if(c)return r>=h?c:c*(i[r]?1:-1)}return e.index-t.index}function p(e){return Ut[e]}function d(e){return Wt[e]}function m(e){return"\\"+Ht[e]}function g(e,t,i){for(var n=e.length,r=t+(i?0:-1);i?r--:++r<n;){var o=e[r];if(o!==o)return r}return-1}function _(e){return!!e&&"object"==typeof e}function v(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function y(e,t){for(var i=-1,n=e.length,r=-1,o=[];++i<n;)e[i]===t&&(e[i]=j,o[++r]=i);return o}function x(e,t){for(var i,n=-1,r=e.length,o=-1,s=[];++n<r;){var a=e[n],h=t?t(a,n,e):a;n&&i===h||(i=h,s[++o]=a)}return s}function b(e){for(var t=-1,i=e.length;++t<i&&v(e.charCodeAt(t)););return t}function T(e){for(var t=e.length;t--&&v(e.charCodeAt(t)););return t}function w(e){return Gt[e]}function M(e){function t(e){if(_(e)&&!sh(e)&&!(e instanceof Q)){if(e instanceof v)return e;if(Is.call(e,"__chain__")&&Is.call(e,"__wrapped__"))return qn(e)}return new v(e)}function i(){}function v(e,t,i){this.__wrapped__=e,this.__actions__=i||[],this.__chain__=!!t}function Q(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=aa,this.__views__=null}function tt(){var e=this.__actions__,t=this.__iteratees__,i=this.__views__,n=new Q(this.__wrapped__);return n.__actions__=e?Zt(e):null,n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=t?Zt(t):null,n.__takeCount__=this.__takeCount__,n.__views__=i?Zt(i):null,n}function nt(){if(this.__filtered__){var e=new Q(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ut(){var e=this.__wrapped__.value();if(!sh(e))return Yi(e,this.__actions__);var t=this.__dir__,i=0>t,n=In(0,e.length,this.__views__),r=n.start,o=n.end,s=o-r,a=i?o:r-1,h=ta(s,this.__takeCount__),c=this.__iteratees__,u=c?c.length:0,l=0,f=[];e:for(;s--&&h>l;){a+=t;for(var p=-1,d=e[a];++p<u;){var m=c[p],g=m.iteratee,_=m.type;if(_==z){if(m.done&&(i?a>m.index:a<m.index)&&(m.count=0,m.done=!1),m.index=a,!m.done){var v=m.limit;if(!(m.done=v>-1?m.count++>=v:!g(d)))continue e}}else{var y=g(d);if(_==W)d=y;else if(!y){if(_==U)continue e;break e}}}f[l++]=d}return f}function Wt(){this.__data__={}}function Gt(e){return this.has(e)&&delete this.__data__[e]}function jt(e){return"__proto__"==e?E:this.__data__[e]}function Ht(e){return"__proto__"!=e&&Is.call(this.__data__,e)}function Xt(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this}function Yt(e){var t=e?e.length:0;for(this.data={hash:Qs(null),set:new js};t--;)this.push(e[t])}function qt(e,t){var i=e.data,n="string"==typeof t||fo(t)?i.set.has(t):i.hash[t];return n?0:-1}function Kt(e){var t=this.data;"string"==typeof e||fo(e)?t.set.add(e):t.hash[e]=!0}function Zt(e,t){var i=-1,n=e.length;for(t||(t=ms(n));++i<n;)t[i]=e[i];return t}function Qt(e,t){for(var i=-1,n=e.length;++i<n&&t(e[i],i,e)!==!1;);return e}function ei(e,t){for(var i=e.length;i--&&t(e[i],i,e)!==!1;);return e}function ti(e,t){for(var i=-1,n=e.length;++i<n;)if(!t(e[i],i,e))return!1;return!0}function ii(e,t){for(var i=-1,n=e.length,r=-1,o=[];++i<n;){var s=e[i];t(s,i,e)&&(o[++r]=s)}return o}function ni(e,t){for(var i=-1,n=e.length,r=ms(n);++i<n;)r[i]=t(e[i],i,e);return r}function ri(e){for(var t=-1,i=e.length,n=sa;++t<i;){var r=e[t];r>n&&(n=r)}return n}function oi(e){for(var t=-1,i=e.length,n=aa;++t<i;){var r=e[t];n>r&&(n=r)}return n}function si(e,t,i,n){var r=-1,o=e.length;for(n&&o&&(i=e[++r]);++r<o;)i=t(i,e[r],r,e);return i}function ai(e,t,i,n){var r=e.length;for(n&&r&&(i=e[--r]);r--;)i=t(i,e[r],r,e);return i}function hi(e,t){for(var i=-1,n=e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}function ci(e){for(var t=e.length,i=0;t--;)i+=+e[t]||0;return i}function ui(e,t){return"undefined"==typeof e?t:e}function li(e,t,i,n){return"undefined"!=typeof e&&Is.call(n,i)?e:t}function fi(e,t,i){var n=vh(t);if(!i)return di(t,e,n);for(var r=-1,o=n.length;++r<o;){var s=n[r],a=e[s],h=i(a,t[s],s,e,t);(h===h?h===a:a!==a)&&("undefined"!=typeof a||s in e)||(e[s]=h)}return e}function pi(e,t){for(var i=-1,n=e.length,r=kn(n),o=t.length,s=ms(o);++i<o;){var a=t[i];r?(a=parseFloat(a),s[i]=Vn(a,n)?e[a]:E):s[i]=e[a]}return s}function di(e,t,i){i||(i=t,t={});for(var n=-1,r=i.length;++n<r;){var o=i[n];t[o]=e[o]}return t}function mi(e,t,i){var n=typeof e;return"function"==n?"undefined"==typeof t?e:Zi(e,t,i):null==e?is:"object"==n?Ri(e):"undefined"==typeof t?Bi(e+""):Li(e+"",t)}function gi(e,t,i,n,r,o,s){var a;if(i&&(a=r?i(e,n,r):i(e)),"undefined"!=typeof a)return a;if(!fo(e))return e;var h=sh(e);if(h){if(a=Rn(e),!t)return Zt(e,a)}else{var c=Ls.call(e),u=c==Z;if(c!=$&&c!=H&&(!u||r))return Nt[c]?On(e,c,t):r?e:{};if(a=Ln(u?{}:e),!t)return di(e,a,vh(e))}o||(o=[]),s||(s=[]);for(var l=o.length;l--;)if(o[l]==e)return s[l];return o.push(e),s.push(a),(h?Qt:Ei)(e,function(n,r){a[r]=gi(n,t,i,r,e,o,s)}),a}function _i(e,t,i){if("function"!=typeof e)throw new Ms(G);return Hs(function(){e.apply(E,i)},t)}function vi(e,t){var i=e?e.length:0,n=[];if(!i)return n;var r=-1,s=Dn(),a=s==o,h=a&&t.length>=200?Ta(t):null,c=t.length;h&&(s=qt,a=!1,t=h);e:for(;++r<i;){var u=e[r];if(a&&u===u){for(var l=c;l--;)if(t[l]===u)continue e;n.push(u)}else s(t,u,0)<0&&n.push(u)}return n}function yi(e,t){var i=!0;return _a(e,function(e,n,r){return i=!!t(e,n,r)}),i}function xi(e,t,i,n){var r=e.length;for(i=null==i?0:+i||0,0>i&&(i=-i>r?0:r+i),n="undefined"==typeof n||n>r?r:+n||0,0>n&&(n+=r),r=i>n?0:n>>>0,i>>>=0;r>i;)e[i++]=t;return e}function bi(e,t){var i=[];return _a(e,function(e,n,r){t(e,n,r)&&i.push(e)}),i}function Ti(e,t,i,n){var r;return i(e,function(e,i,o){return t(e,i,o)?(r=n?i:e,!1):void 0}),r}function wi(e,t,i){for(var n=-1,r=e.length,o=-1,s=[];++n<r;){var a=e[n];if(_(a)&&kn(a.length)&&(sh(a)||oo(a))){t&&(a=wi(a,t,i));var h=-1,c=a.length;for(s.length+=c;++h<c;)s[++o]=a[h]}else i||(s[++o]=a)}return s}function Mi(e,t){return ya(e,t,Co)}function Ei(e,t){return ya(e,t,vh)}function Ai(e,t){return xa(e,t,vh)}function Pi(e,t){for(var i=-1,n=t.length,r=-1,o=[];++i<n;){var s=t[i];hh(e[s])&&(o[++r]=s)}return o}function Si(e,t,i,n,r,o){if(e===t)return 0!==e||1/e==1/t;var s=typeof e,a=typeof t;return"function"!=s&&"object"!=s&&"function"!=a&&"object"!=a||null==e||null==t?e!==e&&t!==t:Ci(e,t,Si,i,n,r,o)}function Ci(e,t,i,n,r,o,s){var a=sh(e),h=sh(t),c=X,u=X;a||(c=Ls.call(e),c==H?c=$:c!=$&&(a=bo(e))),h||(u=Ls.call(t),u==H?u=$:u!=$&&(h=bo(t)));var l=c==$||r&&c==Z,f=u==$||r&&u==Z,p=c==u;if(p&&!a&&!l)return An(e,t,c);if(r){if(!(p||l&&f))return!1}else{var d=l&&Is.call(e,"__wrapped__"),m=f&&Is.call(t,"__wrapped__");if(d||m)return i(d?e.value():e,m?t.value():t,n,r,o,s);if(!p)return!1}o||(o=[]),s||(s=[]);for(var g=o.length;g--;)if(o[g]==e)return s[g]==t;o.push(e),s.push(t);var _=(a?En:Pn)(e,t,i,n,r,o,s);return o.pop(),s.pop(),_}function Di(e,t,i,n,r){for(var o=-1,s=t.length,a=!r;++o<s;)if(a&&n[o]?i[o]!==e[t[o]]:!(t[o]in e))return!1;for(o=-1;++o<s;){var h=t[o],c=e[h],u=i[o];if(a&&n[o])var l="undefined"!=typeof c||h in e;else l=r?r(c,u,h):E,"undefined"==typeof l&&(l=Si(u,c,r,!0));if(!l)return!1}return!0}function Ii(e,t){var i=[];return _a(e,function(e,n,r){i.push(t(e,n,r))}),i}function Ri(e){var t=vh(e),i=t.length;if(!i)return ts(!0);if(1==i){var n=t[0],r=e[n];if(Nn(r))return function(e){return null!=e&&e[n]===r&&("undefined"!=typeof r||n in Yn(e))}}for(var o=ms(i),s=ms(i);i--;)r=e[t[i]],o[i]=r,s[i]=Nn(r);return function(e){return null!=e&&Di(Yn(e),t,o,s)}}function Li(e,t){return Nn(t)?function(i){return null!=i&&i[e]===t&&("undefined"!=typeof t||e in Yn(i))}:function(i){return null!=i&&Si(t,i[e],null,!0)}}function Oi(e,t,i,n,r){if(!fo(e))return e;var o=kn(t.length)&&(sh(t)||bo(t));return(o?Qt:Ei)(t,function(t,s,a){if(_(t))return n||(n=[]),r||(r=[]),Vi(e,a,s,Oi,i,n,r);var h=e[s],c=i?i(h,t,s,e,a):E,u="undefined"==typeof c;u&&(c=t),!o&&"undefined"==typeof c||!u&&(c===c?c===h:h!==h)||(e[s]=c)}),e}function Vi(e,t,i,n,r,o,s){for(var a=o.length,h=t[i];a--;)if(o[a]==h)return void(e[i]=s[a]);var c=e[i],u=r?r(c,h,i,e,t):E,l="undefined"==typeof u;l&&(u=h,kn(h.length)&&(sh(h)||bo(h))?u=sh(c)?c:c&&c.length?Zt(c):[]:ch(h)||oo(h)?u=oo(c)?Mo(c):ch(c)?c:{}:l=!1),o.push(h),s.push(u),l?e[i]=n(u,h,r,o,s):(u===u?u!==c:c===c)&&(e[i]=u)}function Bi(e){return function(t){return null==t?E:t[e]}}function Fi(e,t){return e+zs(oa()*(t-e+1))}function ki(e,t,i,n,r){return r(e,function(e,r,o){i=n?(n=!1,e):t(i,e,r,o)}),i}function Ni(e,t,i){var n=-1,r=e.length;t=null==t?0:+t||0,0>t&&(t=-t>r?0:r+t),i="undefined"==typeof i||i>r?r:+i||0,0>i&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var o=ms(r);++n<r;)o[n]=e[n+t];return o}function zi(e,t){var i;return _a(e,function(e,n,r){return i=t(e,n,r),!i}),!!i}function Ui(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}function Wi(e,t,i){var n=-1,r=e.length,o=kn(r)?ms(r):[];return _a(e,function(e){for(var i=t.length,r=ms(i);i--;)r[i]=null==e?E:e[t[i]];o[++n]={criteria:r,index:n,value:e}}),Ui(o,function(e,t){return f(e,t,i)})}function Gi(e,t){var i=0;return _a(e,function(e,n,r){i+=+t(e,n,r)||0}),i}function ji(e,t){var i=-1,n=Dn(),r=e.length,s=n==o,a=s&&r>=200,h=a?Ta():null,c=[];h?(n=qt,s=!1):(a=!1,h=t?[]:c);e:for(;++i<r;){var u=e[i],l=t?t(u,i,e):u;if(s&&u===u){for(var f=h.length;f--;)if(h[f]===l)continue e;t&&h.push(l),c.push(u)}else n(h,l,0)<0&&((t||a)&&h.push(l),c.push(u))}return c}function Hi(e,t){for(var i=-1,n=t.length,r=ms(n);++i<n;)r[i]=e[t[i]];return r}function Xi(e,t,i,n){for(var r=e.length,o=n?r:-1;(n?o--:++o<r)&&t(e[o],o,e););return i?Ni(e,n?0:o,n?o+1:r):Ni(e,n?o+1:0,n?r:o)}function Yi(e,t){var i=e;i instanceof Q&&(i=i.value());for(var n=-1,r=t.length;++n<r;){var o=[i],s=t[n];Ws.apply(o,s.args),i=s.func.apply(s.thisArg,o)}return i}function qi(e,t,i){var n=0,r=e?e.length:n;if("number"==typeof t&&t===t&&ua>=r){for(;r>n;){var o=n+r>>>1,s=e[o];(i?t>=s:t>s)?n=o+1:r=o}return r}return Ki(e,t,is,i)}function Ki(e,t,i,n){t=i(t);for(var r=0,o=e?e.length:0,s=t!==t,a="undefined"==typeof t;o>r;){var h=zs((r+o)/2),c=i(e[h]),u=c===c;if(s)var l=u||n;else l=a?u&&(n||"undefined"!=typeof c):n?t>=c:t>c;l?r=h+1:o=h}return ta(o,ca)}function Zi(e,t,i){if("function"!=typeof e)return is;if("undefined"==typeof t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,r){return e.call(t,i,n,r)};case 4:return function(i,n,r,o){return e.call(t,i,n,r,o)};case 5:return function(i,n,r,o,s){return e.call(t,i,n,r,o,s)}}return function(){return e.apply(t,arguments)}}function Qi(e){return Fs.call(e,0)}function Ji(e,t,i){for(var n=i.length,r=-1,o=ea(e.length-n,0),s=-1,a=t.length,h=ms(o+a);++s<a;)h[s]=t[s];for(;++r<n;)h[i[r]]=e[r];for(;o--;)h[s++]=e[r++];return h}function $i(e,t,i){for(var n=-1,r=i.length,o=-1,s=ea(e.length-r,0),a=-1,h=t.length,c=ms(s+h);++o<s;)c[o]=e[o];for(var u=o;++a<h;)c[u+a]=t[a];for(;++n<r;)c[u+i[n]]=e[o++];return c}function en(e,t){return function(i,n,r){var o=t?t():{};if(n=Cn(n,r,3),sh(i))for(var s=-1,a=i.length;++s<a;){var h=i[s];e(o,h,n(h,s,i),i)}else _a(i,function(t,i,r){e(o,t,n(t,i,r),r)});return o}}function tn(e){return function(){var t=arguments,i=t.length,n=t[0];if(2>i||null==n)return n;var r=t[i-2],o=t[i-1],s=t[3];i>3&&"function"==typeof r?(r=Zi(r,o,5),i-=2):(r=i>2&&"function"==typeof o?o:null,i-=r?1:0),s&&Bn(t[1],t[2],s)&&(r=3==i?null:r,i=2);for(var a=0;++a<i;){var h=t[a];h&&e(n,h,r)}return n}}function nn(e,t){return function(i,n){var r=i?i.length:0;if(!kn(r))return e(i,n);for(var o=t?r:-1,s=Yn(i);(t?o--:++o<r)&&n(s[o],o,s)!==!1;);return i}}function rn(e){return function(t,i,n){for(var r=Yn(t),o=n(t),s=o.length,a=e?s:-1;e?a--:++a<s;){var h=o[a];if(i(r[h],h,r)===!1)break}return t}}function on(e,t){function i(){var r=this&&this!==Jt&&this instanceof i?n:e;return r.apply(t,arguments)}var n=an(e);return i}function sn(e){return function(t){for(var i=-1,n=$o(No(t)),r=n.length,o="";++i<r;)o=e(o,n[i],i);return o}}function an(e){return function(){var t=ga(e.prototype),i=e.apply(t,arguments);return fo(i)?i:t}}function hn(e){function t(i,n,r){r&&Bn(i,n,r)&&(n=null);var o=Mn(i,e,null,null,null,null,null,n);return o.placeholder=t.placeholder,o}return t}function cn(e,t){return function(i,n,r){r&&Bn(i,n,r)&&(n=null);var o=Cn(),s=null==n;if(o===mi&&s||(s=!1,n=o(n,r,3)),s){var a=sh(i);if(a||!xo(i))return e(a?i:Xn(i));n=h}return Sn(i,n,t)}}function un(e,t){return function(i,n,o){if(n=Cn(n,o,3),sh(i)){var s=r(i,n,t);return s>-1?i[s]:E}return Ti(i,n,e)}}function ln(e){return function(t,i,n){return t&&t.length?(i=Cn(i,n,3),r(t,i,e)):-1}}function fn(e){return function(t,i,n){return i=Cn(i,n,3),Ti(t,i,e,!0)}}function pn(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};for(var i,n=e?t:-1,r=0,o=ms(t);e?n--:++n<t;){var s=o[r++]=arguments[n];if("function"!=typeof s)throw new Ms(G);var a=i?"":Ma(s);i="wrapper"==a?new v([]):i}for(n=i?-1:t;++n<t;){s=o[n],a=Ma(s);var h="wrapper"==a?wa(s):null;i=h&&Fn(h[0])?i[Ma(h[0])].apply(i,h[3]):1==s.length&&Fn(s)?i[a]():i.thru(s)}return function(){var e=arguments;if(i&&1==e.length&&sh(e[0]))return i.plant(e[0]).value();for(var n=0,r=o[n].apply(this,e);++n<t;)r=o[n].call(this,r);return r}}}function dn(e,t){return function(i,n,r){return"function"==typeof n&&"undefined"==typeof r&&sh(i)?e(i,n):t(i,Zi(n,r,3))}}function mn(e){return function(t,i,n){return("function"!=typeof i||"undefined"!=typeof n)&&(i=Zi(i,n,3)),e(t,i,Co)}}function gn(e){return function(t,i,n){return("function"!=typeof i||"undefined"!=typeof n)&&(i=Zi(i,n,3)),e(t,i)}}function _n(e){return function(t,i,n){return t=a(t),t&&(e?t:"")+bn(t,i,n)+(e?"":t)}}function vn(e){var t=$r(function(i,n){var r=y(n,t.placeholder);return Mn(i,e,null,n,r)});return t}function yn(e,t){return function(i,n,r,o){var s=arguments.length<3;return"function"==typeof n&&"undefined"==typeof o&&sh(i)?e(i,n,r,s):ki(i,Cn(n,o,4),r,s,t)}}function xn(e,t,i,n,r,o,s,a,h,c){function u(){for(var x=arguments.length,b=x,T=ms(x);b--;)T[b]=arguments[b];if(n&&(T=Ji(T,n,r)),o&&(T=$i(T,o,s)),d||g){var w=u.placeholder,M=y(T,w);if(x-=M.length,c>x){var A=a?Zt(a):null,C=ea(c-x,0),D=d?M:null,I=d?null:M,O=d?T:null,V=d?null:T;t|=d?R:L,t&=~(d?L:R),m||(t&=~(P|S));var B=[e,t,i,O,D,V,I,A,h,C],F=xn.apply(E,B);return Fn(e)&&Ea(F,B),F.placeholder=w,F}}var k=f?i:this;p&&(e=k[v]),a&&(T=Gn(T,a)),l&&h<T.length&&(T.length=h);var N=this&&this!==Jt&&this instanceof u?_||an(e):e;return N.apply(k,T)}var l=t&O,f=t&P,p=t&S,d=t&D,m=t&C,g=t&I,_=!p&&an(e),v=e;return u}function bn(e,t,i){var n=e.length;if(t=+t,n>=t||!Js(t))return"";var r=t-n;return i=null==i?" ":i+"",Ho(i,ks(r/i.length)).slice(0,r)}function Tn(e,t,i,n){function r(){for(var t=-1,a=arguments.length,h=-1,c=n.length,u=ms(a+c);++h<c;)u[h]=n[h];for(;a--;)u[h++]=arguments[++t];var l=this&&this!==Jt&&this instanceof r?s:e;return l.apply(o?i:this,u)}var o=t&P,s=an(e);return r}function wn(e){return function(t,i,n,r){var o=Cn(n);return o===mi&&null==n?qi(t,i,e):Ki(t,i,o(n,r,1),e)}}function Mn(e,t,i,n,r,o,s,a){var h=t&S;if(!h&&"function"!=typeof e)throw new Ms(G);var c=n?n.length:0;if(c||(t&=~(R|L),n=r=null),c-=r?r.length:0,t&L){var u=n,l=r;n=r=null}var f=h?null:wa(e),p=[e,t,i,n,r,u,l,o,s,a];if(f&&(zn(p,f),t=p[1],a=p[9]),p[9]=null==a?h?0:e.length:ea(a-c,0)||0,t==P)var d=on(p[0],p[2]);else d=t!=R&&t!=(P|R)||p[4].length?xn.apply(E,p):Tn.apply(E,p);var m=f?ba:Ea;return m(d,p)}function En(e,t,i,n,r,o,s){var a=-1,h=e.length,c=t.length,u=!0;if(h!=c&&!(r&&c>h))return!1;for(;u&&++a<h;){var l=e[a],f=t[a];if(u=E,n&&(u=r?n(f,l,a):n(l,f,a)),"undefined"==typeof u)if(r)for(var p=c;p--&&(f=t[p],!(u=l&&l===f||i(l,f,n,r,o,s))););else u=l&&l===f||i(l,f,n,r,o,s)}return!!u}function An(e,t,i){switch(i){case Y:case q:return+e==+t;case K:return e.name==t.name&&e.message==t.message;case J:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case et:case it:return e==t+""}return!1}function Pn(e,t,i,n,r,o,s){var a=vh(e),h=a.length,c=vh(t),u=c.length;if(h!=u&&!r)return!1;for(var l=r,f=-1;++f<h;){var p=a[f],d=r?p in t:Is.call(t,p);if(d){var m=e[p],g=t[p];d=E,n&&(d=r?n(g,m,p):n(m,g,p)),"undefined"==typeof d&&(d=m&&m===g||i(m,g,n,r,o,s))}if(!d)return!1;l||(l="constructor"==p)}if(!l){var _=e.constructor,v=t.constructor;if(_!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof v&&v instanceof v))return!1}return!0}function Sn(e,t,i){var n=i?aa:sa,r=n,o=r;return _a(e,function(e,s,a){var h=t(e,s,a);((i?r>h:h>r)||h===n&&h===o)&&(r=h,o=e)}),o}function Cn(e,i,n){var r=t.callback||es;return r=r===es?mi:r,n?r(e,i,n):r}function Dn(e,i,n){var r=t.indexOf||or;return r=r===or?o:r,e?r(e,i,n):r}function In(e,t,i){for(var n=-1,r=i?i.length:0;++n<r;){var o=i[n],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=ta(t,e+s);break;case"takeRight":e=ea(e,t-s)}}return{start:e,end:t}}function Rn(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Is.call(e,"index")&&(i.index=e.index,i.input=e.input),i}function Ln(e){var t=e.constructor;return"function"==typeof t&&t instanceof t||(t=bs),new t}function On(e,t,i){var n=e.constructor;
switch(t){case rt:return Qi(e);case Y:case q:return new n(+e);case ot:case st:case at:case ht:case ct:case ut:case lt:case ft:case pt:var r=e.buffer;return new n(i?Qi(r):r,e.byteOffset,e.length);case J:case it:return new n(e);case et:var o=new n(e.source,At.exec(e));o.lastIndex=e.lastIndex}return o}function Vn(e,t){return e=+e,t=null==t?fa:t,e>-1&&e%1==0&&t>e}function Bn(e,t,i){if(!fo(i))return!1;var n=typeof t;if("number"==n)var r=i.length,o=kn(r)&&Vn(t,r);else o="string"==n&&t in i;if(o){var s=i[t];return e===e?e===s:s!==s}return!1}function Fn(e){var i=Ma(e);return!!i&&e===t[i]&&i in Q.prototype}function kn(e){return"number"==typeof e&&e>-1&&e%1==0&&fa>=e}function Nn(e){return e===e&&(0===e?1/e>0:!fo(e))}function zn(e,t){var i=e[1],n=t[1],r=i|n,o=O>r,s=n==O&&i==D||n==O&&i==V&&e[7].length<=t[8]||n==(O|V)&&i==D;if(!o&&!s)return e;n&P&&(e[2]=t[2],r|=i&P?0:C);var a=t[3];if(a){var h=e[3];e[3]=h?Ji(h,a,t[4]):Zt(a),e[4]=h?y(e[3],j):Zt(t[4])}return a=t[5],a&&(h=e[5],e[5]=h?$i(h,a,t[6]):Zt(a),e[6]=h?y(e[5],j):Zt(t[6])),a=t[7],a&&(e[7]=Zt(a)),n&O&&(e[8]=null==e[8]?t[8]:ta(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=r,e}function Un(e,t){e=Yn(e);for(var i=-1,n=t.length,r={};++i<n;){var o=t[i];o in e&&(r[o]=e[o])}return r}function Wn(e,t){var i={};return Mi(e,function(e,n,r){t(e,n,r)&&(i[n]=e)}),i}function Gn(e,t){for(var i=e.length,n=ta(t.length,i),r=Zt(e);n--;){var o=t[n];e[n]=Vn(o,i)?r[o]:E}return e}function jn(e){{var i;t.support}if(!_(e)||Ls.call(e)!=$||!Is.call(e,"constructor")&&(i=e.constructor,"function"==typeof i&&!(i instanceof i)))return!1;var n;return Mi(e,function(e,t){n=t}),"undefined"==typeof n||Is.call(e,n)}function Hn(e){for(var i=Co(e),n=i.length,r=n&&e.length,o=t.support,s=r&&kn(r)&&(sh(e)||o.nonEnumArgs&&oo(e)),a=-1,h=[];++a<n;){var c=i[a];(s&&Vn(c,r)||Is.call(e,c))&&h.push(c)}return h}function Xn(e){return null==e?[]:kn(e.length)?fo(e)?e:bs(e):Oo(e)}function Yn(e){return fo(e)?e:bs(e)}function qn(e){return e instanceof Q?e.clone():new v(e.__wrapped__,e.__chain__,Zt(e.__actions__))}function Kn(e,t,i){t=(i?Bn(e,t,i):null==t)?1:ea(+t||1,1);for(var n=0,r=e?e.length:0,o=-1,s=ms(ks(r/t));r>n;)s[++o]=Ni(e,n,n+=t);return s}function Zn(e){for(var t=-1,i=e?e.length:0,n=-1,r=[];++t<i;){var o=e[t];o&&(r[++n]=o)}return r}function Qn(e,t,i){var n=e?e.length:0;return n?((i?Bn(e,t,i):null==t)&&(t=1),Ni(e,0>t?0:t)):[]}function Jn(e,t,i){var n=e?e.length:0;return n?((i?Bn(e,t,i):null==t)&&(t=1),t=n-(+t||0),Ni(e,0,0>t?0:t)):[]}function $n(e,t,i){return e&&e.length?Xi(e,Cn(t,i,3),!0,!0):[]}function er(e,t,i){return e&&e.length?Xi(e,Cn(t,i,3),!0):[]}function tr(e,t,i,n){var r=e?e.length:0;return r?(i&&"number"!=typeof i&&Bn(e,t,i)&&(i=0,n=r),xi(e,t,i,n)):[]}function ir(e){return e?e[0]:E}function nr(e,t,i){var n=e?e.length:0;return i&&Bn(e,t,i)&&(t=!1),n?wi(e,t):[]}function rr(e){var t=e?e.length:0;return t?wi(e,!0):[]}function or(e,t,i){var n=e?e.length:0;if(!n)return-1;if("number"==typeof i)i=0>i?ea(n+i,0):i;else if(i){var r=qi(e,t),s=e[r];return(t===t?t===s:s!==s)?r:-1}return o(e,t,i||0)}function sr(e){return Jn(e,1)}function ar(){for(var e=[],t=-1,i=arguments.length,n=[],r=Dn(),s=r==o;++t<i;){var a=arguments[t];(sh(a)||oo(a))&&(e.push(a),n.push(s&&a.length>=120?Ta(t&&a):null))}i=e.length;var h=e[0],c=-1,u=h?h.length:0,l=[],f=n[0];e:for(;++c<u;)if(a=h[c],(f?qt(f,a):r(l,a,0))<0){for(t=i;--t;){var p=n[t];if((p?qt(p,a):r(e[t],a,0))<0)continue e}f&&f.push(a),l.push(a)}return l}function hr(e){var t=e?e.length:0;return t?e[t-1]:E}function cr(e,t,i){var n=e?e.length:0;if(!n)return-1;var r=n;if("number"==typeof i)r=(0>i?ea(n+i,0):ta(i||0,n-1))+1;else if(i){r=qi(e,t,!0)-1;var o=e[r];return(t===t?t===o:o!==o)?r:-1}if(t!==t)return g(e,r,!0);for(;r--;)if(e[r]===t)return r;return-1}function ur(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var i=0,n=Dn(),r=e.length;++i<r;)for(var o=0,s=e[i];(o=n(t,s,o))>-1;)Xs.call(t,o,1);return t}function lr(e,t,i){var n=-1,r=e?e.length:0,o=[];for(t=Cn(t,i,3);++n<r;){var s=e[n];t(s,n,e)&&(o.push(s),Xs.call(e,n--,1),r--)}return o}function fr(e){return Qn(e,1)}function pr(e,t,i){var n=e?e.length:0;return n?(i&&"number"!=typeof i&&Bn(e,t,i)&&(t=0,i=n),Ni(e,t,i)):[]}function dr(e,t,i){var n=e?e.length:0;return n?((i?Bn(e,t,i):null==t)&&(t=1),Ni(e,0,0>t?0:t)):[]}function mr(e,t,i){var n=e?e.length:0;return n?((i?Bn(e,t,i):null==t)&&(t=1),t=n-(+t||0),Ni(e,0>t?0:t)):[]}function gr(e,t,i){return e&&e.length?Xi(e,Cn(t,i,3),!1,!0):[]}function _r(e,t,i){return e&&e.length?Xi(e,Cn(t,i,3)):[]}function vr(e,t,i,n){var r=e?e.length:0;if(!r)return[];null!=t&&"boolean"!=typeof t&&(n=i,i=Bn(e,t,n)?null:t,t=!1);var s=Cn();return(s!==mi||null!=i)&&(i=s(i,n,3)),t&&Dn()==o?x(e,i):ji(e,i)}function yr(e){for(var t=-1,i=(e&&e.length&&ri(ni(e,Ds)))>>>0,n=ms(i);++t<i;)n[t]=ni(e,Bi(t));return n}function xr(){for(var e=-1,t=arguments.length;++e<t;){var i=arguments[e];if(sh(i)||oo(i))var n=n?vi(n,i).concat(vi(i,n)):i}return n?ji(n):[]}function br(e,t){var i=-1,n=e?e.length:0,r={};for(!n||t||sh(e[0])||(t=[]);++i<n;){var o=e[i];t?r[o]=t[i]:o&&(r[o[0]]=o[1])}return r}function Tr(e){var i=t(e);return i.__chain__=!0,i}function wr(e,t,i){return t.call(i,e),e}function Mr(e,t,i){return t.call(i,e)}function Er(){return Tr(this)}function Ar(){return new v(this.value(),this.__chain__)}function Pr(e){for(var t,n=this;n instanceof i;){var r=qn(n);t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t}function Sr(){var e=this.__wrapped__;return e instanceof Q?(this.__actions__.length&&(e=new Q(this)),new v(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})}function Cr(){return this.value()+""}function Dr(){return Yi(this.__wrapped__,this.__actions__)}function Ir(e,t,i){var n=sh(e)?ti:yi;return i&&Bn(e,t,i)&&(t=null),("function"!=typeof t||"undefined"!=typeof i)&&(t=Cn(t,i,3)),n(e,t)}function Rr(e,t,i){var n=sh(e)?ii:bi;return t=Cn(t,i,3),n(e,t)}function Lr(e,t){return Fa(e,Ri(t))}function Or(e,t,i,n){var r=e?e.length:0;return kn(r)||(e=Oo(e),r=e.length),r?(i="number"!=typeof i||n&&Bn(t,i,n)?0:0>i?ea(r+i,0):i||0,"string"==typeof e||!sh(e)&&xo(e)?r>i&&e.indexOf(t,i)>-1:Dn(e,t,i)>-1):!1}function Vr(e,t,i){var n=sh(e)?ni:Ii;return t=Cn(t,i,3),n(e,t)}function Br(e,t){return Vr(e,Bi(t))}function Fr(e,t,i){var n=sh(e)?ii:bi;return t=Cn(t,i,3),n(e,function(e,i,n){return!t(e,i,n)})}function kr(e,t,i){if(i?Bn(e,t,i):null==t){e=Xn(e);var n=e.length;return n>0?e[Fi(0,n-1)]:E}var r=Nr(e);return r.length=ta(0>t?0:+t||0,r.length),r}function Nr(e){e=Xn(e);for(var t=-1,i=e.length,n=ms(i);++t<i;){var r=Fi(0,t);t!=r&&(n[t]=n[r]),n[r]=e[t]}return n}function zr(e){var t=e?e.length:0;return kn(t)?t:vh(e).length}function Ur(e,t,i){var n=sh(e)?hi:zi;return i&&Bn(e,t,i)&&(t=null),("function"!=typeof t||"undefined"!=typeof i)&&(t=Cn(t,i,3)),n(e,t)}function Wr(e,t,i){if(null==e)return[];var n=-1,r=e.length,o=kn(r)?ms(r):[];return i&&Bn(e,t,i)&&(t=null),t=Cn(t,i,3),_a(e,function(e,i,r){o[++n]={criteria:t(e,i,r),index:n,value:e}}),Ui(o,l)}function Gr(){var e=arguments,t=e[0],i=e[3],n=0,r=e.length-1;if(null==t)return[];for(var o=ms(r);r>n;)o[n]=e[++n];return i&&Bn(e[1],e[2],i)&&(o=e[1]),Wi(t,wi(o),[])}function jr(e,t,i,n){return null==e?[]:(n&&Bn(t,i,n)&&(i=null),sh(t)||(t=null==t?[]:[t]),sh(i)||(i=null==i?[]:[i]),Wi(e,t,i))}function Hr(e,t){return Rr(e,Ri(t))}function Xr(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Ms(G);var i=e;e=t,t=i}return e=Js(e=+e)?e:0,function(){return--e<1?t.apply(this,arguments):void 0}}function Yr(e,t,i){return i&&Bn(e,t,i)&&(t=null),t=e&&null==t?e.length:ea(+t||0,0),Mn(e,O,null,null,null,null,t)}function qr(e,t){var i;if("function"!=typeof t){if("function"!=typeof e)throw new Ms(G);var n=e;e=t,t=n}return function(){return--e>0?i=t.apply(this,arguments):t=null,i}}function Kr(e,t,i){function n(){f&&Ns(f),h&&Ns(h),h=f=p=E}function r(){var i=t-(Ya()-u);if(0>=i||i>t){h&&Ns(h);var n=p;h=f=p=E,n&&(d=Ya(),c=e.apply(l,a),f||h||(a=l=null))}else f=Hs(r,i)}function o(){f&&Ns(f),h=f=p=E,(g||m!==t)&&(d=Ya(),c=e.apply(l,a),f||h||(a=l=null))}function s(){if(a=arguments,u=Ya(),l=this,p=g&&(f||!_),m===!1)var i=_&&!f;else{h||_||(d=u);var n=m-(u-d),s=0>=n||n>m;s?(h&&(h=Ns(h)),d=u,c=e.apply(l,a)):h||(h=Hs(o,n))}return s&&f?f=Ns(f):f||t===m||(f=Hs(r,t)),i&&(s=!0,c=e.apply(l,a)),!s||f||h||(a=l=null),c}var a,h,c,u,l,f,p,d=0,m=!1,g=!0;if("function"!=typeof e)throw new Ms(G);if(t=0>t?0:+t||0,i===!0){var _=!0;g=!1}else fo(i)&&(_=i.leading,m="maxWait"in i&&ea(+i.maxWait||0,t),g="trailing"in i?i.trailing:g);return s.cancel=n,s}function Zr(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Ms(G);var i=function(){var n=arguments,r=i.cache,o=t?t.apply(this,n):n[0];if(r.has(o))return r.get(o);var s=e.apply(this,n);return r.set(o,s),s};return i.cache=new Zr.Cache,i}function Qr(e){if("function"!=typeof e)throw new Ms(G);return function(){return!e.apply(this,arguments)}}function Jr(e){return qr(e,2)}function $r(e,t){if("function"!=typeof e)throw new Ms(G);return t=ea("undefined"==typeof t?e.length-1:+t||0,0),function(){for(var i=arguments,n=-1,r=ea(i.length-t,0),o=ms(r);++n<r;)o[n]=i[t+n];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,i[0],o);case 2:return e.call(this,i[0],i[1],o)}var s=ms(t+1);for(n=-1;++n<t;)s[n]=i[n];return s[t]=o,e.apply(this,s)}}function eo(e){if("function"!=typeof e)throw new Ms(G);return function(t){return e.apply(this,t)}}function to(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new Ms(G);return i===!1?n=!1:fo(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),zt.leading=n,zt.maxWait=+t,zt.trailing=r,Kr(e,t,zt)}function io(e,t){return t=null==t?is:t,Mn(t,R,null,[e],[])}function no(e,t,i,n){return t&&"boolean"!=typeof t&&Bn(e,t,i)?t=!1:"function"==typeof t&&(n=i,i=t,t=!1),i="function"==typeof i&&Zi(i,n,1),gi(e,t,i)}function ro(e,t,i){return t="function"==typeof t&&Zi(t,i,1),gi(e,!0,t)}function oo(e){var t=_(e)?e.length:E;return kn(t)&&Ls.call(e)==H}function so(e){return e===!0||e===!1||_(e)&&Ls.call(e)==Y}function ao(e){return _(e)&&Ls.call(e)==q}function ho(e){return!!e&&1===e.nodeType&&_(e)&&Ls.call(e).indexOf("Element")>-1}function co(e){if(null==e)return!0;var t=e.length;return kn(t)&&(sh(e)||xo(e)||oo(e)||_(e)&&hh(e.splice))?!t:!vh(e).length}function uo(e,t,i,n){if(i="function"==typeof i&&Zi(i,n,3),!i&&Nn(e)&&Nn(t))return e===t;var r=i?i(e,t):E;return"undefined"==typeof r?Si(e,t,i):!!r}function lo(e){return _(e)&&"string"==typeof e.message&&Ls.call(e)==K}function fo(e){var t=typeof e;return"function"==t||!!e&&"object"==t}function po(e,t,i,n){var r=vh(t),o=r.length;if(!o)return!0;if(null==e)return!1;if(i="function"==typeof i&&Zi(i,n,3),!i&&1==o){var s=r[0],a=t[s];if(Nn(a))return a===e[s]&&("undefined"!=typeof a||s in Yn(e))}for(var h=ms(o),c=ms(o);o--;)a=h[o]=t[r[o]],c[o]=Nn(a);return Di(Yn(e),r,h,c,i)}function mo(e){return vo(e)&&e!=+e}function go(e){return null==e?!1:Ls.call(e)==Z?Vs.test(Cs.call(e)):_(e)&&St.test(e)}function _o(e){return null===e}function vo(e){return"number"==typeof e||_(e)&&Ls.call(e)==J}function yo(e){return _(e)&&Ls.call(e)==et||!1}function xo(e){return"string"==typeof e||_(e)&&Ls.call(e)==it}function bo(e){return _(e)&&kn(e.length)&&!!kt[Ls.call(e)]}function To(e){return"undefined"==typeof e}function wo(e){var t=e?e.length:0;return kn(t)?t?Zt(e):[]:Oo(e)}function Mo(e){return di(e,Co(e))}function Eo(e,t,i){var n=ga(e);return i&&Bn(e,t,i)&&(t=null),t?di(t,n,vh(t)):n}function Ao(e){return Pi(e,Co(e))}function Po(e,t){return e?Is.call(e,t):!1}function So(e,t,i){i&&Bn(e,t,i)&&(t=null);for(var n=-1,r=vh(e),o=r.length,s={};++n<o;){var a=r[n],h=e[a];t?Is.call(s,h)?s[h].push(a):s[h]=[a]:s[h]=a}return s}function Co(e){if(null==e)return[];fo(e)||(e=bs(e));var t=e.length;t=t&&kn(t)&&(sh(e)||ma.nonEnumArgs&&oo(e))&&t||0;for(var i=e.constructor,n=-1,r="function"==typeof i&&i.prototype===e,o=ms(t),s=t>0;++n<t;)o[n]=n+"";for(var a in e)s&&Vn(a,t)||"constructor"==a&&(r||!Is.call(e,a))||o.push(a);return o}function Do(e,t,i){var n={};return t=Cn(t,i,3),Ei(e,function(e,i,r){n[i]=t(e,i,r)}),n}function Io(e){for(var t=-1,i=vh(e),n=i.length,r=ms(n);++t<n;){var o=i[t];r[t]=[o,e[o]]}return r}function Ro(e,t,i){var n=null==e?E:e[t];return"undefined"==typeof n&&(n=i),hh(n)?n.call(e):n}function Lo(e,t,i,n){var r=sh(e)||bo(e);if(t=Cn(t,n,4),null==i)if(r||fo(e)){var o=e.constructor;i=r?sh(e)?new o:[]:ga(hh(o)&&o.prototype)}else i={};return(r?Qt:Ei)(e,function(e,n,r){return t(i,e,n,r)}),i}function Oo(e){return Hi(e,vh(e))}function Vo(e){return Hi(e,Co(e))}function Bo(e,t,i){return t=+t||0,"undefined"==typeof i?(i=t,t=0):i=+i||0,e>=t&&i>e}function Fo(e,t,i){i&&Bn(e,t,i)&&(t=i=null);var n=null==e,r=null==t;if(null==i&&(r&&"boolean"==typeof e?(i=e,e=1):"boolean"==typeof t&&(i=t,r=!0)),n&&r&&(t=1,r=!1),e=+e||0,r?(t=e,e=0):t=+t||0,i||e%1||t%1){var o=oa();return ta(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return Fi(e,t)}function ko(e){return e=a(e),e&&e.charAt(0).toUpperCase()+e.slice(1)}function No(e){return e=a(e),e&&e.replace(Ct,p).replace(Mt,"")}function zo(e,t,i){e=a(e),t+="";var n=e.length;return i="undefined"==typeof i?n:ta(0>i?0:+i||0,n),i-=t.length,i>=0&&e.indexOf(t,i)==i}function Uo(e){return e=a(e),e&&xt.test(e)?e.replace(vt,d):e}function Wo(e){return e=a(e),e&&Rt.test(e)?e.replace(It,"\\$&"):e}function Go(e,t,i){e=a(e),t=+t;var n=e.length;if(n>=t||!Js(t))return e;var r=(t-n)/2,o=zs(r),s=ks(r);return i=bn("",s,i),i.slice(0,o)+e+i}function jo(e,t,i){return i&&Bn(e,t,i)&&(t=0),ra(e,t)}function Ho(e,t){var i="";if(e=a(e),t=+t,1>t||!e||!Js(t))return i;do t%2&&(i+=e),t=zs(t/2),e+=e;while(t);return i}function Xo(e,t,i){return e=a(e),i=null==i?0:ta(0>i?0:+i||0,e.length),e.lastIndexOf(t,i)==i}function Yo(e,i,n){var r=t.templateSettings;n&&Bn(e,i,n)&&(i=n=null),e=a(e),i=fi(fi({},n||i),r,li);var o,s,h=fi(fi({},i.imports),r.imports,li),c=vh(h),u=Hi(h,c),l=0,f=i.interpolate||Dt,p="__p += '",d=Ts((i.escape||Dt).source+"|"+f.source+"|"+(f===wt?Et:Dt).source+"|"+(i.evaluate||Dt).source+"|$","g"),g="//# sourceURL="+("sourceURL"in i?i.sourceURL:"lodash.templateSources["+ ++Ft+"]")+"\n";e.replace(d,function(t,i,n,r,a,h){return n||(n=r),p+=e.slice(l,h).replace(Lt,m),i&&(o=!0,p+="' +\n__e("+i+") +\n'"),a&&(s=!0,p+="';\n"+a+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=h+t.length,t}),p+="';\n";var _=i.variable;_||(p="with (obj) {\n"+p+"\n}\n"),p=(s?p.replace(dt,""):p).replace(mt,"$1").replace(gt,"$1;"),p="function("+(_||"obj")+") {\n"+(_?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var v=Sh(function(){return vs(c,g+"return "+p).apply(E,u)});if(v.source=p,lo(v))throw v;return v}function qo(e,t,i){var n=e;return(e=a(e))?(i?Bn(n,t,i):null==t)?e.slice(b(e),T(e)+1):(t+="",e.slice(c(e,t),u(e,t)+1)):e}function Ko(e,t,i){var n=e;return e=a(e),e?e.slice((i?Bn(n,t,i):null==t)?b(e):c(e,t+"")):e}function Zo(e,t,i){var n=e;return e=a(e),e?(i?Bn(n,t,i):null==t)?e.slice(0,T(e)+1):e.slice(0,u(e,t+"")+1):e}function Qo(e,t,i){i&&Bn(e,t,i)&&(t=null);var n=B,r=F;if(null!=t)if(fo(t)){var o="separator"in t?t.separator:o;n="length"in t?+t.length||0:n,r="omission"in t?a(t.omission):r}else n=+t||0;if(e=a(e),n>=e.length)return e;var s=n-r.length;if(1>s)return r;var h=e.slice(0,s);if(null==o)return h+r;if(yo(o)){if(e.slice(s).search(o)){var c,u,l=e.slice(0,s);for(o.global||(o=Ts(o.source,(At.exec(o)||"")+"g")),o.lastIndex=0;c=o.exec(l);)u=c.index;h=h.slice(0,null==u?s:u)}}else if(e.indexOf(o,s)!=s){var f=h.lastIndexOf(o);f>-1&&(h=h.slice(0,f))}return h+r}function Jo(e){return e=a(e),e&&yt.test(e)?e.replace(_t,w):e}function $o(e,t,i){return i&&Bn(e,t,i)&&(t=null),e=a(e),e.match(t||Ot)||[]}function es(e,t,i){return i&&Bn(e,t,i)&&(t=null),_(e)?ns(e):mi(e,t)}function ts(e){return function(){return e}}function is(e){return e}function ns(e){return Ri(gi(e,!0))}function rs(e,t){return Li(e+"",gi(t,!0))}function os(e,t,i){if(null==i){var n=fo(t),r=n&&vh(t),o=r&&r.length&&Pi(t,r);(o?o.length:n)||(o=!1,i=t,t=e,e=this)}o||(o=Pi(t,vh(t)));var s=!0,a=-1,h=hh(e),c=o.length;i===!1?s=!1:fo(i)&&"chain"in i&&(s=i.chain);for(;++a<c;){var u=o[a],l=t[u];e[u]=l,h&&(e.prototype[u]=function(t){return function(){var i=this.__chain__;if(s||i){var n=e(this.__wrapped__),r=n.__actions__=Zt(this.__actions__);return r.push({func:t,args:arguments,thisArg:e}),n.__chain__=i,n}var o=[this.value()];return Ws.apply(o,arguments),t.apply(e,o)}}(l))}return e}function ss(){return e._=Os,this}function as(){}function hs(e){return Bi(e+"")}function cs(e){return function(t){return null==e?E:e[t]}}function us(e,t,i){i&&Bn(e,t,i)&&(t=i=null),e=+e||0,i=null==i?1:+i||0,null==t?(t=e,e=0):t=+t||0;for(var n=-1,r=ea(ks((t-e)/(i||1)),0),o=ms(r);++n<r;)o[n]=e,e+=i;return o}function ls(e,t,i){if(e=+e,1>e||!Js(e))return[];var n=-1,r=ms(ta(e,ha));for(t=Zi(t,i,1);++n<e;)ha>n?r[n]=t(n):t(n);return r}function fs(e){var t=++Rs;return a(e)+t}function ps(e,t){return e+t}function ds(e,t,i){i&&Bn(e,t,i)&&(t=null);var n=Cn(),r=null==t;return n===mi&&r||(r=!1,t=n(t,i,3)),r?ci(sh(e)?e:Xn(e)):Gi(e,t)}e=e?$t.defaults(Jt.Object(),e,$t.pick(Jt,Bt)):Jt;var ms=e.Array,gs=e.Date,_s=e.Error,vs=e.Function,ys=e.Math,xs=e.Number,bs=e.Object,Ts=e.RegExp,ws=e.String,Ms=e.TypeError,Es=ms.prototype,As=bs.prototype,Ps=ws.prototype,Ss=(Ss=e.window)&&Ss.document,Cs=vs.prototype.toString,Ds=Bi("length"),Is=As.hasOwnProperty,Rs=0,Ls=As.toString,Os=e._,Vs=Ts("^"+Wo(Ls).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bs=go(Bs=e.ArrayBuffer)&&Bs,Fs=go(Fs=Bs&&new Bs(0).slice)&&Fs,ks=ys.ceil,Ns=e.clearTimeout,zs=ys.floor,Us=go(Us=bs.getPrototypeOf)&&Us,Ws=Es.push,Gs=As.propertyIsEnumerable,js=go(js=e.Set)&&js,Hs=e.setTimeout,Xs=Es.splice,Ys=go(Ys=e.Uint8Array)&&Ys,qs=go(qs=e.WeakMap)&&qs,Ks=function(){try{var t=go(t=e.Float64Array)&&t,i=new t(new Bs(10),0,1)&&t}catch(n){}return i}(),Zs=go(Zs=ms.isArray)&&Zs,Qs=go(Qs=bs.create)&&Qs,Js=e.isFinite,$s=go($s=bs.keys)&&$s,ea=ys.max,ta=ys.min,ia=go(ia=gs.now)&&ia,na=go(na=xs.isFinite)&&na,ra=e.parseInt,oa=ys.random,sa=xs.NEGATIVE_INFINITY,aa=xs.POSITIVE_INFINITY,ha=ys.pow(2,32)-1,ca=ha-1,ua=ha>>>1,la=Ks?Ks.BYTES_PER_ELEMENT:0,fa=ys.pow(2,53)-1,pa=qs&&new qs,da={},ma=t.support={};!function(){ma.funcDecomp=/\bthis\b/.test(function(){return this}),ma.funcNames="string"==typeof vs.name;try{ma.dom=11===Ss.createDocumentFragment().nodeType}catch(e){ma.dom=!1}try{ma.nonEnumArgs=!Gs.call(arguments,1)}catch(e){ma.nonEnumArgs=!0}}(0,0),t.templateSettings={escape:bt,evaluate:Tt,interpolate:wt,variable:"",imports:{_:t}};var ga=function(){function t(){}return function(i){if(fo(i)){t.prototype=i;var n=new t;t.prototype=null}return n||e.Object()}}(),_a=nn(Ei),va=nn(Ai,!0),ya=rn(),xa=rn(!0),ba=pa?function(e,t){return pa.set(e,t),e}:is;Fs||(Qi=Bs&&Ys?function(e){var t=e.byteLength,i=Ks?zs(t/la):0,n=i*la,r=new Bs(t);if(i){var o=new Ks(r,0,i);o.set(new Ks(e,0,i))}return t!=n&&(o=new Ys(r,n),o.set(new Ys(e,n))),r}:ts(null));var Ta=Qs&&js?function(e){return new Yt(e)}:ts(null),wa=pa?function(e){return pa.get(e)}:as,Ma=function(){return ma.funcNames?"constant"==ts.name?Bi("name"):function(e){for(var t=e.name,i=da[t],n=i?i.length:0;n--;){var r=i[n],o=r.func;if(null==o||o==e)return r.name}return t}:ts("")}(),Ea=function(){var e=0,t=0;return function(i,n){var r=Ya(),o=N-(r-t);if(t=r,o>0){if(++e>=k)return i}else e=0;return ba(i,n)}}(),Aa=$r(function(e,t){return sh(e)||oo(e)?vi(e,wi(t,!1,!0)):[]}),Pa=ln(),Sa=ln(!0),Ca=$r(function(e,t){e||(e=[]),t=wi(t);var i=t.length,r=pi(e,t);for(t.sort(n);i--;){var o=parseFloat(t[i]);if(o!=s&&Vn(o)){var s=o;Xs.call(e,o,1)}}return r}),Da=wn(),Ia=wn(!0),Ra=$r(function(e){return ji(wi(e,!1,!0))}),La=$r(function(e,t){return sh(e)||oo(e)?vi(e,t):[]}),Oa=$r(yr),Va=$r(function(e,t){var i=e?e.length:0;return kn(i)&&(e=Xn(e)),pi(e,wi(t))}),Ba=en(function(e,t,i){Is.call(e,i)?++e[i]:e[i]=1}),Fa=un(_a),ka=un(va,!0),Na=dn(Qt,_a),za=dn(ei,va),Ua=en(function(e,t,i){Is.call(e,i)?e[i].push(t):e[i]=[t]}),Wa=en(function(e,t,i){e[i]=t}),Ga=$r(function(e,t,i){var n=-1,r="function"==typeof t,o=e?e.length:0,s=kn(o)?ms(o):[];return _a(e,function(e){var o=r?t:null!=e&&e[t];s[++n]=o?o.apply(e,i):E}),s}),ja=en(function(e,t,i){e[i?0:1].push(t)},function(){return[[],[]]}),Ha=yn(si,_a),Xa=yn(ai,va),Ya=ia||function(){return(new gs).getTime()},qa=$r(function(e,t,i){var n=P;if(i.length){var r=y(i,qa.placeholder);n|=R}return Mn(e,n,t,i,r)}),Ka=$r(function(e,t){t=t.length?wi(t):Ao(e);for(var i=-1,n=t.length;++i<n;){var r=t[i];e[r]=Mn(e[r],P,e)}return e}),Za=$r(function(e,t,i){var n=P|S;if(i.length){var r=y(i,Za.placeholder);n|=R}return Mn(t,n,e,i,r)}),Qa=hn(D),Ja=hn(I),$a=$r(function(e,t){return _i(e,1,t)}),eh=$r(function(e,t,i){return _i(e,t,i)}),th=pn(),ih=pn(!0),nh=vn(R),rh=vn(L),oh=$r(function(e,t){return Mn(e,V,null,null,null,wi(t))}),sh=Zs||function(e){return _(e)&&kn(e.length)&&Ls.call(e)==X};ma.dom||(ho=function(e){return!!e&&1===e.nodeType&&_(e)&&!ch(e)});var ah=na||function(e){return"number"==typeof e&&Js(e)},hh=s(/x/)||Ys&&!s(Ys)?function(e){return Ls.call(e)==Z}:s,ch=Us?function(e){if(!e||Ls.call(e)!=$)return!1;var t=e.valueOf,i=go(t)&&(i=Us(t))&&Us(i);return i?e==i||Us(e)==i:jn(e)}:jn,uh=tn(fi),lh=$r(function(e){var t=e[0];return null==t?t:(e.push(ui),uh.apply(E,e))}),fh=fn(Ei),ph=fn(Ai),dh=mn(ya),mh=mn(xa),gh=gn(Ei),_h=gn(Ai),vh=$s?function(e){if(e)var t=e.constructor,i=e.length;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&i&&kn(i)?Hn(e):fo(e)?$s(e):[]}:Hn,yh=tn(Oi),xh=$r(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=ni(wi(t),ws);return Un(e,vi(Co(e),t))}var i=Zi(t[0],t[1],3);return Wn(e,function(e,t,n){return!i(e,t,n)})}),bh=$r(function(e,t){return null==e?{}:"function"==typeof t[0]?Wn(e,Zi(t[0],t[1],3)):Un(e,wi(t))}),Th=sn(function(e,t,i){return t=t.toLowerCase(),e+(i?t.charAt(0).toUpperCase()+t.slice(1):t)}),wh=sn(function(e,t,i){return e+(i?"-":"")+t.toLowerCase()}),Mh=_n(),Eh=_n(!0);8!=ra(Vt+"08")&&(jo=function(e,t,i){return(i?Bn(e,t,i):null==t)?t=0:t&&(t=+t),e=qo(e),ra(e,t||(Pt.test(e)?16:10))});var Ah=sn(function(e,t,i){return e+(i?"_":"")+t.toLowerCase()}),Ph=sn(function(e,t,i){return e+(i?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Sh=$r(function(e,t){try{return e.apply(E,t)}catch(i){return lo(i)?i:new _s(i)}}),Ch=cn(ri),Dh=cn(oi,!0);return t.prototype=i.prototype,v.prototype=ga(i.prototype),v.prototype.constructor=v,Q.prototype=ga(i.prototype),Q.prototype.constructor=Q,Wt.prototype["delete"]=Gt,Wt.prototype.get=jt,Wt.prototype.has=Ht,Wt.prototype.set=Xt,Yt.prototype.push=Kt,Zr.Cache=Wt,t.after=Xr,t.ary=Yr,t.assign=uh,t.at=Va,t.before=qr,t.bind=qa,t.bindAll=Ka,t.bindKey=Za,t.callback=es,t.chain=Tr,t.chunk=Kn,t.compact=Zn,t.constant=ts,t.countBy=Ba,t.create=Eo,t.curry=Qa,t.curryRight=Ja,t.debounce=Kr,t.defaults=lh,t.defer=$a,t.delay=eh,t.difference=Aa,t.drop=Qn,t.dropRight=Jn,t.dropRightWhile=$n,t.dropWhile=er,t.fill=tr,t.filter=Rr,t.flatten=nr,t.flattenDeep=rr,t.flow=th,t.flowRight=ih,t.forEach=Na,t.forEachRight=za,t.forIn=dh,t.forInRight=mh,t.forOwn=gh,t.forOwnRight=_h,t.functions=Ao,t.groupBy=Ua,t.indexBy=Wa,t.initial=sr,t.intersection=ar,t.invert=So,t.invoke=Ga,t.keys=vh,t.keysIn=Co,t.map=Vr,t.mapValues=Do,t.matches=ns,t.matchesProperty=rs,t.memoize=Zr,t.merge=yh,t.mixin=os,t.negate=Qr,t.omit=xh,t.once=Jr,t.pairs=Io,t.partial=nh,t.partialRight=rh,t.partition=ja,t.pick=bh,t.pluck=Br,t.property=hs,t.propertyOf=cs,t.pull=ur,t.pullAt=Ca,t.range=us,t.rearg=oh,t.reject=Fr,t.remove=lr,t.rest=fr,t.restParam=$r,t.shuffle=Nr,t.slice=pr,t.sortBy=Wr,t.sortByAll=Gr,t.sortByOrder=jr,t.spread=eo,t.take=dr,t.takeRight=mr,t.takeRightWhile=gr,t.takeWhile=_r,t.tap=wr,t.throttle=to,t.thru=Mr,t.times=ls,t.toArray=wo,t.toPlainObject=Mo,t.transform=Lo,t.union=Ra,t.uniq=vr,t.unzip=yr,t.values=Oo,t.valuesIn=Vo,t.where=Hr,t.without=La,t.wrap=io,t.xor=xr,t.zip=Oa,t.zipObject=br,t.backflow=ih,t.collect=Vr,t.compose=ih,t.each=Na,t.eachRight=za,t.extend=uh,t.iteratee=es,t.methods=Ao,t.object=br,t.select=Rr,t.tail=fr,t.unique=vr,os(t,t),t.add=ps,t.attempt=Sh,t.camelCase=Th,t.capitalize=ko,t.clone=no,t.cloneDeep=ro,t.deburr=No,t.endsWith=zo,t.escape=Uo,t.escapeRegExp=Wo,t.every=Ir,t.find=Fa,t.findIndex=Pa,t.findKey=fh,t.findLast=ka,t.findLastIndex=Sa,t.findLastKey=ph,t.findWhere=Lr,t.first=ir,t.has=Po,t.identity=is,t.includes=Or,t.indexOf=or,t.inRange=Bo,t.isArguments=oo,t.isArray=sh,t.isBoolean=so,t.isDate=ao,t.isElement=ho,t.isEmpty=co,t.isEqual=uo,t.isError=lo,t.isFinite=ah,t.isFunction=hh,t.isMatch=po,t.isNaN=mo,t.isNative=go,t.isNull=_o,t.isNumber=vo,t.isObject=fo,t.isPlainObject=ch,t.isRegExp=yo,t.isString=xo,t.isTypedArray=bo,t.isUndefined=To,t.kebabCase=wh,t.last=hr,t.lastIndexOf=cr,t.max=Ch,t.min=Dh,t.noConflict=ss,t.noop=as,t.now=Ya,t.pad=Go,t.padLeft=Mh,t.padRight=Eh,t.parseInt=jo,t.random=Fo,t.reduce=Ha,t.reduceRight=Xa,t.repeat=Ho,t.result=Ro,t.runInContext=M,t.size=zr,t.snakeCase=Ah,t.some=Ur,t.sortedIndex=Da,t.sortedLastIndex=Ia,t.startCase=Ph,t.startsWith=Xo,t.sum=ds,t.template=Yo,t.trim=qo,t.trimLeft=Ko,t.trimRight=Zo,t.trunc=Qo,t.unescape=Jo,t.uniqueId=fs,t.words=$o,t.all=Ir,t.any=Ur,t.contains=Or,t.detect=Fa,t.foldl=Ha,t.foldr=Xa,t.head=ir,t.include=Or,t.inject=Ha,os(t,function(){var e={};return Ei(t,function(i,n){t.prototype[n]||(e[n]=i)}),e}(),!1),t.sample=kr,t.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return kr(t,e)}):kr(this.value())},t.VERSION=A,Qt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){t[e].placeholder=t}),Qt(["dropWhile","filter","map","takeWhile"],function(e,t){var i=t!=W,n=t==z;Q.prototype[e]=function(e,r){var o=this.__filtered__,s=o&&n?new Q(this):this.clone(),a=s.__iteratees__||(s.__iteratees__=[]);return a.push({done:!1,count:0,index:0,iteratee:Cn(e,r,1),limit:-1,type:t}),s.__filtered__=o||i,s}}),Qt(["drop","take"],function(e,t){var i=e+"While";Q.prototype[e]=function(i){var n=this.__filtered__,r=n&&!t?this.dropWhile():this.clone();if(i=null==i?1:ea(zs(i)||0,0),n)t?r.__takeCount__=ta(r.__takeCount__,i):hr(r.__iteratees__).limit=i;else{var o=r.__views__||(r.__views__=[]);o.push({size:i,type:e+(r.__dir__<0?"Right":"")})}return r},Q.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},Q.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[i](e,t).reverse()}}),Qt(["first","last"],function(e,t){var i="take"+(t?"Right":"");Q.prototype[e]=function(){return this[i](1).value()[0]}}),Qt(["initial","rest"],function(e,t){var i="drop"+(t?"":"Right");Q.prototype[e]=function(){return this[i](1)}}),Qt(["pluck","where"],function(e,t){var i=t?"filter":"map",n=t?Ri:Bi;Q.prototype[e]=function(e){return this[i](n(e))}}),Q.prototype.compact=function(){return this.filter(is)},Q.prototype.reject=function(e,t){return e=Cn(e,t,1),this.filter(function(t){return!e(t)})},Q.prototype.slice=function(e,t){e=null==e?0:+e||0;var i=0>e?this.takeRight(-e):this.drop(e);return"undefined"!=typeof t&&(t=+t||0,i=0>t?i.dropRight(-t):i.take(t-e)),i},Q.prototype.toArray=function(){return this.drop(0)},Ei(Q.prototype,function(e,i){var n=t[i];if(n){var r=/^(?:filter|map|reject)|While$/.test(i),o=/^(?:first|last)$/.test(i);t.prototype[i]=function(){var i=arguments,s=(i.length,this.__chain__),a=this.__wrapped__,h=!!this.__actions__.length,c=a instanceof Q,u=i[0],l=c||sh(a);l&&r&&"function"==typeof u&&1!=u.length&&(c=l=!1);var f=c&&!h;if(o&&!s)return f?e.call(a):n.call(t,this.value());var p=function(e){var r=[e];return Ws.apply(r,i),n.apply(t,r)};if(l){var d=f?a:new Q(this),m=e.apply(d,i);if(!o&&(h||m.__actions__)){var g=m.__actions__||(m.__actions__=[]);g.push({func:Mr,args:[p],thisArg:t})}return new v(m,s)}return this.thru(p)}}}),Qt(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(e){var i=(/^(?:replace|split)$/.test(e)?Ps:Es)[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:join|pop|replace|shift)$/.test(e);t.prototype[e]=function(){var e=arguments;return r&&!this.__chain__?i.apply(this.value(),e):this[n](function(t){return i.apply(t,e)})}}),Ei(Q.prototype,function(e,i){var n=t[i];if(n){var r=n.name,o=da[r]||(da[r]=[]);o.push({name:i,func:n})}}),da[xn(null,S).name]=[{name:"wrapper",func:null}],Q.prototype.clone=tt,Q.prototype.reverse=nt,Q.prototype.value=Ut,t.prototype.chain=Er,t.prototype.commit=Ar,t.prototype.plant=Pr,t.prototype.reverse=Sr,t.prototype.toString=Cr,t.prototype.run=t.prototype.toJSON=t.prototype.valueOf=t.prototype.value=Dr,t.prototype.collect=t.prototype.map,t.prototype.head=t.prototype.first,t.prototype.select=t.prototype.filter,t.prototype.tail=t.prototype.rest,t}var E,A="3.6.0",P=1,S=2,C=4,D=8,I=16,R=32,L=64,O=128,V=256,B=30,F="...",k=150,N=16,z=0,U=1,W=2,G="Expected a function",j="__lodash_placeholder__",H="[object Arguments]",X="[object Array]",Y="[object Boolean]",q="[object Date]",K="[object Error]",Z="[object Function]",Q="[object Map]",J="[object Number]",$="[object Object]",et="[object RegExp]",tt="[object Set]",it="[object String]",nt="[object WeakMap]",rt="[object ArrayBuffer]",ot="[object Float32Array]",st="[object Float64Array]",at="[object Int8Array]",ht="[object Int16Array]",ct="[object Int32Array]",ut="[object Uint8Array]",lt="[object Uint8ClampedArray]",ft="[object Uint16Array]",pt="[object Uint32Array]",dt=/\b__p \+= '';/g,mt=/\b(__p \+=) '' \+/g,gt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,_t=/&(?:amp|lt|gt|quot|#39|#96);/g,vt=/[&<>"'`]/g,yt=RegExp(_t.source),xt=RegExp(vt.source),bt=/<%-([\s\S]+?)%>/g,Tt=/<%([\s\S]+?)%>/g,wt=/<%=([\s\S]+?)%>/g,Mt=/[\u0300-\u036f\ufe20-\ufe23]/g,Et=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,At=/\w*$/,Pt=/^0[xX]/,St=/^\[object .+?Constructor\]$/,Ct=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Dt=/($^)/,It=/[.*+?^${}()|[\]\/\\]/g,Rt=RegExp(It.source),Lt=/['\n\r\u2028\u2029\\]/g,Ot=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),Vt=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",Bt=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window"],Ft=-1,kt={};kt[ot]=kt[st]=kt[at]=kt[ht]=kt[ct]=kt[ut]=kt[lt]=kt[ft]=kt[pt]=!0,kt[H]=kt[X]=kt[rt]=kt[Y]=kt[q]=kt[K]=kt[Z]=kt[Q]=kt[J]=kt[$]=kt[et]=kt[tt]=kt[it]=kt[nt]=!1;var Nt={};Nt[H]=Nt[X]=Nt[rt]=Nt[Y]=Nt[q]=Nt[ot]=Nt[st]=Nt[at]=Nt[ht]=Nt[ct]=Nt[J]=Nt[$]=Nt[et]=Nt[it]=Nt[ut]=Nt[lt]=Nt[ft]=Nt[pt]=!0,Nt[K]=Nt[Z]=Nt[Q]=Nt[tt]=Nt[nt]=!1;var zt={leading:!1,maxWait:0,trailing:!1},Ut={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Gt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},jt={"function":!0,object:!0},Ht={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Xt=jt[typeof i]&&i&&!i.nodeType&&i,Yt=jt[typeof t]&&t&&!t.nodeType&&t,qt=Xt&&Yt&&"object"==typeof e&&e,Kt=jt[typeof self]&&self&&self.Object&&self,Zt=jt[typeof window]&&window&&window.Object&&window,Qt=Yt&&Yt.exports===Xt&&Xt,Jt=qt||Zt!==(this&&this.window)&&Zt||Kt||this,$t=M();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Jt._=$t,define(function(){return $t})):Xt&&Yt?Qt?(Yt.exports=$t)._=$t:Xt._=$t:Jt._=$t}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);